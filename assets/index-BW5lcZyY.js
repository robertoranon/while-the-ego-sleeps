(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const Ar=1/2**32;class ml{float(e=1){return this.int()*Ar*e}probability(e){return this.float()<e}norm(e=1){return(this.int()*Ar-.5)*2*e}normMinMax(e,n){const s=this.minmax(e,n);return this.float()<.5?s:-s}minmax(e,n){return this.float()*(n-e)+e}minmaxInt(e,n){e|=0;const s=(n|0)-e;return s?e+this.int()%s:e}minmaxUint(e,n){e>>>=0;const s=(n>>>0)-e;return s?e+this.int()%s:e}}class Jt extends ml{constructor(e){super(),this.rnd=e}float(e=1){return this.rnd()*e}norm(e=1){return(this.rnd()-.5)*2*e}int(){return this.rnd()*4294967296>>>0}}const de=new Jt(Math.random),w=(t,e=de,n=0,s=t.length)=>t[e.minmax(n,s)|0],pl=(t,e=de)=>w(Object.keys(t),e),En=(t,e=n=>n!==void 0?": "+n:"")=>class extends Error{origMessage;constructor(n){super(t(n)+e(n)),this.origMessage=n!==void 0?String(n):""}},bl={};var wr={};const _l=En(()=>"Assertion failed"),M=(typeof process<"u"&&wr!==void 0?wr.UMBRELLA_ASSERTS:!bl)?(t,e)=>{if(typeof t=="function"&&!t()||!t)throw new _l(typeof e=="function"?e():e)}:()=>{},vl=(t,e,n=de)=>{const s=t.length;M(s>0,"no choices given");const i=e?t.map((o,a)=>[e[a]||0,o]).sort((o,a)=>a[0]-o[0]):t.map(o=>[1,o]),r=i.reduce((o,a)=>o+a[0],0);return r<=0&&console.warn("total weights <= 0"),()=>{const o=n.float(r);let a=r;for(let c=0;c<s;c++)if(a-=i[c][0],a<=o)return i[c][1]}};let wt=20;const yl=En(()=>"unsupported operation"),Et=t=>{throw new yl(t)},G=(t=1,e,...n)=>{const s=[,,].concat(n),i=(...r)=>{const o=s[r[t].length]||e;return o?o(...r):Et(`no impl for vec size ${r[t].length}`)};return i.add=(r,o)=>s[r]=o,i.default=r=>e=r,i.impl=r=>r!=null&&s[r]||e,i},Ge=(t,e=1,n=!0)=>{const s=n?(a,c,l)=>{!a&&(a=c);for(let u=c.length;u-- >0;)a[u]=t(c[u],l[u]);return a}:(a,c,l)=>{!a&&(a=l);for(let u=c.length;u-- >0;)a[u]=t(c[u],l[u]);return a},i=n?(a,c,l)=>(!a&&(a=c),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a):(a,c,l)=>(!a&&(a=l),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a),r=n?(a,c,l)=>(!a&&(a=c),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a):(a,c,l)=>(!a&&(a=l),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a),o=n?(a,c,l)=>(!a&&(a=c),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a[3]=t(c[3],l[3]),a):(a,c,l)=>(!a&&(a=l),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a[3]=t(c[3],l[3]),a);return[G(e,s,i,r,o),i,r,o]},Vo=(t,e)=>t+e,Al=(t,e)=>t/e,Yo=(t,e,n)=>t*e+n,Wo=(t,e,n)=>t+(e-t)*n,jo=(t,e)=>t*e,Xo=(t,e)=>t-e,wl=(t,e,n)=>(t-e)*n,[El,Rl,Sl,$m]=Ge(Vo),Tt=El,tt=Rl,Ae=Sl,ms=(t,e=1)=>{const n=(o,a,c)=>{!o&&(o=a);for(let l=a.length;l-- >0;)o[l]=t(a[l],c);return o},s=(o,a,c)=>(!o&&(o=a),o[0]=t(a[0],c),o[1]=t(a[1],c),o),i=(o,a,c)=>(!o&&(o=a),o[0]=t(a[0],c),o[1]=t(a[1],c),o[2]=t(a[2],c),o),r=(o,a,c)=>(!o&&(o=a),o[0]=t(a[0],c),o[1]=t(a[1],c),o[2]=t(a[2],c),o[3]=t(a[3],c),o);return[G(e,n,s,i,r),s,i,r]},[Cm,Il,Ml,Om]=ms(Vo),xo=Il,Nl=Ml,Er=-1/0,Rr=1/0,Dl=Object.freeze([Er,Er]),$l=Object.freeze([Rr,Rr]),pt=Object.freeze([0,0]),Cl=Object.freeze([1,0]),bt=Object.freeze([0,0,0]),Xt=Object.freeze([0,0,0,0]),Ol=(t,e=1)=>{const n=(o,a,c,l)=>{!o&&(o=a);for(let u=a.length;u-- >0;)o[u]=t(a[u],c,l[u]);return o},s=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c,l[0]),o[1]=t(a[1],c,l[1]),o),i=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c,l[0]),o[1]=t(a[1],c,l[1]),o[2]=t(a[2],c,l[2]),o),r=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c,l[0]),o[1]=t(a[1],c,l[1]),o[2]=t(a[2],c,l[2]),o[3]=t(a[3],c,l[3]),o);return[G(e,n,s,i,r),s,i,r]},[Ll,Tl,kl,Lm]=Ol(Yo),en=Ll,Xn=Tl,Xs=kl,[Bl,Pl,Gl,Tm]=Ge(Math.max),xs=Bl,xn=Pl,Sr=Gl,z=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t),Ot=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t),oe=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t),Rt=G(1,(t,e)=>{!t&&(t=[]);for(let n=e.length;n-- >0;)t[n]=e[n];return t},z,Ot,oe),y=t=>typeof t=="number",Ir=Object.getPrototypeOf,Bt=t=>{let e;return t!=null&&typeof t=="object"&&((e=Ir(t))===null||Ir(e)===null)},Ul=(t,e=0)=>new Array(t).fill(e),Li=t=>{if(t.length){const e=t[t.length-1];return Bt(e)?t.pop():(e==null&&t.pop(),void 0)}},Fl=t=>{const e=Li(t);return t.length?t.length===2?[t[0],t[1],e]:[void 0,t[0],e]:[void 0,void 0,e]},zl=t=>{const e=Li(t);return t.length?t.length===2?[t[0],t[1],e]:y(t[0])?[void 0,t[0],e]:[t[0],void 0,e]:[void 0,void 0,e]},K=(t,e=2)=>y(t)?Ul(e,t):t,Hl=t=>t instanceof Set,ct=(t,e)=>typeof t?.[e]=="function",ql=t=>Hl(t)?t:new Set(t),Vl=(t,e)=>{const n=ql(e),s={};for(let i in t)t.hasOwnProperty(i)&&!n.has(i)&&(s[i]=t[i]);return s},Ti=t=>ct(t,"copy")?t.copy():Rt([],t),ki=t=>t.map(Ti),E=(t,...e)=>t?e.length?Vl({...t},e):{...t}:void 0,Xe=t=>E(t.attribs,"__samples"),Yt=(t,e,n)=>new t(n||ki(e.points),E(e.attribs));class Ce{constructor(e=[0,0,0],n=1,s){this.pos=e,this.attribs=s,this.size=Sr(null,K(n,3),bt)}type="aabb";dim=3;size;copy(){return new Ce(Ot([],this.pos),Ot([],this.size),E(this.attribs))}withAttribs(e){return new Ce(this.pos,this.size,e)}min(){return Ot([],this.pos)}max(){return Ae([],this.pos,this.size)}offset(e){const n=Xs([],this.size,.5,this.pos);return Sr(null,Nl(null,this.size,e*2),bt),Xs(this.pos,this.size,-.5,n),this}toHiccup(){return["aabb",this.attribs,this.pos,this.size]}}const I=Array.isArray,ps=t=>t!=null&&typeof t!="function"&&t.length!==void 0,Yl=En(()=>"illegal argument(s)"),lt=t=>{throw new Yl(t)},Wl=t=>((t==null||!t[Symbol.iterator])&&lt(`value is not iterable: ${t}`),t),Zo=t=>I(t)?t:[...Wl(t)];class bs{constructor(e,n){this.attribs=n,this.points=e?Zo(e):[]}points;*[Symbol.iterator](){yield*this.points}clear(){this.points.length=0}}const Mr=Object.getPrototypeOf({}),Ln="function",Nr="string",ut=(t,e)=>{let n;if(t===e)return!0;if(t!=null){if(typeof t.equiv===Ln)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===Ln)return e.equiv(t)}else return t==e;return typeof t===Nr||typeof e===Nr?!1:(n=Object.getPrototypeOf(t),(n==null||n===Mr)&&(n=Object.getPrototypeOf(e),n==null||n===Mr)?xl(t,e):typeof t!==Ln&&t.length!==void 0&&typeof e!==Ln&&e.length!==void 0?Bi(t,e):t instanceof Set&&e instanceof Set?jl(t,e):t instanceof Map&&e instanceof Map?Xl(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},Bi=(t,e,n=ut)=>{let s=t.length;if(s===e.length)for(;s-- >0&&n(t[s],e[s]););return s<0},jl=(t,e,n=ut)=>t.size===e.size&&n([...t.keys()].sort(),[...e.keys()].sort()),Xl=(t,e,n=ut)=>t.size===e.size&&n([...t].sort(),[...e].sort()),xl=(t,e,n=ut)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let s in t)if(!e.hasOwnProperty(s)||!n(t[s],e[s]))return!1;return!0},it=Math.PI,L=it*2,Vn=it/2;let U=1e-6;const Pi=(t,e=1)=>[Math.cos(t)*e,Math.sin(t)*e],Zl=t=>(t%=L,t<0?L+t:t),Jl=t=>(t=Math.abs(t),t>it?L-t:t),ft=(t,e,n)=>t<e?e:t>n?n:t,A=t=>t<0?0:t>1?1:t,Jo=(t,e,n)=>t>=e&&t<=n,Gi=(t,e,n)=>n!==e?(t-e)/(n-e):0,nt=(t,e,n,s,i)=>s+(i-s)*Gi(t,e,n),Zn=(t,e,n,s,i)=>s+(i-s)*A(Gi(t,e,n)),Kl=(t,e,n)=>e+(n-e)*A(t),[Ql,tu,eu,km]=Ge(jo),nu=Ql,X=tu,He=eu,su=(t,e)=>(n,s,i)=>{n?n!==s&&Rt(n,s):n=s;const r=Math.sin(i),o=Math.cos(i),a=s[t],c=s[e];return n[t]=a*o-c*r,n[e]=a*r+c*o,n},Ko=su(0,1),Ui=Ko,Qo=(t,e,n,s,i=[])=>tt(null,Ko(null,X(i,Pi(s),e),n),t),[iu,ru,ou,Bm]=ms(jo),_s=iu,Ee=ru,Zs=ou,au=(t,e,n,s,i,r,o)=>(!t&&(t=e),en(t,s,o,en(t,n,r,_s(t,e,i)))),cu=(t,e,n,s,i,r,o,a,c)=>(!t&&(t=e),en(t,i,c,en(t,s,a,en(t,n,o,_s(t,e,r))))),lu=(t,e,n,s,i,r)=>{const o=1-r,a=o*o,c=r*r;return cu(t,e,n,s,i,a*o,3*a*r,3*c*o,c*r)},uu=(t,e)=>{const n=Li(e);return new t(e.length===1?e[0]:e,n)},fu=(t,e)=>M(t===e,`require ${e} points`);class Oe{constructor(e=[0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}type="circle";dim=2;copy(){return new Oe(z([],this.pos),this.r,E(this.attribs))}withAttribs(e){return new Oe(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class qt extends bs{type="poly";dim=2;add(...e){this.points.push(...e)}copy(){return Yt(qt,this)}copyTransformed(e){return Yt(qt,this,e(this.points))}withAttribs(e){return new qt(this.points,e)}toHiccup(){return["polygon",this.attribs,this.points]}}class Le{constructor(e=[0,0],n=[1,1],s){this.pos=e,this.attribs=s,this.r=K(n)}type="ellipse";dim=2;r;copy(){return new Le(z([],this.pos),z([],this.r),E(this.attribs))}withAttribs(e){return new Le(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class nn{constructor(e,n){this.attribs=e,this.children=n?Zo(n):[]}type="group";dim=2;children;*[Symbol.iterator](){yield*this.children}add(...e){return this.children.push(...e),this}clear(){this.children.length=0}copy(){return this.copyTransformed(e=>e.copy())}copyTransformed(e){return new nn(E(this.attribs),this.children.map(e))}withAttribs(e){return new nn(e,this.children)}equiv(e){return e instanceof nn&&ut(this.attribs,e.attribs)&&ut(this.children,e.children)}toHiccup(){return["g",this.attribs,...this.children.map(e=>e.toHiccup())]}}const Dr=(t,e)=>y(t)?[t,0,!1]:[t.theta?Math.floor(L/t.theta):t.dist?Math.floor(L/(t.dist/e)):t.num||wt,(t.start||0)*L,t.last===!0],ht=(t,e)=>{if(e){const n=e.__samples;return y(t)?y(n)?n:{num:t,...n}:y(n)?{...t,num:n}:{...t,...n}}return t},du=(t,e)=>t[0]===e[0]?["V",e[1]]:t[1]===e[1]?["H",e[0]]:["L",e];class sn extends bs{type="line";dim=2;constructor(e,n){super(e,n),fu(this.points.length,2)}copy(){return Yt(sn,this)}copyTransformed(e){return Yt(sn,this,e(this.points))}withAttribs(e){return new sn(this.points,e)}toHiccup(){return[this.type,this.attribs,this.points[0],this.points[1]]}toHiccupPathSegments(){return[du(this.points[0],this.points[1])]}}const ta=t=>t[t.length-1],Jn=t=>t,Ue=t=>typeof t?.[Symbol.iterator]=="function",Rn=(t,e)=>[t[0],t[1],e];class un{value;constructor(e){this.value=e}deref(){return this.value}}const $r=t=>new un(t),kt=t=>t instanceof un,hu=t=>t instanceof un?t:new un(t),fn=t=>t instanceof un?t.deref():t,gu=()=>t=>{const e=t[2];return Rn(t,(n,s)=>{if(s){for(let i of fn(s)||[])if(n=e(n,i),kt(n))break}return kt(s)?hu(n):n})},mu=En(()=>"illegal arity"),Fi=t=>{throw new mu(t)};function ea(...t){let[e,n,s,i,r,o,a,c,l,u]=t;switch(t.length){case 0:Fi(0);case 1:return e;case 2:return(...d)=>e(n(...d));case 3:return(...d)=>e(n(s(...d)));case 4:return(...d)=>e(n(s(i(...d))));case 5:return(...d)=>e(n(s(i(r(...d)))));case 6:return(...d)=>e(n(s(i(r(o(...d))))));case 7:return(...d)=>e(n(s(i(r(o(a(...d)))))));case 8:return(...d)=>e(n(s(i(r(o(a(c(...d))))))));case 9:return(...d)=>e(n(s(i(r(o(a(c(l(...d)))))))));case 10:default:const f=(...d)=>e(n(s(i(r(o(a(c(l(u(...d))))))))));return t.length===10?f:ea(f,...t.slice(10))}}const vs=t=>ct(t,"xform")?t.xform():t;function Sn(...t){return t=t.map(vs),ea.apply(null,t)}const Z=Symbol(),Cr=()=>{},pu=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:Fi(t.length);function dn(...t){const e=t[0],n=e[0],s=e[1],i=e[2];t=pu(t);const r=t[0]==null?n():t[0],o=t[1];return fn(s(ct(o,"$reduce")?o.$reduce(i,r):ps(o)?bu(i,r,o):_u(i,r,o)))}const bu=(t,e,n)=>{for(let s=0,i=n.length;s<i;s++)if(e=t(e,n[s]),kt(e)){e=e.deref();break}return e},_u=(t,e,n)=>{for(let s of n)if(e=t(e,s),kt(e)){e=e.deref();break}return e},ys=(t,e)=>[t,Jn,e],vu=(t,e)=>{const n=e.length-1;return Ue(e[n])?e.length>1?dn(t.apply(null,e.slice(0,n)),e[n]):dn(t(),e[0]):void 0};function ae(t){return t?[...t]:ys(()=>[],(e,n)=>(e.push(n),e))}function*na(t,e){const n=vs(t)(ae()),s=n[1],i=n[2];for(let r of e){const o=i([],r);if(kt(o)){yield*fn(s(o.deref()));return}o.length&&(yield*o)}yield*fn(s([]))}function*As(t,e){const n=vs(t)([Cr,Cr,(s,i)=>i])[2];for(let s of e){let i=n(Z,s);if(kt(i)){i=fn(i.deref()),i!==Z&&(yield i);return}i!==Z&&(yield i)}}const yu=(t,e,n=As)=>{const s=e.length-1;return Ue(e[s])?e.length>1?n(t.apply(null,e.slice(0,s)),e[s]):n(t(),e[0]):void 0};function H(t,e){return Ue(e)?As(H(t),e):n=>{const s=n[2];return Rn(n,(i,r)=>s(i,t(r)))}}function Kn(t,e){return Ue(e)?na(Kn(t),e):Sn(H(t),gu())}class rn extends bs{type="points";dim=2;copy(){return Yt(rn,this)}copyTransformed(e){return Yt(rn,this,e(this.points))}withAttribs(e){return new rn(this.points,e)}toHiccup(){return[this.type,this.attribs,this.points]}}class ce extends bs{type="poly3";dim=3;add(...e){this.points.push(...e)}copy(){return Yt(ce,this)}copyTransformed(e){return Yt(ce,this,e(this.points))}withAttribs(e){return new ce(this.points,e)}toHiccup(){return["polygon3",this.attribs,this.points]}}class hn{constructor(e,n,s){this.pos=e,this.dir=n,this.attribs=s}type="ray";dim=2;copy(){return new hn(z([],this.pos),z([],this.dir),E(this.attribs))}withAttribs(e){return new hn(this.pos,this.dir,e)}toHiccup(){return["line",this.attribs,this.pos,Xn([],this.dir,1e6,this.pos)]}}class gn{constructor(e,n,s){this.pos=e,this.dir=n,this.attribs=s}type="ray3";dim=3;copy(){return new gn(Ot([],this.pos),Ot([],this.dir),E(this.attribs))}withAttribs(e){return new gn(this.pos,this.dir,e)}toHiccup(){return["line3",this.attribs,this.pos,Xs([],this.dir,1e6,this.pos)]}}class V{constructor(e=[0,0],n=1,s){this.pos=e,this.attribs=s,this.size=xn(null,K(n),pt)}type="rect";dim=2;size;copy(){return new V(z([],this.pos),z([],this.size),E(this.attribs))}withAttribs(e){return new V(this.pos,this.size,e)}min(){return z([],this.pos)}max(){return tt([],this.pos,this.size)}offset(e){const n=Xn([],this.size,.5,this.pos);return xn(null,xo(null,this.size,e*2),pt),Xn(this.pos,this.size,-.5,n),this}toHiccup(){return[this.type,this.attribs,this.pos,this.size[0],this.size[1]]}}class mn{constructor(e=[0,0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}type="sphere";dim=3;copy(){return new mn(Ot([],this.pos),this.r,E(this.attribs))}withAttribs(e){return new mn(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class pn{constructor(e,n,s){this.pos=e,this.body=n,this.attribs=s}type="text";dim=2;copy(){return new pn(Rt([],this.pos),this.body,E(this.attribs))}withAttribs(e){return new pn(this.pos,this.body,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.body]}}const[Au,wu,Pm,Gm]=Ge(Math.min),Js=Au,sa=wu,[Eu,Ru,Su,Um]=Ge(Xo),fe=Eu,Qn=Ru,Iu=Su,[Fm,Mu,zm,Hm]=ms(Xo),Or=Mu,Nu=(t,e,n)=>new Ce(t,Iu([],e,t),n),Du=(t,e,n,s)=>Nu(t,e,s).offset(n),ia=(t,e=1)=>{const n=(o,a)=>{!o&&(o=a);for(let c=a.length;c-- >0;)o[c]=t(a[c]);return o},s=(o,a)=>(!o&&(o=a),o[0]=t(a[0]),o[1]=t(a[1]),o),i=(o,a)=>(!o&&(o=a),o[0]=t(a[0]),o[1]=t(a[1]),o[2]=t(a[2]),o),r=(o,a)=>(!o&&(o=a),o[0]=t(a[0]),o[1]=t(a[1]),o[2]=t(a[2]),o[3]=t(a[3]),o);return[G(e,n,s,i,r),s,i,r]},[qm,$u,Vm,Ym]=ia(Math.abs),Cu=$u,Q=(t,e,n,s)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t),T=(t,e,n,s,i)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t[3]=i,t),ra=(t,e)=>t[0]*e[1]-t[1]*e[0],oa=(t,e)=>t[0]*e[0]+t[1]*e[1],zi=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],Ou=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],Lu=G(0,(t,e)=>{let n=0;for(let s=t.length;s-- >0;)n+=t[s]*e[s];return n},oa,zi,Ou),aa=t=>t[0]*t[0]+t[1]*t[1],ca=t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2],Tu=t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3],Hi=G(0,t=>{let e=0;for(let n=t.length;n-- >0;)e+=t[n]*t[n];return e},aa,ca,Tu),In=t=>Math.sqrt(Hi(t)),Lr=(t,e,n=!1)=>{const s=Math.atan2(ra(t,e),oa(t,e));return n?Jl(s):s},[Wm,ku,jm,Xm]=Ge(Al),Tr=ku,Bu=Math.abs,yt=(t,e,n=U)=>Bu(t-e)<=n,la=(t,e,n=U)=>t.length===e.length&&yt(t[0],e[0],n)&&yt(t[1],e[1],n),Pu=(t,e,n=U)=>t.length===e.length&&yt(t[0],e[0],n)&&yt(t[1],e[1],n)&&yt(t[2],e[2],n),ua=(t,e,n=U)=>t.length===e.length&&yt(t[0],e[0],n)&&yt(t[1],e[1],n)&&yt(t[2],e[2],n)&&yt(t[3],e[3],n),xe=G(0,(t,e,n=U)=>ct(t,"eqDelta")?t.eqDelta(e,n):ct(e,"eqDelta")?e.eqDelta(t,n):Gu(t,e,t.length,n),la,Pu,ua),Gu=(t,e,n,s=U,i=0,r=0,o=1,a=1)=>{for(;n>0;n--,i+=o,r+=a)if(!yt(t[i],e[r],s))return!1;return!0},Uu=(t,e,n=U)=>{for(let s=e.length;s-- >0;)if(xe(t,e[s],n))return!0;return!1},[Fu,xm,Zm,Jm]=ia(t=>-t),zu=Fu,[Km,Hu,Qm,tp]=ms(Math.pow),qu=Hu,fa=(t,e=1)=>{const n=(o,a,c,l)=>{!o&&(o=a);for(let u=a.length;u-- >0;)o[u]=t(a[u],c[u],l);return o},s=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c[0],l),o[1]=t(a[1],c[1],l),o),i=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c[0],l),o[1]=t(a[1],c[1],l),o[2]=t(a[2],c[2],l),o),r=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c[0],l),o[1]=t(a[1],c[1],l),o[2]=t(a[2],c[2],l),o[3]=t(a[3],c[3],l),o);return[G(e,n,s,i,r),s,i,r]},[ep,Vu,np,sp]=fa(wl),Yu=Vu,Wu=(t,e,n,s=0,i=!1,r=!1)=>{const o=Cu([],n);if(la(t,e)||o[0]<U||o[1]<U)return;s%=L;const a=Yu([],t,e,.5),c=Math.cos(s),l=Math.sin(s),u=[c*a[0]+l*a[1],-l*a[0]+c*a[1]],[f,d]=qu([],u,2),h=f/(o[0]*o[0])+d/(o[1]*o[1]);h>1&&Ee(o,o,Math.sqrt(h));const[g,m]=o,_=g*g,b=m*m,v=Math.max(0,(_*b-_*d-b*f)/(_*d+b*f)),N=(i!==r?1:-1)*Math.sqrt(v),D=[N*(g*u[1]/m),N*(-(m*u[0])/g)],dt=[c*D[0]-l*D[1]+(t[0]+e[0])/2,l*D[0]+c*D[1]+(t[1]+e[1])/2],Ut=Tr(null,Qn([],u,D),o),Ns=Tr(null,Qn(null,zu([],u),D),o),On=Lr(Cl,Ut);let W=Lr(Ut,Ns);return!r&&W>0?W-=L:r&&W<0&&(W+=L),W%=L,{center:dt,r:o,axis:s,start:On,end:On+W,xl:i,cw:r}},ju=(t,e)=>Math.abs(t-e),Xu=(t,e=U)=>t>e?1:t<-e?-1:0,ne=(t,e,n)=>t+(e-t)*n,da=(t,e,n,s,i,r)=>{const o=1-i,a=1-r;return t*o*a+e*i*a+n*o*r+s*i*r},xu=(t,e,n,s,i)=>{const r=i*i,o=1-i,a=o*o;return t*a*o+e*3*a*i+n*3*r*o+s*r*i},Zu=(t,e,n,s,i)=>{const r=i-1,o=i*i,a=r*r,c=(1+2*i)*a,l=i*a,u=o*(3-2*i),f=o*r;return c*t+l*e+u*n+f*s},qe=(t,e,n,s,i)=>{s*=.5;const r=-.5*t+1.5*e-1.5*n+s,o=t-2.5*e+2*n-s,a=-.5*t+.5*n,c=e,l=i*i;return i*l*r+l*o+i*a+c},ha=(t,e,n,s,i,r,o,a,c,l,u,f,d,h,g,m,_,b)=>qe(qe(t,e,n,s,_),qe(i,r,o,a,_),qe(c,l,u,f,_),qe(d,h,g,m,_),b),kr=(t,e,n=.5,s=0,i=2)=>n*((e-t)/(i-s)),Ju=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1];return n*n+s*s},Ku=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1],i=t[2]-e[2];return n*n+s*s+i*i},Qu=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1],i=t[2]-e[2],r=t[3]-e[3];return n*n+s*s+i*i+r*r},Mn=G(0,(t,e)=>{let n=0;for(let s=t.length;s-- >0;){const i=t[s]-e[s];n+=i*i}return n},Ju,Ku,Qu),t0=(t,e)=>Math.sqrt(Mn(t,e)),[e0,ip,rp,op]=fa(Wo),ts=e0;function Ks(...t){return new Oe(...zl(t))}var _t=(t=>(t[t.FINE=0]="FINE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.SEVERE=4]="SEVERE",t[t.NONE=5]="NONE",t))(_t||{});let n0=0;class s0{constructor(e,n=_t.FINE,s){this.parent=s,this.id=e||`logger-${n0++}`,this.level=typeof n=="string"?_t[n]:n}id;level;addChild(e){return e.parent=this,e}enabled(e){return this.level<=e}fine(...e){this.log(_t.FINE,e)}debug(...e){this.log(_t.DEBUG,e)}info(...e){this.log(_t.INFO,e)}warn(...e){this.log(_t.WARN,e)}severe(...e){this.log(_t.SEVERE,e)}none(){}log(e,n){this.level<=e&&this.logEntry([e,this.id,Date.now(),...n])}}const ga=Object.freeze({level:_t.NONE,addChild(t){return t},childLogger:()=>ga,enabled:()=>!1,fine(){},debug(){},info(){},warn(){},severe(){},none(){},logEntry(){}});class qi extends s0{set(e){this.parent=e}childLogger(e,n){return new qi(e,n??this.level,this)}logEntry(e){this.parent.logEntry(e)}}const ma=new qi("root",_t.FINE,ga),i0=ma.childLogger("defmulti"),x=Symbol();function Pt(t,e,n){const s={},i=e?r0(e):{},r=(...o)=>{const a=t(...o),c=s[a]||Ze(s,i,a)||s[x];return c?c(...o):Et(`missing implementation for: "${a.toString()}"`)};return r.add=(o,a)=>(s[o]&&i0.warn(`overwriting '${o.toString()}' impl`),s[o]=a,!0),r.addAll=o=>{let a=!0;for(let c in o)a=r.add(c,o[c])&&a;return x in o&&r.setDefault(o[x]),a},r.setDefault=o=>r.add(x,o),r.remove=o=>s[o]?(delete s[o],!0):!1,r.callable=(...o)=>{const a=t(...o);return!!(s[a]||Ze(s,i,a)||s[x])},r.isa=(o,a)=>{let c=i[o];!c&&(i[o]=c=new Set),c.add(a)},r.impls=()=>{const o=new Map;for(let a in s)o.set(a,s[a]);for(let a in i){const c=Ze(s,i,a);c&&o.set(a,c)}return s[x]&&o.set(x,s[x]),o},r.implForID=o=>s[String(o)]||Ze(s,i,o)||s[x],r.rels=()=>i,r.parents=o=>i[o],r.ancestors=o=>new Set(pa([],i,o)),r.dependencies=function*(){for(let o in i)for(let a of i[o])yield[o,a];for(let o in s)!i[o]&&(yield[o,void 0])},n&&r.addAll(n),r}const Ze=(t,e,n)=>{const s=e[n];if(s)for(let i of s){let r=t[i]||Ze(t,e,i);if(r)return r}},pa=(t,e,n)=>{const s=e[n];if(s)for(let i of s)t.push(i),pa(t,e,i);return t},r0=t=>{const e={};for(let n in t){const s=t[n];e[n]=s instanceof Set?s:Array.isArray(s)?new Set(s):new Set([s])}return e},he=t=>t.type,o0=(t,e)=>(t[0]=e,t[1]=e,t),a0=(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t),c0=(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t[3]=e,t);G(0,(t,e)=>{for(let n=t.length;n-- >0;)t[n]=e;return t},o0,a0,c0);const l0=t=>Array(t).fill(0),u0=t=>ct(t,"empty")?t.empty():l0(t.length),Vi=(t,e,n)=>{const s=fe([],n,e),i=Hi(s);return i>1e-6?Lu(fe([],t,e),s)/i:void 0},ba=(t,e,n,s,i=!1,r=0)=>{const o=Vi(t,e,n);if(o!==void 0&&(!i||o>=r&&o<=1-r))return s=s||u0(t),o<=0?Rt(s,e):o>=1?Rt(s,n):ts(s,e,n,o)},f0=(t,e,n=!1,s=[])=>{if(!e.length)return;const i=[],r=e.length-1;let o=1/0,a,c;for(n?(a=r,c=0):(a=0,c=1);c<=r;a=c,c++)if(ba(t,e[a],e[c],i)){const l=Mn(t,i);l<o&&(o=l,Rt(s,i))}return o<1/0?s:void 0},Yi=(t,e,n)=>(s,i,r=1)=>{!s&&(s=i);const o=Math.sqrt(t(i));return o>=U?e(s,i,r/o):s!==i?n(s,i):s},Te=Yi(Hi,_s,Rt),d0=Yi(aa,Ee,z),h0=Yi(ca,Zs,Ot);class Wi{points;index;constructor(e,n=!1){n?(this.points=e.slice(),this.points.push(e[0])):this.points=e,this.buildIndex()}totalLength(){const e=this.index;return e?e[e.length-1]:0}pointAt(e){const n=this.points,s=n.length-1;if(s<0)return;if(s===0||e<=0)return n[0];if(e>=1)return n[s];const i=this.index,r=e*i[s];for(let o=1;o<=s;o++)if(i[o]>=r)return ts([],n[o-1],n[o],(r-i[o-1])/(i[o]-i[o-1]))}closestPoint(e){return f0(e,this.points)}closestT(e){const{index:n,points:s}=this,i=[],r=[];let o=1/0,a=-1;for(let c=0,l=n.length-1;c<l;c++)if(ba(e,s[c],s[c+1],i)){const u=Mn(e,i);u<o&&(o=u,a=c,Rt(r,i))}return a>=0?Kl(Vi(e,s[a],s[a+1])||0,n[a],n[a+1])/this.totalLength():void 0}segmentAt(e){let n=this.indexAt(e);if(n!==void 0)return n=Math.max(1,n),[this.points[n-1],this.points[n]]}tangentAt(e,n=1){const s=this.segmentAt(e);return s?Te(null,fe([],s[1],s[0]),n):void 0}splitAt(e){if(e<=0||e>=1)return[this.points];const n=this.pointAt(e);if(!n)return;const s=Math.max(1,this.indexAt(e)),i=this.points.slice(0,s),r=this.points.slice(s);return xe(i[s-1],n)||i.push(n),xe(r[0],n)||r.unshift(n),[i,r]}splitNear(e){const n=this.closestT(e);return n!==void 0?this.splitAt(n):void 0}extractRange(e,n){if(e>n){const c=e;e=n,n=c}const s=this.pointAt(e),i=this.pointAt(n);if(!(s&&i))return;const r=Math.max(1,this.indexAt(e)),o=Math.max(1,this.indexAt(n)),a=this.points.slice(r,o);return(!a.length||!xe(a[0],s))&&a.unshift(s),xe(a[a.length-1],i)||a.push(i),a}indexAt(e){const s=this.points.length-1;if(s<0)return;if(s===0||e<=0)return 0;if(e>=1)return s;const i=this.index,r=e*i[s];for(let o=1;o<=s;o++)if(i[o]>=r)return o}sampleUniform(e,n=!1,s=[]){const{index:i,points:r}=this,o=this.totalLength(),a=e/o,c=i.length;for(let l=0,u=1;l<1;l+=a){const f=l*o;for(;f>=i[u]&&u<c;)u++;if(u>=c)break;const d=i[u-1];s.push(ts([],r[u-1],r[u],(f-d)/(i[u]-d)))}return n&&s.push(Rt([],r[r.length-1])),s}sampleFixedNum(e,n=!1,s){return this.sampleUniform(this.totalLength()/e,n,s)}buildIndex(){const e=[0],n=this.points,s=n.length;for(let i=0,r=1;r<s;i=r,r++)e[r]=e[i]+t0(n[i],n[r]);this.index=e}}const Br=Math.cos,Pr=Math.sin,_a=G(1),g0=_a.add(2,(t,e,n=pt)=>tt(t||e,Pi(e[1],e[0]),n));_a.add(3,(t,e,n=bt)=>{const s=e[0],i=e[1],r=e[2],o=Br(i);return Q(t||e,s*o*Br(r)+n[0],s*o*Pr(r)+n[1],s*Pr(i)+n[2])});const va=(t,e,n,s,i,r)=>{if(Bt(r)&&r.dist!==void 0)return new Wi(va(t,e,n,s,i,r.num||wt)).sampleUniform(r.dist,r.last!==!1);r=y(r)?{num:r,last:!0}:{num:wt,...r};let o=i-s,a=r.theta?Math.round(o/r.theta):r.num;o/=a,r.last!==!1&&a++;const c=new Array(a);for(let l=0;l<a;l++)c[l]=Qo(t,e,n,s+l*o);return c},Gr=(t,e,n=!1,s=!1)=>{if(m0(e)){const i=new Wi(t,n);return Bt(e)?n?e.dist?i.sampleUniform(e.dist,e.last):i.sampleFixedNum(e.num||wt,e.last):e.dist?i.sampleUniform(e.dist,e.last!==!1):i.sampleFixedNum(e.num||wt,e.last!==!1):i.sampleFixedNum(e||wt,!n)}return s?ki(t):t},m0=t=>t!==void 0&&(y(t)||t.dist!=null||t.last!=null||t.num!=null),ya=t=>function e(n,s){if(Bt(s)&&s.dist!==void 0)return new Wi(e(n,s.num||wt)).sampleUniform(s.dist,s.last!==!1);s=y(s)?{num:s,last:!0}:{num:wt,...s};const i=[];return t(i,n,s.num),s.last&&i.push(Rt([],n[n.length-1])),i},p0=ya((t,[e,n,s,i],r)=>{const o=1/r;for(let a=0;a<r;a++)t.push(lu([],e,n,s,i,a*o))}),b0=(t,e,n,s,i)=>{const r=1-i;return au(t,e,n,s,r*r,2*r*i,i*i)},_0=ya((t,[e,n,s],i)=>{const r=1/i;for(let o=0;o<i;o++)t.push(b0([],e,n,s,o*r))}),ji=(t,e=1,n=!0)=>{const s=n?(a,c,l,u)=>{!a&&(a=c);for(let f=c.length;f-- >0;)a[f]=t(c[f],l[f],u[f]);return a}:(a,c,l,u)=>{!a&&(a=u);for(let f=c.length;f-- >0;)a[f]=t(c[f],l[f],u[f]);return a},i=n?(a,c,l,u)=>(!a&&(a=c),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a):(a,c,l,u)=>(!a&&(a=u),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a),r=n?(a,c,l,u)=>(!a&&(a=c),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a):(a,c,l,u)=>(!a&&(a=u),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a),o=n?(a,c,l,u)=>(!a&&(a=c),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a[3]=t(c[3],l[3],u[3]),a):(a,c,l,u)=>(!a&&(a=u),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a[3]=t(c[3],l[3],u[3]),a);return[G(e,s,i,r,o),i,r,o]},[ap,v0,cp,lp]=ji(Yo),y0=v0,vt=Pt(he,{bpatch:"points",cubic3:"cubic",group3:"group",line:"polyline",line3:"polyline",path3:"path",points3:"points",poly3:"poly",polyline3:"polyline",quad:"poly",quad3:"poly",quadratic3:"quadratic",tri:"poly",tri3:"poly"},{aabb:({pos:t,size:e})=>{const[n,s,i]=t,[r,o,a]=Ae([],t,e);return[[n,s,i],[n,s,a],[r,s,a],[r,s,i],[n,o,i],[n,o,a],[r,o,a],[r,o,i]]},arc:(t,e)=>va(t.pos,t.r,t.axis,t.start,t.end,ht(e,t.attribs)),circle:(t,e=wt)=>{e=ht(e,t.attribs);const n=t.pos,s=t.r;let[i,r,o]=Dr(e,s);const a=L/i;o&&i++;const c=new Array(i);for(let l=0;l<i;l++)c[l]=g0(null,[s,r+l*a],n);return c},complexpoly:(t,e)=>{const n=vt(t.boundary,e);for(let s of t.children)n.push(...vt(s,e));return n},cubic:(t,e)=>p0(t.points,ht(e,t.attribs)),ellipse:(t,e=wt)=>{e=ht(e,t.attribs);const n=[],s=t.pos,i=t.r;let[r,o,a]=Dr(e,Math.max(t.r[0],t.r[1]));const c=L/r;a&&r++;for(let l=0;l<r;l++)n[l]=y0([],Pi(o+l*c),i,s);return n},extra:()=>[],group:(t,e)=>(e=ht(e,t.attribs),t.children.reduce((n,s)=>n.concat(vt(s,e)),[])),path:(t,e)=>{e=ht(e,t.attribs);const n=y(e)?{num:e}:e,s=[],i=r=>{const o=ta(r)?.type==="z";for(let a=r.length-1,c=0;c<=a;c++){const l=r[c];l.geo&&s.push(...vt(l.geo,{...n,last:!o&&c===a}))}};i(t.segments);for(let r of t.subPaths)i(r);return s},points:t=>t.points.slice(),poly:(t,e)=>Gr(t.points,ht(e,t.attribs),!0,!0),polyline:(t,e)=>Gr(t.points,ht(e,t.attribs),!1,!0),quadratic:(t,e)=>_0(t.points,ht(e,t.attribs)),rect:(t,e)=>{e=ht(e,t.attribs);const n=t.pos,s=tt([],n,t.size),i=[z([],n),[s[0],n[1]],s,[n[0],s[1]]];return e!=null?vt(new qt(i),e):i}}),Aa=Pt(he,{circle:"points",complexpoly:"group",ellipse:"points",line:"points",line3:"points3",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",rect:"points",tri:"points",tri3:"points3"},{aabb:t=>{const[e,n,s,i,r,o,a,c]=vt(t);return[[o,a,c,r],[i,e,n,s],[s,i,c,a],[e,n,o,r],[n,s,a,o],[i,e,r,c]].map(l=>new ce(ki(l),Xe(t)))},arc:(t,e)=>{const n=[Ti(t.pos),...vt(t,e)];return[new qt(n,Xe(t))]},group:(t,e)=>[...Kn(n=>Aa(n,e),t)],path:(t,e)=>Ur(qt,t,e),path3:(t,e)=>Ur(ce,t,e),points:(t,e)=>[new qt(vt(t,e),Xe(t))],points3:(t,e)=>[new ce(vt(t,e),Xe(t))]}),Ur=(t,e,n)=>{const s=e.empty();return s.attribs=e.attribs,[e.segments,...e.subPaths].map(i=>(s.segments=i,new t(vt(s,n),Xe(e))))},es=(t,e)=>t-e*Math.floor(t/e),P=t=>t-Math.floor(t),Fr=(t,e=1)=>Math.round(t/e)*e,ge=(t={},e)=>new nn(t,e);function A0(...t){return uu(sn,t)}const on=(t,e,n)=>{const s=t[0],i=t[1];return(e[0]-s)*(n[1]-i)-(n[0]-s)*(e[1]-i)},w0=(t,e,n,s=U)=>Xu(on(t,e,n),s),E0=(t,e,n,s=U)=>w0(t,e,n,s)<0,zr=(t,e)=>e!==0?t/e:0,R0=(t,e,n,s=!0,i=!0)=>{const r=n>0?s?function(){return this.buf[this.offset+n*this.stride]}:function(){return this.buf[this.offset+n]}:function(){return this.buf[this.offset]},o=n>0?s?function(a){this.buf[this.offset+n*this.stride]=a}:function(a){this.buf[this.offset+n]=a}:function(a){this.buf[this.offset]=a};i&&Object.defineProperty(t,n,{get:r,set:o,enumerable:!0}),Object.defineProperty(t,e,{get:r,set:o,enumerable:!0})},S0=(t,e,n,s)=>e.forEach((i,r)=>R0(t,i,r,n,s)),ke=t=>typeof t=="function";function wa(t,e=Object.create(null)){return(...n)=>{const s=JSON.stringify(n);return s!==void 0?s in e?e[s]:e[s]=t.apply(null,n):t.apply(null,n)}}function Ea(t,e=Object.create(null)){return(...n)=>{const s=n.join("-");return s in e?e[s]:e[s]=t(...n)}}const I0=Ea((t,e)=>t.repeat(e)),Ra=wa((t,e=!1)=>e?n=>M0(n)||n.toFixed(t):n=>n.toFixed(t)),M0=t=>isNaN(t)?"NaN":t===1/0?"+∞":t===-1/0?"-∞":void 0,N0={5120:"i8",5121:"u8",5122:"i16",5123:"u16",5124:"i32",5125:"u32",5126:"f32"},D0={i8:5120,u8:5121,u8c:5121,i16:5122,u16:5123,i32:5124,u32:5125,f32:5126,f64:void 0},$0={i8:0,u8:0,u8c:0,i16:1,u16:1,i32:2,u32:2,i64:3,u64:3,f32:2,f64:3},C0={f32:Float32Array,f64:Float64Array},O0={i8:Int8Array,i16:Int16Array,i32:Int32Array},L0={u8:Uint8Array,u8c:Uint8ClampedArray,u16:Uint16Array,u32:Uint32Array},T0={i64:BigInt64Array,u64:BigUint64Array},Qs={...C0,...O0,...L0},k0=t=>{const e=N0[t];return e!==void 0?e:t},Sa=t=>{const e=D0[t];return e!==void 0?e:t};function Yn(t,...e){const n=T0[t];return new(n||Qs[k0(t)])(...e)}const B0=t=>{if(Array.isArray(t))return"f64";for(let e in Qs)if(t instanceof Qs[e])return e;return"f64"},P0=t=>t>16?"u32":t>8?"u16":"u8",G0=(t,e,n,s,i,r)=>{const o=[];for(;n-- >0;)o.push(new t(e,s,i)),s+=r;return o},[up,fp,dp,U0]=ji(ft),F0=U0,Ds=(t,e,n=0,s=0,i=1,r=1)=>t[n]*e[s]+t[n+i]*e[s+r]+t[n+2*i]*e[s+2*r],S=(t,e,n=0,s=0,i=1,r=1)=>t[n]*e[s]+t[n+i]*e[s+r]+t[n+2*i]*e[s+2*r]+t[n+3*i]*e[s+3*r],ns=(t,e,n,s,i,r)=>(!t&&(t=e),t[0]=nt(e[0],n[0],s[0],i[0],r[0]),t[1]=nt(e[1],n[1],s[1],i[1],r[1]),t),z0=(t,e,n,s,i,r)=>(!t&&(t=e),t[0]=nt(e[0],n[0],s[0],i[0],r[0]),t[1]=nt(e[1],n[1],s[1],i[1],r[1]),t[2]=nt(e[2],n[2],s[2],i[2],r[2]),t),H0=(t,e,n,s,i,r)=>(!t&&(t=e),t[0]=nt(e[0],n[0],s[0],i[0],r[0]),t[1]=nt(e[1],n[1],s[1],i[1],r[1]),t[2]=nt(e[2],n[2],s[2],i[2],r[2]),t[3]=nt(e[3],n[3],s[3],i[3],r[3]),t);G(1,(t,e,n,s,i,r)=>{!t&&(t=e);for(let o=e.length;o-- >0;)t[o]=nt(e[o],n[o],s[o],i[o],r[o]);return t},ns,z0,H0);function*q0(t,e,n,s){for(;e-- >0;)yield t[n],n+=s}const Hr=(t,e)=>(t>>>e|t<<32-e)>>>0,[V0,hp,gp,mp]=ji(Wo),Y0=V0,Ia=G(1,(t,e,n,s=de)=>{!t&&(t=e);for(let i=e.length;i-- >0;)t[i]=s.minmax(e[i],n[i]);return t});function*Ma(t,e=!0,n=!1){if(t>0)for(let s=0,i=e?t+1:t;s<i;s++)yield n?1-s/t:s/t}function Lt(...t){return W0(Lt,dn,t)}const W0=(t,e,n)=>{let s,i;switch(n.length){case 4:i=n[3],s=n[2];break;case 3:i=n[2];break;case 2:return H(r=>t(n[0],n[1],r));default:Fi(n.length)}return e(vs(n[0])(n[1]),s,i)};function*ti(...t){const e=t.map(n=>n[Symbol.iterator]());for(;;){const n=[];for(let s of e){let i=s.next();if(i.done)return;n.push(i.value)}yield n}}function bn(...t){return new V(...Fl(t))}const j0=(t,e,n)=>new V(t,Qn([],e,t),n),pe=(t,e,n,s)=>j0(t,e,s).offset(n),ei=(t,e,n)=>(e=K(e),new V(Xn([],e,-.5,t),e,n)),Na=(t,e)=>n=>n.map(s=>s.geo?{type:s.type,geo:t(s.geo)}:s.point?{type:s.type,point:e(s.point)}:{...s}),ni=Pt(he,{bpatch:"points",complexpoly:"group",cubic:"points",cubic3:"points3",group3:"group",line:"points",line3:"points3",path3:"path",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",quadratic:"points",quadratic3:"points3",tri:"points",tri3:"points3"},{aabb:(t,e)=>(e=K(e,3),new Ce(He([],t.pos,e),He([],t.size,e),E(t.attribs))),arc:(t,e)=>{e=K(e);const n=t.copy();return X(null,n.pos,e),X(null,n.r,e),n},circle:(t,e)=>y(e)?new Oe(Ee([],t.pos,e),t.r*e,E(t.attribs)):new Le(X([],t.pos,e),Ee([],e,t.r),E(t.attribs)),ellipse:(t,e)=>(e=K(e),new Le(X([],t.pos,e),X([],t.r,e),E(t.attribs))),extra:t=>t,group:(t,e)=>t.copyTransformed(n=>ni(n,e)),path:(t,e)=>(e=K(e),t.copyTransformed(Na(n=>ni(n,e),n=>nu([],n,e)))),points:(t,e)=>t.copyTransformed(n=>n.map(y(e)?s=>Ee([],s,e):s=>X([],s,e))),points3:(t,e)=>t.copyTransformed(n=>n.map(y(e)?s=>Zs([],s,e):s=>He([],s,e))),ray:(t,e)=>(e=K(e),new hn(X([],t.pos,e),d0(null,X([],t.dir,e)),E(t.attribs))),ray3:(t,e)=>(e=K(e),new gn(He([],t.pos,e),h0(null,He([],t.dir,e)),E(t.attribs))),rect:(t,e)=>(e=K(e),new V(X([],t.pos,e),X([],t.size,e),E(t.attribs))),sphere:(t,e)=>y(e)?new mn(Zs([],t.pos,e),t.r*e,E(t.attribs)):Et("can't non-uniformly scale sphere"),text:(t,e)=>new pn(X([],t.pos,K(e)),t.body,E(t.attribs))}),si=Pt(he,{bpatch:"points",cubic:"points",cubic3:"points3",complexpoly:"group",group3:"group",line:"points",line3:"points3",path3:"path",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",quadratic:"points",quadratic3:"points3",tri:"points",tri3:"points3"},{aabb:(t,e)=>new Ce(Ae([],t.pos,e),Ot([],t.size),E(t.attribs)),arc:(t,e)=>{const n=t.copy();return tt(null,n.pos,e),n},circle:(t,e)=>new Oe(tt([],t.pos,e),t.r,E(t.attribs)),ellipse:(t,e)=>new Le(tt([],t.pos,e),z([],t.r),E(t.attribs)),extra:t=>t,group:(t,e)=>t.copyTransformed(n=>si(n,e)),path:(t,e)=>t.copyTransformed(Na(n=>si(n,e),n=>Tt([],n,e))),points:(t,e)=>t.copyTransformed(n=>n.map(s=>tt([],s,e))),points3:(t,e)=>t.copyTransformed(n=>n.map(s=>Ae([],s,e))),ray:(t,e)=>new hn(tt([],t.pos,e),t.dir,E(t.attribs)),ray3:(t,e)=>new gn(Ae([],t.pos,e),t.dir,E(t.attribs)),rect:(t,e)=>new V(tt([],t.pos,e),z([],t.size),E(t.attribs)),sphere:(t,e)=>new mn(Ae([],t.pos,e),t.r,E(t.attribs)),text:(t,e)=>new pn(tt([],t.pos,e),t.body,E(t.attribs))}),X0=t=>{const e=t.length-1;if(e<2)return 0;let n=0,s=t[e],i=t[0];for(let r=0;r<=e;s=i,i=t[++r])n+=ra(s,i);return n/2},ie=Pt(he,{group3:"group",quad:"poly"},{[x]:()=>0,aabb:({size:[t,e,n]})=>2*(t*e+t*n+e*n),arc:t=>.5*Math.abs(t.start-t.end)*t.r[0]*t.r[1],circle:t=>it*t.r**2,complexpoly:(t,e)=>ie(t.boundary,e)-t.children.reduce((n,s)=>n+ie(s,e),0),ellipse:t=>it*t.r[0]*t.r[1],group:({children:t})=>t.reduce((e,n)=>e+ie(n,!1),0),path:(t,e)=>t.closed?Aa(t).reduce((n,s)=>n+ie(s,e),0):0,plane:()=>1/0,poly:(t,e)=>{const n=X0(t.points);return e?n:Math.abs(n)},rect:t=>t.size[0]*t.size[1],sphere:t=>4*it*t.r**2,tri:(t,e)=>{const n=.5*on(...t.points);return e?n:Math.abs(n)}}),B=t=>typeof t=="string",an={},qr=(t,e)=>{for(let n in e){const s=e[n];if(I(s)){const[i,r,o,a]=s;e[n]=s.length===2?(c,l)=>r(c,i(c,l)):s.length===3?(c,l)=>o(c,r(c,i(c,l))):(c,l)=>a(c,o(c,r(c,i(c,l))))}}an[t]={...an[t],...e}},Da=(t,e,n,s)=>{const i=an[n];M(!!i,`no conversions available for ${n}`);let r=i[s];return r?r(t,e):an.rgb[s]?i.rgb(t,an.rgb[s]([],e)):Et(`can't convert: ${s} -> ${n}`)},x0=(t=0)=>e=>(e*100).toFixed(t)+"%",Z0=[.299,.587,.114],$a=[.2126,.7152,.0722],J0=[3.1338561,-.9787684,.0719453,-1.6168667,1.9161415,-.2289914,-.4906146,.033454,1.4052427],K0=[3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252],Q0=[.96422,1,.82521],tf=[.95047,1,1.08883];let ss=Ra(3),Vr=x0(3);const st=1/255,Y=(t,e=1)=>t!=null?A(t):e,ef=t=>{if(typeof t[0]=="number")switch(t.length){case 1:return t.push(0,0,1),[t];case 2:return t.push(0,1),[t];case 3:return t.push(1),[t];default:return[t]}return t},Ca=t=>{const e=ss(P(t[0])*360),n=Vr(A(t[1])),s=Vr(A(t[2])),i=Y(t[3]);return i<1?`hsla(${e},${n},${s},${ss(i)})`:`hsl(${e},${n},${s})`},Yr=(t,e,n=1)=>T(t||e,A(e[0]),A(e[1]),A(e[2]),Y(e[3],n)),Xi=(t,e,n=1)=>T(t||e,P(e[0]),A(e[1]),A(e[2]),Y(e[3],n)),nf=(t,e)=>{t=Xi(t||e,e);const n=t[1],s=t[2],i=(2-n)*s/2;return t[2]=i,t[1]=i&&i<1?n*s/(i<.5?i*2:2-i*2):n,t},sf=t=>Ca(nf([],t)),Wr="0123456789abcdef",ii=t=>Wr[t>>>4&15]+Wr[t&15],rf=t=>ii(t>>>8)+ii(t&255),of=t=>ii(t>>>16)+rf(t),xi=Ea((t,e,n="")=>{const s=I0("0",e);return i=>(i=(i>>>0).toString(t),n+(i.length<e?s.substring(i.length)+i:i))});xi(2,8);xi(2,16);xi(2,32);const Oa=of,ri=t=>{const e=t>>>24;return e<255?`rgba(${t>>16&255},${t>>8&255},${t&255},${ss(e*st)})`:`#${Oa(t&16777215)}`},af=t=>(t&255)<<16|t>>16&255|t&4278255360,cf=af,La=(t,e,n,s=!1)=>{const i=Ds(e,n,0,0,3),r=Ds(e,n,1,0,3),o=Ds(e,n,2,0,3),a=Y(n[3]);return s?T(t||n,A(i),A(r),A(o),a):T(t||n,i,r,o,a)},lf=(t,e,n,s=!0)=>{t=T(t||n,n[0],n[1],n[2],Y(n[3]));const i=S(t,e,0,0)+e[4],r=S(t,e,0,5)+e[9],o=S(t,e,0,10)+e[14],a=S(t,e,0,15)+e[19];return s?T(t,A(i),A(r),A(o),A(a)):T(t,i,r,o,a)},uf=(t,e)=>[S(e,t,0,0,1,5),S(e,t,0,1,1,5),S(e,t,0,2,1,5),S(e,t,0,3,1,5),S(e,t,0,4,1,5)+e[4],S(e,t,5,0,1,5),S(e,t,5,1,1,5),S(e,t,5,2,1,5),S(e,t,5,3,1,5),S(e,t,5,4,1,5)+e[9],S(e,t,10,0,1,5),S(e,t,10,1,1,5),S(e,t,10,2,1,5),S(e,t,10,3,1,5),S(e,t,10,4,1,5)+e[14],S(e,t,15,0,1,5),S(e,t,15,1,1,5),S(e,t,15,2,1,5),S(e,t,15,3,1,5),S(e,t,15,4,1,5)+e[19]],$s=t=>{const e=t**3;return e>.008856?e:(t-16/116)/7.787},Ta=(t,e,n=Q0)=>{const s=(e[0]+.16)/1.16;return T(t||e,$s(e[1]/5+s)*n[0],$s(s)*n[1],$s(s-e[2]/2)*n[2],Y(e[3]))},ff=(t,e)=>Ta(t,e,tf),ka=(t,e)=>{let{1:n,2:s}=e;s*=L;const i=Y(e[3]);return n>0?T(t||e,e[0],Math.cos(s)*n,Math.sin(s)*n,i):T(t||e,e[0],0,0,i)},Zi=(t,e,n=J0)=>La(t,n,e),oi=(t,e)=>Zi(t,e,K0),is=(t,e)=>Zi(null,Ta(t,e)),Ba=(t,e)=>oi(null,ff(t,e)),Cs=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Os=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4),cn=(t,e)=>T(t||e,Cs(e[0]),Cs(e[1]),Cs(e[2]),Y(e[3])),Ls=(t,e=0)=>(t<0?0:t>1?1:t)*255+.5<<e,we=t=>{const e=Ls(t[0]),n=Ls(t[1]),s=Ls(t[2]),i=Y(t[3]);return i<1?`rgba(${e},${n},${s},${ss(i)})`:`#${Oa(e<<16|n<<8|s)}`},df=t=>we(cn([],t)),Pa={abgr32:t=>ri(cf(t[0])),argb32:t=>ri(t[0]),hsl:Ca,hsv:sf,lab50:t=>we(cn(null,is([],t))),lab65:t=>we(cn(null,Ba([],t))),lch:t=>we(cn(null,is(null,ka([],t)))),rgb:df,srgb:we};({...Pa});let hf=Pa;const ai=(t,e=hf)=>{let n;return B(t)?t:y(t)?ri(t):t.mode?(n=e[t.mode])?n(t):e.rgb(Da([],t,"rgb",t.mode)):we(t)},gf=t=>t!=null&&typeof t.deref=="function",mf=t=>gf(t)?t.deref():t,pf=t=>t!=null&&typeof t!="string"&&typeof t[Symbol.iterator]=="function",bf=(t,e,n,s,i)=>{const r=z([],$l),o=z([],Dl),a=[],c=l=>{Qo(t,e,n,l,a),sa(null,r,a),xn(null,o,a)};if(c(s),c(i),s>i){const l=s;s=i,i=l}for(let l=Fr(s,Vn),u=Fr(i,Vn);l<u;l+=Vn)Jo(l,s,i)&&c(l);return[r,o]},jr=(t,e=0,n=t.length)=>{let s=1/0,i=1/0,r=-1/0,o=-1/0;for(let a=e;a<n;a++){const[c,l]=t[a];c<s&&(s=c),c>r&&(r=c),l<i&&(i=l),l>o&&(o=l)}return[[s,i],[r,o]]},_f=(t,e=0,n=t.length)=>{let s=1/0,i=1/0,r=1/0,o=-1/0,a=-1/0,c=-1/0;for(let l=e;l<n;l++){const[u,f,d]=t[l];u<s&&(s=u),u>o&&(o=u),f<i&&(i=f),f>a&&(a=f),d<r&&(r=d),d>c&&(c=d)}return[[s,i,r],[o,a,c]]},vf=(t,e,n,s,i,r,o)=>{t[n]=Math.min(s,o),e[n]=Math.max(s,o);const a=-s+i,c=s-2*i+r,l=-s+3*i-3*r+o;let u=c*c-a*l;if(u>0){u=Math.sqrt(u);const f=d=>{if(d>0&&d<1){const h=xu(s,i,r,o,d);t[n]=Math.min(t[n],h),e[n]=Math.max(e[n],h)}};f(a/(-c-u)),f(a/(-c+u))}},Xr=(t,e,n,s)=>{const i=[],r=[];for(let o=t.length;o-- >0;)vf(i,r,o,t[o],e[o],n[o],s[o]);return[i,r]},yf=(t,e,n)=>{const s=A((t-e)/(t-2*e+n)),i=1-s;return i*i*t+2*i*s*e+s*s*n},Af=(t,e,n)=>{for(let s=t.length;s-- >0;)if(!Jo(t[s],e[s],n[s]))return!1;return!0},wf=(t,e,n)=>{const s=Js([],t,n),i=xs([],t,n);if(!Af(e,s,i)){const r=[];for(let o=t.length;o-- >0;)r[o]=yf(t[o],e[o],n[o]);Js(null,s,r),xs(null,i,r)}return[s,i]};function Vt(t,e){return Ue(e)?As(Vt(t),e):n=>{const s=n[2];return Rn(n,(i,r)=>t(r)?s(i,r):i)}}const Ts=(t,e)=>{let n=t.length-1;if(n<0)return;let s=e(t[n]);if(!s)return;let{pos:i,size:r}=s;for(;n-- >0;)s=e(t[n]),s&&([i,r]=Ef(i,r,s.pos,s.size));return[i,r]},Ef=(t,e,n,s)=>{const i=Tt([],t,e),r=Tt([],n,s),o=Js([],t,n);return[o,fe(null,xs(null,i,r),o)]},Wn=Pt(he,{aabb:"rect",bpatch:"points",poly:"points",polyline:"points",quad:"points",tri:"points"},{arc:(t,e=0)=>pe(...bf(t.pos,t.r,t.axis,t.start,t.end),e),bpatch:({points:t},e=0)=>pe(...jr([...Kn(n=>Xr(...n),[[t[0],t[1],t[2],t[3]],[t[3],t[7],t[11],t[15]],[t[12],t[13],t[14],t[15]],[t[0],t[4],t[8],t[12]]])]),e),circle:(t,e=0)=>new V(Or([],t.pos,t.r+e),Ee(null,[2,2],t.r+e)),complexpoly:(t,e=0)=>{const n=Ts([t.boundary,...t.children],Wn);return n?new V(...n).offset(e):void 0},cubic:({points:t},e=0)=>pe(...Xr(t[0],t[1],t[2],t[3]),e),ellipse:(t,e=0)=>{const n=xo([],t.r,e);return new V(Qn([],t.pos,n),X(null,[2,2],n))},extra:()=>{},group:(t,e=0)=>{const n=Ts(t.children,Wn);return n?new V(...n).offset(e):void 0},line:({points:[t,e]},n=0)=>pe(sa([],t,e),xn([],t,e),n),path:(t,e=0)=>{const n=i=>As(Sn(H(r=>r.geo),Vt(r=>!!r)),i),s=Ts([...n(t.segments),...Kn(n,t.subPaths)],Wn);return s?new V(...s).offset(e):void 0},points:(t,e=0)=>pe(...jr(t.points),e),points3:(t,e=0)=>Du(..._f(t.points),e),quadratic:({points:t},e=0)=>pe(...wf(t[0],t[1],t[2]),e),rect:(t,e=0)=>e===0?t.copy():t.copy().offset(e),text:(t,e=0)=>new V(Or([],t.pos,e),e*2)}),Ga=(t,e,n,s=U)=>{const i=Vi(t,e,n);return i!==void 0?Mn(t,ts([],e,n,A(i)))<s*s:!1},Rf=(t,e,n,s=U)=>{const i=e.length;let[r,o]=[0,1];for(;o<i;r=o,o++)if(Ga(t,e[r],e[o],s))return!0;return!1},Sf=(t,e,n)=>Mn(e,t)<=n*n,If=(t,e,n,s)=>{const i=E0(e,n,s)?1:-1;return i*on(e,s,t)>=0&&i*on(n,e,t)>=0&&i*on(s,n,t)>=0},ks=(t,e)=>{const n=e.length-1,s=t[0],i=t[1];let r=e[n],o=e[0],a=0;for(let c=0;c<=n;r=o,o=e[++c])a=Mf(s,i,r[0],r[1],o[0],o[1],a);return a},Mf=(t,e,n,s,i,r,o)=>(s<e&&r>=e||r<e&&s>=e)&&(n<=t||i<=t)?o^~~(n+(e-s)/(r-s)*(i-n)<t):o,Ji=G(0),Nf=Ji.add(2,([t,e],n,s)=>t>=n[0]&&t<=n[0]+s[0]&&e>=n[1]&&e<=n[1]+s[1]),Df=Ji.add(3,([t,e,n],s,i)=>t>=s[0]&&t<=s[0]+i[0]&&e>=s[1]&&e<=s[1]+i[1]&&n>=s[2]&&n<=s[2]+i[2]);Ji.default((t,e,n)=>{for(let s=t.length;s-- >0;){const i=t[s],r=e[s];if(i<r||i>r+n[s])return!1}return!0});const Ki=G(0);Ki.add(2,([t,e],n,s)=>t>=n[0]-s[0]&&t<=n[0]+s[0]&&e>=n[1]-s[1]&&e<=n[1]+s[1]);Ki.add(3,([t,e,n],s,i)=>t>=s[0]-i[0]&&t<=s[0]+i[0]&&e>=s[1]-i[1]&&e<=s[1]+i[1]&&n>=s[2]-i[2]&&n<=s[2]+i[2]);Ki.default((t,e,n)=>{for(let s=t.length;s-- >0;){const i=t[s],r=e[s],o=n[s];if(i<r-o||i>r+o)return!1}return!0});const Wt=Pt(he,{group3:"group",points3:"points",quad:"poly",sphere:"circle"},{[x]:()=>!1,aabb:(t,e)=>Df(e,t.pos,t.size),circle:(t,e)=>Sf(e,t.pos,t.r),complexpoly:(t,e)=>ks(e,t.boundary.points)?!t.children.some(n=>ks(e,n.points)):!1,group:(t,e)=>t.children.some(n=>Wt(n,e)),line:(t,e)=>Ga(e,t.points[0],t.points[1]),points:({points:t},e)=>Uu(e,t),poly:(t,e)=>ks(e,t.points)>0,polyline:(t,e)=>Rf(e,t.points),rect:(t,e)=>Nf(e,t.pos,t.size),tri:(t,e)=>If(e,...t.points)}),xr=(t,e,n=de,s=[])=>{const i=Wn(t);if(!i)return;const r=i.pos,o=i.max();for(;e-- >0;)for(;;){const a=Ia([],r,o,n);if(Wt(t,a)){s.push(a);break}}return s};function Ua(...t){return yu(Ua,t)||(e=>{const n=e[2],s=t[0];let i=t[1]||0;return Rn(e,(r,o)=>n(r,s(i++,o)))})}function Fa(t,e,n){return new $f(t,e,n)}class $f{from;to;step;constructor(e,n,s){e===void 0?(e=0,n=1/0):n===void 0&&(n=e,e=0),s=s===void 0?e<n?1:-1:s,this.from=e,this.to=n,this.step=s}*[Symbol.iterator](){let{from:e,to:n,step:s}=this;if(s>0)for(;e<n;)yield e,e+=s;else if(s<0)for(;e>n;)yield e,e+=s}$reduce(e,n){const s=this.step;if(s>0)for(let i=this.from,r=this.to;i<r&&!kt(n);i+=s)n=e(n,i);else for(let i=this.from,r=this.to;i>r&&!kt(n);i+=s)n=e(n,i);return n}}const Qi=(t,e)=>t===e?0:t==null?e==null?0:-1:e==null?t==null?0:1:typeof t.compare=="function"?t.compare(e):typeof e.compare=="function"?-e.compare(t):t<e?-1:t>e?1:0,Cf=t=>typeof t=="string",Of=(t,e,n)=>{const s={expire:1e4,utf8:!1,...n};Cf(e)&&s.utf8&&(e=new TextEncoder().encode(e),s.mime+=";charset=UTF-8");const i=URL.createObjectURL(e instanceof Blob?e:new Blob([e],{type:s.mime})),r=document.createElement("a");r.setAttribute("download",t),r.setAttribute("href",i),document.body.appendChild(r),r.click(),document.body.removeChild(r),s.expire>0&&setTimeout(()=>URL.revokeObjectURL(i),s.expire)},Lf=(t,e,n="png",s=.95)=>{const i=`image/${n}`;t.toBlob(r=>r?Of(`${e}.${n}`,r,{mime:i}):console.warn("can't download canvas"),i,s)},Tf=[0,31,59,90,120,151,181,212,243,273,304,334],kf=1e3,Bf=60*kf,Pf=(t,e)=>typeof t?.[e]=="function",Gf=t=>typeof t=="number",za=t=>typeof t=="string",Uf=t=>za(t)||Gf(t)?new Date(t):Pf(t,"toDate")?t.toDate():t,Ha=t=>!(t%4)&&(!!(t%100)||!(t%400));function qa(t,e=Object.create(null)){return(...n)=>{const s=n.join("-");return s in e?e[s]:e[s]=t(...n)}}const Ff=qa((t,e)=>t.repeat(e)),tr=qa((t,e=" ")=>{const n=Ff(String(e),t);return(s,i)=>s==null?n:(s=s.toString(),i=i!==void 0?i:s.length,i<t?n.substring(i)+s:s)}),gt=tr(2,"0"),zf=tr(3,"0"),Hf=tr(4,"0"),qf=t=>typeof t=="function",Vf={months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],sepHM:".",date:["dd","/DM","MM","/MY","yyyy"],time:["h","/HM","mm"," ","a"],units:{y:{s:"y",p:"y"},M:{s:"m",p:"m"},d:{s:"d",p:"d"},h:{s:"h",p:"h"},m:{s:"min",p:"min"},s:{s:"s",p:"s"},t:{s:"ms",p:"ms"}},less:"< %s",past:"%s ago",now:"just now",future:"in %s"},Yf=t=>{const e={sepED:" ",sepDM:"/",sepMY:"/",sepHM:":",date:["E","/ED","d","/DM","MMM","/MY","yyyy"],time:["H","/HM","mm"],...t};return!e.dateTime&&(e.dateTime=[...e.date,", ",...e.time]),e};let be=Yf(Vf);const Wf=(t,e,n)=>Tf[e]+n+~~(e>1&&Ha(t)),jf=(t,e,n)=>{const s=new Date(Date.UTC(t,0,1)).getDay()||7;if(!e){if(s===5&&n<4)return 53;if(s===6&&n<3)return 52+~~Ha(t-1);if(s===7&&n<2)return 52}const i=(s<5?8:15)-s;return Math.ceil((Wf(t,e,n)-i)/7+1)},ci={yyyy:t=>Hf(t.getFullYear()),yy:t=>gt(t.getFullYear()%100),MMM:t=>be.months[t.getMonth()],MM:t=>gt(t.getMonth()+1),M:t=>String(t.getMonth()+1),dd:t=>gt(t.getDate()),d:t=>String(t.getDate()),E:t=>be.days[t.getDay()],ww:t=>gt(ci.w(t,!1)),w:t=>String(jf(t.getFullYear(),t.getMonth(),t.getDate())),q:t=>String((t.getMonth()/3|0)+1),HH:t=>gt(t.getHours()),H:t=>String(t.getHours()),hh:t=>{const e=t.getHours()%12;return gt(e>0?e:12)},h:t=>{const e=t.getHours()%12;return String(e>0?e:12)},mm:t=>gt(t.getMinutes()),m:t=>String(t.getMinutes()),ss:t=>gt(t.getSeconds()),s:t=>String(t.getSeconds()),SS:t=>zf(t.getMilliseconds()),S:t=>String(t.getMilliseconds()),A:t=>t.getHours()<12?"AM":"PM",a:t=>t.getHours()<12?"am":"pm",Z:(t,e=!1)=>{const n=e?0:t.getTimezoneOffset(),s=Math.abs(n);return`${n<0?"+":"-"}${gt(s/60|0)}:${gt(s%60)}`},ZZ:(t,e=!1)=>e?"Z":ci.Z(t,e),"/DM":()=>be.sepDM,"/ED":()=>be.sepED,"/HM":()=>be.sepHM,"/MY":()=>be.sepMY},Xf=t=>(e=Date.now(),n=!1)=>{let s=Uf(e);return n&&(s=new Date(s.getTime()+s.getTimezoneOffset()*Bf)),t.map(i=>za(i)?i.startsWith("\\")?i.substring(1):ci[i]?.(s,n)??i:qf(i)?i(s,n):i).join("")},xf=Xf(["yyyy","MM","dd","-","HH","mm","ss"]),Zf={WEBGL_draw_buffers:{gl:!0,alias:"GL_EXT_draw_buffers"},OES_standard_derivatives:{gl:!0,alias:"GL_OES_standard_derivatives"}};var er=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(er||{});const Va={fragColor:["vec4",0]};var Nn=(t=>(t[t.ALPHA=6406]="ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.R16F=33325]="R16F",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32F=33326]="R32F",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.R8=33321]="R8",t[t.R8_SNORM=36756]="R8_SNORM",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.RED=6403]="RED",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RG16F=33327]="RG16F",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32F=33328]="RG32F",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RG8=33323]="RG8",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RGB=6407]="RGB",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB16I=36233]="RGB16I",t[t.RGB16UI=36215]="RGB16UI",t[t.RGB32F=34837]="RGB32F",t[t.RGB32I=36227]="RGB32I",t[t.RGB32UI=36209]="RGB32UI",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.RGB8=32849]="RGB8",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGB8I=36239]="RGB8I",t[t.RGB8UI=36221]="RGB8UI",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA=6408]="RGBA",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGBA16F=34842]="RGBA16F",t[t.RGBA16I=36232]="RGBA16I",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGBA32F=34836]="RGBA32F",t[t.RGBA32I=36226]="RGBA32I",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGBA4=32854]="RGBA4",t[t.RGBA8=32856]="RGBA8",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGBA8I=36238]="RGBA8I",t[t.RGBA8UI=36220]="RGBA8UI",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t))(Nn||{}),Je=(t=>(t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t))(Je||{}),Re=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t))(Re||{}),rs=(t=>(t[t.LINEAR=9729]="LINEAR",t[t.NEAREST=9728]="NEAREST",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t))(rs||{}),os=(t=>(t[t.REPEAT=10497]="REPEAT",t[t.CLAMP=33071]="CLAMP",t[t.REPEAT_MIRROR=33648]="REPEAT_MIRROR",t))(os||{});const p=(t,e,n,s=!1,i=!1,r=s)=>({format:t,types:e,render:s,renderExt:r,filter:i,num:n}),ln={6406:p(6406,[5121,1,5131,2,36193,2,5126,4],1,!0,!0),6402:p(6402,[5123,2,5125,4],1,!0),33189:p(6402,[5123,2,5125,4],1,!0),33190:p(6402,[5125,4],1,!0),36012:p(6402,[5126,4],1,!0),34041:p(34041,[34042,4],1,!0),35056:p(34041,[34042,4],1,!0),36013:p(34041,[36269,4],1,!0),6410:p(6410,[5121,2,5131,4,36193,4,5126,8],2,!0,!0),6409:p(6409,[5121,1,5131,2,36193,2,5126,4],1,!0,!0),35898:p(6407,[5126,12,5131,6,35899,4],3,!1,!0,!0),33325:p(6403,[5126,4,5131,2],1,!1,!0,!0),33331:p(36244,[5122,2],1,!0),33332:p(36244,[5123,2],1,!0),33326:p(6403,[5126,4],1,!1,!1,!0),33333:p(36244,[5124,4],1,!0),33334:p(36244,[5125,4],1,!0),36756:p(6403,[5120,1],1,!1,!0),33321:p(6403,[5121,1],1,!0,!0),33329:p(36244,[5120,1],1,!0),33330:p(36244,[5121,1],1,!0),33327:p(33319,[5126,8,5131,4],2,!1,!0,!0),33337:p(33320,[5122,4],2,!0),33338:p(33320,[5123,4],2,!0),33328:p(33319,[5126,8],2,!1,!1,!0),33339:p(33320,[5124,8],2,!0),33340:p(33320,[5125,8],2,!0),36757:p(33319,[5120,2],2,!1,!0),33323:p(33319,[5121,2],2,!0,!0),33335:p(33320,[5120,2],2,!0),33336:p(33320,[5121,2],2,!0),6407:p(6407,[5121,3,5131,6,36193,6,5126,12,33635,2],3,!0,!0),32857:p(6408,[33640,4],4,!0,!0),36975:p(36249,[33640,4],4,!0),34843:p(6407,[5126,12,5131,6],3,!1,!0),36233:p(36248,[5122,6],3),36215:p(36248,[5123,6],3),34837:p(6407,[5126,12],3),36227:p(36248,[5124,12],3),36209:p(36248,[5125,12],3),32855:p(6408,[5121,4,32820,2,33640,4],4,!0,!0),36194:p(6407,[5121,3,33635,2],3,!0,!0),36758:p(6407,[5120,3],3,!1,!0),32849:p(6407,[5121,3],3,!0,!0),36239:p(36248,[5120,3],3),36221:p(36248,[5121,3],3),35901:p(6407,[5126,12,5131,6,35902,4],3,!1,!0),6408:p(6408,[5121,4,5131,8,36193,8,5126,16,32819,2,32820,2],4,!0,!0),34842:p(6408,[5126,16,5131,8],4,!1,!0,!0),36232:p(36249,[5122,8],4,!0),36214:p(36249,[5123,8],4,!0),34836:p(6408,[5126,16],4,!1,!1,!0),36226:p(36249,[5124,16],4,!0),36208:p(36249,[5125,16],4,!0),32854:p(6408,[5121,4,32819,2],4,!0,!0),36759:p(6408,[5120,4],4,!1,!0),32856:p(6408,[5121,4],4,!0,!0),36238:p(36249,[5120,4],4,!0),36220:p(36249,[5121,4],4,!0),35907:p(6408,[5121,4],4,!0,!0),35905:p(6407,[5121,3],3,!1,!0)},Be=t=>typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,Zr=t=>t.type===Je.FLOAT||t.type===Je.HALF_FLOAT||t.type===Je.HALF_FLOAT_OES||t.type===Je.FLOAT_32_UNSIGNED_INT_24_8_REV,Jf=En(()=>"WebGL"),k=t=>{throw new Jf(t)},Ya=t=>t!=null,Dn=t=>typeof t=="boolean",Jr=(t,e=new Map)=>n=>{e.has(n)||(e.set(n,!0),t(n))};var at=(t=>(t.GLES_100="100",t.GLES_300="300 es",t))(at||{});const Se="vec2",Kf="vec3",Ie="vec4",Wa="bool",$n="float",ws="int",nr="uint",ja="sampler2D",Qf="sampler3D",t1=/^[iub]?vec[234]$/,e1=/^mat[234]$/,n1=t=>Bt(t)&&!!t.tag&&!!t.type,Fe=t=>t1.test(t.type),Xa=t=>e1.test(t.type),me=(t,e,n)=>t===e.type&&n===e.info?e:{tag:"lit",type:t,info:n,val:e},xa=t=>me(Wa,y(t)?!!t:t),St=t=>me($n,Dn(t)?t&1:t),sr=t=>me(ws,Dn(t)?t&1:y(t)?t|0:t),Za=t=>me(nr,Dn(t)?t&1:y(t)?t>>>0:t),Ja=(t,e)=>n=>y(n)||n!==void 0&&!Fe(n)&&n.type!==t?e(n):n,s1=Ja($n,St),i1=Ja(ws,sr);xa(!0);xa(!1);const ir=St(0),Ka=St(1);St(2);St(.5);const Qa=sr(0);sr(1);Za(0);Za(1);St(Math.PI);St(Math.PI*2);St(Math.PI/2);St(Math.SQRT2);St((1+Math.sqrt(5))/2);const tc=(t,e)=>n=>[n[0]===void 0?e:t(n[0]),...n.slice(1).map(t)],rr=tc(s1,ir),r1=tc(i1,Qa),o1=(t,e="")=>t[0]+e.substring(1),or=(t,e)=>Fe(t[0])?o1(t[0].type,e[t.length]):e[t.length],ec=(t,e,n)=>me(t,n=e(n),or(n,["n","n"])),a1=(t,e,n)=>me(t,n=e(n),or(n,["n","n","vn"])),c1=(t,e,n)=>me(t,n=e(n),n.length===2?Fe(n[1])?n[0].type[0]+n[1].type[0]:"vn":or(n,["n","n",void 0,"vnn"]));function ar(...t){return ec(Se,rr,t)}function cr(...t){return a1(Kf,rr,t)}function nc(...t){return c1(Ie,rr,t)}function l1(...t){return ec("ivec2",r1,t)}ar(0);ar(1);ar(2);cr(0);cr(1);cr(2);const u1=t=>t.replace("[]","");let f1=0;const lr=(t="_s")=>`${t}${(f1++).toString(36)}`;function et(t,...e){let n,s,i;switch(e.length){case 0:B(t)||(i=t,t=i.type);break;case 1:B(e[0])?n=e[0]:e[0].tag?i=e[0]:s=e[0];break;case 2:B(e[0])?[n,s]=e:[s,i]=e;break;case 3:[n,s,i]=e;break;default:lt()}return{tag:"sym",type:t,id:n||lr(),opts:s||{},init:i}}const Kr=(t,e,n)=>et(t,e,{q:"in",type:"in",...n}),Qr=(t,e,n)=>et(t,e,{q:"out",type:"out",...n}),to=(t,e,n)=>et(t,e,{q:"in",type:"uni",...n}),d1=t=>Pt(e=>e.tag,{},{[x]:e=>Et(`no impl for AST node type: '${e.tag}'`),...t}),eo=/[};]$/,h1=t=>{const e={type:"fs",version:at.GLES_300,versionPragma:!0,prelude:"",...t},n=e.type==="vs",s=e.prec!==void 0?u=>u===(u|0)?u+".0":u.toFixed(e.prec):u=>u===(u|0)?u+".0":String(u),i=u=>u,r=(u,f=", ")=>u.map(l).join(f),o=u=>`${u.id}(${r(u.args)})`,a=(u,f=!1)=>{const{id:d,type:h,opts:g,init:m}=u,_=[];if(g.type){let b;e.version<at.GLES_300?n?b={in:"attribute",out:"varying",uni:"uniform"}[g.type]:(b={in:"varying",out:null,uni:"uniform"}[g.type],!b&&Et("GLSL 100 doesn't support fragment shader output variables")):(g.loc!=null&&_.push(`layout(location=${g.loc}) `),g.smooth!=null&&_.push(g.smooth+" "),b=g.type==="uni"?"uniform":g.type),_.push(b+" ")}else g.const&&_.push("const "),f&&g.q&&_.push(g.q+" ");return g.prec&&_.push(g.prec+" "),_.push(i(u1(h))," ",d),g.num&&_.push(`[${g.num}]`),m&&_.push(" = ",l(m)),_.join("")},c=u=>`${l(u.val)}[${l(u.id)}]`,l=d1({arg:u=>a(u,!0),array_init:u=>e.version>=at.GLES_300?`${u.type}(${r(u.init)})`:Et(`array initializers not available in GLSL ${e.version}`),assign:u=>l(u.l)+" = "+l(u.r),ctrl:u=>u.id,call:o,call_i:u=>u.id==="texture"&&e.version<at.GLES_300?`${u.id}${u.args[0].type.substring(7)}(${r(u.args)})`:o(u),decl:u=>a(u.id),fn:u=>`${i(u.type)} ${u.id}(${r(u.args)}) ${l(u.scope)}`,for:u=>`for(${u.init?l(u.init):""}; ${l(u.test)}; ${u.iter?l(u.iter):""}) ${l(u.scope)}`,idx:c,idxm:c,if:u=>{const f=`if (${l(u.test)}) `+l(u.t);return u.f?f+" else "+l(u.f):f},lit:u=>{const f=u.val;switch(u.type){case"bool":return Dn(f)?String(f):`bool(${l(f)})`;case"float":return y(f)?s(f):`float(${l(f)})`;case"int":return y(f)?String(f):`int(${l(f)})`;case"uint":return y(f)?`${f}u`:`uint(${l(f)})`;default:return Fe(u)||Xa(u)?`${u.type}(${r(f)})`:Et(`unknown type: ${u.type}`)}},op1:u=>u.post?`(${l(u.val)}${u.op})`:`(${u.op}${l(u.val)})`,op2:u=>`(${l(u.l)} ${u.op} ${l(u.r)})`,ret:u=>"return"+(u.val?" "+l(u.val):""),scope:u=>{let f=u.body.map(l).reduce((d,h)=>(d.push(eo.test(h)?h:h+";"),d),[]).join(`
`);return f+=u.body.length&&!eo.test(f)?";":"",u.global?(e.prelude&&(f=e.prelude+`
`+f),e.versionPragma&&(f=`#version ${e.version}
`+f),f):`{
${f}
}`},swizzle:u=>`${l(u.val)}.${u.id}`,sym:u=>u.id,ternary:u=>`(${l(u.test)} ? ${l(u.t)} : ${l(u.f)})`,while:u=>`while (${l(u.test)}) ${l(u.scope)}`});return Object.assign(l,{gl_FragColor:et(Ie,"gl_FragColor"),gl_FragCoord:et(Ie,"gl_FragCoord",{const:!0}),gl_FragData:et("vec4[]","gl_FragData",{num:1}),gl_FrontFacing:et("bool","gl_FrontFacing",{const:!0}),gl_PointCoord:et(Se,"gl_PointCoord",{const:!0}),gl_PointSize:et($n,"gl_PointSize"),gl_Position:et(Ie,"gl_Position")}),l},g1=(t,e,n=ut)=>{for(let s=t.length;s-- >0;)if(n(e,t[s]))return s;return-1};function sc(t,e){for(let n of e)t.delete(n);return t}const m1=(t,e)=>{if(t===e)return!0;if(!(e instanceof Map)||t.size!==e.size)return!1;for(let n of t.entries())if(!ut(e.get(n[0]),n[1]))return!1;return!0},p1=(t,e)=>{if(t===e)return!0;if(!(e instanceof Set)||t.size!==e.size)return!1;for(let n of t.keys())if(!e.has(n))return!1;return!0},b1="modulepreload",_1=function(t){return"/"+t},no={},v1=function(e,n,s){let i=Promise.resolve();if(n&&n.length>0){let o=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");i=o(n.map(l=>{if(l=_1(l),l in no)return;no[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":b1,u||(d.as="script"),d.crossOrigin="",d.href=l,c&&d.setAttribute("nonce",c),document.head.appendChild(d),u)return new Promise((h,g)=>{d.addEventListener("load",h),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})},Cn=(t,e={})=>{const n=Reflect.ownKeys(t),s=Reflect.ownKeys(e),i=Symbol("isa");function r(o){for(let a of n){const c=Object.getOwnPropertyDescriptor(o.prototype,a);(!c||c.configurable)&&Object.defineProperty(o.prototype,a,{value:t[a],writable:!0})}return Object.defineProperty(o.prototype,i,{value:!0}),o}for(let o of s)Object.defineProperty(r,o,{value:e[o],enumerable:e.propertyIsEnumerable(o)});return Object.defineProperty(r,Symbol.hasInstance,{value:o=>!!o[i]}),r},y1=()=>typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node<"u";let _n=null;y1()&&v1(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]).then(t=>{_n=t.inspect});const A1=(t,e)=>[...H(n=>_n(n,e),t)].join(", "),w1=(t,e)=>[...H(([n,s])=>`${_n(n,e)} => ${_n(s,e)}`,t)].join(", "),ic=Cn({[Symbol.for("nodejs.util.inspect.custom")](t,e){const n=this[Symbol.toStringTag],s={...e,depth:e.depth===null?null:e.depth-1};return t>=0?[`${n}(${this.size||0}) {`,_n?this instanceof Set?A1(this,s):this instanceof Map?w1(this,s):"":"","}"].join(" "):e.stylize(`[${n}]`,"special")}}),E1=t=>t instanceof Map;function as(t,e){if(E1(t))for(let n of e)t.set(n[0],n[1]);else for(let n of e)t.add(n);return t}var R1=Object.getOwnPropertyDescriptor,S1=(t,e,n,s)=>{for(var i=s>1?void 0:s?R1(e,n):e,r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(i)||i);return i};const Kt=new WeakMap,It=t=>Kt.get(t).vals;let F=class extends Set{constructor(t,e={}){super(),Kt.set(this,{equiv:e.equiv||ut,vals:[]}),t&&this.into(t)}*[Symbol.iterator](){yield*It(this)}get[Symbol.species](){return F}get[Symbol.toStringTag](){return"ArraySet"}get size(){return It(this).length}copy(){const{equiv:t,vals:e}=Kt.get(this),n=new F(null,{equiv:t});return Kt.get(n).vals=e.slice(),n}empty(){return new F(null,this.opts())}clear(){It(this).length=0}first(){if(this.size)return It(this)[0]}add(t){return!this.has(t)&&It(this).push(t),this}into(t){return as(this,t)}has(t){return this.get(t,Z)!==Z}get(t,e){const{equiv:n,vals:s}=Kt.get(this),i=g1(s,t,n);return i>=0?s[i]:e}delete(t){const{equiv:e,vals:n}=Kt.get(this);for(let s=n.length;s-- >0;)if(e(n[s],t))return n.splice(s,1),!0;return!1}disj(t){return sc(this,t)}equiv(t){return p1(this,t)}forEach(t,e){const n=It(this);for(let s=n.length;s-- >0;){const i=n[s];t.call(e,i,i,this)}}*entries(){for(let t of It(this))yield[t,t]}*keys(){yield*It(this)}*values(){yield*It(this)}opts(){return{equiv:Kt.get(this).equiv}}};F=S1([ic],F);var I1=Object.getOwnPropertyDescriptor,M1=(t,e,n,s)=>{for(var i=s>1?void 0:s?I1(e,n):e,r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(i)||i);return i};const J=new WeakMap,Tn=t=>J.get(t).map;let le=class extends Map{constructor(t,e){super();const n={equiv:ut,keys:F,...e};J.set(this,{keys:new n.keys(null,{equiv:n.equiv}),map:new Map,opts:n}),t&&this.into(t)}[Symbol.iterator](){return this.entries()}get[Symbol.species](){return le}get[Symbol.toStringTag](){return"EquivMap"}get size(){return J.get(this).keys.size}clear(){const{keys:t,map:e}=J.get(this);t.clear(),e.clear()}empty(){return new le(null,J.get(this).opts)}copy(){const{keys:t,map:e,opts:n}=J.get(this),s=new le;return J.set(s,{keys:t.copy(),map:new Map(e),opts:n}),s}equiv(t){return m1(this,t)}delete(t){const{keys:e,map:n}=J.get(this);return t=e.get(t,Z),t!==Z?(n.delete(t),e.delete(t),!0):!1}dissoc(t){return sc(this,t)}forEach(t,e){for(let n of Tn(this))t.call(e,n[1],n[0],this)}get(t,e){const{keys:n,map:s}=J.get(this);return t=n.get(t,Z),t!==Z?s.get(t):e}has(t){return J.get(this).keys.has(t)}set(t,e){const{keys:n,map:s}=J.get(this),i=n.get(t,Z);return i!==Z?s.set(i,e):(n.add(t),s.set(t,e)),this}into(t){return as(this,t)}entries(){return Tn(this).entries()}keys(){return Tn(this).keys()}values(){return Tn(this).values()}opts(){return J.get(this).opts}};le=M1([ic],le);const N1=new Set(["__proto__","prototype","constructor"]),Bs=t=>N1.has(t),D1=t=>I(t)?t.some(Bs):B(t)?t.indexOf(".")!==-1?t.split(".").some(Bs):Bs(t):!1,$1=(t,e)=>ct(t,"copy")?t.copy():new(t[Symbol.species]||e)(t),rc=(t,e,n)=>{if(t.size<e.size){const s=t;t=e,e=s}return n=n?as(n,t):$1(t,Set),t===e?n:as(n,e)};class vn{dependencies;dependents;constructor(e){if(this.dependencies=new le,this.dependents=new le,e)for(let[n,s]of e)s!=null?this.addDependency(n,s):this.addNode(n)}*[Symbol.iterator](){yield*this.sort()}get[Symbol.species](){return vn}copy(){const e=new vn;for(let n of this.dependencies)e.dependencies.set(n[0],n[1].copy());for(let n of this.dependents)e.dependents.set(n[0],n[1].copy());return e}addNode(e){return!this.dependencies.has(e)&&this.dependencies.set(e,new F),this}addDependency(e,n){(ut(e,n)||this.depends(n,e))&&lt(`Circular dependency between: ${e} & ${n}`);let s=this.dependencies.get(e);return this.dependencies.set(e,s?s.add(n):new F([n])),s=this.dependents.get(n),this.dependents.set(n,s?s.add(e):new F([e])),this}addDependencies(e,n){for(let s of n)this.addDependency(e,s)}removeEdge(e,n){let s=this.dependencies.get(e);return s&&s.delete(n),s=this.dependents.get(n),s&&s.delete(e),this}removeNode(e){return this.dependencies.delete(e),this}depends(e,n){return this.transitiveDependencies(e).has(n)}dependent(e,n){return this.transitiveDependents(e).has(n)}immediateDependencies(e){return this.dependencies.get(e)||new F}immediateDependents(e){return this.dependents.get(e)||new F}isLeaf(e){return this.immediateDependents(e).size===0}isRoot(e){return this.immediateDependencies(e).size===0}nodes(){return rc(new F(this.dependencies.keys()),new F(this.dependents.keys()))}leaves(){return Vt(e=>this.isLeaf(e),this.nodes())}roots(){return Vt(e=>this.isRoot(e),this.nodes())}transitiveDependencies(e){return li(this.dependencies,e)}transitiveDependents(e){return li(this.dependents,e)}sort(){const e=[],n=this.copy();let s=new F(n.leaves());for(;;){if(!s.size)return e.reverse();const i=s.first();s.delete(i);for(let r of[...n.immediateDependencies(i)])n.removeEdge(i,r),n.isLeaf(r)&&s.add(r);e.push(i),n.removeNode(i)}}}const li=(t,e)=>{const n=t.get(e);return n?dn(ys(null,(s,i)=>rc(s,li(t,i))),n,n):new F},oc=t=>{let e;switch(t.tag){case"scope":return t.body;case"fn":return t.scope.body;case"for":return e=[t.test,...t.scope.body],t.init&&e.push(t.init),t.iter&&e.push(t.iter),e;case"while":return[t.test,...t.scope.body];case"if":return e=[t.test,...t.t.body],t.f&&e.push(...t.f.body),e}},C1=t=>oc(t)||(t.tag==="scope"?t.body:t.tag==="ternary"?[t.test,t.t,t.f]:t.tag==="ret"?t.val!==void 0?[t.val]:void 0:t.tag==="call"||t.tag==="call_i"?t.args:t.tag==="sym"&&t.init?[t.init]:t.tag==="decl"?[t.id]:t.tag==="op1"||t.tag==="swizzle"?[t.val]:t.tag==="op2"?[t.l,t.r]:t.tag==="assign"?[t.r]:Fe(t)||Xa(t)||n1(t.val)?t.val:void 0),cs=(t,e,n,s,i=!0)=>{if(I(s))s.forEach(r=>n=cs(t,e,n,r,i));else{i&&(n=t(n,s));const r=e(s);r&&(n=cs(t,e,n,r,i)),!i&&(n=t(n,s))}return n},ac=(t,e=new vn)=>t.deps?.length?t.deps.reduce((n,s)=>ac(s,n.addDependency(t,s)),e):e.addNode(t),O1=t=>({tag:"decl",type:t.type,id:t}),cc=(t,e=!1)=>({tag:"scope",type:"void",body:t.filter(n=>n!=null).map(n=>n.tag==="sym"?O1(n):n),global:e}),L1=t=>{const e=t.filter(s=>s.tag!=="fn"),n=t.reduce((s,i)=>i.tag==="fn"?ac(i,s):s,new vn);return cc(e.concat(n.sort()),!0)};function*Ps(t){for(let e in t)t.hasOwnProperty(e)&&(yield t[e])}const T1=(t,e=t,n,s={})=>{const i=document.createElement("canvas");return ui(i,t,e,s.dpr),s.pixelated&&(i.style.imageRendering="pixelated"),n?.appendChild(i),{canvas:i,ctx:i.getContext("2d",s.ctx)}},Me=(t,e=t,n,s)=>T1(t,e,n,{dpr:1,...s}),ui=(t,e,n,s=window.devicePixelRatio||1)=>(s!==1&&(t.style.width=`${e}px`,t.style.height=`${n}px`),t.width=e*s,t.height=n*s,s),k1={alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},B1=(t={})=>{const e=t.canvas?B(t.canvas)?document.getElementById(t.canvas):t.canvas:document.createElement("canvas");t.width&&(e.width=t.width),t.height&&(e.height=t.height),t.autoScale!==!1&&ui(e,e.width,e.height),t.parent?.appendChild(e);const n=e.getContext(t.version!==1?"webgl2":"webgl",{...k1,...t.opts});return n||k("WebGL unavailable"),t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost),{canvas:e,gl:n,ext:lc(n,t.ext),resize:(s,i)=>{ui(e,s,i,t.autoScale!==!1?window.devicePixelRatio:1),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight)}}},lc=(t,e,n=!0)=>{const s={};if(e)for(let i of e)s[i]=t.getExtension(i),n&&!s[i]&&k(`extension ${i} not available`);return s},ls=ma.childLogger("webgl"),P1={a:"",v:"",u:"",o:""},G1={[at.GLES_100]:{number:100,attrib:(t,e,n)=>`attribute ${I(e)?e[0]:e} ${n.a}${t};`,varying:{vs:(t,e,n)=>_e("varying",e,n.v+t),fs:(t,e,n)=>_e("varying",e,n.v+t)},uniform:(t,e,n)=>_e("uniform",e,n.u+t),output:(t,e,n)=>I(e)?`#define ${n.o}${t} gl_FragData[${e[1]}]`:""},[at.GLES_300]:{number:300,attrib:(t,e,n)=>I(e)?`layout(location=${e[1]}) in ${e[0]} ${n.a}${t};`:`in ${e} ${n.a}${t};`,varying:{vs:(t,e,n)=>_e("out",e,n.v+t),fs:(t,e,n)=>_e("in",e,n.v+t)},uniform:(t,e,n)=>_e("uniform",e,n.u+t),output:(t,e,n)=>I(e)?`layout(location=${e[1]}) out ${e[0]} ${n.o}${t};`:`out ${e} ${n.o}${t};`}},_e=(t,e,n)=>{const s=I(e)?e[0]:e;return s.indexOf("[]")>0?`${t} ${s.replace("[]","")} ${n}[${e[1]}];`:`${t} ${s} ${n};`},uc=(t,e,n="")=>{let s=">=";return e||(e=n,n=null,s="<"),`#if __VERSION__ ${s} ${t}
${e}${n?`
#else
${n}`:""}
#endif`};uc(300,"","#define texture texture2D");const so=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp int;
precision highp float;
#else
precision mediump int;
precision mediump float;
#endif
${uc(300,"precision lowp sampler3D;")}
#ifndef PI
#define PI 3.141592653589793
#endif
#ifndef TAU
#define TAU 6.283185307179586
#endif
#ifndef HALF_PI
#define HALF_PI 1.570796326794896
#endif
`,U1=Object.freeze([1,0,0,1]),F1=Object.freeze([1,0,0,0,1,0,0,0,1]),fc=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Mt=t=>(e,n,s=0)=>{let i;return r=>{r=r===void 0?s:r,r!==i&&(e["uniform1"+t](n,r),i=r)}},R=(t,e)=>(n,s,i=e)=>{let r=[];return o=>{o=o===void 0?i:o,Bi(r,o)||(n["uniform"+t](s,o),r=[...o])}},ve=(t,e)=>(n,s,i=e)=>{let r=[];return o=>{o=o===void 0?i:o,Bi(r,o)||(n["uniformMatrix"+t](s,!1,o),r=[...o])}},Nt=[0],z1={bool:Mt("i"),float:Mt("f"),int:Mt("i"),uint:Mt("ui"),bvec2:R("2iv",pt),bvec3:R("3iv",bt),bvec4:R("4iv",Xt),ivec2:R("2iv",pt),ivec3:R("3iv",bt),ivec4:R("4iv",Xt),vec2:R("2fv",pt),vec3:R("3fv",bt),vec4:R("4fv",Xt),mat2:ve("2fv",U1),mat3:ve("3fv",F1),mat4:ve("4fv",fc),sampler2D:Mt("i"),sampler2DShadow:Mt("i"),sampler3D:Mt("i"),samplerCube:Mt("i"),samplerCubeShadow:Mt("i"),"bool[]":R("1iv",Nt),"float[]":R("1fv",Nt),"int[]":R("1iv",Nt),"uint[]":R("1uiv",Nt),"bvec2[]":R("2iv",pt),"bvec3[]":R("3iv",bt),"bvec4[]":R("4iv",Xt),"ivec2[]":R("2iv",pt),"ivec3[]":R("3iv",bt),"ivec4[]":R("4iv",Xt),"vec2[]":R("2fv",pt),"vec3[]":R("3fv",bt),"vec4[]":R("4fv",Xt),"mat2[]":ve("2fv",pt),"mat3[]":ve("3fv",bt),"mat4[]":ve("4fv",Xt),"sampler2D[]":R("1iv",Nt),"sampler2DShadow[]":R("1iv",Nt),"sampler3D[]":R("1iv",Nt),"samplerCube[]":R("1iv",Nt),"samplerCubeShadow[]":R("1iv",Nt)},H1=/ERROR: \d+:(\d+): (.*)/;class ur{gl;program;attribs;uniforms;state;warnAttrib=Jr(e=>ls.warn(`unknown attrib: ${e} (no further warnings will be shown...)`));warnUni=Jr(e=>ls.warn(`unknown uniform: ${e} (no further warnings will be shown...)`));constructor(e,n,s,i,r){this.gl=e,this.program=n,this.attribs=s,this.uniforms=i,this.state=r||{}}withState(e){return new ur(this.gl,this.program,this.attribs,this.uniforms,{...this.state,...e})}bind(e){return this.program?(this.gl.useProgram(this.program),this.bindAttribs(e.attribs),this.bindUniforms(e.uniforms),!0):!1}unbind(){let e;for(let n in this.attribs)(e=this.attribs[n])&&this.gl.disableVertexAttribArray(e.loc);return this.gl.useProgram(null),!0}release(){return this.program?(this.gl.deleteProgram(this.program),delete this.program,!0):!1}bindAttribs(e){const n=this.gl;let s;for(let i in e)if(s=this.attribs[i]){const r=e[i];r.buffer.bind(),n.enableVertexAttribArray(s.loc),n.vertexAttribPointer(s.loc,r.size||3,Sa(r.type||n.FLOAT),r.normalized||!1,r.stride||0,r.offset||0)}else this.warnAttrib(i)}bindUniforms(e={}){const n=this.uniforms;for(let s in e){const i=n[s];if(i){let r=e[s];r=ke(r)?r(n,e):mf(r),i.setter(r)}else this.warnUni(s)}for(let s in n)if(n.hasOwnProperty(s)&&(!e||!Ya(e[s]))){const i=n[s],r=i.defaultFn?i.defaultFn(n,e):i.defaultVal;i.setter(r)}}prepareState(e=this.state){const n=this.gl;e.depth!==void 0&&this.setState(n.DEPTH_TEST,e.depth),e.cull!==void 0&&(this.setState(n.CULL_FACE,e.cull),e.cullMode&&n.cullFace(e.cullMode)),e.blend!==void 0&&(this.setState(n.BLEND,e.blend),e.blendFn&&n.blendFunc(e.blendFn[0],e.blendFn[1]),e.blendEq!==void 0&&n.blendEquation(e.blendEq)),e.stencil!==void 0&&(this.setState(n.STENCIL_TEST,e.stencil),e.stencilFn&&n.stencilFunc(e.stencilFn[0],e.stencilFn[1],e.stencilFn[2]),e.stencilOp&&n.stencilOp(e.stencilOp[0],e.stencilOp[1],e.stencilOp[2]),e.stencilMask!==void 0&&n.stencilMask(e.stencilMask))}setState(e,n){n?this.gl.enable(e):this.gl.disable(e)}}const dc=(t,e,n)=>{const s=Be(t)?at.GLES_300:at.GLES_100,i=ke(e.vs)?oo(e,"vs",s,n):ao(e,"vs",s),r=ke(e.fs)?oo(e,"fs",s,n):ao(e,"fs",s),o=ls;o.debug(i),o.debug(r),e.ext&&V1(t,e.ext);const a=co(t,t.VERTEX_SHADER,i),c=co(t,t.FRAGMENT_SHADER,r),l=t.createProgram()||k("error creating shader program");if(t.attachShader(l,a),t.attachShader(l,c),t.linkProgram(l),t.getProgramParameter(l,t.LINK_STATUS)){const u=X1(t,l,e.attribs),f=x1(t,l,e.uniforms);return t.deleteShader(a),t.deleteShader(c),new ur(t,l,u,f,e.state)}throw new Error(`Error linking shader: ${t.getProgramInfoLog(l)}`)},kn=(t,e,n)=>{let s=[];for(let i in t)t.hasOwnProperty(i)&&s.push(e(i,t[i],n));return s.push(""),s.join(`
`)},q1=(t,e,n)=>{const s=Zf[t],i=n===at.GLES_300;return s&&(!i&&s.gl||i&&s.gl2)?`#extension ${s&&s.alias||t} : ${Dn(e)?e?"enable":"disable":e}
`:""},V1=(t,e)=>{for(let n in e){const s=e[n];(s===!0||s==="require")&&lc(t,[n],s==="require")}},hc=(t,e)=>{let n=t.pre?t.replacePrelude?t.pre:t.pre+`
`+so:so;if(t.ext)for(let s in t.ext)n+=q1(s,t.ext[s],e);return n},io=(t,e,n)=>{for(let s in e){const i=e[s];n[s]=I(i)?t(i[0],s,{loc:i[1]}):t(i,s)}},Y1=t=>{const[e,n]=I(t)?[t[0],{num:t[1]}]:[t,{}];return/(u?int|[ui]vec[234])/.test(e)&&(n.smooth="flat"),[e,n]},ro=(t,e,n)=>{for(let s in t.varying){const[i,r]=Y1(t.varying[s]);n[s]=e(i,s,r)}},W1=(t,e)=>{for(let n in t.uniforms){const s=t.uniforms[n];e[n]=I(s)?to(s[0],n,s[0].indexOf("[]")>0?{num:s[1]}:void 0):to(s,n)}},oo=(t,e,n,s={})=>{let i=hc(t,n);const r={},o={},a={},c={};if(t.uniforms&&W1(t,c),e==="vs")io(Kr,t.attribs,r),t.varying&&ro(t,Qr,o);else{t.varying&&ro(t,Kr,r);const u=t.outputs||Va;if(n>=at.GLES_300)io(Qr,u,o);else for(let f in u){const d=u[f];I(d)&&d[0]==="vec4"?(i+=`#define ${f} gl_FragData[${d[1]}]
`,a[f]=et("vec4",f)):Et(`GLSL ${n} doesn't support output vars`)}}const l=h1({type:e,version:n,prelude:i,prec:s.prec});return l(L1([...Ps(c),...Ps(r),...Ps(o),...t[e](l,c,r,{...o,...a})]))+(t.post?`
`+t.post:"")},ao=(t,e,n)=>{const s=G1[n],i={...P1,...t.declPrefixes},r=e==="vs";let o="";return o+=`#version ${n}
`,o+=hc(t,n),t.generateDecls!==!1&&(o+=r?kn(t.attribs,s.attrib,i):kn(t.outputs||Va,s.output,i),o+=kn(t.varying,s.varying[e],i),o+=kn(t.uniforms,s.uniform,i)),o+=t[e],t.post&&(o+=`
`+t.post),o},co=(t,e,n)=>{const s=t.createShader(e)||k("error creating shader");return t.shaderSource(s,n),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:j1(t,s,n)},j1=(t,e,n)=>{const s=n.split(`
`),r=t.getShaderInfoLog(e).split(`
`).map(o=>{const a=H1.exec(o),c=a?a[1]:null;if(c)return`line ${c}: ${a[2]}
${s[parseInt(c)-1]}`}).filter(Ya).join(`
`);return k(`Error compiling shader:
${r}`)},X1=(t,e,n)=>{const s={};for(let i in n){const r=n[i],[o,a]=I(r)?r:[r,null],c=i;a!=null?(t.bindAttribLocation(e,a,c),s[i]={type:o,loc:a}):s[i]={type:o,loc:t.getAttribLocation(e,c)}}return s},x1=(t,e,n={})=>{const s={};for(let i in n){const r=n[i];let o,a,c,l,u;I(r)?([o,a,c]=r,l=o.indexOf("[]")<0?a:c,ke(l)&&(u=l,l=void 0)):o=r;const f=t.getUniformLocation(e,i);if(f!=null){const d=z1[o];d?s[i]={loc:f,setter:d(t,f,l),defaultFn:u,defaultVal:l,type:o}:k(`invalid uniform type: ${o}`)}else ls.warn(`unknown uniform: ${i}`)}return s};class gc{gl;buffer;target;mode;data;constructor(e,n,s=e.ARRAY_BUFFER,i=e.STATIC_DRAW,r=!1){this.gl=e,this.buffer=e.createBuffer()||k("error creating WebGL buffer"),this.target=s,this.mode=i,n&&(this.set(n),r&&(this.data=n))}bind(){return this.gl.bindBuffer(this.target,this.buffer),!0}unbind(){return this.gl.bindBuffer(this.target,null),!0}release(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),delete this.buffer),!0}update(){this.data&&this.set(this.data)}set(e,n=this.mode){this.bind(),this.gl.bufferData(this.target,e,n),this.data&&(this.data=e)}setChunk(e,n=0){this.bind(),this.gl.bufferSubData(this.target,n,e),this.data&&this.data.set(e,n>>>$0[B0(e)])}}const Z1=(t,e,n=t.ARRAY_BUFFER,s=t.STATIC_DRAW,i=!1)=>new gc(t,e,n,s,i),lo=(t,e,n=t.STATIC_DRAW)=>(e.attribPool?e.attribs=fo(t,e.attribPool,void 0,t.ARRAY_BUFFER,n):uo(t,e.attribs,n),e.instancePool?e.instances={attribs:fo(t,e.instancePool,void 0,t.ARRAY_BUFFER,n),num:e.instancePool.capacity}:e.instances&&uo(t,e.instances.attribs,n),J1(t,e.indices,n),e.mode==null&&(e.mode=er.TRIANGLES),Bt(e.shader)&&(e.shader=dc(t,e.shader)),e),mc=(t,e,n,s)=>{e.buffer?e.data&&e.buffer.set(e.data):e.buffer=new gc(t,e.data,n,s,e.retain)},uo=(t,e,n)=>{if(e)for(let s in e)mc(t,e[s],t.ARRAY_BUFFER,n);return e},J1=(t,e,n=t.STATIC_DRAW)=>(e&&mc(t,e,t.ELEMENT_ARRAY_BUFFER,n),e),fo=(t,e,n,s=t.ARRAY_BUFFER,i=t.STATIC_DRAW)=>{const r=Z1(t,e.bytes(),s,i,!0),o={};for(let a of Object.keys(e.specs)){const c=e.specs[a];o[a]={buffer:r,size:c.size,type:Sa(c.type),stride:e.byteStride,offset:c.byteOffset}}return o},pc=t=>e=>{if(e)for(let n=e.length,s;n-- >0;)(s=e[n])&&s[t](n)},K1=pc("bind"),Q1=pc("unbind");class td{gl;tex;target;format;filter;wrap;type;size;constructor(e,n={}){this.gl=e,this.tex=e.createTexture()||k("error creating WebGL texture"),this.configure({filter:rs.NEAREST,wrap:os.CLAMP,...n})}configure(e={},n=!0){const s=this.gl,i=e.target||this.target||Re.TEXTURE_2D,r=e.format||this.format||Nn.RGBA,o=ln[r],a=e.type||this.type||o.types[0];return!this.target&&(this.target=i),this.format=r,this.type=a,s.bindTexture(this.target,this.tex),e.flip!==void 0&&s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.flip?1:0),e.premultiply!==void 0&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiply?1:0),this.configureImage(i,e),e.mipmap&&s.generateMipmap(i),this.configureFilter(i,e),this.configureWrap(i,e),this.configureLOD(i,e),this.configureLevels(i,e),n&&s.bindTexture(this.target,null),!0}configureImage(e,n){n.image!==void 0&&(e===Re.TEXTURE_3D?this.configureImage3d(e,n):this.configureImage2d(e,n))}configureImage2d(e,n){const s=n.level||0,i=n.pos||[0,0,0],{image:r,width:o,height:a}=n,l=ln[this.format].format,{gl:u,type:f,format:d}=this;o&&a?n.sub?u.texSubImage2D(e,s,i[0],i[1],o,a,l,f,r):(s===0&&(this.size=[o,a]),u.texImage2D(e,s,d,o,a,0,l,f,r)):n.sub?u.texSubImage2D(e,s,i[0],i[1],l,f,r):(r!=null&&s===0&&(this.size=[r.width,r.height]),u.texImage2D(e,s,d,l,f,r))}configureImage3d(e,n){const{image:s,width:i,height:r,depth:o}=n;if(!(i&&r&&o))return;const a=n.level||0,c=n.pos||[0,0,0],u=ln[this.format].format,{gl:f,type:d,format:h}=this;n.sub?f.texSubImage3D(e,a,c[0],c[1],c[2],i,r,o,u,d,s):(a===0&&(this.size=[i,r,o]),f.texImage3D(e,a,h,i,r,o,0,u,d,s))}configureFilter(e,n){const s=this.gl,i=n.filter||this.filter||rs.NEAREST;let r,o;I(i)?(r=i[0],o=i[1]||r,this.filter=[r,o]):(this.filter=[i,i,i],r=o=i),s.texParameteri(e,s.TEXTURE_MIN_FILTER,r),s.texParameteri(e,s.TEXTURE_MAG_FILTER,o)}configureWrap(e,n){const s=this.gl,i=n.wrap||this.wrap||os.CLAMP;let r,o,a;I(i)?(r=i[0],o=i[1]||r,a=i[2]||r,this.wrap=[r,o,a]):(r=o=a=i,this.wrap=[i,i,i]),s.texParameteri(e,s.TEXTURE_WRAP_S,r),s.texParameteri(e,s.TEXTURE_WRAP_T,o),Be(s)&&e===s.TEXTURE_3D&&s.texParameteri(e,s.TEXTURE_WRAP_R,a)}configureLOD(e,n){const s=this.gl;if(n.lod){const[i,r]=n.lod;i&&s.texParameterf(e,s.TEXTURE_MIN_LOD,i),r&&s.texParameterf(e,s.TEXTURE_MAX_LOD,r)}}configureLevels(e,n){const s=this.gl;if(n.minMaxLevel){const[i,r]=n.minMaxLevel;s.texParameteri(e,s.TEXTURE_BASE_LEVEL,i),s.texParameteri(e,s.TEXTURE_MAX_LEVEL,r)}}bind(e=0){const n=this.gl;return n.activeTexture(n.TEXTURE0+e),n.bindTexture(this.target,this.tex),!0}unbind(e=0){const n=this.gl;return n.activeTexture(n.TEXTURE0+e),n.bindTexture(this.target,null),!0}release(){return this.tex?(this.gl.deleteTexture(this.tex),delete this.tex,delete this.gl,!0):!1}}const Ne=(t,e)=>new td(t,e),ed=(t,e={})=>{const n=I(t)?t:[t];for(let s=0,i=n.length;s<i;s++){const r=n[s],o=r.indices,a=r.shader.gl;e.bindTex!==!1&&K1(r.textures),e.shaderState!==!1&&r.shader.prepareState(),e.bindShader!==!1&&r.shader.bind(r),o?.buffer?(o.buffer.bind(),r.instances?ho(a,r):a.drawElements(r.mode,r.num,o.data instanceof Uint32Array?a.UNSIGNED_INT:a.UNSIGNED_SHORT,0)):r.instances?ho(a,r):a.drawArrays(r.mode,0,r.num),e.unbindShader!==!1&&r.shader.unbind(null),e.unbindTex&&Q1(r.textures)}},ho=(t,e)=>{const n=Be(t),s=n?void 0:t.getExtension("ANGLE_instanced_arrays");n||s||k("instancing not supported");const i=e.shader.attribs,r=e.instances.attribs;e.shader.bindAttribs(r);for(let o in r){const a=i[o];if(a){let c=r[o].divisor;c=c!==void 0?c:1,n?t.vertexAttribDivisor(a.loc,c):s.vertexAttribDivisorANGLE(a.loc,c)}}if(e.indices){const o=e.indices.data instanceof Uint32Array?t.UNSIGNED_INT:t.UNSIGNED_SHORT;n?t.drawElementsInstanced(e.mode,e.num,o,0,e.instances.num):s.drawElementsInstancedANGLE(e.mode,e.num,o,0,e.instances.num)}else n?t.drawArraysInstanced(e.mode,0,e.num,e.instances.num):s.drawArraysInstancedANGLE(e.mode,0,e.num,e.instances.num);for(let o in r){const a=i[o];a&&(n?t.vertexAttribDivisor(a.loc,0):s.vertexAttribDivisorANGLE(a.loc,0))}e.shader.unbind(null)};class nd{gl;buffer;format;width;height;constructor(e,n){this.gl=e,this.buffer=e.createRenderbuffer()||k("error creating RBO"),this.configure(n)}bind(){return this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.buffer),!0}unbind(){return this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),!0}release(){return this.gl.deleteRenderbuffer(this.buffer),delete this.buffer,!0}configure(e,n=!0){const s=this.gl;return this.bind(),this.format=e.format||s.DEPTH_COMPONENT16,this.width=e.width,this.height=e.height,s.renderbufferStorage(s.RENDERBUFFER,e.format||s.DEPTH_COMPONENT16,e.width,e.height),n?this.unbind():!0}}const sd=36064,id=36063;class rd{gl;fbo;ext;maxAttachments;constructor(e,n){this.gl=e,this.fbo=e.createFramebuffer()||k("error creating FBO"),this.ext=!Be(e)&&n?.tex&&n.tex.length>1?e.getExtension("WEBGL_draw_buffers")||k("missing WEBGL_draw_buffers ext"):void 0,this.maxAttachments=e.getParameter(id),n&&this.configure(n)}bind(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),!0}unbind(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),!0}release(){return this.gl.deleteFramebuffer(this.fbo),delete this.fbo,delete this.ext,!0}configure(e,n=!0){const s=this.gl;if(this.bind(),e.tex){M(e.tex.length<this.maxAttachments,`too many attachments (max. ${this.maxAttachments})`);const i=[];for(let r=0;r<e.tex.length;r++){const o=e.tex[r];M(!!(ln[o.format].render||ln[o.format].renderExt),`texture #${r} has non-renderable format`);const a=sd+r;s.framebufferTexture2D(s.FRAMEBUFFER,a,s.TEXTURE_2D,o.tex,0),i[r]=a}this.ext?this.ext.drawBuffersWEBGL(i):Be(s)&&s.drawBuffers(i)}return e.depth&&(e.depth instanceof nd?s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e.depth.buffer):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,e.depth.tex,0)),this.validate(),n?this.unbind():!0}validate(){const e=this.gl,n=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(n){case e.FRAMEBUFFER_COMPLETE:return!0;case e.FRAMEBUFFER_UNSUPPORTED:k("FBO unsupported");case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:k("FBO incomplete attachment");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:k("FBO incomplete dimensions");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:k("FBO incomplete missing attachment");default:return k(`FBO error: ${n}`)}}}const od=(t,e)=>new rd(t,e),yn=(t,e)=>(M(t.tag!=="swizzle"||t.val.tag==="sym","can't assign to non-symbol swizzle"),{tag:"assign",type:t.type,l:t,r:e}),ad=t=>{const[e,n,s]=B(t)?[t]:t;return{tag:"arg",type:e,id:n||lr(),opts:{q:"in",...s}}};function cd(t,e,n,s){e=e||lr();const i=n.map(ad),r=s(...i.map(c=>et(c.type,c.id,c.opts))).filter(c=>c!=null);cs((c,l)=>(l.tag==="ret"&&(M(l.type===t,`wrong return type for function '${e}', expected ${t}, got ${l.type}`),c++),c),oc,0,r);const o=cs((c,l)=>(l.tag==="call"&&l.fn&&c.push(l.fn),c),C1,[],r),a=(...c)=>ld(a,...c);return Object.assign(a,{tag:"fn",type:t,id:e,args:i,deps:o,scope:cc(r)})}const Es=t=>cd("void","main",[],t);function ld(t,...e){return B(t)?{tag:"call",type:e[0],id:t,args:e.slice(1)}:{tag:"call",type:t.type,id:t.id,args:e,fn:t}}const go=(t,e,...n)=>({tag:"call_i",type:e,id:t,args:n});function ud(t,e){const n=t.type[0],s=(i,r)=>e.length===1?i:r+e.length;return{tag:"swizzle",type:n==="i"?s(ws,"ivec"):n==="u"?s(nr,"uvec"):n==="b"?s(Wa,"bvec"):s($n,"vec"),val:t,id:e}}function fd(t){return ud(t,"xy")}const mo=t=>{const e=t.type[0],n=t.type.indexOf("Shadow")>0;return e==="s"?n?$n:Ie:e==="i"?n?ws:"ivec4":e==="u"?n?nr:"uvec4":lt(`unknown sampler type ${t.type}`)},bc=(t,e,n,s)=>{const i=s?go(t,mo(e),e,...n,s):go(t,mo(e),e,...n);return!Fe(i)&&(i.info="n"),i};function dd(t,e,n){return bc("texture",t,[e],n)}function hd(t,e,n){return bc("texelFetch",t,[e,n])}function fi(t){return t?dn(fi(),t):ys(()=>({}),(e,[n,s])=>(e[n]=s,e))}function di(...t){const e=vu(di,t);if(e!==void 0)return e;const n=t[0];return ys(()=>!1,n?(s,i)=>n(i)?$r(!0):s:(s,i)=>i?$r(!0):s)}function _c(t,e){return Ue(e)?na(_c(t),B(e)?[e]:e):n=>{const s=n[2],i=(r,o)=>{const a=t(o);if(a){for(let c of a)if(r=i(r,c),kt(r))break;return r}return s(r,o)};return Rn(n,i)}}function gd(t){return _c(e=>pf(e)?e:void 0,t)}const md=()=>Jn,pd=(t,e=0,n=t.length,s=de)=>{for(M(e>=0&&n>=e&&n<=t.length,`illegal range ${e}..${n}`);n>e+1;){const i=s.minmax(e,n)|0,r=t[i];t[i]=t[--n],t[n]=r}return t},bd=(t,e=t.length,n=de)=>pd(t,0,e,n),vc=(t,e)=>t-e,_d=(t,e)=>e-t,vd=(t,e,n=o=>o,s=Qi,i=0,r=t.length-1)=>{const o=n(e);for(;i<=r;){const a=i+r>>>1,c=s(n(t[a]),o);if(c<0)i=a+1;else if(c>0)r=a-1;else return a}return-i-1},fr=(t={})=>{let{size:e=2,uv:n=!0,center:s=!0}=t;e*=.5;const i=s?0:e;return{attribs:{position:{data:new Float32Array([i-e,i-e,i+e,i-e,i-e,i+e,i+e,i+e]),size:2},...n?{uv:{data:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}:null},uniforms:{},shader:null,mode:er.TRIANGLE_STRIP,num:4}},yd=(t,e,n)=>[Es(()=>[yn(t.gl_Position,nc(n.position,ir,Ka))])],Ad=(t,e,n,s)=>[Es(()=>[yn(s.v_uv,n.uv),yn(t.gl_Position,nc(n.position,ir,Ka))])],wd=(t,e,n,s)=>[Es(()=>[yn(s.fragColor,dd(e.tex,n.v_uv))])],yc={vs:Ad,fs:wd,attribs:{position:Se,uv:Se},varying:{v_uv:Se},uniforms:{tex:ja},state:{depth:!1},ext:{}},Ac=t=>{const e=t.gl,n=t.passes.length;M(n>0,"require at least one shader pass");const s=!t.passes[n-1].outputs.length,i=Id(t),r=Ed(t,i),o=Md(t,i,s),a=(g,m,_=!0)=>{_&&o[g].bind();const b=t.passes[g],v=r[g],N=v.shader,D=b.outputs.length?i[b.outputs[0]].size:[e.drawingBufferWidth,e.drawingBufferHeight];N.uniforms.resolution&&(v.uniforms.resolution=D),N.uniforms.time&&(v.uniforms.time=m),e.viewport(0,0,D[0],D[1]),ed(v),_&&o[g].unbind()},c=g=>{for(let m=0;m<o.length;m++)a(m,g);s&&a(n-1,g,!1)},l=()=>{c((Date.now()-f)*.001),u&&(d=requestAnimationFrame(l))};let u,f=Date.now(),d;return{start(){f=Date.now(),u=!0,d=requestAnimationFrame(l)},stop(){u&&(u=!1,cancelAnimationFrame(d))},update(g){c(g)},singlePass(g,m){a(g,m,g<o.length)},passes:t.passes,fbos:o,models:r,textures:i}},Ed=(t,e)=>{const n=t.gl,s=lo(n,fr({uv:!1}));return t.passes.map(i=>{const r=i.model?lo(n,i.model):{...s};return r.shader=Sd(n,i,e),r.uniforms={...i.uniformVals},i.inputs.length>0&&(r.textures=i.inputs.map(o=>e[o])),r})},Rd={[Re.TEXTURE_2D]:ja,[Re.TEXTURE_3D]:Qf,[Re.TEXTURE_CUBE_MAP]:"samplerCube"},Sd=(t,e,n)=>{const s=Be(t),i=e.outputs.length,r={...e.ext},o={vs:e.vs||yd,fs:e.fs,attribs:e.attribs||{position:Se},varying:e.varying,uniforms:{...e.uniforms,...Lt(Ua((l,u)=>[`input${l}`,[Rd[n[u].target],l]]),fi(),e.inputs)},outputs:i?Lt(H(l=>[`output${l}`,[Ie,l]]),fi(),Fa(i)):void 0,state:e.state,pre:e.pre,post:e.post,replacePrelude:e.replacePrelude,generateDecls:e.generateDecls,ext:r},a=di(l=>Zr(n[l]),e.inputs),c=di(l=>Zr(n[l]),e.outputs);return s||(a&&(r.OES_texture_float="require"),i>1&&(r.WEBGL_draw_buffers="require")),c&&(r[s?"EXT_color_buffer_float":"WEBGL_color_buffer_float"]="require",s&&(r.EXT_float_blend="require")),dc(t,o)},Id=t=>Object.keys(t.textures).reduce((e,n)=>(e[n]=Ne(t.gl,{width:t.width,height:t.height,depth:t.depth,filter:rs.NEAREST,wrap:os.CLAMP,image:null,...t.textures[n]}),e),{}),Md=(t,e,n)=>(n?t.passes.slice(0,t.passes.length-1):t.passes).map(s=>od(t.gl,{tex:s.outputs.map(i=>e[i])})),wc=(t,e)=>(M(t.length===e.length,"require same number of in/out textures"),{fs:(n,s,i,r)=>[Es(()=>[...H(o=>yn(r[`output${o}`],hd(s[`input${o}`],l1(fd(n.gl_FragCoord)),Qa)),Fa(t.length))])],inputs:t,outputs:e});function Nd(t,e,n,s){let i,r;if(y(t)){const c=Me(t,e,n,s);i=c.canvas,r=c.ctx}else i=t,r=i.getContext("2d");const o=r.getImageData(0,0,i.width,i.height),a=new Uint32Array(o.data.buffer);return{canvas:i,ctx:r,img:o,data:a}}var At=(t=>(t[t.ALPHA=0]="ALPHA",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t[t.RED=3]="RED",t))(At||{});const Dd=["rotateCW","rotate180","rotateCCW"],$d=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/255,hi=(t,e,n,s,i,r,o=0,a=0)=>(t|=0,e|=0,n|=0,s|=0,t<0&&(n+=t,o-=t,t=0),e<0&&(s+=e,a-=e,e=0),[t,e,ft(n,0,i-t),ft(s,0,r-e),o,a]),po=(t,e,n={})=>{const s=t.width,i=e.width;let r,o,a,c,l,u;return[r,o,l,u]=hi(n.sx||0,n.sy||0,n.w||s,n.h||t.height,s,t.height),[a,c,l,u,r,o]=hi(n.dx||0,n.dy||0,l,u,i,e.height,r,o),{sx:r,sy:o,dx:a,dy:c,rw:l,rh:u}},Cd=(t,e,n)=>{for(let s=t.length;s-- >0;)t[s]=n(t[s],e)},Od=(t,e,n,s)=>{for(let i=t.length;i-- >0;)t[i]=s(t[i],n(e[i]))},Ld=(t,e,n,s,i)=>{const r=~i;for(let o=t.length;o-- >0;)t[o]=t[o]&r|n(s(e[o]))&i},bo=(t,e,n)=>{const s=e.fromABGR,i=e.toABGR;for(let r=t.length;r-- >0;)t[r]=s(n(i(t[r])))},_o=t=>(t&255)<<16|t>>16&255|t&4278255360,Td=(t,e,n={})=>(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):e).putImageData(t.toImageData(n.data),n.x||0,n.y||0),gi=(t,e)=>e>0?`(${t} << ${e})`:e<0?`(${t} >>> ${-e})`:`${t}`,dr=(t,e)=>gi(t,-e),Ec=t=>`0x${t.toString(16)}`,kd=t=>{const e=8-t,n=(1<<t)-1;return new Function("luma",`return (x) => ${dr("luma(x)",e)} & ${n};`)($d)},Bd=t=>{let e;if(t!==8){const n=(1<<t)-1,s=255/n;e=`(((x & ${n}) * ${s}) | 0)`}else e="x";return new Function("x",`return 0xff000000 | (${e} * 0x010101);`)},Pd=t=>new Function("x","return ("+t.map(e=>{const n=e.abgrShift+(8-e.size);return`(${dr("x",n)} & ${Ec(e.maskA)})`}).join(" | ")+") >>> 0;"),Gd=(t,e)=>{const n=t.map(i=>{if(i.size!==8){const r=i.mask0,o=255/r,a=dr("x",i.shift);return gi(`((${a} & ${r}) * ${o})`,24-i.lane*8)}else return gi(`(x & ${Ec(i.maskA)})`,i.abgrShift)}).join(" | "),s=e?"":"0xff000000 | ";return new Function("x",`return (${s}${n}) >>> 0;`)},Ud=(t,e,n)=>{const s=1<<t.size,i=s-1,r=i<<n>>>0,o=~r>>>0,a=t.lane!=null?t.lane:e,c=u=>u>>>n&i,l=(u,f)=>u&o|(f&i)<<n;return{size:t.size,num:s,abgrShift:24-a*8-n,lane:a,shift:n,mask0:i,maskA:r,int:c,setInt:l,float:u=>c(u)/i,setFloat:(u,f)=>l(u,A(f)*i)}},hr=t=>{M(t.channels.length>0,"no channel specs given");const e=t.channels.reduce(([n,s],i,r)=>(s-=i.size,n.push(Ud(i,r,s)),[n,s]),[[],t.size])[0];return{__packed:!0,type:t.type,size:t.size,alpha:t.alpha||0,channels:e,fromABGR:t.fromABGR||Pd(e),toABGR:t.toABGR||Gd(e,!!t.alpha)}},Fd=hr({type:"u32",size:32,alpha:8,channels:[{size:8,lane:At.ALPHA},{size:8,lane:At.RED},{size:8,lane:At.GREEN},{size:8,lane:At.BLUE}],fromABGR:_o,toABGR:_o});Cn({order(){return[0]},includes(t){return t>=0&&t<this.size[0]},indexAt(t){return this.includes(t)?this.indexAtUnsafe(t):-1},indexAtUnsafe(t){return this.offset+(t|0)*this.stride[0]},getAt(t){return this.includes(t)?this.data[this.indexAtUnsafe(t)]:0},getAtUnsafe(t){return this.data[this.indexAtUnsafe(t)]},setAt(t,e){return this.includes(t)?(this.data[this.indexAtUnsafe(t)]=e,!0):!1},setAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t)]=e,!0}});const Rc=Cn({order(){return Math.abs(this.stride[1])>Math.abs(this.stride[0])?[1,0]:[0,1]},includes(t,e){const n=this.size;return t>=0&&t<n[0]&&e>=0&&e<n[1]},indexAt(t,e){return this.includes(t,e)?this.indexAtUnsafe(t,e):-1},indexAtUnsafe(t,e){return this.offset+(t|0)*this.stride[0]+(e|0)*this.stride[1]},getAt(t,e){return this.includes(t,e)?this.data[this.indexAtUnsafe(t,e)]:0},getAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t,e)]},setAt(t,e,n){return this.includes(t,e)?(this.data[this.indexAtUnsafe(t,e)]=n,!0):!1},setAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e)]=n,!0}});Cn({order(){return Sc(this.stride)},includes(t,e,n){const s=this.size;return t>=0&&t<s[0]&&e>=0&&e<s[1]&&n>=0&&n<s[2]},indexAt(t,e,n){return this.includes(t,e,n)?this.indexAtUnsafe(t,e,n):-1},indexAtUnsafe(t,e,n){const s=this.stride;return this.offset+(t|0)*s[0]+(e|0)*s[1]+(n|0)*s[2]},getAt(t,e,n){return this.includes(t,e,n)?this.data[this.indexAtUnsafe(t,e,n)]:0},getAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e,n)]},setAt(t,e,n,s){return this.includes(t,e,n)?(this.data[this.indexAtUnsafe(t,e,n)]=s,!0):!1},setAtUnsafe(t,e,n,s){return this.data[this.indexAtUnsafe(t,e,n)]=s,!0}});Cn({order(){return Sc(this.stride)},includes(t,e,n,s){const i=this.size;return t>=0&&t<i[0]&&e>=0&&e<i[1]&&n>=0&&n<i[2]&&s>=0&&s<i[3]},indexAt(t,e,n,s){return this.includes(t,e,n,s)?this.indexAtUnsafe(t,e,n,s):-1},indexAtUnsafe(t,e,n,s){const i=this.stride;return this.offset+(t|0)*i[0]+(e|0)*i[1]+(n|0)*i[2]+(s|0)*i[3]},getAt(t,e,n,s){return this.includes(t,e,n,s)?this.data[this.indexAtUnsafe(t,e,n,s)]:0},getAtUnsafe(t,e,n,s){return this.data[this.indexAtUnsafe(t,e,n,s)]},setAt(t,e,n,s,i){return this.includes(t,e,n,s)?(this.data[this.indexAtUnsafe(t,e,n,s)]=i,!0):!1},setAtUnsafe(t,e,n,s,i){return this.data[this.indexAtUnsafe(t,e,n,s)]=i,!0}});const Sc=t=>[...t].map((e,n)=>[e,n]).sort((e,n)=>Math.abs(n[0])-Math.abs(e[0])).map(e=>e[1]),zd=t=>{const e=(t>>>24)/255;return t&4278190080|(t>>>16&255)*e<<16|(t>>>8&255)*e<<8|(t&255)*e},Hd=t=>{const e=(t>>>24)/255;return e>0?(t&4278190080|Math.min(255,(t>>>16&255)/e)<<16|Math.min(255,(t>>>8&255)/e)<<8|Math.min(255,(t&255)/e))>>>0:t},qd=t=>{const e=t>>>24;return(t>>>16&255)<=e&&(t>>>8&255)<=e&&(t&255)<=e},Vd=(t,e,n,s=1)=>M(t.length>=e*n*s,"pixel buffer too small"),Yd=(t,e,n)=>t?(Ic(t,e,n),t):new ImageData(e,n),Ic=(t,e,n)=>M(t.width===e&&t.height===n,"imagedata has wrong dimensions"),Bn=(t,e)=>{const n=t.channels[e];return M(n!=null,`invalid channel ID: ${e}`),n},Wd=t=>M(!!t.alpha,"missing alpha channel"),mi=hr({type:"u32",size:32,alpha:8,channels:[{size:8,lane:At.ALPHA},{size:8,lane:At.BLUE},{size:8,lane:At.GREEN},{size:8,lane:At.RED}],fromABGR:Jn,toABGR:Jn}),jd=(t,e,n=e,s,i)=>{const r=y(e)&&y(n)?Me(e,n,s,i):Me(t.width,t.height,s,i);return r.ctx.drawImage(t,0,0,r.canvas.width,r.canvas.height),r},Xd=async(t,e="anonymous")=>{const n=new Image;return n.crossOrigin=e,n.src=t,await n.decode(),n},xd=Xd;function Zd(t,e="linear",n="clamp"){const s=!!t.format.__float,i=t.format.channels.length===1?"1":"",r=`${e[0]}${n[0]}${i}`,o=(s?{nc1:Pn,nw1:Gn,nr1:Un,nc:Pn,nw:Gn,nr:Un,lc1:a=>Gs(Ft(a)),lw1:a=>Gs(zt(a)),lr1:a=>Gs(Ht(a)),lc:a=>Fs(a,Pn(a)),lw:a=>Fs(a,Gn(a)),lr:a=>Fs(a,Un(a)),cc1:a=>Hs(Ft(a)),cw1:a=>Hs(zt(a)),cr1:a=>Hs(Ht(a)),cc:a=>Vs(a,Pn(a)),cw:a=>Vs(a,Gn(a)),cr:a=>Vs(a,Un(a))}:{nc1:Ft,nw1:zt,nr1:Ht,nc:Ft,nw:zt,nr:Ht,lc1:a=>jn(Ft(a)),lw1:a=>jn(zt(a)),lr1:a=>jn(Ht(a)),lc:a=>Us(a,Ft(a)),lw:a=>Us(a,zt(a)),lr:a=>Us(a,Ht(a)),cc1:a=>zs(a,Ft(a)),cw1:a=>zs(a,zt(a)),cr1:a=>zs(a,Ht(a)),cc:a=>qs(a,Ft(a)),cw:a=>qs(a,zt(a)),cr:a=>qs(a,Ht(a))})[r];return M(!!o,`missing impl for ${r}`),o(t)}const Ft=({data:t,width:e,height:n})=>(s,i)=>s>=0&&s<e&&i>=0&&i<n?t[(i|0)*e+(s|0)]:0,zt=({data:t,width:e,height:n})=>(s,i)=>t[es(i|0,n)*e+es(s|0,e)],Ht=({data:t,width:e,height:n})=>{const s=e-1,i=n-1;return(r,o)=>t[ft(o|0,0,i)*e+ft(r|0,0,s)]},Pn=({data:t,width:e,height:n,stride:[s,i]})=>(r,o)=>{let a;return r>=0&&r<e&&o>=0&&o<n?(a=(o|0)*i+(r|0)*s,t.slice(a,a+s)):[0]},Gn=({data:t,width:e,height:n,stride:[s,i]})=>(r,o)=>{let a=es(o|0,n)*i+es(r|0,e)*s;return t.slice(a,a+s)},Un=({data:t,width:e,height:n,stride:[s,i]})=>{const r=e-1,o=n-1;return(a,c)=>{let l=ft(c|0,0,o)*i+ft(a|0,0,r)*s;return t.slice(l,l+s)}},Ke=(t,e,n,s,i=4)=>da(t[s],t[s+i],t[s+2*i],t[s+3*i],e,n),jn=t=>(e,n)=>(e-=.5,n-=.5,da(t(e,n),t(e+1,n),t(e,n+1),t(e+1,n+1),P(e),P(n))),Gs=t=>(t=jn(t),(e,n)=>[t(e,n)]),Us=(t,e)=>{const{fromABGR:n,toABGR:s}=t.format,i=new Uint32Array(4),r=new Uint8Array(i.buffer);return(o,a)=>{o-=.5,a-=.5,i[0]=s(e(o,a)),i[1]=s(e(o+1,a)),i[2]=s(e(o,a+1)),i[3]=s(e(o+1,a+1));const c=P(o),l=P(a);return n(Ke(r,c,l,0)|Ke(r,c,l,1)<<8|Ke(r,c,l,2)<<16|Ke(r,c,l,3)<<24)>>>0}},Fs=({stride:[t]},e)=>{const n=new Float32Array(t*4);return(s,i)=>{s-=.5,i-=.5,n.set(e(s,i),0),n.set(e(s+1,i),t),n.set(e(s,i+1),t*2),n.set(e(s+1,i+1),t*3);const r=P(s),o=P(i);let a=[];for(let c=0;c<t;c++)a.push(Ke(n,r,o,c,t));return a}},Mc=t=>(e,n)=>{e-=.5,n-=.5;const s=e-1,i=e+1,r=e+2,o=n-1,a=n+1,c=n+2;return ha(t(s,o),t(e,o),t(i,o),t(r,o),t(s,n),t(e,n),t(i,n),t(r,n),t(s,a),t(e,a),t(i,a),t(r,a),t(s,c),t(e,c),t(i,c),t(r,c),P(e),P(n))},zs=(t,e)=>{const n=t.format.channels[0].mask0;return e=Mc(e),(s,i)=>ft(e(s,i),0,n)},Hs=t=>(t=Mc(t),(e,n)=>[t(e,n)]),Nc=(t,e,n,s,i=4)=>ha(t[s],t[s+i],t[s+2*i],t[s+3*i],t[s+4*i],t[s+5*i],t[s+6*i],t[s+7*i],t[s+8*i],t[s+9*i],t[s+10*i],t[s+11*i],t[s+12*i],t[s+13*i],t[s+14*i],t[s+15*i],e,n),Fn=(t,e,n,s,i=4)=>ft(Nc(t,e,n,s,i),0,255),qs=(t,e)=>{const{fromABGR:n,toABGR:s}=t.format,i=new Uint32Array(16),r=new Uint8Array(i.buffer);return(o,a)=>{o-=.5,a-=.5;const c=o-1,l=o+1,u=o+2,f=a-1,d=a+1,h=a+2,g=P(o),m=P(a);return i[0]=s(e(c,f)),i[1]=s(e(o,f)),i[2]=s(e(l,f)),i[3]=s(e(u,f)),i[4]=s(e(c,a)),i[5]=s(e(o,a)),i[6]=s(e(l,a)),i[7]=s(e(u,a)),i[8]=s(e(c,d)),i[9]=s(e(o,d)),i[10]=s(e(l,d)),i[11]=s(e(u,d)),i[12]=s(e(c,h)),i[13]=s(e(o,h)),i[14]=s(e(l,h)),i[15]=s(e(u,h)),n(Fn(r,g,m,0)|Fn(r,g,m,1)<<8|Fn(r,g,m,2)<<16|Fn(r,g,m,3)<<24)>>>0}},Vs=({stride:[t]},e)=>{const n=new Float32Array(t*16);return(s,i)=>{s-=.5,i-=.5;const r=s-1,o=s+1,a=s+2,c=i-1,l=i+1,u=i+2,f=P(s),d=P(i);n.set(e(r,c),0),n.set(e(s,c),t),n.set(e(o,c),2*t),n.set(e(a,c),3*t),n.set(e(r,i),4*t),n.set(e(s,i),5*t),n.set(e(o,i),6*t),n.set(e(a,i),7*t),n.set(e(r,l),8*t),n.set(e(s,l),9*t),n.set(e(o,l),10*t),n.set(e(a,l),11*t),n.set(e(r,u),12*t),n.set(e(s,u),13*t),n.set(e(o,u),14*t),n.set(e(a,u),15*t);let h=[];for(let g=0;g<t;g++)h.push(Nc(n,f,d,g,t));return h}};var Jd=Object.getOwnPropertyDescriptor,Kd=(t,e,n,s)=>{for(var i=s>1?void 0:s?Jd(e,n):e,r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(i)||i);return i};function Qd(...t){return t[0]instanceof $t?t[0].as(t[1]):new $t(...t)}const th=(t,e,n,s=n)=>eh(jd(t,n,s).canvas,e),eh=(t,e=mi)=>{const{data:n}=Nd(t),s=t.width,i=t.height;let r;if(e===mi)r=n;else{r=Yn(e.type,s*i);const o=n,a=e.fromABGR;for(let c=r.length;c-- >0;)r[c]=a(o[c])}return new $t(s,i,e,r)};let $t=class{size;stride;format;data;constructor(t,e,n=mi,s){this.size=[t,e],this.stride=[1,t],this.format=n.__packed?n:hr(n),this.data=s||Yn(n.type,t*e)}get pixels(){return this.data}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}get dim(){return 2}*[Symbol.iterator](){yield*this.data}as(t){return this.getRegion(0,0,this.width,this.height,t)}copy(){const t=this.empty();return t.data.set(this.data),t}empty(){return new $t(this.width,this.height,this.format)}order(){}includes(t,e){}indexAt(t,e){}indexAtUnsafe(t,e){}getAt(t,e){}getAtUnsafe(t,e){}setAt(t,e,n){}setAtUnsafe(t,e,n){}getChannelAt(t,e,n,s=!1){const i=Bn(this.format,n),r=this.getAt(t,e);return s?i.float(r):i.int(r)}setChannelAt(t,e,n,s,i=!1){const r=Bn(this.format,n),o=this.getAt(t,e);return i?r.setFloat(o,s):r.setInt(o,s),this}blend(t,e,n){let s=this.width,i=e.width;const{sx:r,sy:o,dx:a,dy:c,rw:l,rh:u}=po(this,e,n);if(l<1||u<1)return e;const f=this.data,d=e.data,h=this.format.toABGR,g=e.format.toABGR,m=e.format.fromABGR;for(let _=(r|0)+(o|0)*s,b=(a|0)+(c|0)*i,v=0;v<u;v++,_+=s,b+=i)for(let N=0;N<l;N++)d[b+N]=m(t(h(f[_+N]),g(d[b+N])));return e}blit(t,e){let n=this.width,s=t.width;const{sx:i,sy:r,dx:o,dy:a,rw:c,rh:l}=po(this,t,e);if(c<1||l<1)return t;const u=this.data,f=t.data,d=this.format.toABGR,h=t.format.fromABGR,g=this.format!==t.format?(m,_)=>{for(let b=0;b<c;b++)f[_+b]=h(d(u[m+b]))}:(m,_)=>f.set(u.subarray(m,m+c),_);for(let m=(i|0)+(r|0)*n,_=(o|0)+(a|0)*s,b=0;b<l;b++,m+=n,_+=s)g(m,_);return t}blitCanvas(t,e={}){Td(this,t,e)}setImageData(t){Ic(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,s=this.format.fromABGR;for(let i=e.length;i-- >0;)n[i]=s(e[i]);return this}toImageData(t){t=Yd(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,s=this.format.toABGR;for(let i=e.length;i-- >0;)e[i]=s(n[i]);return t}getRegion(t,e,n,s,i){const[r,o,a,c]=hi(t,e,n,s,this.width,this.height);if(!(a<1||c<1))return this.blit(new $t(a,c,i||this.format),{sx:r,sy:o,w:a,h:c})}getChannel(t){const e=Bn(this.format,t),n=new $t(this.width,this.height,{type:P0(e.size),size:e.size,channels:[{size:e.size,lane:At.RED}],fromABGR:kd(e.size),toABGR:Bd(e.size)}),s=this.data,i=n.data,r=e.int;for(let o=s.length;o-- >0;)i[o]=r(s[o]);return n}setChannel(t,e){const n=Bn(this.format,t),s=this.data,i=n.setInt;if(y(e))Cd(s,e,i);else{const r=e.data,o=e.format.channels[0];Vd(r,this.width,this.height),n.size===o.size?Od(s,r,o.int,i):Ld(s,r,this.format.fromABGR,e.format.toABGR,n.maskA)}return this}invert(){const{data:t,format:e}=this,n=Math.pow(2,e.size-e.alpha)-1;for(let s=t.length;s-- >0;)t[s]^=n;return this}premultiply(){return Wd(this.format),bo(this.data,this.format,zd),this}postmultiply(){return bo(this.data,this.format,Hd),this}isPremultiplied(){const t=this.data,e=this.format.toABGR;for(let n=t.length;n-- >0;)if(!qd(e(t[n])))return!1;return!0}forEach(t){const e=this.data;for(let n=e.length;n-- >0;)e[n]=t(e[n],n);return this}fill(t){this.data.fill(t)}flipX(){const{data:t,width:e}=this;for(let n=0;n<t.length;n+=e)t.subarray(n,n+e).reverse();return this}flipY(){const{data:t,width:e}=this,n=Yn(this.format.type,e);for(let s=0,i=t.length-e;s<i;s+=e,i-=e)n.set(t.subarray(s,s+e)),t.copyWithin(s,i,i+e),t.set(n,i);return this}rotateByID(t){return t>0?this[Dd[t-1]]():this}rotateCW(){const{width:t,height:e}=this,n=e-1;return this._rotate((s,i)=>s*e+n-i),this.size[0]=e,this.size[1]=t,this}rotateCCW(){const{width:t,height:e}=this,n=t-1;return this._rotate((s,i)=>(n-s)*e+i),this.size[0]=e,this.size[1]=t,this}rotate180(){const{width:t,height:e}=this,n=t-1,s=e-1;return this._rotate((i,r)=>(s-r)*t+n-i),this}scale(t,e="linear"){return M(t>0,"scale must be > 0"),this.resize(this.width*t,this.height*t,e)}resize(t,e,n="linear"){t|=0,e|=0,M(t>0&&e>0,"target width & height must be > 0");const s=Qd(t,e,this.format),i=s.data,r=t>0?this.width/t:0,o=e>0?this.height/e:0;n=B(n)?Zd(this,n,"repeat"):n;for(let a=0,c=0;a<e;a++){const l=a*o;for(let u=0;u<t;u++,c++)i[c]=n(u*r,l)}return s}upsize(){const{width:t,height:e,data:n}=this,s=new $t(t*2,e*2,this.format),i=s.data;for(let r=0,o=0;r<e;r++)for(let a=0,c=r*t*4;a<t;a++,o++,c+=2)i[c]=n[o];return s}_rotate(t){const{data:e,format:n,width:s,height:i}=this,r=Yn(n.type,s*i);for(let o=0;o<i;o++)for(let a=0;a<s;a++)r[t(a,o)]=e[o*s+a];this.data=r}};$t=Kd([Rc],$t);class xt{constructor(e,n){this.mode=e,this.value=n}deref(){return this.value}}const nh={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",grey:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32",transparent:"0000",rebeccapurple:"639"};let sh={canvas:"fff",canvastext:"000",linktext:"001ee4",visitedtext:"4e2386",activetext:"eb3323",buttonface:"ddd",buttontext:"000",buttonborder:"000",field:"fff",fieldtext:"000",highlight:"bbd5fb",highlighttext:"000",mark:"000",marktext:"fff",graytext:"808080"};const Dc=(t,e,n)=>T(t||e,e[0],e[1],e[2],n),ih=t=>t.mode,rh=t=>(t&3840)*4352|(t&240)*272|(t&15)*17,oh=t=>((t&61440)*69632|(t&3840)*4352|(t&240)*272|(t&15)*17)>>>0,Rs=(t,e)=>T(t||[],(e>>>16&255)*st,(e>>>8&255)*st,(e&255)*st,(e>>>24)*st),$c=(t,e)=>T(t||[],(e&255)*st,(e>>>8&255)*st,(e>>>16&255)*st,(e>>>24)*st),ah=t=>{t=(B(t)?t:t.deref()).toLowerCase();const e=nh[t]||sh[t];if(e||t[0]==="#")return new xt("srgb",Rs([],lh(e||t)));const n=t.split(/[(),/ ]+/),[s,i,r,o,a]=n;switch(M(n.length===5||n.length===6,`invalid color: ${t}`),s){case"rgb":case"rgba":return new xt("srgb",[q(i,1,st,!0),q(r,1,st,!0),q(o,1,st,!0),ye(a)]);case"hsl":case"hsla":return new xt("hsl",[Ys(i),vo(r),vo(o),ye(a)]);case"lab":return new xt("lab50",[q(i),q(r,1.25),q(o,1.25),ye(a)]);case"lch":return new xt(s,[q(i),q(r,1.5),Ys(o),ye(a)]);case"oklab":return new xt(s,[q(i,1,1),q(r,.4,1),q(o,.4,1),ye(a)]);case"oklch":return new xt(s,[q(i,1,1),q(r,.4,1),Ys(o),ye(a)]);default:Et(`color mode: ${s}`)}},ch={rad:L,grad:400,turn:1,deg:360},Ys=t=>{const e=/^(-?[0-9.]+)(deg|rad|grad|turn)?$/.exec(t);return M(!!e,`expected hue, got: ${t}`),P(parseFloat(e[1])/(ch[e[2]]||360))},ye=t=>t?q(t,1,1,!0):1,vo=(t,e=!0)=>{M(/^([0-9.]+)%$/.test(t),`expected percentage, got: ${t}`);const n=parseFloat(t)/100;return e?A(n):n},q=(t,e=1,n=.01,s=!1)=>{M(/^-?[0-9.]+%?$/.test(t),`expected number or percentage, got: ${t}`);const i=parseFloat(t)*(t.endsWith("%")?.01*e:n);return s?A(i):i},lh=t=>{const e=/^#?([0-9a-f]{3,8})$/i.exec(t);if(e){const n=e[1],s=parseInt(n,16);switch(n.length){case 3:return(rh(s)|4278190080)>>>0;case 4:return Hr(oh(s),8);case 6:return(s|4278190080)>>>0;case 8:return Hr(s,8)}}return lt(`invalid hex color: "${t}"`)},uh=wa((t,e=3,n=",",s="[",i="]")=>{const r=typeof e=="number"?Ra(e):e;switch(t){case 1:return o=>`${s}${r(o[0])}${i}`;case 2:return o=>`${s}${r(o[0])}${n}${r(o[1])}${i}`;case 3:return o=>`${s}${r(o[0])}${n}${r(o[1])}${n}${r(o[2])}${i}`;case 4:return o=>`${s}${r(o[0])}${n}${r(o[1])}${n}${r(o[2])}${n}${r(o[3])}${i}`;default:return o=>{const a=[];for(let c=0;c<o.length;c++)a.push(r(o[c]));return`${s}${a.join(n)}${i}`}}}),Cc=t=>{const e=t.channels||{},n=t.order,s=n.length;n.reduce((d,h)=>(d[h]={range:[0,1],...e[h]},d),e);const i=Object.freeze(n.map(d=>e[d].range[0])),r=Object.freeze(n.map(d=>e[d].range[1])),o=oe([],i),a=oe([],r);o[s-1]=1;const c=n.findIndex(d=>!!e[d].hue),l=class{constructor(d,h=0,g=1){this.offset=h,this.stride=g,this.buf=d||[0,0,0,0],this.offset=h,this.stride=g}buf;get mode(){return t.mode}get length(){return s}get range(){return[i,r]}get[Symbol.toStringTag](){return t.mode}get xyz(){return[this[0],this[1],this[2]]}[Symbol.iterator](){return q0(this.buf,this.length,this.offset,this.stride)}copy(){return new l(this.deref())}copyView(){return new l(this.buf,this.offset,this.stride)}empty(){return new l}deref(){return[this[0],this[1],this[2],this[3]]}set(d){return oe(this,d)}clamp(){return c>=0&&(this[c]=P(this[c])),F0(null,this,i,r),this}eqDelta(d,h=U){return ua(this,d,h)}randomize(d){return Ia(this,o,a,d)}toJSON(){return this.deref()}toString(){return uh(4,4)(this)}};S0(l.prototype,n),qr(t.mode,t.from),qr("rgb",{[t.mode]:t.toRgb});const u=(d,h,g)=>{const m=new l(...g);return h!==t.mode?Da(m,d,t.mode,h):m.set(d)},f=(d,...h)=>d==null?new l:B(d)?f(ah(d),...h):ps(d)?B(d.mode)?u(d,d.mode,h):new l(d,...h):ct(d,"deref")?u(d.deref(),d.mode,h):y(d)?h.length&&h.every(y)?new l(...ef([d,...h])):u(Rs([],d),"srgb",h):lt(`can't create a ${t.mode} color from: ${d}`);return f.class=l,f.range=[i,r],f.random=(d,h,g,m)=>new l(h,g,m).randomize(d),f.mapBuffer=(d,h=d.length/s|0,g=0,m=1,_=s)=>G0(l,d,h,g,m,_),f},pi=(t,e=$a)=>zi(t,e),Oc=t=>zi(t,Z0),fh=t=>((t>>>16&255)*76+(t>>>8&255)*150+(t&255)*29)/65025,dh=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/65025,hh=t=>fh(t[0]),gh=t=>dh(t[0]),gr=(t,e,n=1)=>(e=P(e)*6,T(t||[],A(Math.abs(e-3)-1),A(2-Math.abs(e-2)),A(2-Math.abs(e-4)),n)),Lc=(t,e)=>{const n=e[0];let s=e[1];const i=e[2],r=gr(t||e,n,Y(e[3])),o=pi(r);return i<o?s*=i/o:o<1&&(s*=(1-i)/(1-o)),Q(r,A((r[0]-o)*s+i),A((r[1]-o)*s+i),A((r[2]-o)*s+i))},Tc=(t,e)=>{t=Xi(t||e,e);const n=t[1],s=t[2];if(n<1e-6)return Q(t,s,s,s);const i=t[0]*6%6,r=s*(1-n),o=1-Math.abs(i%2-1);let a=3*s*n/(1+o);const c=a*o+r;switch(a+=r,i|0){case 0:return Q(t,a,c,r);case 1:return Q(t,c,a,r);case 2:return Q(t,r,a,c);case 3:return Q(t,r,c,a);case 4:return Q(t,c,r,a);case 5:return Q(t,a,r,c);default:return Q(t,r,r,r)}},kc=(t,e)=>{const n=A(e[1]),s=A(e[2]);t=gr(t||e,e[0],Y(e[3]));const i=(1-Math.abs(2*s-1))*n;return Q(t,(t[0]-.5)*i+s,(t[1]-.5)*i+s,(t[2]-.5)*i+s)},Bc=(t,e)=>{t=Xi(t||e,e);const n=t[1],s=t[2];return gr(t,e[0],t[3]),Q(t,((t[0]-1)*n+1)*s,((t[1]-1)*n+1)*s,((t[2]-1)*n+1)*s)},Ss=(t,e)=>T(t||e,Os(e[0]),Os(e[1]),Os(e[2]),Y(e[3])),mh=(t,e)=>Ss(null,Rs(t,e)),ph=(t,e)=>Ss(null,$c(t,e)),bh=[4.0767416621,-1.2684380046,-.0041960863,-3.307711591,2.6097574011,-.7034186147,.2309699292,-.3413193965,1.707614701],_h=(t,{0:e,1:n,2:s,3:i})=>La(t,bh,[(e+.3963377774*n+.2158037573*s)**3,(e-.1055613458*n-.0638541728*s)**3,(e-.0894841775*n-1.291485548*s)**3,i]),vh=(t,e)=>{const{0:n,1:s,2:i}=e;return T(t||e,zr(i*n,s),i,zr(i*(1-n-s),s),Y(e[3]))},yh=(t,e,n=$a)=>{const s=e[0],i=(2-2*n[2])*e[1],r=(2-2*n[0])*e[2];return T(t||e,s+r,s-n[2]/n[1]*i-n[0]/n[1]*r,s+i,Y(e[3]))},Is=Cc({mode:"rgb",order:["r","g","b","alpha"],from:{abgr32:(t,e)=>ph(t,e[0]),argb32:(t,e)=>mh(t,e[0]),hcy:Lc,hsi:Tc,hsl:kc,hsv:Bc,lab50:is,lab65:Ba,lch:[ka,is],oklab:_h,rgb:oe,srgb:Ss,xyy:[vh,oi],xyz50:Zi,xyz65:oi,ycc:yh},toRgb:oe}),ue=Cc({mode:"srgb",order:["r","g","b","alpha"],from:{abgr32:(t,e)=>$c(t,e[0]),argb32:(t,e)=>Rs(t,e[0]),hcy:Lc,hsi:Tc,hsl:kc,hsv:Bc,rgb:cn},toRgb:Ss});function Ah(t,...e){let[n,s,i,r,o,a,c,l]=e;switch(e.length){case 1:return(...u)=>t(n,...u);case 2:return(...u)=>t(n,s,...u);case 3:return(...u)=>t(n,s,i,...u);case 4:return(...u)=>t(n,s,i,r,...u);case 5:return(...u)=>t(n,s,i,r,o,...u);case 6:return(...u)=>t(n,s,i,r,o,a,...u);case 7:return(...u)=>t(n,s,i,r,o,a,c,...u);case 8:return(...u)=>t(n,s,i,r,o,a,c,l,...u);default:lt()}}const wh=(t,e)=>Lt(H(([n,s,i,r])=>A(n+s*Math.cos(L*(i*e+r)))),ae(),ti(...t)),yo=(t,e,n)=>Lt(Sn(H(Ah(wh,e)),md()),ae(),Ma(t-1)),Ao=(t,e)=>{t=Yr([],t),e=Yr([],e);const n=[...H(([s,i])=>.5*(s-i),ti(t,e))];return[[...H(([s,i])=>s-i,ti(t,n))],n,[-.5,-.5,-.5,-.5],[0,0,0,0]]},Eh=Pt(ih,{lch:"lab",oklab:"lab",ycc:"lab",xyy:"hcy"},{argb32:hh,abgr32:gh,hcy:t=>t[2],lab:t=>t[0],rgb:pi,srgb:Oc,xyz:t=>t[1],[x]:t=>pi(Is(t))}),j=(t,e,n)=>{const s=t[e];t[e]=t[n],t[n]=s},Rh=(...t)=>{const[e,n,s]=t,i=t.length;switch(i){case 0:return j;case 1:return(r,o,a)=>{j(r,o,a),j(e,o,a)};case 2:return(r,o,a)=>{j(r,o,a),j(e,o,a),j(n,o,a)};case 3:return(r,o,a)=>{j(r,o,a),j(e,o,a),j(n,o,a),j(s,o,a)};default:return(r,o,a)=>{j(r,o,a);for(let c=i;c-- >0;)j(t[c],o,a)}}};function bi(t,e=Qi,n=j,s=0,i=t.length-1){if(s<i){const r=t[s+(i-s>>1)];let o=s-1,a=i+1;for(;;){do o++;while(e(t[o],r)<0);do a--;while(e(t[a],r)>0);if(o>=a)break;n(t,o,a)}bi(t,e,n,s,a),bi(t,e,n,a+1,i)}return t}const Sh=(t,e,n=Qi)=>{const s=ke(e)?t.map(e):e;return M(s.length===t.length,"keys.length != src.length"),bi(s,n,Rh(t)),t},Ih=(t,e,n=!1)=>Sh(t,e,n?_d:vc),Ve=.072,Ye=.213,Mh=.285,We=.715,Nh=.787,Dh=.928,De=lf,$h=(t,...e)=>e.reduce(uf,t),Pc=t=>[1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0],Ch=(t,e=.5*(1-t))=>[t,0,0,0,e,0,t,0,0,e,0,0,t,0,e,0,0,0,1,0],Oh=t=>[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],wo=t=>[Ye+Nh*t,We-We*t,Ve-Ve*t,0,0,Ye-Ye*t,We+Mh*t,Ve-Ve*t,0,0,Ye-Ye*t,We-We*t,Ve+Dh*t,0,0,0,0,0,1,0],Lh=t=>t,Th=(t,e,n,s)=>{if(n===void 0||s===void 0){const i=t.timeBounds();n=n??i[0],s=s??i[1]}return H(i=>(i=ne(n,s,i),[i,t.at(i)]),Ma(e))};class Pe{constructor(e,n,s){this.impl=e,this.stops=n,M(n.length>=2,"require at least 2 keyframes/stops");const i={domain:Lh,...s};this.domain=i.domain,this.sort()}domain;copy(){return new Pe(this.impl,this.stops.map(e=>e.slice()))}empty(){return new Pe(this.impl,[])}at(e){const{domain:n,impl:s,stops:i}=this,r=i.length-1,o=i[0],a=i[r];e=n(e,o[0],a[0]);const c=this.timeIndex(e);return c<0?o[1]:c>=r?a[1]:s.at(i,c,e)}samples(e=100,n,s){return Th(this,e,n,s)}bounds(){const{impl:e,stops:n}=this,s=n.length;let i=null,r=null;for(let o=s;o-- >0;){const a=n[o][1];i=e.min(i,a),r=e.max(r,a)}return{min:i,max:r,minT:n[0][0],maxT:n[s-1][0]}}timeBounds(){return[this.stops[0][0],ta(this.stops)[0]]}setStopAt(e,n,s=.01){const i=this.closestIndex(e,s);return i<0?(this.stops.push([e,n]),this.sort(),!0):(this.stops[i][1]=n,!1)}removeStopAt(e,n=.01){return this.stops.length>2?this.removeStopAtIndex(this.closestIndex(e,n)):!1}removeStopAtIndex(e){const n=this.stops;return e<0||e>=n.length||n.length<=2?!1:(n.splice(e,1),!0)}closestIndex(e,n=.01){const s=this.stops;for(let i=s.length;i-- >0;)if(ju(e,s[i][0])<n)return i;return-1}clampedIndexTime(e,n,s=.01){const i=this.stops,r=i.length-1;return e==0?Math.min(n,i[1][0]-s):e===r?Math.max(n,i[r-1][0]+s):ft(n,i[e-1][0]+s,i[e+1][0]-s)}sort(){this.stops.sort((e,n)=>e[0]-n[0])}uniform(){const e=this.stops.length-1;this.stops.forEach((n,s)=>n[0]=s/e)}timeIndex(e){const n=this.stops,s=n.length;if(s<256){for(let r=s;r-- >0;)if(e>=n[r][0])return r;return-1}const i=vd(n,[e,null],r=>r[0],vc);return i<-1?-(i+2):i}}const kh=(t,e)=>new Pe(Bh,t,e),Bh={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>{const s=t.length-1,i=t[Math.max(e-1,0)],[r,o]=t[Math.max(e,0)],[a,c]=t[Math.min(e+1,s)],l=t[Math.min(e+2,s)],u=kr(i[1],c,0,i[0],a),f=kr(o,l[1],0,r,l[0]);return Zu(o,u,c,f,Gi(n,r,a))}},Ph=(t,e)=>new Pe(Gh,t,e),Gh={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>{const s=t[e],i=t[e+1];return nt(n,s[0],i[0],s[1],i[1])}},Gc=4,zn=1<<Gc,Uc=8,Uh=1<<Uc,mt=4095;let Fc=4,zc=.5;const Ws=t=>.5*(1-Math.cos(t*Math.PI));let rt;const Fh=function(t,e=0,n=0){if(rt==null){rt=new Array(mt+1);for(let _=0;_<mt+1;_++)rt[_]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),n<0&&(n=-n);let s=Math.floor(t),i=Math.floor(e),r=Math.floor(n),o=t-s,a=e-i,c=n-r,l,u,f=0,d=.5,h,g,m;for(let _=0;_<Fc;_++){let b=s+(i<<Gc)+(r<<Uc);l=Ws(o),u=Ws(a),h=rt[b&mt],h+=l*(rt[b+1&mt]-h),g=rt[b+zn&mt],g+=l*(rt[b+zn+1&mt]-g),h+=u*(g-h),b+=Uh,g=rt[b&mt],g+=l*(rt[b+1&mt]-g),m=rt[b+zn&mt],m+=l*(rt[b+zn+1&mt]-m),g+=u*(m-g),h+=Ws(c)*(g-h),f+=h*d,d*=zc,s<<=1,o*=2,i<<=1,a*=2,r<<=1,c*=2,o>=1&&(s++,o--),a>=1&&(i++,a--),c>=1&&(r++,c--)}return f},zh=function(t,e){t>0&&(Fc=t),e>0&&(zc=e)},_i={sinTimesCos:Vh,sinFractCos:xh,sinPlusCos:Yh,sinPlusSin:Wh,cos:jh,sin:Xh,hopalong:Zh,clifford:Jh,deJong:Kh,gumowskiMira:eg,bedhead:Qh,fractalDream:tg,perlin:qh,radial:vi,macMillan:ng,juan:sg,nAttractor:ig},Hh=(t,e=Object.keys(_i))=>{const n=w(e,t);let s=1,i=10;switch(n){case"fractalDream":case"clifford":i=t.minmaxInt(1,30);break;case"perlin":i=t.minmaxInt(1,20);break;case"bedhead":case"deJong":i=t.minmaxInt(1,50);break;case"hopalong":default:i=t.minmaxInt(1,100);break}const r=t.minmaxInt(s,i);return{type:n,opts:{scale:[r,r],amplitude:t.minmax(.5,20),a:t.minmax(-15,15),b:t.minmax(-15,15),c:t.minmax(-15,15),d:t.minmax(-15,15),mode:w([0,1],t),center:[t.minmax(-.5,.5),t.minmax(-.5,.5)],falloff:t.minmax(.01,.3),lod:t.minmaxInt(0,5)},conversion:w(["multiplyByPI","aCos","aSin"],t)}};function qh([t,e],n){const s=n.lod?n.lod:4,i=n.falloff?n.falloff:.5;return zh(s,i),(Fh(t,e)-.5)*2}function Vh([t,e],n){return Math.sin(t)*Math.cos(e)}function Yh([t,e],n){return(Math.sin(t)+Math.cos(e))*.5}function Wh([t,e],n){return(Math.sin(t)+Math.sin(e))*.5}function jh([t,e],n){return Math.cos(t)}function Xh([t,e],n){return Math.sin(t)}function xh([t,e],n){return Math.sin(t)/Math.cos(e)}function Gt([t,e],[n,s],i=1){return i===0?Math.atan2(s,n)/it:Math.atan2(s-e,n-t)/it}function Zh([t,e],{a:n=1,b:s=1,c:i=1,mode:r=0}){const o=e-1-Math.sqrt(Math.abs(s*t-1-i))*Math.sign(t-1),a=n-t-1;return Gt([t,e],[o,a],r)}function Jh([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const a=Math.sin(n*e)+i*Math.cos(n*t),c=Math.sin(s*t)+r*Math.cos(s*e);return Gt([t,e],[a,c],o)}function Kh([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const a=Math.sin(n*e)-Math.cos(s*t),c=Math.sin(i*t)-Math.cos(r*e);return Gt([t,e],[a,c],o)}function Qh([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const a=Math.sin(t*e/s)*e+Math.cos(n*t-e),c=t+Math.sin(e)/s;return Gt([t,e],[a,c],o)}function tg([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const a=Math.sin(s*e)+i*Math.sin(s*t),c=Math.sin(n*t)+r*Math.sin(n*e);return Gt([t,e],[a,c],o)}function eg([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const a=n*t+(1-n)*2*t*t/(1+t*t),c=s*e*a,l=a-t;return Gt([t,e],[c,l],o)}function ng([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const a=e,c=-a+2*n*e/(1-e*e)+s*e;return Gt([t,e],[a,c],o)}function sg([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const a=Math.cos(n*t),c=Math.sin(s*e),l=a*a-c*c,u=2*Math.cos(i*t)*Math.sin(r*e);return Gt([t,e],[l,u],o)}function ig([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const a=n*Math.sin(e-e*(e*e+1)/2)+s*Math.tanh(t-t*(t*t+1)/2),c=i*Math.sin(t-t*(t*t+1)/2)+r/Math.cosh(e-e*(e*e+1)/2);return Gt([t,e],[a,c],o)}function vi([t,e],{center:n=[0,0],exchangeInputs:s=!1}){const[i,r]=s?[n[1],n[0]]:n;return Math.atan2(e-r,t-i)/it}function Hc(t,e,n=!0){if(t<=e[0])return e[0];let s=0;for(;s<e.length-1;){if(t<=e[s+1])return n?t-e[s]<e[s+1]-t?e[s]:e[s+1]:e[s];s++}return e[e.length-1]}function Eo(t,e=[-1,1]){const n=[];if(t>1)for(let s=0;s<=t;s++)n.push(e[0]+(e[1]-e[0])*s/t);return n}function rg(t,e,n,s,i=!0){const r=n.amplitude?n.amplitude:1;let[o,a]=e;n.scale&&(o*=n.scale[0],a*=n.scale[1]);let c=t(n.exchangeInputs?[a,o]:[o,a],n);return s==null||s.length==0?c*r:r*Hc(c,s,i)}function og(t,e,n,s,i=!0){if(_i[t])return rg(_i[t],e,n,s,i);throw new Error(`noise '${t}' is not implemented.`)}function Ro(t,{type:e="perlin",opts:n={scale:[1,1]},rotation:s=0,conversion:i="multiplyByPI",quantizationArray:r=[],quantizeToClosest:o=!0}){const a=e||"perlin";if(a==="radial"){const[f,d]=n.exchangeInputs?[t[1],t[0]]:t;return r==null||r.length==0?vi([f,d],n)*it:Hc(vi([f,d],n),r,o)*it}const c=og(a,t,n,r,o),l=n.amplitude?n.amplitude:1;let u=1;switch(i){case"aCos":u=s+Math.acos(c/l);break;case"aSin":u=s+Math.asin(c/l);break;default:u=s+it*c}return Zl(u)}const ag=async t=>{const e=[];return t.length>0&&e.push(...(await Promise.all(t.map(n=>xd(n)))).map(n=>th(n,Fd))),e},cg={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>t[e+1][1]},lg=(t,e)=>new Pe(cg,t,e);function qc(t,e){for(const n of e)if(Wt(n,t))return!0;return!1}function js(t,e){let n=0;for(const s of e){if(Wt(s,t))return n;n++}return-1}const je=t=>[((t=Math.floor(t))>>16&255)/255,(t>>8&255)/255,(255&t)/255],Hn=(t,e)=>t==="hermite"?kh(e):t==="linear"?Ph(e):lg(e),ug=(t,e,n,s)=>{const[i,r]=ns([],e,n,s,[0,0],[t.width,t.height]);return t.getAt(Math.floor(i),Math.floor(r))},se=(t,e,n)=>vl(t,e,n)(),qn=0xfffffffffn,fg=t=>new Uint32Array([Number(t>>96n&qn),Number(t>>64n&qn),Number(t>>32n&qn),Number(t&qn)]),dg=t=>fg(BigInt("0x"+t.replace(/-/g,"").substring(0,32)));[...yo(10,Ao([0,0,.102],[.933,.996,1])).map(t=>ai(De(null,wo(.8),t)))],[...yo(10,Ao([.067,0,0,1],[1,.996,.933,1])).map(t=>ai(De(null,wo(.8),t)))];const So={0:[2120566,15130821,16291640,13845523,271427,.01,1.01,1.1],1:[4562234,16777215,6596594,4145473,1973791,0,1,1.2],2:[4470864,12303972,15397070,12633537,8225937,0,1.05,1.5],3:[13354938,15131351,2633011,3159101,4540754,.03,1,1],5:[12442047,3031122,16762967,16777215,4268596,-.03,1,1.5],6:[16250866,12965997,2497557,15001283,15752483,0,1,1],7:[5871085,279433,16580427,16755973,8171460,-.04,1,1.2],8:[13762590,2589067,7179309,15508269,15425574,.01,1,1],9:[1529984,16708813,10072218,7631457,2766650,0,1,1.02],11:[11907778,5930364,14344183,2305075,10535377,0,1,1.1],12:[10289158,1659231,6661793,15566395,15354668,0,1,1],13:[13515281,469832,2384251,16707790,16288806,.01,1,1.15],14:[13553870,1644825,15814693,16777215,15132902,0,1,1.15],15:[1317406,15791103,4211788,3751743,2041382,0,1,1],16:[657672,2241339,15392981,13020303,6180927,0,1,1.9],17:[3368330,8829912,7704143,16166445,15885337,0,1,1.12],18:[16711422,16168524,15351084,3817281,6535886,0,1,1.1],19:[7289398,13139994,14797476,9608602,5534304,0,1,1.2],20:[13859385,13784116,7498570,15786420,15508823,0,1,1.1],21:[9831194,16427286,16515070,7169902,1776414,0,1,1.1],22:[42733,8370176,863316,16142621,16757760,0,1.02,1.1],23:[5777159,9907463,16730942,16757263,16770376,0,1.01,1.05],24:[15718311,3939072,8763312,15848851,16328960,0,1,1.26],27:[6124414,16579836,135451,4145221,3156271,0,1,2],28:[9947562,13732155,15702825,3610381,13942932,0,1.05,1.2],29:[14303591,16044894,16177326,3031127,540023,0,1.02,1.1],30:[14155826,2829634,9279918,15594228,15672124,0,1,1],31:[6575426,8371106,16119484,15051558,12471335,0,1,1.15],32:[15125682,14530706,11569512,8344889,10249796,0,1.03,1.05],34:[2994148,13099310,16120284,3223857,4036282,0,1.02,1.2],35:[2735890,11272015,572861,15866687,16750868,0,1.05,1.1],36:[402725,1332558,15194544,16034598,792857,.01,1.03,1.04],37:[4004864,8763055,15783315,16263680,15718568,0,1.03,1.04],38:[15971407,15193272,14338478,1844529,16400720,.01,1.04,1.3],40:[14719784,15459775,2831168,1916524,5136224,0,1.03,1.07],41:[9667969,12965348,8283473,4612962,8951467,0,1.05,1.6],42:[1716574,10208227,15266296,3770568,15821646,0,1,1.15],44:[16706750,16154427,16008999,2952226,16245696,0,1.01,1.02],45:[14342093,10727818,5800279,3824192,3427905,0,1.03,1.16],47:[2508371,2792847,15320170,16032353,15167313,0,1,1.12],48:[6319160,2635288,16710368,14524766,12348453,0,1.03,1.1],49:[15260604,8761251,0,5308418,11494980,0,1,1],50:[3084589,12921662,8323635,16702104,8323635]};Object.keys(So).map(t=>{const e=So[t];return[je(e[4]),je(e[0]),je(e[1]),je(e[2]),je(e[3])]});const hg=(t,e)=>gg(Ih(t.map(n=>Is(n)),Oc,e)),gg=t=>({bg:[t[0]],fg:t.slice(1).reverse()}),Vc=(t,e,n,s=.001,i=!0)=>Zn(t.supportData.distanceToCenter,0,e,i?n:s,i?s:n),mg=t=>Math.sqrt(Math.pow(t/2,2)+Math.pow(.5,2)),pg=(t,e,n,s)=>(n===void 0&&(n=-e/2),s===void 0&&(s=e/2),nt(t[0],n,s,0,1)),bg=(t,e)=>{let n;return(t.update!==void 0||e.update!==void 0)&&(n=(s,i)=>Math.min(t.update?t.update(s,i):Number.MAX_VALUE,e.update?e.update(s,i):Number.MAX_VALUE)),{get:(s,i)=>Math.min(t.get(s,i),e.get(s,i)),update:n,info:"min("+t.info+", "+e.info+")",aux:t.aux}},Zt=(t,e=0,n=1,s={},i=!1)=>{let r=[],o=0,a=1,c=t,l=0,u=s.cutoff??0,f=s.valueTransform??(g=>g),d=s.outputTransform??(g=>g);t==="width"||t==="height"?(r=t==="width"?["pos",0]:["pos",1],o=s.minValue??-.5,a=s.maxValue??.5):t==="agent ID"||t==="agent generation"?(r=t==="agent ID"?["ID"]:["generation"],o=s.minValue??0,a=s.maxValue??1):t==="space traveled"?(r=["spaceTraveled"],o=s.minValue??0,a=s.maxValue??1,l=1):t==="distance from center"&&(o=s.minValue??0,a=s.maxValue??Math.SQRT2);const h=(g,m)=>{const _=l===0?g:m;let b=0;if(r.length>0){const N=_[r[0]];r.length>1?b=N[r[1]]:b=N}b=f(b);let v=0;switch(t){case"random":v=s.rnd.minmax(e,n);break;case"distance from center":v=Vc(g,a,e,n);break;case"pos inside bounds":qc(g.pos,s.bounds)?v=e:v=n;break;case"image luminance":if(g.supportData.features&&g.supportData.features.length>s.imageIndex){const N=Eh(g.supportData.features[s.imageIndex]);N<u?v=1e-5:v=Zn(N,o,a,e,n)}else v=a;break;default:v=Zn(b,o,a,e,n);break}return d(v)};return{get:(g,m)=>h(g,m),update:i?(g,m)=>h(g,m):void 0,info:c,aux:[e,n]}};function _g(t,e,n,{decimatePercentage:s=0,elasticity:i=[0,0],minSize:r=.01,margin:o=0,shakeAmount:a=[[0,0],[0,0]],shuffleResult:c=!1},l){let u=n,f=e;Array.isArray(e)&&Array.isArray(n)?l.probability(.5)?u=Array.isArray(n)?l.minmaxInt(n[0],n[1]+1):n:f=Array.isArray(e)?l.minmaxInt(e[0],e[1]+1):e:y(n)&&y(e)&&(l.probability(.5)?u=[n,n]:f=[e,e]);let d=y(u)?0:1,h=t;if(d===1){let b=u;u=f,f=b,h=bn([t.pos[1],t.pos[0]],[t.size[1],t.size[0]])}const g=vg(h,u,f,i,r,o,l),m=[...gd(g)];d===1&&m.forEach(b=>{b.pos=[b.pos[1],b.pos[0]],b.size=[b.size[1],b.size[0]]});const _=Math.floor(m.length*s);return _>0&&Ag(m,_,l),yg(m,a[0],a[1],l),c&&bd(m,m.length,l),m}function vg(t,e,n,s,i,r=0,o){const a=[];for(let c=0;c<e;c++){const l=[];a.push(l);let u=Array.isArray(n)?o.minmaxInt(n[0],n[1]+1):n;const f=[(t.size[0]-(u+1)*r)/u,(t.size[1]-(e+1)*r)/e];if(s[0]===0&&s[1]===0||f[0]<=i||u===1)for(let d=0;d<u;d++){const h=bn([t.pos[0]+r+d*(f[0]+r),t.pos[1]+r+c*(f[1]+r)],[f[0],f[1]]);l.push(h)}else{let d=t.pos[0]+r,h=t.pos[1]+r+c*(f[1]+r);for(let g=0;g<u;g++){let m=Math.min(Math.max(f[0]+o.minmax(s[0],s[1]),i),t.pos[0]+t.size[0]-((u-(g+1))*(i+r)+d+r));g===u-1&&(m=t.pos[0]+t.size[0]-r-d);const _=bn([d,h],[m,f[1]]);d+=m+r,l.push(_)}}}return a}function yg(t,[e,n],[s,i],r){return t.forEach(o=>{const a=r.minmax(e,n),c=r.minmax(s,i);o.pos=[o.pos[0]+a,o.pos[1]+c]}),t}function Ag(t,e,n){for(let s=0;s<e;s++){const i=n.minmaxInt(0,t.length);t.splice(i,1)}return t}const us={default:{matrix:fc,offset:[0,0,0,0]}},wg={brightness:0,contrast:0,filterMatrix:us.default.matrix,filterOffset:us.default.offset,exposure:0,saturation:0,simmetry:0,info:"default"};function Eg(t){const e=1+t,n=.2126,s=.7152,i=.0722,r=(1-e)*n,o=(1-e)*s,a=(1-e)*i;return[r+e,r,r,0,o,o+e,o,0,a,a,a+e,0,0,0,0,1]}function mr(t){const e=Eg(t.saturation||0);let n=t.filterMatrix||us.default.matrix,s=t.filterOffset||us.default.offset;return $h(Pc(t.brightness||0),Ch(1+(t.contrast||0),-.5*(t.contrast||0)),Oh(1+(t.exposure||0)),[e[0],e[4],e[8],e[12],0,e[1],e[5],e[9],e[13],0,e[2],e[6],e[10],e[14],0,e[3],e[7],e[11],e[15],0],[n[0],n[4],n[8],n[12],s[0],n[1],n[5],n[9],n[13],s[1],n[2],n[6],n[10],n[14],s[2],n[3],n[7],n[11],n[15],s[3]])}function Rg(t,e){const n=mr(e);t.colors.bg=t.colors.bg.map(s=>De([],n,ue(s))),t.colors.fg=t.colors.fg.map(s=>De([],n,ue(s))),t.background?.colors&&(t.background.colors=t.background.colors.map(s=>De([],n,ue(s))))}const Qe=["bounds","bounds-interp","distanceFromCenter","generation","id-nomix"],Io={black_and_white:["#111111","#FCFCFC"]},Sg=(t,e,n,s={})=>({name:"while_the_ego_sleeps",background:({bounds:i,colors:r,scalingFactor:o})=>{const a=i.aux,c=t.RND_STYLE.probability(.3);return{shapes:a,fill:w([[0],[0,1]],t.RND_STYLE),draw:w([[1]],t.RND_STYLE),weights:i.aux.map(()=>c?2*o:1.5*se([1,3,5,7],[4,3,2,1],t.RND_STYLE)*o),rounds:[0],colors:r.fg,info:"all-inverted"}},bounds:({aspectRatio:i})=>{const r=w([0,.1,.3],t.RND_BOUNDS),o=ei([0,0],[i-r,1-r]),a=[o],c=w([t.RND_BOUNDS.minmaxInt(2,7),[2,6]],t.RND_BOUNDS),l=w([t.RND_BOUNDS.minmaxInt(1,5),[1,4]],t.RND_BOUNDS),u=t.RND_BOUNDS.probability(.4),f=t.RND_BOUNDS.minmaxInt(2,5),d=_g(r===0?ei([0,0],[i-.15,1-.15]):o,u?f:l,u?f:c,{decimatePercentage:0,elasticity:u?[0,0]:[-.1,.1],minSize:.05,margin:t.RND_BOUNDS.minmax(.01,.02),shuffleResult:t.RND_BOUNDS.probability(.5),shakeAmount:w([void 0,[[-.001,.001],[-.001,.001]]],t.RND_BOUNDS)},t.RND_BOUNDS);let h=d;return{get:g=>({init:h,update:d,overall:a}),aux:h,info:h.length}},aspectRatio:e/n,halfDiagonal:({aspectRatio:i})=>mg(i),scalingFactor:.3*Math.max(e,n)/1e3,gridSize:[e,n],assets:["./assets/"+w(["skagen.jpeg","contorted-wood.jpg"],t.RND_STYLE)],style:({aspectRatio:i,bounds:r})=>{const o={type:"line | sanding",alphaDecay:l=>l*l*l,grainsFactorRange:[150,725],minAlpha:.001,followBounds:!0,sizeFactor:w([.2,.35,.5],t.RND_STYLE),doubleSided:!1,sameStyleOutsideBounds:t.RND_STYLE.probability(.2),sandedLineProbability:t.RND_STYLE.minmax(.5,1),sameWeightFactor:!1,allSanded:t.RND_STYLE.probability(.6),maxLength:[.05,.2],multiplyByImageLuminance:!1};return{aux:o,get:(l,u)=>{const f=Wt(Ks([0,0],.45*i),l.pos);let d=l.pos[0]>(.25-.5)*i||l.pos[0]<(.75-.5)*i?1:.5;return d*=l.pos[1]>.25-.5||l.pos[1]<.75-.5?1:.5,{...o,type:t.RND_STYLE.probability(o.sandedLineProbability)&&(f||o.allSanded)?"line | sanding":"line",grainsFactor:t.RND_STYLE.minmaxInt(o.grainsFactorRange[0],o.grainsFactorRange[1]),maxLength:t.RND_STYLE.minmax(o.maxLength[0],o.maxLength[1])*d,sizeFactor:o.sameWeightFactor?o.sizeFactor:w([.2,.35,.5],t.RND_STYLE),followBounds:!0}},update:(l,u)=>({type:l.attribs.style.type==="line"?"line":o.sameStyleOutsideBounds||qc(l.pos,r.aux)?"line | sanding":t.RND_STYLE.probability(.95)?"line":"line | sanding"})}},colors:()=>{const i=pl(Io,t.RND_COLORS),r={...hg(Io[i]),info:i};return{fg:[ue(r.fg[0])],bg:[ue(r.bg[0])],info:r.info}},agentFactory:({bounds:i})=>{let r=0;for(const o of i.aux)r+=ie(o);return{maxNewPerIteration:5,maxIterations:w([4e3],t.RND_SYSTEM),maxSpaceTraveled:w([30,50,80,100],t.RND_SYSTEM),newPerIteration:0,maxActive:50,branch:t.RND_SYSTEM.minmaxInt(2,8),initialAgents:30,maxAgents:w([2e4],t.RND_SYSTEM),directions:[[0,1],[0,-1],[1,0],[-1,0]],initPolicy:o=>o.agents.length<30?"randomFree":"randomOccupied",neverEnding:!0,maxColliding:1e3}},agent:()=>{const i=w([[2,2],[1,2],[.5,1],[.1,.5],[.1,.2]],t.RND);return{get:r=>({angled:!1,step:t.RND.minmax(.01,.04),fuzziness:0,chance:1,maxLength:t.RND.minmax(i[0],i[1]),maxIteration:1e3,minSpaceBeforeDrawing:.3/Math.max(e,n)})}},stroke:({colors:i,bounds:r,background:o})=>{const a=(c,l)=>{const u=js(c.pos,r.aux);return u<0||o?.fill[u%o.fill.length]===0?i.fg[0]:i.bg[0]};return se([{info:"true inverted",get:a,update:a}],[6,1],t.RND_STYLE)},alpha:({agentFactory:i,bounds:r})=>{const[o,a]=w([[.5,.02],[1,.01]],t.RND_STYLE);return w([Zt("pos inside bounds",.7,a,{bounds:r.aux},!0),Zt("random",a,o,{rnd:t.RND_STYLE}),Zt("image luminance",0,1,{imageIndex:0},!0)],t.RND_STYLE)},postprocess:{...wg,fadeAmount:5e-4},vector_field:({aspectRatio:i,agentFactory:r,bounds:o,halfDiagonal:a})=>{const c=[],l=s.vfNumber?s.vfNumber:t.RND_NOISE.minmaxInt(2,4),u=[],f=s.quantization?Eo(Number.parseInt(s.quantization)):se([[],Eo(t.RND_NOISE.minmaxInt(4,10))],[6,1],t.RND_NOISE);for(let v=0;v<l;v++)c.push({...Hh(t.RND_NOISE,["sinTimesCos","sinPlusCos","sinPlusSin","cos","sin","hopalong","clifford","gumowskiMira","fractalDream","perlin","macMillan"]),rotation:0,quantizationArray:f,conversion:w(["aCos"],t.RND_NOISE)}),u.push(c[v]);const d=[[0,0],[.2,1],[.4,0],[.6,0],[.8,1],[1,0]],h=s.interpolation?Hn(s.interpolation,d):se([Hn("hermite",d),Hn("linear",d),Hn("step",d)],[2,2,2],t.RND_NOISE),g="space traveled",m=s.mixStrategy?s.mixStrategy:w(Qe,t.RND_NOISE);return{aux:u,info:{interpolatedBy:g,choice:m},get:(v,N)=>{const D=[];for(let $=0;$<l;$++)D.push(Ro(v.pos,c[$]));const dt=D[0];if(l===1)return dt;let Ut=h.at(N.spaceTraveled%r.maxSpaceTraveled/r.maxSpaceTraveled);const Ns=Math.floor(N.spaceTraveled/r.maxSpaceTraveled),On=Qe.indexOf(m),W=Qe[(On+Ns)%Qe.length];if(W==="id-nomix"){const $=v.ID%(l-1);return D[$+1]}else if(W==="id"){const $=v.ID%(l-1);return ne(dt,D[$+1],Ut)}else if(W==="bounds-interp"){const $=js(v.pos,o.aux);return $<0?dt:ne(dt,D[$%(l-1)+1],Ut)}else if(W==="bounds"){const $=js(v.pos,o.aux);return $<0?dt:D[$%(l-1)+1]}else if(W==="distanceFromCenter"){const $=v.supportData.distanceToCenter/a,ze=Math.floor($*(l-1));return ne(dt,D[ze+1],Ut)}else if(W==="generation"){const $=v.generation%(l-1)/(l-1),ze=Math.floor($*(l-1));return ne(dt,D[ze+1],Ut)}else{const $=pg(v.pos,i),ze=Math.floor($*(l-1));return ne(dt,D[ze+1],Ut)}},getAt:(v,N)=>Ro(v,c[0])}},weight:({agentFactory:i,halfDiagonal:r,bounds:o,scalingFactor:a})=>{const c=a,[l,u]=w([[7.5*c,.75*c],[10*c,.75*c]],t.RND_STYLE);return se([bg({get:(f,d)=>Zn(f.ID%i.maxAgents,0,i.maxAgents,l,u),info:"agent ID",aux:[l,u]},Zt("distance from center",l,u,{maxValue:r},!0)),Zt("pos inside bounds",7.5*c,0,{bounds:o.aux},!0),{...Zt("random",u,l,{rnd:t.RND_STYLE}),update:f=>{const d=Math.min(f.attribs.weight,Vc(f,r*.75,l));return f.history.length<.008&&d<6?4.5*a:d},info:"random / distance from center"},Zt("distance from center",l*.75,u,{maxValue:r*.75},!0)],[1,1,1,1,1,1],t.RND_STYLE)}}),jt=(t,e,n=!0)=>{let s;n&&(s=e.fill)&&s!=="none"&&((s=e.fillRule)?t.fill(s):t.fill()),(s=e.stroke)&&s!=="none"&&t.stroke(),(s=e.clip)&&t.clip(s===!0?"nonzero":s)},yi=(t,e,n,s,i=0,r=L,o=!1)=>{t.beginPath(),t.arc(n[0],n[1],s,i,r,o),jt(t,e)},Ai=(t,e,n,s,i=0,r=0,o=L,a=!1)=>{t.beginPath(),t.ellipse(n[0],n[1],s[0],s[1],i,r,o,a),jt(t,e)},pr=ai,Ms=(t,e)=>B(e)?e[0]==="$"?t.grads[e.substring(1)]:e:pr(e),Yc=(t,{from:e,to:n},s)=>{const i=t.createLinearGradient(e[0],e[1],n[0],n[1]);for(let r of s)i.addColorStop(r[0],pr(r[1]));return i},Wc=(t,{from:e,to:n,r1:s,r2:i},r)=>{const o=t.createRadialGradient(e[0],e[1],s,n[0],n[1],i);for(let a of r)o.addColorStop(a[0],pr(a[1]));return o},jc=(t,e,{width:n,height:s},i,r,o,a)=>{if(ct(i,"toImageData")&&(i=i.toImageData()),i instanceof ImageData){t.putImageData(i,r[0],r[1]);return}n=n||i.width,s=s||i.height,o?t.drawImage(i,o[0],o[1],a?a[0]:n,a?a[1]:s,r[0],r[1],n,s):t.drawImage(i,r[0],r[1],n,s)},Ig={align:"left",alpha:1,baseline:"alphabetic",compose:"source-over",dash:[],dashOffset:0,direction:"inherit",fill:"#000",filter:"none",font:"10px sans-serif",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",shadowX:0,shadowY:0,smooth:!0,stroke:"#000",weight:1},Xc={align:"textAlign",alpha:"globalAlpha",baseline:"textBaseline",clip:"clip",compose:"globalCompositeOperation",dash:"setLineDash",dashOffset:"lineDashOffset",direction:"direction",fill:"fillStyle",fillRule:"fillRule",filter:"filter",font:"font",lineCap:"lineCap",lineJoin:"lineJoin",miterLimit:"miterLimit",shadowBlur:"shadowBlur",shadowColor:"shadowColor",shadowX:"shadowOffsetX",shadowY:"shadowOffsetY",smooth:"imageSmoothingEnabled",stroke:"strokeStyle",weight:"lineWidth"},Mo=(t,e=!1)=>({attribs:{...t.attribs},grads:{...t.grads},edits:[],restore:e}),Mg=(t,e,n)=>{let s;if(n){Dg(t,n)&&(s=Mo(e,!0));for(let i in n){const r=Xc[i];if(r){const o=n[i];o!=null&&e.attribs[i]!==o&&(!s&&(s=Mo(e)),s.attribs[i]=o,s.edits.push(i),xc(t,e,i,r,o))}else(i==="__background"||i==="__clear")&&(t.save(),t.resetTransform(),i==="__clear"?n[i]&&t.clearRect(0,0,t.canvas.width,t.canvas.height):(t.fillStyle=Ms(e,n[i]),t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.restore())}return s}},Ng=(t,e,n)=>{if(n.restore){t.restore();return}const s=n.edits,i=e.attribs;for(let r=s.length;r-- >0;){const o=s[r],a=i[o];xc(t,e,o,Xc[o],a??Ig[o])}},No=(t,e,n)=>{!t.grads&&(t.grads={}),t.grads[e]=n},xc=(t,e,n,s,i)=>{switch(n){case"fill":case"stroke":case"shadowColor":t[s]=Ms(e,i);break;case"dash":t[s].call(t,i);break;case"clip":case"fillRule":break;default:t[s]=i}},Dg=(t,e)=>{let n;return(n=e.transform)||e.setTransform||e.translate||e.scale||e.rotate?(t.save(),n?t.transform(n[0],n[1],n[2],n[3],n[4],n[5]):(n=e.setTransform)?t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]):((n=e.translate)&&t.translate(n[0],n[1]),(n=e.rotate)&&t.rotate(n),(n=e.scale)&&(ps(n)?t.scale(n[0],n[1]):t.scale(n,n))),!0):!1},Dt=(t,e,n,s)=>{e.stroke!=="none"&&(t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(s[0],s[1]),t.stroke())},wi=(t,e,n)=>{if(e.stroke!=="none"){t.beginPath();for(let{0:s,1:i}of n)t.moveTo(s[0],s[1]),t.lineTo(i[0],i[1]);t.stroke()}},Ei=(t,e,n,s)=>{let i;(i=e.fill)&&i!=="none"&&Do(t,n,s,"fill","fillRect"),(i=e.stroke)&&i!=="none"&&Do(t,n,s,"stroke","strokeRect")},Do=(t,e,n,s,i)=>{const{start:r=0,cstride:o=1,estride:a=2,size:c=1}=e;let l=e&&e.num!=null?e.num:(n.length-r)/a|0;if(e.shape==="circle")for(let u=r;l-- >0;u+=a)t.beginPath(),t.arc(n[u],n[u+o],c,0,L),t[s]();else{const u=c/2;for(let f=r;l-- >0;f+=a)t[i](n[f]-u,n[f+o]-u,c,c)}},Ri=(t,e,n)=>{t.beginPath();let s=[0,0];for(let i=0,r=n.length;i<r;i++){const o=n[i];let a=o[1],c,l;switch(o[0]){case"m":a=[s[0]+a[0],s[1]+a[1]];case"M":t.moveTo(a[0],a[1]),s=a;break;case"l":a=[s[0]+a[0],s[1]+a[1]];case"L":t.lineTo(a[0],a[1]),s=a;break;case"h":a=[s[0]+a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"H":a=[a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"v":a=[s[0],s[1]+a],t.lineTo(a[0],a[1]),s=a;break;case"V":a=[s[0],a],t.lineTo(a[0],a[1]),s=a;break;case"c":c=o[2],l=o[3],l=[s[0]+l[0],s[1]+l[1]],t.bezierCurveTo(s[0]+a[0],s[1]+a[1],s[0]+c[0],s[1]+c[1],l[0],l[1]),s=l;break;case"C":c=o[2],l=o[3],t.bezierCurveTo(a[0],a[1],c[0],c[1],l[0],l[1]),s=l;break;case"q":c=o[2],c=[s[0]+c[0],s[1]+c[1]],t.quadraticCurveTo(s[0]+a[0],s[1]+a[1],c[0],c[1]),s=c;break;case"Q":c=o[2],t.quadraticCurveTo(a[0],a[1],c[0],c[1]),s=c;break;case"A":case"a":{c=o[2],l=o[6],o[0]==="a"&&(l=[s[0]+l[0],s[1]+l[1]]);const{center:[u,f],start:d,end:h}=Wu(s,l,[a,c],o[3],o[4],o[5]);t.ellipse(u,f,a,c,o[3],d,h,!o[5]),s=l;break}case"r":c=o[2],c=[s[0]+c[0],s[1]+c[1]],t.arcTo(s[0]+a[0],s[1]+a[1],c[0],c[1],o[3]),s=c;break;case"R":c=o[2],t.arcTo(a[0],a[1],c[0],c[1],o[3]),s=c;break;case"z":case"Z":t.closePath()}}jt(t,e)},Si=(t,e,n,s)=>{let i;(i=e.fill)&&i!=="none"&&$o(t,n,s,"fill","fillRect"),(i=e.stroke)&&i!=="none"&&$o(t,n,s,"stroke","strokeRect")},$o=(t,e,n,s,i)=>{const r=e?.size||1;if(e.shape==="circle")for(let o of n)t.beginPath(),t.arc(o[0],o[1],r,0,L),t[s]();else{const o=r/2;for(let a of n)t[i](a[0]-o,a[1]-o,r,r)}},Ii=(t,e,n)=>{n.length<2||(Zc(t,n),t.closePath(),jt(t,e))},Mi=(t,e,n,s)=>{s.length<2||(Jc(t,n,s),t.closePath(),jt(t,e))},Zc=(t,e)=>{let n=e[0];t.beginPath(),t.moveTo(n[0],n[1]);for(let s=1,i=e.length;s<i;s++)n=e[s],t.lineTo(n[0],n[1])},Jc=(t,e,n)=>{const{start:s=0,cstride:i=1,estride:r=2}=e;let o=e?.num??(n.length-s)/r|0;t.beginPath(),t.moveTo(n[s],n[s+i]);for(let a=s+r;o-- >1;a+=r)t.lineTo(n[a],n[a+i])},Ni=(t,e,n)=>{n.length<2||e.stroke=="none"||(Zc(t,n),jt(t,e,!1))},Di=(t,e,n,s)=>{s.length<2||(Jc(t,n,s),jt(t,e,!1))},$i=(t,e,n,s,i,r)=>{let o;if(r!==void 0){t.beginPath(),t.roundRect(n[0],n[1],s,i,r),jt(t,e);return}(o=e.fill)&&o!=="none"&&t.fillRect(n[0],n[1],s,i),(o=e.stroke)&&o!=="none"&&t.strokeRect(n[0],n[1],s,i)},Kc=(t,e,n,s,i)=>{let r;(r=e.fill)&&r!=="none"&&t.fillText(s.toString(),n[0],n[1],i),(r=e.stroke)&&r!=="none"&&t.strokeText(s.toString(),n[0],n[1],i)},An=(t,e,n={attribs:{},edits:[]})=>{if(!e)return;if(ct(e,"toHiccup")){An(t,e.toHiccup(),n);return}if(I(e[0])){for(let o of e)An(t,o,n);return}const s=e[1];if(s?.__skip)return;const i=Mg(t,n,s),r=i?i.attribs:n.attribs;switch(e[0]){case"g":case"defs":$g(t,i,n,e);break;case"linearGradient":No(n,s.id,Yc(t,s,e[2]));break;case"radialGradient":No(n,s.id,Wc(t,s,e[2]));break;case"points":Si(t,r,s,e[2]);break;case"packedPoints":Ei(t,r,s,e[2]);break;case"line":Dt(t,r,e[2],e[3]);break;case"lines":wi(t,r,e[2]);break;case"hline":Dt(t,r,[-1e6,e[2]],[1e6,e[2]]);break;case"vline":Dt(t,r,[e[2],-1e6],[e[2],1e6]);break;case"polyline":Ni(t,r,e[2]);break;case"packedPolyline":Di(t,r,s,e[2]);break;case"polygon":Ii(t,r,e[2]);break;case"packedPolygon":Mi(t,r,s,e[2]);break;case"path":Ri(t,r,e[2]);break;case"rect":$i(t,r,e[2],e[3],e[4],e[5]??s?.r);break;case"circle":case"arc":yi(t,r,e[2],e[3],e[4],e[5],e[6]);break;case"ellipse":Ai(t,r,e[2],e[3],e[4],e[5],e[6],e[7]);break;case"text":Kc(t,r,e[2],e[3],e[4]);break;case"img":jc(t,r,s,e[2],e[3],e[4],e[5])}i&&Ng(t,n,i)},$g=(t,e,n,s)=>{const i=s.length,r=s[0]==="g"&&e||n;for(let o=2;o<i;o++)An(t,s[o],r)},Cg={align:"left",alpha:1,baseline:"alphabetic",compose:"source-over",dash:[],dashOffset:0,direction:"inherit",fill:"#000",filter:"none",font:"10px sans-serif",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",shadowX:0,shadowY:0,smooth:!0,stroke:"#000",weight:1},Qc={align:"textAlign",alpha:"globalAlpha",baseline:"textBaseline",clip:"clip",compose:"globalCompositeOperation",dash:"setLineDash",dashOffset:"lineDashOffset",direction:"direction",fill:"fillStyle",fillRule:"fillRule",filter:"filter",font:"font",lineCap:"lineCap",lineJoin:"lineJoin",miterLimit:"miterLimit",shadowBlur:"shadowBlur",shadowColor:"shadowColor",shadowX:"shadowOffsetX",shadowY:"shadowOffsetY",smooth:"imageSmoothingEnabled",stroke:"strokeStyle",weight:"lineWidth"},Co=(t,e=!1)=>({attribs:{...t.attribs},grads:{...t.grads},edits:[],restore:e}),Oo=(t,e,n)=>{let s;if(n){Og(t,n)&&(s=Co(e,!0));for(let i in n){const r=Qc[i];if(r){const o=n[i];o!=null&&e.attribs[i]!==o&&(!s&&(s=Co(e)),s.attribs[i]=o,s.edits.push(i),tl(t,e,i,r,o))}else(i==="__background"||i==="__clear")&&(t.save(),t.resetTransform(),i==="__clear"?n[i]&&t.clearRect(0,0,t.canvas.width,t.canvas.height):(t.fillStyle=Ms(e,n[i]),t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.restore())}return s}},Lo=(t,e,n)=>{if(n.restore){t.restore();return}const s=n.edits,i=e.attribs;for(let r=s.length;r-- >0;){const o=s[r],a=i[o];tl(t,e,o,Qc[o],a??Cg[o])}},To=(t,e,n)=>{!t.grads&&(t.grads={}),t.grads[e]=n},tl=(t,e,n,s,i)=>{switch(n){case"fill":case"stroke":case"shadowColor":t[s]=Ms(e,i);break;case"dash":t[s].call(t,i);break;case"clip":case"fillRule":break;default:t[s]=i}},Og=(t,e)=>{let n;return(n=e.transform)||e.setTransform||e.translate||e.scale||e.rotate?(t.save(),n?t.transform(n[0],n[1],n[2],n[3],n[4],n[5]):(n=e.setTransform)?t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]):((n=e.translate)&&t.translate(n[0],n[1]),(n=e.rotate)&&t.rotate(n),(n=e.scale)&&(ps(n)?t.scale(n[0],n[1]):t.scale(n,n))),!0):!1};function ko(t){const e=Math.max(0,Math.min(1,t)),n=Math.floor(e*16777215),s=(n>>16&255)/255,i=(n>>8&255)/255,r=(n&255)/255;return[s,i,r,1]}class Lg{constructor(e,n,s,i=Nn.RGBA32F,r=!1){this.gl=e;const o=mr(n);this.canvasTex=Ne(this.gl),this.backgroundTex=Ne(this.gl),this.fadeAmount=n.fadeAmount||0,this.pipeline=Ac({gl:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,textures:{curr:{format:i},next:{format:i},canvasTex:{},backgroundTex:{}},passes:[{model:fr({uv:!0}),...yc,fs:`
                    #define saturate(a) clamp( a, 0.0, 1.0 )
                    
                    void main() {
                        vec4 src = texture(input0, v_uv / uvScale + uvOffset );
                        vec4 background = texture(input2, v_uv / uvScale + uvOffset );
                        vec4 c = src;
                        ${r?"":`
                        if (src.a > 0.00001) {
                            
                            c = matrix * src + offset;

                        } 
                        `}

                        // read previous frame
                        vec4 prev = texture(input1, v_uv);
                        // fade it
                        prev = vec4(mix(background.rgb, prev.rgb, 1.0 - fadeAmount), prev.a);
                        
                        // alpha blend canvas and prev
                        output0 = vec4( c.rgb * c.a + (1.0-c.a) * prev.rgb, max(c.a, prev.a));
                    }`,inputs:["canvasTex","curr","backgroundTex"],outputs:["next"],uniforms:{canvasTex:"sampler2D",backgroundTex:"sampler2D",curr:"sampler2D",fadeAmount:["float",this.fadeAmount],fadeColor:["vec4",new Float32Array(oe(null,Is(s)))],matrix:["mat4",new Float32Array([o[0],o[5],o[10],o[15],o[1],o[6],o[11],o[16],o[2],o[7],o[12],o[17],o[3],o[8],o[13],o[18]])],offset:["vec4",[o[4],o[9],o[14],o[19]]],uvScale:["vec2",[1,1]],uvOffset:["vec2",[0,0]]},state:{blend:!1,blendFn:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEq:e.FUNC_ADD}},wc(["next"],["curr"]),{fs:`void main() { 
                      
                      vec4 l = texelFetch(input0, ivec2(gl_FragCoord.xy), 0);
                      vec4 b = texelFetch(input1, ivec2(gl_FragCoord.xy), 0); // background
                    
                      // alpha compose background and current frame
                      fragColor = vec4(l.a * l.rgb + (1.0 - l.a) * b.rgb, 1.0); }`,inputs:["curr","backgroundTex"],outputs:[]}]})}pipeline;canvasTex;backgroundTex;fadeAmount;updateImage(e,n){this.pipeline.textures.canvasTex.configure({image:e,width:e.width,height:e.height,flip:!0}),this.pipeline.textures.backgroundTex.configure({image:n,width:n.width,height:n.height,flip:!0})}draw(e,n,s){s!==void 0&&(this.fadeAmount=s,this.pipeline.models[0].uniforms.fadeAmount=this.fadeAmount),this.updateImage(e,n),this.pipeline.update()}}class Tg{constructor(e,n,s,i=Nn.RGBA32F,r=!1){this.gl=e;const o=mr(n);this.canvasTex=Ne(this.gl),this.alphaTex=Ne(this.gl),this.backgroundTex=Ne(this.gl),this.fadeAmount=n.fadeAmount||0,this.alphaBoost=s||1,this.pipeline=Ac({gl:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,textures:{curr:{format:i},next:{format:i},canvasTex:{},alphaTex:{},backgroundTex:{}},passes:[{model:fr({uv:!0}),...yc,fs:`
                    #define saturate(a) clamp( a, 0.0, 1.0 )

                    float decodeAlpha(vec3 rgb) {
                        return dot(rgb, vec3(1.0, 1.0/256.0, 1.0/65536.0));
                    }
                    
                    void main() {
                        vec4 src = texture(input0, v_uv / uvScale + uvOffset );
                        float alpha = min(alphaBoost * src.a * decodeAlpha(texture(input3, v_uv / uvScale + uvOffset).rgb), 1.0);
                        vec4 background = texture(input2, v_uv / uvScale + uvOffset );
                        vec4 c = src;
                      ${r?"":`
                        if (alpha > 0.00001) {
                            
                            c = matrix * src + offset;

                        } 
                        `}
                        // read previous frame
                        vec4 prev = texture(input1, v_uv);
                        // fade it
                        prev = vec4(mix(background.rgb, prev.rgb, 1.0 - fadeAmount), prev.a);
                        
                        // alpha blend canvas and prev
                        output0 = vec4( c.rgb * alpha + (1.0-alpha) * prev.rgb, max(alpha, prev.a));
                    }`,inputs:["canvasTex","curr","backgroundTex","alphaTex"],outputs:["next"],uniforms:{canvasTex:"sampler2D",backgroundTex:"sampler2D",alphaTex:"sampler2D",curr:"sampler2D",fadeAmount:["float",this.fadeAmount],alphaBoost:["float",this.alphaBoost],matrix:["mat4",new Float32Array([o[0],o[5],o[10],o[15],o[1],o[6],o[11],o[16],o[2],o[7],o[12],o[17],o[3],o[8],o[13],o[18]])],offset:["vec4",[o[4],o[9],o[14],o[19]]],uvScale:["vec2",[1,1]],uvOffset:["vec2",[0,0]]},state:{blend:!1,blendFn:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEq:e.FUNC_ADD}},wc(["next"],["curr"]),{fs:`void main() { 
                      
                      vec4 l = texelFetch(input0, ivec2(gl_FragCoord.xy), 0);
                      vec4 b = texelFetch(input1, ivec2(gl_FragCoord.xy), 0); // background
                    
                      // alpha compose background and current frame
                      fragColor = vec4(l.a * l.rgb + (1.0 - l.a) * b.rgb, 1.0); }`,inputs:["curr","backgroundTex"],outputs:[]}]})}pipeline;canvasTex;alphaTex;backgroundTex;fadeAmount;alphaBoost;updateImage(e,n,s){this.pipeline.textures.canvasTex.configure({image:e,width:e.width,height:e.height,flip:!0}),this.pipeline.textures.alphaTex.configure({image:s,width:s.width,height:s.height,flip:!0}),this.pipeline.textures.backgroundTex.configure({image:n,width:n.width,height:n.height,flip:!0})}draw(e,n,s,i){i!==void 0&&(this.fadeAmount=i,this.pipeline.models[0].uniforms.fadeAmount=this.fadeAmount),this.updateImage(e,n,s),this.pipeline.update()}}const kg=(t,e)=>{t.useWebGL||Rg(e,e.postprocess);const n={drawCanvas:Me(t.width,t.height,document.body,t.useDisplayP3?{ctx:{colorSpace:"display-p3"}}:{}),useWebGL:t.useWebGL,useSeparateAlpha:t.useWebGL&&t.useSeparateAlpha};return t.useWebGL&&(n.backgroundCanvas=Me(t.width,t.height,document.body,t.useDisplayP3?{ctx:{colorSpace:"display-p3"}}:{}),n.canvas=B1({width:t.width,height:t.height,parent:document.body,version:2,autoScale:!1,opts:{preserveDrawingBuffer:!0}}),"drawingBufferColorSpace"in n.canvas.gl&&t.useDisplayP3&&(n.canvas.gl.drawingBufferColorSpace="display-p3"),n.drawCanvas.canvas.style.display="none",n.backgroundCanvas.canvas.style.display="none",t.useSeparateAlpha?(n.alphaCanvas=Me(t.width,t.height,document.body),n.alphaCanvas.canvas.style.display="none",n.webGLPipe=new Tg(n.canvas.gl,e.postprocess,1.2,t.textureFormat,t.disablePostprocesing)):n.webGLPipe=new Lg(n.canvas.gl,e.postprocess,e.colors.bg[0],t.textureFormat,t.disablePostprocesing)),n},Bg=(t,e,n)=>{t.drawCanvas.canvas.width=e,t.drawCanvas.canvas.height=n,t.useWebGL&&(t.backgroundCanvas.canvas.width=e,t.backgroundCanvas.canvas.height=n,t.canvas.canvas.width=e,t.canvas.canvas.height=n,t.useSeparateAlpha&&(t.alphaCanvas.canvas.width=e,t.alphaCanvas.canvas.height=n))},el=t=>t.useWebGL?t.canvas.canvas:t.drawCanvas.canvas,Pg=(t,e)=>{An(t.useWebGL?t.backgroundCanvas.canvas.getContext("2d"):t.drawCanvas.canvas.getContext("2d"),e)},Gg=(t,e,n)=>{t.useWebGL&&(t.drawCanvas.ctx.clearRect(0,0,t.drawCanvas.canvas.width,t.drawCanvas.canvas.height),t.useSeparateAlpha&&t.alphaCanvas.ctx.clearRect(0,0,t.alphaCanvas.canvas.width,t.alphaCanvas.canvas.height)),t.useSeparateAlpha?fs(t.drawCanvas.canvas.getContext("2d"),t.alphaCanvas.canvas.getContext("2d"),e):An(t.drawCanvas.canvas.getContext("2d"),e),t.useWebGL&&(t.useSeparateAlpha?t.webGLPipe.draw(t.drawCanvas.canvas,t.backgroundCanvas.canvas,t.alphaCanvas.canvas,n):t.webGLPipe.draw(t.drawCanvas.canvas,t.backgroundCanvas.canvas,n))},fs=(t,e,n,s={attribs:{},edits:[]},i={attribs:{},edits:[]})=>{if(!n)return;if(ct(n,"toHiccup")){fs(t,e,n.toHiccup(),s,i);return}if(I(n[0])){for(let u of n)fs(t,e,u,s,i);return}const r=n[1];if(r?.__skip)return;const o=Oo(t,s,C(r)),a=Oo(e,i,O(r)),c=o?o.attribs:s.attribs,l=a?a.attribs:i.attribs;switch(n[0]){case"g":case"defs":Ug(t,e,o,s,a,i,n);break;case"linearGradient":To(s,r.id,Yc(t,r,n[2]));break;case"radialGradient":To(s,r.id,Wc(t,r,n[2]));break;case"points":Si(t,C(c),C(r),n[2]),Si(e,O(l),O(r),n[2]);break;case"packedPoints":Ei(t,C(c),C(r),n[2]),Ei(e,O(l),O(r),n[2]);break;case"line":Dt(e,O(l),n[2],n[3]),Dt(t,C(c),n[2],n[3]);break;case"lines":wi(t,C(c),n[2]),wi(e,O(l),n[2]);break;case"hline":Dt(t,C(c),[-1e6,n[2]],[1e6,n[2]]),Dt(e,O(l),[-1e6,n[2]],[1e6,n[2]]);break;case"vline":Dt(t,C(c),[n[2],-1e6],[n[2],1e6]),Dt(e,O(l),[n[2],-1e6],[n[2],1e6]);break;case"polyline":Ni(t,C(c),n[2]),Ni(e,O(l),n[2]);break;case"packedPolyline":Di(t,C(c),C(r),n[2]),Di(e,O(l),O(r),n[2]);break;case"polygon":Ii(t,C(c),n[2]),Ii(e,O(l),n[2]);break;case"packedPolygon":Mi(t,C(c),C(r),n[2]),Mi(e,O(l),O(r),n[2]);break;case"path":Ri(t,C(c),n[2]),Ri(e,O(l),n[2]);break;case"rect":$i(t,C(c),n[2],n[3],n[4],n[5]??r?.r),$i(e,O(l),n[2],n[3],n[4],n[5]??r?.r);break;case"circle":case"arc":yi(t,C(c),n[2],n[3],n[4],n[5],n[6]),yi(e,O(l),n[2],n[3],n[4],n[5],n[6]);break;case"ellipse":Ai(t,C(c),n[2],n[3],n[4],n[5],n[6],n[7]),Ai(e,O(l),n[2],n[3],n[4],n[5],n[6],n[7]);break;case"text":Kc(t,c,n[2],n[3],n[4]);break;case"img":jc(t,c,r,n[2],n[3],n[4],n[5])}o&&Lo(t,s,o),a&&Lo(e,i,a)},Ug=(t,e,n,s,i,r,o)=>{const a=o.length,c=o[0]==="g"&&n||s,l=o[0]==="g"&&i||r;for(let u=2;u<a;u++)fs(t,e,o[u],c,l)},C=t=>{const e={...t};return e.alpha=1,e},O=t=>{const e={...t};return e.stroke&&(e.stroke=ko(t.alpha?t.alpha:1)),t.fill&&(e.fill=ko(t.alpha?t.alpha:1)),e.alpha=1,e},Fg={};var Bo={};const zg=(t,e,n=!1)=>{const s=typeof global<"u"?global:typeof window<"u"?window:void 0;s&&(n||(typeof process<"u"&&Bo!==void 0?Bo.UMBRELLA_GLOBALS:!Fg))&&(s[t]=e)},br=t=>I(t)?(t.every(e=>B(e)&&e!==""||y(e))||nl(t),t):B(t)?t.length>0?br(t.split(".")):[]:t!=null?[t]:[],Hg=(t,e)=>{if(t==null)return!1;e=br(e);for(let n=e.length-1,s=0;s<=n;s++){const i=e[s];if(!t.hasOwnProperty(i)||(t=t[i],t==null&&s<n))return!1}return!0},qg=t=>{const e=br(t);return D1(e)&&nl(t),e},nl=t=>lt(`illegal path: ${JSON.stringify(t)}`);function Vg(t){const e=qg(t);let[n,s,i,r]=e;switch(e.length){case 0:return(o,a)=>a;case 1:return(o,a)=>o?(o[n]=a,o):void 0;case 2:return(o,a)=>{let c;return o&&(c=o[n])?(c[s]=a,o):void 0};case 3:return(o,a)=>{let c;return o&&(c=o[n])&&(c=c[s])?(c[i]=a,o):void 0};case 4:return(o,a)=>{let c;return o&&(c=o[n])&&(c=c[s])&&(c=c[i])?(c[r]=a,o):void 0};default:return(o,a)=>{let c=o;const l=e.length-1;for(let u=0;u<l;u++)if(!(c=c[e[u]]))return;return c[e[l]]=a,o}}}const sl=(t,e,n)=>Vg(e)(t,n),Yg=/^(function\s+\w+)?\s*\(\{([\w\s,:]+)\}/;function Wg(t,e){const n={prefix:"@",unwrap:!0,...e};return Bt(t)?il(t,n):I(t)?rl(t,n):t}const il=(t,e,n,s=[],i={},r=[])=>{n=n||t;for(let o in t)wn(n,[...s,o],i,r,e);return!e.unwrap||s.length?t:al(t,i)},rl=(t,e,n,s=[],i={},r=[])=>{n=n||t;for(let o=0,a=t.length;o<a;o++)wn(n,[...s,o],i,r,e);return!e.unwrap||s.length?t:al(t,i)},wn=(t,e,n,s,i)=>{const r=e.join("/");s.indexOf(r)>=0&&lt(`cyclic references not allowed: ${r}`);let[o,a]=ol(t,e);if(!n[r]){if(a)return n[r]=!0,o;let c=Z;s.push(r),Bt(o)?il(o,{...i,unwrap:!1},t,e,n,s):I(o)?rl(o,{...i,unwrap:!1},t,e,n,s):!i.onlyFnRefs&&B(o)&&o.startsWith(i.prefix)?c=wn(t,Po(e,o,i.prefix.length),n,s,i):ke(o)?c=Xg(o,l=>wn(t,Po(e,l,0),n,s,i),r,n):Hg(t,e)||(o=jg(t,e,n,s,i)),c!==Z&&(sl(t,e,c),o=c),n[r]=!0,s.pop()}return o},jg=(t,e,n,s,i)=>{let r=s.pop(),o;for(let a=1,c=e.length;a<=c;a++)o=wn(t,e.slice(0,a),n,s,i);return s.push(r),o},Xg=(t,e,n,s)=>{const i=Yg.exec(t.toString());let r;if(i){const o=i[2].replace(/\s|(,\s*$)/g,"").split(/,/g).map(a=>a.split(":")[0]).reduce((a,c)=>(a[c]=e(c),a),{});r=t(o,e)}else r=t(e);return _r(r,n,s),r},_r=(t,e,n)=>{n[e]=!0,Bt(t)?xg(t,e,n):I(t)&&Zg(t,e,n)},xg=(t,e,n)=>{let s,i;for(let r in t)s=t[r],i=e+"/"+r,_r(s,i,n)},Zg=(t,e,n)=>{let s,i;for(let r=0,o=t.length;r<o;r++)s=t[r],i=e+"/"+r,_r(s,i,n)},Po=(t,e,n=1)=>{if(e.charAt(n)==="/")return e.substring(n+1).split("/");t=t.slice(0,t.length-1);const s=e.substring(n).split("/");for(let i=0,r=s.length;i<r;i++)if(s[i]==="..")!t.length&&lt(`invalid lookup path: ${e}`),t.pop();else return t.concat(s.slice(i));return!t.length&&lt(`invalid lookup path: ${e}`),t};class Go{constructor(e){this._value=e}deref(){return this._value}}const ol=(t,e)=>{const n=e.length-1;let s=t,i=t instanceof Go;for(let r=0;s!=null&&r<=n;r++)s=s[e[r]],s instanceof Go&&(i=!0,s=s.deref());return[s,i]},al=(t,e)=>{for(let n in e){const s=n.split("/"),i=ol(t,s);i[1]&&sl(t,s,i[0])}return t},cl=(t,e,n)=>{t.attribs.stroke??=n.stroke.get(t,e);const s=n.stroke.update?n.stroke.update(t,e):t.attribs.stroke;t.attribs.weight??=n.weight.get(t,e);const i=n.weight.update?n.weight.update(t,e):t.attribs.weight;t.attribs.alpha??=n.alpha.get(t,e);const r=n.alpha.update?n.alpha.update(t,e):t.attribs.alpha;return{stroke:s,weight:i,alpha:r}},Jg=(t,e,n)=>(t.attribs.style??=n.style.get(t,e),n.style.update?{...t.attribs.style,...n.style.update(t,e)}:t.attribs.style),Kg=(t,e,n)=>n.map(s=>ug(s,t.pos,[-e.aspectRatio/2,-.5],[e.aspectRatio/2,.5])),Uo=(t,e,n,s,i,r=0,o)=>({ID:t,parent:o,active:!0,pos:e,dir:n,bounds:s,generation:r,history:{positions:[],length:0},supportData:{features:[],distanceToCenter:0,velocity:[0,0]},opts:i,attribs:{},lastDrawnAtLength:0}),Qg=(t,e,n,s)=>{const{pos:i,bounds:r,history:o,opts:a}=t,{step:c,fuzziness:l,maxLength:u}=a;if(t.active){o.positions.push(Ti(i));const f=e(t,s!==void 0?c*s/1e3:c,[l,l]);Wt(r,i)&&!n(t)&&o.length<=u?o.length+=f:t.active=!1}return t},tm=(t,e)=>(n,s)=>{const{pos:i,dir:r}=n,o=Te([],Ui([],r,e.vector_field.get(n,t,[0])),s);return Tt(null,i,o),n.supportData.velocity=o,In(o)},em=(t,e)=>(n,s)=>{const[i,r]=n.pos;return ll(n,t,s,e),fe(n.supportData.velocity,n.pos,[i,r]),In(n.supportData.velocity)},nm=(t,e)=>(n,s)=>{const{pos:i,dir:r}=n,[o,a]=i;ll(n,t,s,e);const c=Te([],Ui([],r,e.vector_field.get(n,t,[0])),s);return Tt(null,i,c),fe(n.supportData.velocity,n.pos,[o,a]),In(n.supportData.velocity)},sm=(t,e)=>(t.supportData.features=Kg(t,e.preset,e.images),t.supportData.distanceToCenter=In(t.pos),t),ll=(t,e,n,s)=>{s.domain_warping&&Tt(null,t.pos,_s([],s.domain_warping.get(t,e),n))},im={warped:em,vector_field:tm,warped_vector_field:nm},rm=(t,e)=>t.active?e>0?t.history.length-t.lastDrawnAtLength>=e:!0:!1;var om=Object.getOwnPropertyDescriptor,am=(t,e,n,s)=>{for(var i=s>1?void 0:s?om(e,n):e,r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(i)||i);return i};let Ci=class{constructor(t,e,n,s,i=void 0,r=(o,a)=>{}){this.space=n,this.rnd=s,this.data=new Array(t*e).fill(i),this.size=[t,e],this.stride=[1,t],this.spaceMin=n.pos,this.spaceMax=tt([],n.pos,n.size),this.freeValue=i;for(let o=0;o<t;o++)for(let a=0;a<e;a++)this.setAtUnsafe(o,a,r(o,a))}size;stride;spaceMin;spaceMax;data=[];freeValue;agents=[];clear(){const[t,e]=this.size;for(let n=0;n<t;n++)for(let s=0;s<e;s++)this.setAtUnsafe(n,s,this.freeValue)}setAgents(t){this.agents=t}fromSpaceToGrid(t){const[e,n]=ns([],t,this.spaceMin,this.spaceMax,[0,0],this.size);return[Math.floor(e),Math.floor(n)]}fromGridToSpace(t){return ns([],t,[0,0],this.size,this.spaceMin,this.spaceMax)}isFree(t){const e=this.fromSpaceToGrid(t);return this.isCellFree(e[0],e[1])}checkCollision(t,e,n=!1,s=0){const i=this.fromSpaceToGrid(t.pos);return this.isCellFree(i[0],i[1],e,t,s)?(n&&this.setAt(i[0],i[1],t),!1):!0}isCellFree(t,e,n=0,s,i=0){if(this.includes(t,e)){const r=this.getAt(t,e);return r===this.freeValue||s!==void 0&&r===s||r.ID<i}}randomFree(t,e=0){let n=0;for(;n<1e4;){const s=xr(t,1,this.rnd);if(s&&s.length>0){const i=this.fromSpaceToGrid(s[0]);if(this.isCellFree(Math.floor(i[0]),Math.floor(i[1]),0,void 0,e))return{pos:s[0],agent:void 0};n++}}return{pos:void 0,agent:void 0}}freeLine(t,e,n,s,i,r=!0,o=0){const a=s*Math.min(this.width,this.height),c=Te([],n,1),l=this.fromSpaceToGrid(e);let u=Tt([],l,c),f=this.fromGridToSpace(u),d=0;for(;(!i||Wt(i,f))&&(!r||this.isCellFree(Math.floor(u[0]),Math.floor(u[1]),0,t,o))&&d<a;)Tt(null,u,c),f=this.fromGridToSpace(u),d++;return[f[0],f[1]]}randomOccupied(t,e="random point"){let n=0;for(;n<1e4;){if(e==="random point"){const s=xr(t,1,this.rnd);if(s){const i=this.fromSpaceToGrid(s[0]);if(!this.isCellFree(Math.floor(i[0]),Math.floor(i[1]),0))return{pos:[s[0][0],s[0][1]],agent:this.getAt(Math.floor(i[0]),Math.floor(i[1]))}}}else if(this.agents.length>0){const s=se(this.agents,this.agents.map(i=>i.history.length),this.rnd);if(s.history.length>0){const i=w(s.history.positions,this.rnd);if(Wt(t,i))return{agent:s,pos:[i[0]+this.rnd.minmax(-.001,.001),i[1]+this.rnd.minmax(-.001,.001)]}}}n++}return{pos:void 0,agent:void 0}}setAtUnsafe(t,e,n){}setAt(t,e,n){}getAt(t,e){}getAtUnsafe(t,e){}includes(t,e){}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}};Ci=am([Rc],Ci);const cm=(t,e,n=[])=>({preset:t,agents:[],spaceManager:e,images:n,iterations:0,spaceTraveled:0,agentsToCreate:0,iterationSpawnableAgents:0,activeAgents:0}),lm=(t,e,n,s)=>{let i,r;if(t.iterations+=1,t.iterations<e.agentFactory.maxIterations&&t.spaceTraveled<e.agentFactory.maxSpaceTraveled||e.agentFactory.neverEnding){const o=h=>t.spaceManager.checkCollision(h,0,!0,t.agents.length-e.agentFactory.maxColliding),a=Lt(Sn(Vt(h=>h.active),H(h=>(sm(h,t),Qg(h,im[h.opts.type?h.opts.type:"vector_field"](t,e),o,s)))),ae(),t.agents);r=Lt(Vt(h=>h.active),ae(),a),t.activeAgents=r.length;const c=Lt(Vt(h=>!h.active),ae(),a);t.spaceTraveled=t.agents.reduce((h,g)=>h+g.history.length,0),t.agentsToCreate+=c.length*e.agentFactory.branch+e.agentFactory.newPerIteration,t.iterationSpawnableAgents+=e.agentFactory.maxNewPerIteration,i=Math.min(t.agentsToCreate,t.iterationSpawnableAgents,e.agentFactory.maxActive-r.length),e.agentFactory.neverEnding||(i=Math.min(i,e.agentFactory.maxAgents-t.agents.length)),t.agentsCreated=0;let l=0;const f=e.bounds.get(t).init.map(h=>ie(h)),d=f.reduce((h,g)=>h+g,0);for(;t.agentsCreated<i&&l<300;)ul(t,e,f,d,n)&&t.agentsCreated++,l++;return t.iterationSpawnableAgents-=t.agentsCreated,!0}return t.iterations>=e.agentFactory.maxIterations&&console.log("max iterations reached"),t.spaceTraveled>=e.agentFactory.maxSpaceTraveled&&console.log("max length reached"),!1},ul=(t,e,n,s,i)=>{let r=!1;const o=e.agentFactory.initPolicy(t),a=e.bounds.get(t);if(o==="randomFree"){const c=s>0?se(a.init,n,i):w(a.init,i),{pos:l,agent:u}=t.spaceManager.randomFree(c),f=w(e.agentFactory.initialDirections?.length>0?e.agentFactory.initialDirections:e.agentFactory.directions,i);l&&f&&(t.agents.push(Uo(t.agents.length,l,f,w(a.overall,i),e.agent.get(t))),r=!0,t.agentsToCreate--)}else if(o==="randomOccupied"){const{pos:c,agent:l}=t.spaceManager.randomOccupied(w(a.update,i));c&&l&&(t.agents.push(Uo(t.agents.length,c,w([[l.dir[1],-l.dir[0]],[-l.dir[1],l.dir[0]]],i),l.bounds,e.agent.get(t),l.generation+1,l)),r=!0,t.agentsToCreate--)}return r},um=(t,e,n)=>{const s=[],i=fe([],e,t),r=In(i);let o=n.grains.proportional?Math.floor(r*n.grains.factor):n.grains.factor;const a=1/(o-1);for(let c=0;c<o;c++){let l;n.grains.distribution&&n.grains.distribution==="sin"?l=[t[0]+(e[0]-t[0])*Math.sin(Math.sin(c*a)),t[1]+(e[1]-t[1])*Math.sin(Math.sin(c*a))]:l=Y0([],t,e,[c/o,c/o]);let u=n.alpha.min?n.alpha.min:0,f=n.alpha.max===void 0?1:n.alpha.max,d=ft(ne(u,f,n.alpha.decay(1-c/o)),u,f),h=n.color.color;const g=new rn([l],{stroke:h,size:n.size,weight:n.shapeAttribs.weight,shape:"circle",alpha:d,fill:n.shapeAttribs.filled?h:void 0});s.push(g)}return s},fm=(t,e,n)=>{let s=cl(t,e,e.preset),i=Jg(t,e,e.preset);const r=[];return i.type.includes("line")&&r.push(dm(t,e)),i.type.includes("sanding")&&r.push(hm(t,e,{...s,...i})),i.type.includes("square")&&r.push(mm(t,e,{...s,...i},n)),i.type.includes("circle")&&r.push(gm(t,e,{...s,...i},n)),t.lastDrawnAtLength=t.history.length,ge(s,r)},dm=(t,e,n=1)=>A0(t.history.positions.at(-n),t.pos,cl(t,e,e.preset)),hm=(t,e,n)=>{const s=[];if(n.type.includes("sanding")){n.color!==void 0&&(n.stroke=n.color);let r=Te([],Ui([],t.supportData.velocity,Vn));const o=Fo(t.pos,e.spaceManager.freeLine(t,t.pos,r,n.maxLength*(n.multiplyLengthFactor??1),n.followBounds?t.bounds:void 0,!0,e.agents.length-e.preset.agentFactory.maxColliding),n);if(s.push(...o),n.shadingLength>0){const a=Fo(t.pos,Tt([],t.pos,Te([],[-r[0],-r[1]],n.shadingLength)),{...n,minAlpha:0,stroke:n.shadingColor!==void 0?n.shadingColor:De([],Pc(-.8),Is(n.stroke)),grainsFactor:n.grainsFactor});s.push(...a)}}return ge(n,s)},Fo=(t,e,n)=>um(t,e,{grains:{factor:n.grainsFactor,proportional:!0,distribution:n.grainsDistribution},alpha:{min:n.minAlpha,max:n.maxAlpha>0?n.maxAlpha:n.alpha,decay:n.alphaDecay,multiplyByImage:void 0,luminanceRange:n.multiplyByImageLuminance?n.multiplyByImageLuminance.range:[0,1]},color:{color:n.stroke,fromImage:n.colorFromImage!==void 0?n.colorFromImage.index:void 0},size:Math.max(1e-4,n.weight*n.sizeFactor),shapeAttribs:{weight:n.weightFactor?n.weightFactor*n.weight:n.weight*.5,filled:!0}}),gm=(t,e,n,s)=>{const i=[];return i.push(Ks(t.pos,Math.min(n.weight,.6),{...n,alpha:.001})),s.probability(0)&&i.push(Ks(t.pos,s.minmax(.001,.01),{...n,fill:Dc([],ue(w(e.preset.colors.fg,s)),s.minmax(.2,.6))})),ge(n,i)},mm=(t,e,n,s)=>{const i=[];return s.probability(5e-4)&&i.push(ei(t.pos,[s.minmax(.001,.3),s.minmax(.001,.3)],{...n,fill:Dc([],ue(w(e.preset.colors.fg,s)),s.minmax(.2,.6))})),ge(n,i)},pm=(t,e,n,s,i,r)=>{const o=[];return t.forEach((a,c)=>{if(e[c%e.length]){const l=i[c%i.length],u={weight:s[c%s.length],stroke:l};n[c%n.length]&&(u.fill=l),r&&(u.r=r[c%r.length]),a.attribs=u,o.push(a)}}),ge({lineCap:"round",radius:300},o)};let $e,vr,ot;addEventListener("beforeunload",t=>{console.log("beforeunload"),vr=[]});const bm=async(t,e,n,s,i)=>{const r=Wg({...t(e,n,s,i)},{onlyFnRefs:!0});return $e={preset:r,iterations:0,presetId:r.name,lineSlice:-1},vr=await ag(r.assets),r.assets.length>0&&console.log("using images "+r.assets.map(o=>o).join(", ")),zg("state",$e),$e},_m=t=>{const{preset:e}=$e,{gridSize:n,aspectRatio:s}=e;ot=cm(e,new Ci(Math.floor(n[0]),Math.floor(n[1]),bn([-s/2,-.5],[s,1]),t.RND,0,(o,a)=>0),vr),window.agents=ot;const i=e.bounds.get(ot).init.map(o=>ie(o)),r=i.reduce((o,a)=>o+a,0);for(let o=0;o<e.agentFactory.initialAgents;o++)ul(ot,e,i,r,t.RND);return ot.agentsToCreate=0,ot},vm=(t,e)=>{const{preset:n}=$e;return lm(ot,n,t.RND,e)},ym=(t,e,n,s=!1,i=!1,r=!1)=>{const{preset:o}=$e,a=s||i,c=ot.preset.agent.get(ot).minSpaceBeforeDrawing||0,l=Lt(Sn(Vt(f=>f.active&&f.history.positions.length>0&&rm(f,c)),H(f=>fm(f,ot,n))),ae(),ot.agents),u=ge({lineCap:"round",lineJoin:"round"},l);return a&&(r||s)&&u.children.unshift(fl(t,f=>f,o.background)),e(u)},fl=(t,e,n,s)=>{const i=[];return s&&i.push(bn(t,{fill:s})),n&&i.push(e(pm(n.shapes,n.draw,n.fill,n.weights,n.colors,n.rounds))),ge({lineCap:"round"},i)},Am=(t=!1)=>{const e=document.createElement("div");e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.padding="12px 16px",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.fontFamily="monospace",e.style.fontSize="2vw",e.style.borderRadius="4px",e.style.zIndex="1000",e.style.display=t?"block":"none",e.style.pointerEvents="none",e.style.whiteSpace="pre-line",document.body.appendChild(e);let n=t;return{element:e,isVisible:n,toggle:()=>{n=!n,e.style.display=n?"block":"none"},update:(r,o,a,c)=>{n&&(e.textContent=`Frame: ${r}
        FPS: ${o}
        SpaceTraveled: ${a.spaceTraveled.toFixed(2)}
        Agents: ${a.agents.length}
        ActiveAgents: ${a.activeAgents}
        AgentsCreated: ${a.agentsCreated}
        Preset: ${c.presetId}`)}}};$genart.configure({id:"layer-trippy",allowExternalConfig:!1});await $genart.waitForAdapter();const Ct=await $genart.setParams({hash:$genart.params.text({name:"Hash",desc:"seed for random",edit:"protected",maxLength:256,default:" "}),numAgents:$genart.params.range({name:"Max Active Agents",desc:"Max number of active agents",edit:"protected",min:1,max:50,step:1,default:20}),vfNumber:$genart.params.range({name:"VF Number",desc:"Vector Fields Number",min:2,max:6,step:1}),mixStrategy:$genart.params.choice({name:"VF Mix Strategy",desc:"Vector Fields Mix Strategy",options:Qe}),mixType:$genart.params.choice({name:"VF Mix Type",desc:"Vector Fields Mix Type",options:["step","linear","hermite"]}),vectorFieldQuantization:$genart.params.choice({name:"VF Quantization",desc:"Vector Fields Quantization",options:["0","2","3","4","5"]}),speed:$genart.params.range({name:"speed multiplier",desc:"speed multiplier of the drawing system",edit:"protected",min:.1,max:10,step:.1,default:2}),fade:$genart.params.range({name:"fade multiplier",desc:"fade multiplier of the drawing system",edit:"protected",min:0,max:10,step:.01,default:1})});$genart.random.reset();let Qt=$genart.random,ds=$genart.seed;Ct("hash").trim()!==""&&(ds=Ct("hash"),Qt=new $genart.prng.SFC32(dg(ds)));const hs={RND:new Jt(Qt.rnd),RND_COLORS:new Jt(Qt.copy().rnd),RND_STYLE:new Jt(Qt.copy().rnd),RND_BOUNDS:new Jt(Qt.copy().rnd),RND_NOISE:new Jt(Qt.copy().rnd),RND_SYSTEM:new Jt(Qt.copy().rnd)};let wm=!0,Em=!1,Rm=Nn.RGBA16F,Sm=!0,Im=!1,Oi,dl,re,zo=1*60,Mm=!1,Nm=-1,Ho=0,qo=0,Dm=!1;const gs=await bm(Sg,hs,$genart.screen.width,$genart.screen.height,{mixStrategy:Ct("mixStrategy"),quantization:Ct("vectorFieldQuantization"),interpolation:Ct("mixType"),vfNumber:Ct("vfNumber")}),{preset:tn}=gs;console.log(ds,tn);$genart.on("genart:param-change",({paramID:t,param:e})=>{console.log("param change:",t,e)});$genart.on("genart:resize",({screen:t})=>{console.log("resize",t),hl()});let te,ee,yr;const hl=()=>{({width:te,height:ee}=$genart.screen),re||(re=kg({useWebGL:wm,width:te,height:ee,useDisplayP3:Sm,useSeparateAlpha:Em,textureFormat:Rm,disablePostprocesing:Im},tn),yr=Am(Dm)),Bg(re,te,ee),dl=_m(hs),Oi=t=>si(ni(t,[te/tn.aspectRatio,ee]),[te/2,ee/2]),Pg(re,fl([te,ee],Oi,tn.background,tn.colors.bg[0]))};hl();$genart.setUpdate((t,e)=>{const{preset:n}=gs;n.agentFactory.maxActive=Ct("numAgents"),qo=(n.postprocess.fadeAmount||0)*Ct("fade");const s=Math.min(t-Ho,100);Ho=t;let i=!0;if(zo<=0){i=i&&vm(hs,s*Ct("speed"));const r=i&&ym([te,ee],Oi,hs.RND_STYLE,Mm);i&&Gg(re,r,qo),i||console.log("stop")}return zo--,e===0&&$genart.capture(el(re)),e===Nm&&gl(),yr.update(e,Math.round(1e3/Math.max(s,1)),dl,gs),i});window.onkeydown=t=>{switch(t.key){case"x":gl();break;case"o":yr.toggle();break}};const gl=()=>{Lf(el(re),`${gs.presetId}-${ds}-${xf()}`,"png"),console.log("saved to image")};
