(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const _i=1/2**32;class fl{float(e=1){return this.int()*_i*e}probability(e){return this.float()<e}norm(e=1){return(this.int()*_i-.5)*2*e}normMinMax(e,n){const s=this.minmax(e,n);return this.float()<.5?s:-s}minmax(e,n){return this.float()*(n-e)+e}minmaxInt(e,n){e|=0;const s=(n|0)-e;return s?e+this.int()%s:e}minmaxUint(e,n){e>>>=0;const s=(n>>>0)-e;return s?e+this.int()%s:e}}class Jt extends fl{constructor(e){super(),this.rnd=e}float(e=1){return this.rnd()*e}norm(e=1){return(this.rnd()-.5)*2*e}int(){return this.rnd()*4294967296>>>0}}const ue=new Jt(Math.random),E=(t,e=ue,n=0,s=t.length)=>t[e.minmax(n,s)|0],dl=(t,e=ue)=>E(Object.keys(t),e),Sn=(t,e=n=>n!==void 0?": "+n:"")=>class extends Error{origMessage;constructor(n){super(t(n)+e(n)),this.origMessage=n!==void 0?String(n):""}},hl={};var vi={};const gl=Sn(()=>"Assertion failed"),I=(typeof process<"u"&&vi!==void 0?vi.UMBRELLA_ASSERTS:!hl)?(t,e)=>{if(typeof t=="function"&&!t()||!t)throw new gl(typeof e=="function"?e():e)}:()=>{},ml=(t,e,n=ue)=>{const s=t.length;I(s>0,"no choices given");const r=e?t.map((o,a)=>[e[a]||0,o]).sort((o,a)=>a[0]-o[0]):t.map(o=>[1,o]),i=r.reduce((o,a)=>o+a[0],0);return i<=0&&console.warn("total weights <= 0"),()=>{const o=n.float(i);let a=i;for(let c=0;c<s;c++)if(a-=r[c][0],a<=o)return r[c][1]}};let yt=20;const pl=Sn(()=>"unsupported operation"),At=t=>{throw new pl(t)},G=(t=1,e,...n)=>{const s=[,,].concat(n),r=(...i)=>{const o=s[i[t].length]||e;return o?o(...i):At(`no impl for vec size ${i[t].length}`)};return r.add=(i,o)=>s[i]=o,r.default=i=>e=i,r.impl=i=>i!=null&&s[i]||e,r},Ge=(t,e=1,n=!0)=>{const s=n?(a,c,l)=>{!a&&(a=c);for(let u=c.length;u-- >0;)a[u]=t(c[u],l[u]);return a}:(a,c,l)=>{!a&&(a=l);for(let u=c.length;u-- >0;)a[u]=t(c[u],l[u]);return a},r=n?(a,c,l)=>(!a&&(a=c),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a):(a,c,l)=>(!a&&(a=l),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a),i=n?(a,c,l)=>(!a&&(a=c),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a):(a,c,l)=>(!a&&(a=l),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a),o=n?(a,c,l)=>(!a&&(a=c),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a[3]=t(c[3],l[3]),a):(a,c,l)=>(!a&&(a=l),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a[3]=t(c[3],l[3]),a);return[G(e,s,r,i,o),r,i,o]},Fo=(t,e)=>t+e,bl=(t,e)=>t/e,zo=(t,e,n)=>t*e+n,Ho=(t,e,n)=>t+(e-t)*n,qo=(t,e)=>t*e,Vo=(t,e)=>t-e,_l=(t,e,n)=>(t-e)*n,[vl,yl,Al,Im]=Ge(Fo),Ct=vl,Q=yl,ye=Al,hs=(t,e=1)=>{const n=(o,a,c)=>{!o&&(o=a);for(let l=a.length;l-- >0;)o[l]=t(a[l],c);return o},s=(o,a,c)=>(!o&&(o=a),o[0]=t(a[0],c),o[1]=t(a[1],c),o),r=(o,a,c)=>(!o&&(o=a),o[0]=t(a[0],c),o[1]=t(a[1],c),o[2]=t(a[2],c),o),i=(o,a,c)=>(!o&&(o=a),o[0]=t(a[0],c),o[1]=t(a[1],c),o[2]=t(a[2],c),o[3]=t(a[3],c),o);return[G(e,n,s,r,i),s,r,i]},[Mm,wl,El,Dm]=hs(Fo),Yo=wl,Rl=El,yi=-1/0,Ai=1/0,Sl=Object.freeze([yi,yi]),Il=Object.freeze([Ai,Ai]),gt=Object.freeze([0,0]),Ml=Object.freeze([1,0]),mt=Object.freeze([0,0,0]),xt=Object.freeze([0,0,0,0]),Dl=(t,e=1)=>{const n=(o,a,c,l)=>{!o&&(o=a);for(let u=a.length;u-- >0;)o[u]=t(a[u],c,l[u]);return o},s=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c,l[0]),o[1]=t(a[1],c,l[1]),o),r=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c,l[0]),o[1]=t(a[1],c,l[1]),o[2]=t(a[2],c,l[2]),o),i=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c,l[0]),o[1]=t(a[1],c,l[1]),o[2]=t(a[2],c,l[2]),o[3]=t(a[3],c,l[3]),o);return[G(e,n,s,r,i),s,r,i]},[Nl,$l,Cl,Nm]=Dl(zo),tn=Nl,Xn=$l,Ys=Cl,[Ol,Ll,Bl,$m]=Ge(Math.max),Ws=Ol,xn=Ll,wi=Bl,z=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t),Nt=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t),ie=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t),wt=G(1,(t,e)=>{!t&&(t=[]);for(let n=e.length;n-- >0;)t[n]=e[n];return t},z,Nt,ie),v=t=>typeof t=="number",Ei=Object.getPrototypeOf,Lt=t=>{let e;return t!=null&&typeof t=="object"&&((e=Ei(t))===null||Ei(e)===null)},Tl=(t,e=0)=>new Array(t).fill(e),$r=t=>{if(t.length){const e=t[t.length-1];return Lt(e)?t.pop():(e==null&&t.pop(),void 0)}},kl=t=>{const e=$r(t);return t.length?t.length===2?[t[0],t[1],e]:[void 0,t[0],e]:[void 0,void 0,e]},Pl=t=>{const e=$r(t);return t.length?t.length===2?[t[0],t[1],e]:v(t[0])?[void 0,t[0],e]:[t[0],void 0,e]:[void 0,void 0,e]},J=(t,e=2)=>v(t)?Tl(e,t):t,Gl=t=>t instanceof Set,at=(t,e)=>typeof t?.[e]=="function",Ul=t=>Gl(t)?t:new Set(t),Fl=(t,e)=>{const n=Ul(e),s={};for(let r in t)t.hasOwnProperty(r)&&!n.has(r)&&(s[r]=t[r]);return s},Cr=t=>at(t,"copy")?t.copy():wt([],t),Or=t=>t.map(Cr),A=(t,...e)=>t?e.length?Fl({...t},e):{...t}:void 0,je=t=>A(t.attribs,"__samples"),Wt=(t,e,n)=>new t(n||Or(e.points),A(e.attribs));class $e{constructor(e=[0,0,0],n=1,s){this.pos=e,this.attribs=s,this.size=wi(null,J(n,3),mt)}type="aabb";dim=3;size;copy(){return new $e(Nt([],this.pos),Nt([],this.size),A(this.attribs))}withAttribs(e){return new $e(this.pos,this.size,e)}min(){return Nt([],this.pos)}max(){return ye([],this.pos,this.size)}offset(e){const n=Ys([],this.size,.5,this.pos);return wi(null,Rl(null,this.size,e*2),mt),Ys(this.pos,this.size,-.5,n),this}toHiccup(){return["aabb",this.attribs,this.pos,this.size]}}const S=Array.isArray,gs=t=>t!=null&&typeof t!="function"&&t.length!==void 0,zl=Sn(()=>"illegal argument(s)"),ct=t=>{throw new zl(t)},Hl=t=>((t==null||!t[Symbol.iterator])&&ct(`value is not iterable: ${t}`),t),Wo=t=>S(t)?t:[...Hl(t)];class ms{constructor(e,n){this.attribs=n,this.points=e?Wo(e):[]}points;*[Symbol.iterator](){yield*this.points}clear(){this.points.length=0}}const Ri=Object.getPrototypeOf({}),Ln="function",Si="string",lt=(t,e)=>{let n;if(t===e)return!0;if(t!=null){if(typeof t.equiv===Ln)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===Ln)return e.equiv(t)}else return t==e;return typeof t===Si||typeof e===Si?!1:(n=Object.getPrototypeOf(t),(n==null||n===Ri)&&(n=Object.getPrototypeOf(e),n==null||n===Ri)?Yl(t,e):typeof t!==Ln&&t.length!==void 0&&typeof e!==Ln&&e.length!==void 0?Lr(t,e):t instanceof Set&&e instanceof Set?ql(t,e):t instanceof Map&&e instanceof Map?Vl(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},Lr=(t,e,n=lt)=>{let s=t.length;if(s===e.length)for(;s-- >0&&n(t[s],e[s]););return s<0},ql=(t,e,n=lt)=>t.size===e.size&&n([...t.keys()].sort(),[...e.keys()].sort()),Vl=(t,e,n=lt)=>t.size===e.size&&n([...t].sort(),[...e].sort()),Yl=(t,e,n=lt)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let s in t)if(!e.hasOwnProperty(s)||!n(t[s],e[s]))return!1;return!0},st=Math.PI,O=st*2,Vn=st/2;let U=1e-6;const Br=(t,e=1)=>[Math.cos(t)*e,Math.sin(t)*e],Wl=t=>(t%=O,t<0?O+t:t),jl=t=>(t=Math.abs(t),t>st?O-t:t),ut=(t,e,n)=>t<e?e:t>n?n:t,y=t=>t<0?0:t>1?1:t,jo=(t,e,n)=>t>=e&&t<=n,Tr=(t,e,n)=>n!==e?(t-e)/(n-e):0,et=(t,e,n,s,r)=>s+(r-s)*Tr(t,e,n),fn=(t,e,n,s,r)=>s+(r-s)*y(Tr(t,e,n)),Xl=(t,e,n)=>e+(n-e)*y(t),[xl,Zl,Jl,Cm]=Ge(qo),Kl=xl,j=Zl,ze=Jl,Ql=(t,e)=>(n,s,r)=>{n?n!==s&&wt(n,s):n=s;const i=Math.sin(r),o=Math.cos(r),a=s[t],c=s[e];return n[t]=a*o-c*i,n[e]=a*i+c*o,n},Xo=Ql(0,1),kr=Xo,xo=(t,e,n,s,r=[])=>Q(null,Xo(null,j(r,Br(s),e),n),t),[tu,eu,nu,Om]=hs(qo),ps=tu,we=eu,js=nu,su=(t,e,n,s,r,i,o)=>(!t&&(t=e),tn(t,s,o,tn(t,n,i,ps(t,e,r)))),ru=(t,e,n,s,r,i,o,a,c)=>(!t&&(t=e),tn(t,r,c,tn(t,s,a,tn(t,n,o,ps(t,e,i))))),iu=(t,e,n,s,r,i)=>{const o=1-i,a=o*o,c=i*i;return ru(t,e,n,s,r,a*o,3*a*i,3*c*o,c*i)},ou=(t,e)=>{const n=$r(e);return new t(e.length===1?e[0]:e,n)},au=(t,e)=>I(t===e,`require ${e} points`);class Ce{constructor(e=[0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}type="circle";dim=2;copy(){return new Ce(z([],this.pos),this.r,A(this.attribs))}withAttribs(e){return new Ce(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class Vt extends ms{type="poly";dim=2;add(...e){this.points.push(...e)}copy(){return Wt(Vt,this)}copyTransformed(e){return Wt(Vt,this,e(this.points))}withAttribs(e){return new Vt(this.points,e)}toHiccup(){return["polygon",this.attribs,this.points]}}class Oe{constructor(e=[0,0],n=[1,1],s){this.pos=e,this.attribs=s,this.r=J(n)}type="ellipse";dim=2;r;copy(){return new Oe(z([],this.pos),z([],this.r),A(this.attribs))}withAttribs(e){return new Oe(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class en{constructor(e,n){this.attribs=e,this.children=n?Wo(n):[]}type="group";dim=2;children;*[Symbol.iterator](){yield*this.children}add(...e){return this.children.push(...e),this}clear(){this.children.length=0}copy(){return this.copyTransformed(e=>e.copy())}copyTransformed(e){return new en(A(this.attribs),this.children.map(e))}withAttribs(e){return new en(e,this.children)}equiv(e){return e instanceof en&&lt(this.attribs,e.attribs)&&lt(this.children,e.children)}toHiccup(){return["g",this.attribs,...this.children.map(e=>e.toHiccup())]}}const Ii=(t,e)=>v(t)?[t,0,!1]:[t.theta?Math.floor(O/t.theta):t.dist?Math.floor(O/(t.dist/e)):t.num||yt,(t.start||0)*O,t.last===!0],ft=(t,e)=>{if(e){const n=e.__samples;return v(t)?v(n)?n:{num:t,...n}:v(n)?{...t,num:n}:{...t,...n}}return t},cu=(t,e)=>t[0]===e[0]?["V",e[1]]:t[1]===e[1]?["H",e[0]]:["L",e];class nn extends ms{type="line";dim=2;constructor(e,n){super(e,n),au(this.points.length,2)}copy(){return Wt(nn,this)}copyTransformed(e){return Wt(nn,this,e(this.points))}withAttribs(e){return new nn(this.points,e)}toHiccup(){return[this.type,this.attribs,this.points[0],this.points[1]]}toHiccupPathSegments(){return[cu(this.points[0],this.points[1])]}}const Zo=t=>t[t.length-1],Zn=t=>t,Ue=t=>typeof t?.[Symbol.iterator]=="function",In=(t,e)=>[t[0],t[1],e];class dn{value;constructor(e){this.value=e}deref(){return this.value}}const Mi=t=>new dn(t),Ot=t=>t instanceof dn,lu=t=>t instanceof dn?t:new dn(t),hn=t=>t instanceof dn?t.deref():t,uu=()=>t=>{const e=t[2];return In(t,(n,s)=>{if(s){for(let r of hn(s)||[])if(n=e(n,r),Ot(n))break}return Ot(s)?lu(n):n})},fu=Sn(()=>"illegal arity"),Pr=t=>{throw new fu(t)};function Jo(...t){let[e,n,s,r,i,o,a,c,l,u]=t;switch(t.length){case 0:Pr(0);case 1:return e;case 2:return(...d)=>e(n(...d));case 3:return(...d)=>e(n(s(...d)));case 4:return(...d)=>e(n(s(r(...d))));case 5:return(...d)=>e(n(s(r(i(...d)))));case 6:return(...d)=>e(n(s(r(i(o(...d))))));case 7:return(...d)=>e(n(s(r(i(o(a(...d)))))));case 8:return(...d)=>e(n(s(r(i(o(a(c(...d))))))));case 9:return(...d)=>e(n(s(r(i(o(a(c(l(...d)))))))));case 10:default:const f=(...d)=>e(n(s(r(i(o(a(c(l(u(...d))))))))));return t.length===10?f:Jo(f,...t.slice(10))}}const bs=t=>at(t,"xform")?t.xform():t;function Mn(...t){return t=t.map(bs),Jo.apply(null,t)}const x=Symbol(),Di=()=>{},du=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:Pr(t.length);function gn(...t){const e=t[0],n=e[0],s=e[1],r=e[2];t=du(t);const i=t[0]==null?n():t[0],o=t[1];return hn(s(at(o,"$reduce")?o.$reduce(r,i):gs(o)?hu(r,i,o):gu(r,i,o)))}const hu=(t,e,n)=>{for(let s=0,r=n.length;s<r;s++)if(e=t(e,n[s]),Ot(e)){e=e.deref();break}return e},gu=(t,e,n)=>{for(let s of n)if(e=t(e,s),Ot(e)){e=e.deref();break}return e},_s=(t,e)=>[t,Zn,e],mu=(t,e)=>{const n=e.length-1;return Ue(e[n])?e.length>1?gn(t.apply(null,e.slice(0,n)),e[n]):gn(t(),e[0]):void 0};function oe(t){return t?[...t]:_s(()=>[],(e,n)=>(e.push(n),e))}function*Ko(t,e){const n=bs(t)(oe()),s=n[1],r=n[2];for(let i of e){const o=r([],i);if(Ot(o)){yield*hn(s(o.deref()));return}o.length&&(yield*o)}yield*hn(s([]))}function*vs(t,e){const n=bs(t)([Di,Di,(s,r)=>r])[2];for(let s of e){let r=n(x,s);if(Ot(r)){r=hn(r.deref()),r!==x&&(yield r);return}r!==x&&(yield r)}}const pu=(t,e,n=vs)=>{const s=e.length-1;return Ue(e[s])?e.length>1?n(t.apply(null,e.slice(0,s)),e[s]):n(t(),e[0]):void 0};function H(t,e){return Ue(e)?vs(H(t),e):n=>{const s=n[2];return In(n,(r,i)=>s(r,t(i)))}}function Jn(t,e){return Ue(e)?Ko(Jn(t),e):Mn(H(t),uu())}class sn extends ms{type="points";dim=2;copy(){return Wt(sn,this)}copyTransformed(e){return Wt(sn,this,e(this.points))}withAttribs(e){return new sn(this.points,e)}toHiccup(){return[this.type,this.attribs,this.points]}}class ae extends ms{type="poly3";dim=3;add(...e){this.points.push(...e)}copy(){return Wt(ae,this)}copyTransformed(e){return Wt(ae,this,e(this.points))}withAttribs(e){return new ae(this.points,e)}toHiccup(){return["polygon3",this.attribs,this.points]}}class mn{constructor(e,n,s){this.pos=e,this.dir=n,this.attribs=s}type="ray";dim=2;copy(){return new mn(z([],this.pos),z([],this.dir),A(this.attribs))}withAttribs(e){return new mn(this.pos,this.dir,e)}toHiccup(){return["line",this.attribs,this.pos,Xn([],this.dir,1e6,this.pos)]}}class pn{constructor(e,n,s){this.pos=e,this.dir=n,this.attribs=s}type="ray3";dim=3;copy(){return new pn(Nt([],this.pos),Nt([],this.dir),A(this.attribs))}withAttribs(e){return new pn(this.pos,this.dir,e)}toHiccup(){return["line3",this.attribs,this.pos,Ys([],this.dir,1e6,this.pos)]}}class V{constructor(e=[0,0],n=1,s){this.pos=e,this.attribs=s,this.size=xn(null,J(n),gt)}type="rect";dim=2;size;copy(){return new V(z([],this.pos),z([],this.size),A(this.attribs))}withAttribs(e){return new V(this.pos,this.size,e)}min(){return z([],this.pos)}max(){return Q([],this.pos,this.size)}offset(e){const n=Xn([],this.size,.5,this.pos);return xn(null,Yo(null,this.size,e*2),gt),Xn(this.pos,this.size,-.5,n),this}toHiccup(){return[this.type,this.attribs,this.pos,this.size[0],this.size[1]]}}class bn{constructor(e=[0,0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}type="sphere";dim=3;copy(){return new bn(Nt([],this.pos),this.r,A(this.attribs))}withAttribs(e){return new bn(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class _n{constructor(e,n,s){this.pos=e,this.body=n,this.attribs=s}type="text";dim=2;copy(){return new _n(wt([],this.pos),this.body,A(this.attribs))}withAttribs(e){return new _n(this.pos,this.body,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.body]}}const[bu,_u,Lm,Bm]=Ge(Math.min),Xs=bu,Qo=_u,[vu,yu,Au,Tm]=Ge(Vo),le=vu,Kn=yu,wu=Au,[km,Eu,Pm,Gm]=hs(Vo),Ni=Eu,Ru=(t,e,n)=>new $e(t,wu([],e,t),n),Su=(t,e,n,s)=>Ru(t,e,s).offset(n),ta=(t,e=1)=>{const n=(o,a)=>{!o&&(o=a);for(let c=a.length;c-- >0;)o[c]=t(a[c]);return o},s=(o,a)=>(!o&&(o=a),o[0]=t(a[0]),o[1]=t(a[1]),o),r=(o,a)=>(!o&&(o=a),o[0]=t(a[0]),o[1]=t(a[1]),o[2]=t(a[2]),o),i=(o,a)=>(!o&&(o=a),o[0]=t(a[0]),o[1]=t(a[1]),o[2]=t(a[2]),o[3]=t(a[3]),o);return[G(e,n,s,r,i),s,r,i]},[Um,Iu,Fm,zm]=ta(Math.abs),Mu=Iu,K=(t,e,n,s)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t),B=(t,e,n,s,r)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t[3]=r,t),ea=(t,e)=>t[0]*e[1]-t[1]*e[0],na=(t,e)=>t[0]*e[0]+t[1]*e[1],Gr=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],Du=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],Nu=G(0,(t,e)=>{let n=0;for(let s=t.length;s-- >0;)n+=t[s]*e[s];return n},na,Gr,Du),sa=t=>t[0]*t[0]+t[1]*t[1],ra=t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2],$u=t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3],Ur=G(0,t=>{let e=0;for(let n=t.length;n-- >0;)e+=t[n]*t[n];return e},sa,ra,$u),Dn=t=>Math.sqrt(Ur(t)),$i=(t,e,n=!1)=>{const s=Math.atan2(ea(t,e),na(t,e));return n?jl(s):s},[Hm,Cu,qm,Vm]=Ge(bl),Ci=Cu,Ou=Math.abs,_t=(t,e,n=U)=>Ou(t-e)<=n,ia=(t,e,n=U)=>t.length===e.length&&_t(t[0],e[0],n)&&_t(t[1],e[1],n),Lu=(t,e,n=U)=>t.length===e.length&&_t(t[0],e[0],n)&&_t(t[1],e[1],n)&&_t(t[2],e[2],n),oa=(t,e,n=U)=>t.length===e.length&&_t(t[0],e[0],n)&&_t(t[1],e[1],n)&&_t(t[2],e[2],n)&&_t(t[3],e[3],n),Xe=G(0,(t,e,n=U)=>at(t,"eqDelta")?t.eqDelta(e,n):at(e,"eqDelta")?e.eqDelta(t,n):Bu(t,e,t.length,n),ia,Lu,oa),Bu=(t,e,n,s=U,r=0,i=0,o=1,a=1)=>{for(;n>0;n--,r+=o,i+=a)if(!_t(t[r],e[i],s))return!1;return!0},Tu=(t,e,n=U)=>{for(let s=e.length;s-- >0;)if(Xe(t,e[s],n))return!0;return!1},[ku,Ym,Wm,jm]=ta(t=>-t),Pu=ku,[Xm,Gu,xm,Zm]=hs(Math.pow),Uu=Gu,aa=(t,e=1)=>{const n=(o,a,c,l)=>{!o&&(o=a);for(let u=a.length;u-- >0;)o[u]=t(a[u],c[u],l);return o},s=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c[0],l),o[1]=t(a[1],c[1],l),o),r=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c[0],l),o[1]=t(a[1],c[1],l),o[2]=t(a[2],c[2],l),o),i=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c[0],l),o[1]=t(a[1],c[1],l),o[2]=t(a[2],c[2],l),o[3]=t(a[3],c[3],l),o);return[G(e,n,s,r,i),s,r,i]},[Jm,Fu,Km,Qm]=aa(_l),zu=Fu,Hu=(t,e,n,s=0,r=!1,i=!1)=>{const o=Mu([],n);if(ia(t,e)||o[0]<U||o[1]<U)return;s%=O;const a=zu([],t,e,.5),c=Math.cos(s),l=Math.sin(s),u=[c*a[0]+l*a[1],-l*a[0]+c*a[1]],[f,d]=Uu([],u,2),h=f/(o[0]*o[0])+d/(o[1]*o[1]);h>1&&we(o,o,Math.sqrt(h));const[g,p]=o,_=g*g,m=p*p,M=Math.max(0,(_*m-_*d-m*f)/(_*d+m*f)),D=(r!==i?1:-1)*Math.sqrt(M),N=[D*(g*u[1]/p),D*(-(p*u[0])/g)],kt=[c*N[0]-l*N[1]+(t[0]+e[0])/2,l*N[0]+c*N[1]+(t[1]+e[1])/2],Pt=Ci(null,Kn([],u,N),o),L=Ci(null,Kn(null,Pu([],u),N),o),Gt=$i(Ml,Pt);let ge=$i(Pt,L);return!i&&ge>0?ge-=O:i&&ge<0&&(ge+=O),ge%=O,{center:kt,r:o,axis:s,start:Gt,end:Gt+ge,xl:r,cw:i}},qu=(t,e)=>Math.abs(t-e),Vu=(t,e=U)=>t>e?1:t<-e?-1:0,ne=(t,e,n)=>t+(e-t)*n,ca=(t,e,n,s,r,i)=>{const o=1-r,a=1-i;return t*o*a+e*r*a+n*o*i+s*r*i},Yu=(t,e,n,s,r)=>{const i=r*r,o=1-r,a=o*o;return t*a*o+e*3*a*r+n*3*i*o+s*i*r},Wu=(t,e,n,s,r)=>{const i=r-1,o=r*r,a=i*i,c=(1+2*r)*a,l=r*a,u=o*(3-2*r),f=o*i;return c*t+l*e+u*n+f*s},He=(t,e,n,s,r)=>{s*=.5;const i=-.5*t+1.5*e-1.5*n+s,o=t-2.5*e+2*n-s,a=-.5*t+.5*n,c=e,l=r*r;return r*l*i+l*o+r*a+c},la=(t,e,n,s,r,i,o,a,c,l,u,f,d,h,g,p,_,m)=>He(He(t,e,n,s,_),He(r,i,o,a,_),He(c,l,u,f,_),He(d,h,g,p,_),m),Oi=(t,e,n=.5,s=0,r=2)=>n*((e-t)/(r-s)),ju=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1];return n*n+s*s},Xu=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2];return n*n+s*s+r*r},xu=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2],i=t[3]-e[3];return n*n+s*s+r*r+i*i},Nn=G(0,(t,e)=>{let n=0;for(let s=t.length;s-- >0;){const r=t[s]-e[s];n+=r*r}return n},ju,Xu,xu),Zu=(t,e)=>Math.sqrt(Nn(t,e)),[Ju,t3,e3,n3]=aa(Ho),Qn=Ju;function xs(...t){return new Ce(...Pl(t))}var pt=(t=>(t[t.FINE=0]="FINE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.SEVERE=4]="SEVERE",t[t.NONE=5]="NONE",t))(pt||{});let Ku=0;class Qu{constructor(e,n=pt.FINE,s){this.parent=s,this.id=e||`logger-${Ku++}`,this.level=typeof n=="string"?pt[n]:n}id;level;addChild(e){return e.parent=this,e}enabled(e){return this.level<=e}fine(...e){this.log(pt.FINE,e)}debug(...e){this.log(pt.DEBUG,e)}info(...e){this.log(pt.INFO,e)}warn(...e){this.log(pt.WARN,e)}severe(...e){this.log(pt.SEVERE,e)}none(){}log(e,n){this.level<=e&&this.logEntry([e,this.id,Date.now(),...n])}}const ua=Object.freeze({level:pt.NONE,addChild(t){return t},childLogger:()=>ua,enabled:()=>!1,fine(){},debug(){},info(){},warn(){},severe(){},none(){},logEntry(){}});class Fr extends Qu{set(e){this.parent=e}childLogger(e,n){return new Fr(e,n??this.level,this)}logEntry(e){this.parent.logEntry(e)}}const fa=new Fr("root",pt.FINE,ua),t0=fa.childLogger("defmulti"),X=Symbol();function Bt(t,e,n){const s={},r=e?e0(e):{},i=(...o)=>{const a=t(...o),c=s[a]||xe(s,r,a)||s[X];return c?c(...o):At(`missing implementation for: "${a.toString()}"`)};return i.add=(o,a)=>(s[o]&&t0.warn(`overwriting '${o.toString()}' impl`),s[o]=a,!0),i.addAll=o=>{let a=!0;for(let c in o)a=i.add(c,o[c])&&a;return X in o&&i.setDefault(o[X]),a},i.setDefault=o=>i.add(X,o),i.remove=o=>s[o]?(delete s[o],!0):!1,i.callable=(...o)=>{const a=t(...o);return!!(s[a]||xe(s,r,a)||s[X])},i.isa=(o,a)=>{let c=r[o];!c&&(r[o]=c=new Set),c.add(a)},i.impls=()=>{const o=new Map;for(let a in s)o.set(a,s[a]);for(let a in r){const c=xe(s,r,a);c&&o.set(a,c)}return s[X]&&o.set(X,s[X]),o},i.implForID=o=>s[String(o)]||xe(s,r,o)||s[X],i.rels=()=>r,i.parents=o=>r[o],i.ancestors=o=>new Set(da([],r,o)),i.dependencies=function*(){for(let o in r)for(let a of r[o])yield[o,a];for(let o in s)!r[o]&&(yield[o,void 0])},n&&i.addAll(n),i}const xe=(t,e,n)=>{const s=e[n];if(s)for(let r of s){let i=t[r]||xe(t,e,r);if(i)return i}},da=(t,e,n)=>{const s=e[n];if(s)for(let r of s)t.push(r),da(t,e,r);return t},e0=t=>{const e={};for(let n in t){const s=t[n];e[n]=s instanceof Set?s:Array.isArray(s)?new Set(s):new Set([s])}return e},fe=t=>t.type,n0=(t,e)=>(t[0]=e,t[1]=e,t),s0=(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t),r0=(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t[3]=e,t);G(0,(t,e)=>{for(let n=t.length;n-- >0;)t[n]=e;return t},n0,s0,r0);const i0=t=>Array(t).fill(0),o0=t=>at(t,"empty")?t.empty():i0(t.length),zr=(t,e,n)=>{const s=le([],n,e),r=Ur(s);return r>1e-6?Nu(le([],t,e),s)/r:void 0},ha=(t,e,n,s,r=!1,i=0)=>{const o=zr(t,e,n);if(o!==void 0&&(!r||o>=i&&o<=1-i))return s=s||o0(t),o<=0?wt(s,e):o>=1?wt(s,n):Qn(s,e,n,o)},a0=(t,e,n=!1,s=[])=>{if(!e.length)return;const r=[],i=e.length-1;let o=1/0,a,c;for(n?(a=i,c=0):(a=0,c=1);c<=i;a=c,c++)if(ha(t,e[a],e[c],r)){const l=Nn(t,r);l<o&&(o=l,wt(s,r))}return o<1/0?s:void 0},Hr=(t,e,n)=>(s,r,i=1)=>{!s&&(s=r);const o=Math.sqrt(t(r));return o>=U?e(s,r,i/o):s!==r?n(s,r):s},Le=Hr(Ur,ps,wt),c0=Hr(sa,we,z),l0=Hr(ra,js,Nt);class qr{points;index;constructor(e,n=!1){n?(this.points=e.slice(),this.points.push(e[0])):this.points=e,this.buildIndex()}totalLength(){const e=this.index;return e?e[e.length-1]:0}pointAt(e){const n=this.points,s=n.length-1;if(s<0)return;if(s===0||e<=0)return n[0];if(e>=1)return n[s];const r=this.index,i=e*r[s];for(let o=1;o<=s;o++)if(r[o]>=i)return Qn([],n[o-1],n[o],(i-r[o-1])/(r[o]-r[o-1]))}closestPoint(e){return a0(e,this.points)}closestT(e){const{index:n,points:s}=this,r=[],i=[];let o=1/0,a=-1;for(let c=0,l=n.length-1;c<l;c++)if(ha(e,s[c],s[c+1],r)){const u=Nn(e,r);u<o&&(o=u,a=c,wt(i,r))}return a>=0?Xl(zr(e,s[a],s[a+1])||0,n[a],n[a+1])/this.totalLength():void 0}segmentAt(e){let n=this.indexAt(e);if(n!==void 0)return n=Math.max(1,n),[this.points[n-1],this.points[n]]}tangentAt(e,n=1){const s=this.segmentAt(e);return s?Le(null,le([],s[1],s[0]),n):void 0}splitAt(e){if(e<=0||e>=1)return[this.points];const n=this.pointAt(e);if(!n)return;const s=Math.max(1,this.indexAt(e)),r=this.points.slice(0,s),i=this.points.slice(s);return Xe(r[s-1],n)||r.push(n),Xe(i[0],n)||i.unshift(n),[r,i]}splitNear(e){const n=this.closestT(e);return n!==void 0?this.splitAt(n):void 0}extractRange(e,n){if(e>n){const c=e;e=n,n=c}const s=this.pointAt(e),r=this.pointAt(n);if(!(s&&r))return;const i=Math.max(1,this.indexAt(e)),o=Math.max(1,this.indexAt(n)),a=this.points.slice(i,o);return(!a.length||!Xe(a[0],s))&&a.unshift(s),Xe(a[a.length-1],r)||a.push(r),a}indexAt(e){const s=this.points.length-1;if(s<0)return;if(s===0||e<=0)return 0;if(e>=1)return s;const r=this.index,i=e*r[s];for(let o=1;o<=s;o++)if(r[o]>=i)return o}sampleUniform(e,n=!1,s=[]){const{index:r,points:i}=this,o=this.totalLength(),a=e/o,c=r.length;for(let l=0,u=1;l<1;l+=a){const f=l*o;for(;f>=r[u]&&u<c;)u++;if(u>=c)break;const d=r[u-1];s.push(Qn([],i[u-1],i[u],(f-d)/(r[u]-d)))}return n&&s.push(wt([],i[i.length-1])),s}sampleFixedNum(e,n=!1,s){return this.sampleUniform(this.totalLength()/e,n,s)}buildIndex(){const e=[0],n=this.points,s=n.length;for(let r=0,i=1;i<s;r=i,i++)e[i]=e[r]+Zu(n[r],n[i]);this.index=e}}const Li=Math.cos,Bi=Math.sin,ga=G(1),u0=ga.add(2,(t,e,n=gt)=>Q(t||e,Br(e[1],e[0]),n));ga.add(3,(t,e,n=mt)=>{const s=e[0],r=e[1],i=e[2],o=Li(r);return K(t||e,s*o*Li(i)+n[0],s*o*Bi(i)+n[1],s*Bi(r)+n[2])});const ma=(t,e,n,s,r,i)=>{if(Lt(i)&&i.dist!==void 0)return new qr(ma(t,e,n,s,r,i.num||yt)).sampleUniform(i.dist,i.last!==!1);i=v(i)?{num:i,last:!0}:{num:yt,...i};let o=r-s,a=i.theta?Math.round(o/i.theta):i.num;o/=a,i.last!==!1&&a++;const c=new Array(a);for(let l=0;l<a;l++)c[l]=xo(t,e,n,s+l*o);return c},Ti=(t,e,n=!1,s=!1)=>{if(f0(e)){const r=new qr(t,n);return Lt(e)?n?e.dist?r.sampleUniform(e.dist,e.last):r.sampleFixedNum(e.num||yt,e.last):e.dist?r.sampleUniform(e.dist,e.last!==!1):r.sampleFixedNum(e.num||yt,e.last!==!1):r.sampleFixedNum(e||yt,!n)}return s?Or(t):t},f0=t=>t!==void 0&&(v(t)||t.dist!=null||t.last!=null||t.num!=null),pa=t=>function e(n,s){if(Lt(s)&&s.dist!==void 0)return new qr(e(n,s.num||yt)).sampleUniform(s.dist,s.last!==!1);s=v(s)?{num:s,last:!0}:{num:yt,...s};const r=[];return t(r,n,s.num),s.last&&r.push(wt([],n[n.length-1])),r},d0=pa((t,[e,n,s,r],i)=>{const o=1/i;for(let a=0;a<i;a++)t.push(iu([],e,n,s,r,a*o))}),h0=(t,e,n,s,r)=>{const i=1-r;return su(t,e,n,s,i*i,2*i*r,r*r)},g0=pa((t,[e,n,s],r)=>{const i=1/r;for(let o=0;o<r;o++)t.push(h0([],e,n,s,o*i))}),Vr=(t,e=1,n=!0)=>{const s=n?(a,c,l,u)=>{!a&&(a=c);for(let f=c.length;f-- >0;)a[f]=t(c[f],l[f],u[f]);return a}:(a,c,l,u)=>{!a&&(a=u);for(let f=c.length;f-- >0;)a[f]=t(c[f],l[f],u[f]);return a},r=n?(a,c,l,u)=>(!a&&(a=c),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a):(a,c,l,u)=>(!a&&(a=u),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a),i=n?(a,c,l,u)=>(!a&&(a=c),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a):(a,c,l,u)=>(!a&&(a=u),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a),o=n?(a,c,l,u)=>(!a&&(a=c),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a[3]=t(c[3],l[3],u[3]),a):(a,c,l,u)=>(!a&&(a=u),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a[3]=t(c[3],l[3],u[3]),a);return[G(e,s,r,i,o),r,i,o]},[s3,m0,r3,i3]=Vr(zo),p0=m0,bt=Bt(fe,{bpatch:"points",cubic3:"cubic",group3:"group",line:"polyline",line3:"polyline",path3:"path",points3:"points",poly3:"poly",polyline3:"polyline",quad:"poly",quad3:"poly",quadratic3:"quadratic",tri:"poly",tri3:"poly"},{aabb:({pos:t,size:e})=>{const[n,s,r]=t,[i,o,a]=ye([],t,e);return[[n,s,r],[n,s,a],[i,s,a],[i,s,r],[n,o,r],[n,o,a],[i,o,a],[i,o,r]]},arc:(t,e)=>ma(t.pos,t.r,t.axis,t.start,t.end,ft(e,t.attribs)),circle:(t,e=yt)=>{e=ft(e,t.attribs);const n=t.pos,s=t.r;let[r,i,o]=Ii(e,s);const a=O/r;o&&r++;const c=new Array(r);for(let l=0;l<r;l++)c[l]=u0(null,[s,i+l*a],n);return c},complexpoly:(t,e)=>{const n=bt(t.boundary,e);for(let s of t.children)n.push(...bt(s,e));return n},cubic:(t,e)=>d0(t.points,ft(e,t.attribs)),ellipse:(t,e=yt)=>{e=ft(e,t.attribs);const n=[],s=t.pos,r=t.r;let[i,o,a]=Ii(e,Math.max(t.r[0],t.r[1]));const c=O/i;a&&i++;for(let l=0;l<i;l++)n[l]=p0([],Br(o+l*c),r,s);return n},extra:()=>[],group:(t,e)=>(e=ft(e,t.attribs),t.children.reduce((n,s)=>n.concat(bt(s,e)),[])),path:(t,e)=>{e=ft(e,t.attribs);const n=v(e)?{num:e}:e,s=[],r=i=>{const o=Zo(i)?.type==="z";for(let a=i.length-1,c=0;c<=a;c++){const l=i[c];l.geo&&s.push(...bt(l.geo,{...n,last:!o&&c===a}))}};r(t.segments);for(let i of t.subPaths)r(i);return s},points:t=>t.points.slice(),poly:(t,e)=>Ti(t.points,ft(e,t.attribs),!0,!0),polyline:(t,e)=>Ti(t.points,ft(e,t.attribs),!1,!0),quadratic:(t,e)=>g0(t.points,ft(e,t.attribs)),rect:(t,e)=>{e=ft(e,t.attribs);const n=t.pos,s=Q([],n,t.size),r=[z([],n),[s[0],n[1]],s,[n[0],s[1]]];return e!=null?bt(new Vt(r),e):r}}),ba=Bt(fe,{circle:"points",complexpoly:"group",ellipse:"points",line:"points",line3:"points3",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",rect:"points",tri:"points",tri3:"points3"},{aabb:t=>{const[e,n,s,r,i,o,a,c]=bt(t);return[[o,a,c,i],[r,e,n,s],[s,r,c,a],[e,n,o,i],[n,s,a,o],[r,e,i,c]].map(l=>new ae(Or(l),je(t)))},arc:(t,e)=>{const n=[Cr(t.pos),...bt(t,e)];return[new Vt(n,je(t))]},group:(t,e)=>[...Jn(n=>ba(n,e),t)],path:(t,e)=>ki(Vt,t,e),path3:(t,e)=>ki(ae,t,e),points:(t,e)=>[new Vt(bt(t,e),je(t))],points3:(t,e)=>[new ae(bt(t,e),je(t))]}),ki=(t,e,n)=>{const s=e.empty();return s.attribs=e.attribs,[e.segments,...e.subPaths].map(r=>(s.segments=r,new t(bt(s,n),je(e))))},ts=(t,e)=>t-e*Math.floor(t/e),P=t=>t-Math.floor(t),Pi=(t,e=1)=>Math.round(t/e)*e,de=(t={},e)=>new en(t,e);function b0(...t){return ou(nn,t)}const rn=(t,e,n)=>{const s=t[0],r=t[1];return(e[0]-s)*(n[1]-r)-(n[0]-s)*(e[1]-r)},_0=(t,e,n,s=U)=>Vu(rn(t,e,n),s),v0=(t,e,n,s=U)=>_0(t,e,n,s)<0,Gi=(t,e)=>e!==0?t/e:0,y0=(t,e,n,s=!0,r=!0)=>{const i=n>0?s?function(){return this.buf[this.offset+n*this.stride]}:function(){return this.buf[this.offset+n]}:function(){return this.buf[this.offset]},o=n>0?s?function(a){this.buf[this.offset+n*this.stride]=a}:function(a){this.buf[this.offset+n]=a}:function(a){this.buf[this.offset]=a};r&&Object.defineProperty(t,n,{get:i,set:o,enumerable:!0}),Object.defineProperty(t,e,{get:i,set:o,enumerable:!0})},A0=(t,e,n,s)=>e.forEach((r,i)=>y0(t,r,i,n,s)),Be=t=>typeof t=="function";function _a(t,e=Object.create(null)){return(...n)=>{const s=JSON.stringify(n);return s!==void 0?s in e?e[s]:e[s]=t.apply(null,n):t.apply(null,n)}}function va(t,e=Object.create(null)){return(...n)=>{const s=n.join("-");return s in e?e[s]:e[s]=t(...n)}}const w0=va((t,e)=>t.repeat(e)),ya=_a((t,e=!1)=>e?n=>E0(n)||n.toFixed(t):n=>n.toFixed(t)),E0=t=>isNaN(t)?"NaN":t===1/0?"+∞":t===-1/0?"-∞":void 0,R0={5120:"i8",5121:"u8",5122:"i16",5123:"u16",5124:"i32",5125:"u32",5126:"f32"},S0={i8:5120,u8:5121,u8c:5121,i16:5122,u16:5123,i32:5124,u32:5125,f32:5126,f64:void 0},I0={i8:0,u8:0,u8c:0,i16:1,u16:1,i32:2,u32:2,i64:3,u64:3,f32:2,f64:3},M0={f32:Float32Array,f64:Float64Array},D0={i8:Int8Array,i16:Int16Array,i32:Int32Array},N0={u8:Uint8Array,u8c:Uint8ClampedArray,u16:Uint16Array,u32:Uint32Array},$0={i64:BigInt64Array,u64:BigUint64Array},Zs={...M0,...D0,...N0},C0=t=>{const e=R0[t];return e!==void 0?e:t},Aa=t=>{const e=S0[t];return e!==void 0?e:t};function Yn(t,...e){const n=$0[t];return new(n||Zs[C0(t)])(...e)}const O0=t=>{if(Array.isArray(t))return"f64";for(let e in Zs)if(t instanceof Zs[e])return e;return"f64"},L0=t=>t>16?"u32":t>8?"u16":"u8",B0=(t,e,n,s,r,i)=>{const o=[];for(;n-- >0;)o.push(new t(e,s,r)),s+=i;return o},[o3,a3,c3,T0]=Vr(ut),k0=T0,Is=(t,e,n=0,s=0,r=1,i=1)=>t[n]*e[s]+t[n+r]*e[s+i]+t[n+2*r]*e[s+2*i],R=(t,e,n=0,s=0,r=1,i=1)=>t[n]*e[s]+t[n+r]*e[s+i]+t[n+2*r]*e[s+2*i]+t[n+3*r]*e[s+3*i],es=(t,e,n,s,r,i)=>(!t&&(t=e),t[0]=et(e[0],n[0],s[0],r[0],i[0]),t[1]=et(e[1],n[1],s[1],r[1],i[1]),t),P0=(t,e,n,s,r,i)=>(!t&&(t=e),t[0]=et(e[0],n[0],s[0],r[0],i[0]),t[1]=et(e[1],n[1],s[1],r[1],i[1]),t[2]=et(e[2],n[2],s[2],r[2],i[2]),t),G0=(t,e,n,s,r,i)=>(!t&&(t=e),t[0]=et(e[0],n[0],s[0],r[0],i[0]),t[1]=et(e[1],n[1],s[1],r[1],i[1]),t[2]=et(e[2],n[2],s[2],r[2],i[2]),t[3]=et(e[3],n[3],s[3],r[3],i[3]),t);G(1,(t,e,n,s,r,i)=>{!t&&(t=e);for(let o=e.length;o-- >0;)t[o]=et(e[o],n[o],s[o],r[o],i[o]);return t},es,P0,G0);function*U0(t,e,n,s){for(;e-- >0;)yield t[n],n+=s}const Ui=(t,e)=>(t>>>e|t<<32-e)>>>0,[F0,l3,u3,f3]=Vr(Ho),z0=F0,wa=G(1,(t,e,n,s=ue)=>{!t&&(t=e);for(let r=e.length;r-- >0;)t[r]=s.minmax(e[r],n[r]);return t});function*Ea(t,e=!0,n=!1){if(t>0)for(let s=0,r=e?t+1:t;s<r;s++)yield n?1-s/t:s/t}function $t(...t){return H0($t,gn,t)}const H0=(t,e,n)=>{let s,r;switch(n.length){case 4:r=n[3],s=n[2];break;case 3:r=n[2];break;case 2:return H(i=>t(n[0],n[1],i));default:Pr(n.length)}return e(bs(n[0])(n[1]),s,r)};function*Js(...t){const e=t.map(n=>n[Symbol.iterator]());for(;;){const n=[];for(let s of e){let r=s.next();if(r.done)return;n.push(r.value)}yield n}}function vn(...t){return new V(...kl(t))}const q0=(t,e,n)=>new V(t,Kn([],e,t),n),me=(t,e,n,s)=>q0(t,e,s).offset(n),Ze=(t,e,n)=>(e=J(e),new V(Xn([],e,-.5,t),e,n)),Ra=(t,e)=>n=>n.map(s=>s.geo?{type:s.type,geo:t(s.geo)}:s.point?{type:s.type,point:e(s.point)}:{...s}),Ks=Bt(fe,{bpatch:"points",complexpoly:"group",cubic:"points",cubic3:"points3",group3:"group",line:"points",line3:"points3",path3:"path",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",quadratic:"points",quadratic3:"points3",tri:"points",tri3:"points3"},{aabb:(t,e)=>(e=J(e,3),new $e(ze([],t.pos,e),ze([],t.size,e),A(t.attribs))),arc:(t,e)=>{e=J(e);const n=t.copy();return j(null,n.pos,e),j(null,n.r,e),n},circle:(t,e)=>v(e)?new Ce(we([],t.pos,e),t.r*e,A(t.attribs)):new Oe(j([],t.pos,e),we([],e,t.r),A(t.attribs)),ellipse:(t,e)=>(e=J(e),new Oe(j([],t.pos,e),j([],t.r,e),A(t.attribs))),extra:t=>t,group:(t,e)=>t.copyTransformed(n=>Ks(n,e)),path:(t,e)=>(e=J(e),t.copyTransformed(Ra(n=>Ks(n,e),n=>Kl([],n,e)))),points:(t,e)=>t.copyTransformed(n=>n.map(v(e)?s=>we([],s,e):s=>j([],s,e))),points3:(t,e)=>t.copyTransformed(n=>n.map(v(e)?s=>js([],s,e):s=>ze([],s,e))),ray:(t,e)=>(e=J(e),new mn(j([],t.pos,e),c0(null,j([],t.dir,e)),A(t.attribs))),ray3:(t,e)=>(e=J(e),new pn(ze([],t.pos,e),l0(null,ze([],t.dir,e)),A(t.attribs))),rect:(t,e)=>(e=J(e),new V(j([],t.pos,e),j([],t.size,e),A(t.attribs))),sphere:(t,e)=>v(e)?new bn(js([],t.pos,e),t.r*e,A(t.attribs)):At("can't non-uniformly scale sphere"),text:(t,e)=>new _n(j([],t.pos,J(e)),t.body,A(t.attribs))}),Qs=Bt(fe,{bpatch:"points",cubic:"points",cubic3:"points3",complexpoly:"group",group3:"group",line:"points",line3:"points3",path3:"path",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",quadratic:"points",quadratic3:"points3",tri:"points",tri3:"points3"},{aabb:(t,e)=>new $e(ye([],t.pos,e),Nt([],t.size),A(t.attribs)),arc:(t,e)=>{const n=t.copy();return Q(null,n.pos,e),n},circle:(t,e)=>new Ce(Q([],t.pos,e),t.r,A(t.attribs)),ellipse:(t,e)=>new Oe(Q([],t.pos,e),z([],t.r),A(t.attribs)),extra:t=>t,group:(t,e)=>t.copyTransformed(n=>Qs(n,e)),path:(t,e)=>t.copyTransformed(Ra(n=>Qs(n,e),n=>Ct([],n,e))),points:(t,e)=>t.copyTransformed(n=>n.map(s=>Q([],s,e))),points3:(t,e)=>t.copyTransformed(n=>n.map(s=>ye([],s,e))),ray:(t,e)=>new mn(Q([],t.pos,e),t.dir,A(t.attribs)),ray3:(t,e)=>new pn(ye([],t.pos,e),t.dir,A(t.attribs)),rect:(t,e)=>new V(Q([],t.pos,e),z([],t.size),A(t.attribs)),sphere:(t,e)=>new bn(ye([],t.pos,e),t.r,A(t.attribs)),text:(t,e)=>new _n(Q([],t.pos,e),t.body,A(t.attribs))}),V0=t=>{const e=t.length-1;if(e<2)return 0;let n=0,s=t[e],r=t[0];for(let i=0;i<=e;s=r,r=t[++i])n+=ea(s,r);return n/2},se=Bt(fe,{group3:"group",quad:"poly"},{[X]:()=>0,aabb:({size:[t,e,n]})=>2*(t*e+t*n+e*n),arc:t=>.5*Math.abs(t.start-t.end)*t.r[0]*t.r[1],circle:t=>st*t.r**2,complexpoly:(t,e)=>se(t.boundary,e)-t.children.reduce((n,s)=>n+se(s,e),0),ellipse:t=>st*t.r[0]*t.r[1],group:({children:t})=>t.reduce((e,n)=>e+se(n,!1),0),path:(t,e)=>t.closed?ba(t).reduce((n,s)=>n+se(s,e),0):0,plane:()=>1/0,poly:(t,e)=>{const n=V0(t.points);return e?n:Math.abs(n)},rect:t=>t.size[0]*t.size[1],sphere:t=>4*st*t.r**2,tri:(t,e)=>{const n=.5*rn(...t.points);return e?n:Math.abs(n)}}),k=t=>typeof t=="string",on={},Fi=(t,e)=>{for(let n in e){const s=e[n];if(S(s)){const[r,i,o,a]=s;e[n]=s.length===2?(c,l)=>i(c,r(c,l)):s.length===3?(c,l)=>o(c,i(c,r(c,l))):(c,l)=>a(c,o(c,i(c,r(c,l))))}}on[t]={...on[t],...e}},Sa=(t,e,n,s)=>{const r=on[n];I(!!r,`no conversions available for ${n}`);let i=r[s];return i?i(t,e):on.rgb[s]?r.rgb(t,on.rgb[s]([],e)):At(`can't convert: ${s} -> ${n}`)},Y0=(t=0)=>e=>(e*100).toFixed(t)+"%",W0=[.299,.587,.114],Ia=[.2126,.7152,.0722],j0=[3.1338561,-.9787684,.0719453,-1.6168667,1.9161415,-.2289914,-.4906146,.033454,1.4052427],X0=[3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252],x0=[.96422,1,.82521],Z0=[.95047,1,1.08883];let ns=ya(3),zi=Y0(3);const nt=1/255,Y=(t,e=1)=>t!=null?y(t):e,J0=t=>{if(typeof t[0]=="number")switch(t.length){case 1:return t.push(0,0,1),[t];case 2:return t.push(0,1),[t];case 3:return t.push(1),[t];default:return[t]}return t},Ma=t=>{const e=ns(P(t[0])*360),n=zi(y(t[1])),s=zi(y(t[2])),r=Y(t[3]);return r<1?`hsla(${e},${n},${s},${ns(r)})`:`hsl(${e},${n},${s})`},Hi=(t,e,n=1)=>B(t||e,y(e[0]),y(e[1]),y(e[2]),Y(e[3],n)),Yr=(t,e,n=1)=>B(t||e,P(e[0]),y(e[1]),y(e[2]),Y(e[3],n)),K0=(t,e)=>{t=Yr(t||e,e);const n=t[1],s=t[2],r=(2-n)*s/2;return t[2]=r,t[1]=r&&r<1?n*s/(r<.5?r*2:2-r*2):n,t},Q0=t=>Ma(K0([],t)),qi="0123456789abcdef",tr=t=>qi[t>>>4&15]+qi[t&15],tf=t=>tr(t>>>8)+tr(t&255),ef=t=>tr(t>>>16)+tf(t),Wr=va((t,e,n="")=>{const s=w0("0",e);return r=>(r=(r>>>0).toString(t),n+(r.length<e?s.substring(r.length)+r:r))});Wr(2,8);Wr(2,16);Wr(2,32);const Da=ef,er=t=>{const e=t>>>24;return e<255?`rgba(${t>>16&255},${t>>8&255},${t&255},${ns(e*nt)})`:`#${Da(t&16777215)}`},nf=t=>(t&255)<<16|t>>16&255|t&4278255360,sf=nf,Na=(t,e,n,s=!1)=>{const r=Is(e,n,0,0,3),i=Is(e,n,1,0,3),o=Is(e,n,2,0,3),a=Y(n[3]);return s?B(t||n,y(r),y(i),y(o),a):B(t||n,r,i,o,a)},rf=(t,e,n,s=!0)=>{t=B(t||n,n[0],n[1],n[2],Y(n[3]));const r=R(t,e,0,0)+e[4],i=R(t,e,0,5)+e[9],o=R(t,e,0,10)+e[14],a=R(t,e,0,15)+e[19];return s?B(t,y(r),y(i),y(o),y(a)):B(t,r,i,o,a)},of=(t,e)=>[R(e,t,0,0,1,5),R(e,t,0,1,1,5),R(e,t,0,2,1,5),R(e,t,0,3,1,5),R(e,t,0,4,1,5)+e[4],R(e,t,5,0,1,5),R(e,t,5,1,1,5),R(e,t,5,2,1,5),R(e,t,5,3,1,5),R(e,t,5,4,1,5)+e[9],R(e,t,10,0,1,5),R(e,t,10,1,1,5),R(e,t,10,2,1,5),R(e,t,10,3,1,5),R(e,t,10,4,1,5)+e[14],R(e,t,15,0,1,5),R(e,t,15,1,1,5),R(e,t,15,2,1,5),R(e,t,15,3,1,5),R(e,t,15,4,1,5)+e[19]],Ms=t=>{const e=t**3;return e>.008856?e:(t-16/116)/7.787},$a=(t,e,n=x0)=>{const s=(e[0]+.16)/1.16;return B(t||e,Ms(e[1]/5+s)*n[0],Ms(s)*n[1],Ms(s-e[2]/2)*n[2],Y(e[3]))},af=(t,e)=>$a(t,e,Z0),Ca=(t,e)=>{let{1:n,2:s}=e;s*=O;const r=Y(e[3]);return n>0?B(t||e,e[0],Math.cos(s)*n,Math.sin(s)*n,r):B(t||e,e[0],0,0,r)},jr=(t,e,n=j0)=>Na(t,n,e),nr=(t,e)=>jr(t,e,X0),ss=(t,e)=>jr(null,$a(t,e)),Oa=(t,e)=>nr(null,af(t,e)),Ds=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Ns=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4),an=(t,e)=>B(t||e,Ds(e[0]),Ds(e[1]),Ds(e[2]),Y(e[3])),$s=(t,e=0)=>(t<0?0:t>1?1:t)*255+.5<<e,Ae=t=>{const e=$s(t[0]),n=$s(t[1]),s=$s(t[2]),r=Y(t[3]);return r<1?`rgba(${e},${n},${s},${ns(r)})`:`#${Da(e<<16|n<<8|s)}`},cf=t=>Ae(an([],t)),La={abgr32:t=>er(sf(t[0])),argb32:t=>er(t[0]),hsl:Ma,hsv:Q0,lab50:t=>Ae(an(null,ss([],t))),lab65:t=>Ae(an(null,Oa([],t))),lch:t=>Ae(an(null,ss(null,Ca([],t)))),rgb:cf,srgb:Ae};({...La});let lf=La;const sr=(t,e=lf)=>{let n;return k(t)?t:v(t)?er(t):t.mode?(n=e[t.mode])?n(t):e.rgb(Sa([],t,"rgb",t.mode)):Ae(t)},uf=t=>t!=null&&typeof t.deref=="function",ff=t=>uf(t)?t.deref():t,df=t=>t!=null&&typeof t!="string"&&typeof t[Symbol.iterator]=="function",hf=(t,e,n,s,r)=>{const i=z([],Il),o=z([],Sl),a=[],c=l=>{xo(t,e,n,l,a),Qo(null,i,a),xn(null,o,a)};if(c(s),c(r),s>r){const l=s;s=r,r=l}for(let l=Pi(s,Vn),u=Pi(r,Vn);l<u;l+=Vn)jo(l,s,r)&&c(l);return[i,o]},Vi=(t,e=0,n=t.length)=>{let s=1/0,r=1/0,i=-1/0,o=-1/0;for(let a=e;a<n;a++){const[c,l]=t[a];c<s&&(s=c),c>i&&(i=c),l<r&&(r=l),l>o&&(o=l)}return[[s,r],[i,o]]},gf=(t,e=0,n=t.length)=>{let s=1/0,r=1/0,i=1/0,o=-1/0,a=-1/0,c=-1/0;for(let l=e;l<n;l++){const[u,f,d]=t[l];u<s&&(s=u),u>o&&(o=u),f<r&&(r=f),f>a&&(a=f),d<i&&(i=d),d>c&&(c=d)}return[[s,r,i],[o,a,c]]},mf=(t,e,n,s,r,i,o)=>{t[n]=Math.min(s,o),e[n]=Math.max(s,o);const a=-s+r,c=s-2*r+i,l=-s+3*r-3*i+o;let u=c*c-a*l;if(u>0){u=Math.sqrt(u);const f=d=>{if(d>0&&d<1){const h=Yu(s,r,i,o,d);t[n]=Math.min(t[n],h),e[n]=Math.max(e[n],h)}};f(a/(-c-u)),f(a/(-c+u))}},Yi=(t,e,n,s)=>{const r=[],i=[];for(let o=t.length;o-- >0;)mf(r,i,o,t[o],e[o],n[o],s[o]);return[r,i]},pf=(t,e,n)=>{const s=y((t-e)/(t-2*e+n)),r=1-s;return r*r*t+2*r*s*e+s*s*n},bf=(t,e,n)=>{for(let s=t.length;s-- >0;)if(!jo(t[s],e[s],n[s]))return!1;return!0},_f=(t,e,n)=>{const s=Xs([],t,n),r=Ws([],t,n);if(!bf(e,s,r)){const i=[];for(let o=t.length;o-- >0;)i[o]=pf(t[o],e[o],n[o]);Xs(null,s,i),Ws(null,r,i)}return[s,r]};function Yt(t,e){return Ue(e)?vs(Yt(t),e):n=>{const s=n[2];return In(n,(r,i)=>t(i)?s(r,i):r)}}const Cs=(t,e)=>{let n=t.length-1;if(n<0)return;let s=e(t[n]);if(!s)return;let{pos:r,size:i}=s;for(;n-- >0;)s=e(t[n]),s&&([r,i]=vf(r,i,s.pos,s.size));return[r,i]},vf=(t,e,n,s)=>{const r=Ct([],t,e),i=Ct([],n,s),o=Xs([],t,n);return[o,le(null,Ws(null,r,i),o)]},Wn=Bt(fe,{aabb:"rect",bpatch:"points",poly:"points",polyline:"points",quad:"points",tri:"points"},{arc:(t,e=0)=>me(...hf(t.pos,t.r,t.axis,t.start,t.end),e),bpatch:({points:t},e=0)=>me(...Vi([...Jn(n=>Yi(...n),[[t[0],t[1],t[2],t[3]],[t[3],t[7],t[11],t[15]],[t[12],t[13],t[14],t[15]],[t[0],t[4],t[8],t[12]]])]),e),circle:(t,e=0)=>new V(Ni([],t.pos,t.r+e),we(null,[2,2],t.r+e)),complexpoly:(t,e=0)=>{const n=Cs([t.boundary,...t.children],Wn);return n?new V(...n).offset(e):void 0},cubic:({points:t},e=0)=>me(...Yi(t[0],t[1],t[2],t[3]),e),ellipse:(t,e=0)=>{const n=Yo([],t.r,e);return new V(Kn([],t.pos,n),j(null,[2,2],n))},extra:()=>{},group:(t,e=0)=>{const n=Cs(t.children,Wn);return n?new V(...n).offset(e):void 0},line:({points:[t,e]},n=0)=>me(Qo([],t,e),xn([],t,e),n),path:(t,e=0)=>{const n=r=>vs(Mn(H(i=>i.geo),Yt(i=>!!i)),r),s=Cs([...n(t.segments),...Jn(n,t.subPaths)],Wn);return s?new V(...s).offset(e):void 0},points:(t,e=0)=>me(...Vi(t.points),e),points3:(t,e=0)=>Su(...gf(t.points),e),quadratic:({points:t},e=0)=>me(..._f(t[0],t[1],t[2]),e),rect:(t,e=0)=>e===0?t.copy():t.copy().offset(e),text:(t,e=0)=>new V(Ni([],t.pos,e),e*2)}),Ba=(t,e,n,s=U)=>{const r=zr(t,e,n);return r!==void 0?Nn(t,Qn([],e,n,y(r)))<s*s:!1},yf=(t,e,n,s=U)=>{const r=e.length;let[i,o]=[0,1];for(;o<r;i=o,o++)if(Ba(t,e[i],e[o],s))return!0;return!1},Af=(t,e,n)=>Nn(e,t)<=n*n,wf=(t,e,n,s)=>{const r=v0(e,n,s)?1:-1;return r*rn(e,s,t)>=0&&r*rn(n,e,t)>=0&&r*rn(s,n,t)>=0},Os=(t,e)=>{const n=e.length-1,s=t[0],r=t[1];let i=e[n],o=e[0],a=0;for(let c=0;c<=n;i=o,o=e[++c])a=Ef(s,r,i[0],i[1],o[0],o[1],a);return a},Ef=(t,e,n,s,r,i,o)=>(s<e&&i>=e||i<e&&s>=e)&&(n<=t||r<=t)?o^~~(n+(e-s)/(i-s)*(r-n)<t):o,Xr=G(0),Rf=Xr.add(2,([t,e],n,s)=>t>=n[0]&&t<=n[0]+s[0]&&e>=n[1]&&e<=n[1]+s[1]),Sf=Xr.add(3,([t,e,n],s,r)=>t>=s[0]&&t<=s[0]+r[0]&&e>=s[1]&&e<=s[1]+r[1]&&n>=s[2]&&n<=s[2]+r[2]);Xr.default((t,e,n)=>{for(let s=t.length;s-- >0;){const r=t[s],i=e[s];if(r<i||r>i+n[s])return!1}return!0});const xr=G(0);xr.add(2,([t,e],n,s)=>t>=n[0]-s[0]&&t<=n[0]+s[0]&&e>=n[1]-s[1]&&e<=n[1]+s[1]);xr.add(3,([t,e,n],s,r)=>t>=s[0]-r[0]&&t<=s[0]+r[0]&&e>=s[1]-r[1]&&e<=s[1]+r[1]&&n>=s[2]-r[2]&&n<=s[2]+r[2]);xr.default((t,e,n)=>{for(let s=t.length;s-- >0;){const r=t[s],i=e[s],o=n[s];if(r<i-o||r>i+o)return!1}return!0});const jt=Bt(fe,{group3:"group",points3:"points",quad:"poly",sphere:"circle"},{[X]:()=>!1,aabb:(t,e)=>Sf(e,t.pos,t.size),circle:(t,e)=>Af(e,t.pos,t.r),complexpoly:(t,e)=>Os(e,t.boundary.points)?!t.children.some(n=>Os(e,n.points)):!1,group:(t,e)=>t.children.some(n=>jt(n,e)),line:(t,e)=>Ba(e,t.points[0],t.points[1]),points:({points:t},e)=>Tu(e,t),poly:(t,e)=>Os(e,t.points)>0,polyline:(t,e)=>yf(e,t.points),rect:(t,e)=>Rf(e,t.pos,t.size),tri:(t,e)=>wf(e,...t.points)}),Wi=(t,e,n=ue,s=[])=>{const r=Wn(t);if(!r)return;const i=r.pos,o=r.max();for(;e-- >0;)for(;;){const a=wa([],i,o,n);if(jt(t,a)){s.push(a);break}}return s};function Ta(...t){return pu(Ta,t)||(e=>{const n=e[2],s=t[0];let r=t[1]||0;return In(e,(i,o)=>n(i,s(r++,o)))})}function ka(t,e,n){return new If(t,e,n)}class If{from;to;step;constructor(e,n,s){e===void 0?(e=0,n=1/0):n===void 0&&(n=e,e=0),s=s===void 0?e<n?1:-1:s,this.from=e,this.to=n,this.step=s}*[Symbol.iterator](){let{from:e,to:n,step:s}=this;if(s>0)for(;e<n;)yield e,e+=s;else if(s<0)for(;e>n;)yield e,e+=s}$reduce(e,n){const s=this.step;if(s>0)for(let r=this.from,i=this.to;r<i&&!Ot(n);r+=s)n=e(n,r);else for(let r=this.from,i=this.to;r>i&&!Ot(n);r+=s)n=e(n,r);return n}}const Zr=(t,e)=>t===e?0:t==null?e==null?0:-1:e==null?t==null?0:1:typeof t.compare=="function"?t.compare(e):typeof e.compare=="function"?-e.compare(t):t<e?-1:t>e?1:0,Mf=t=>typeof t=="string",Df=(t,e,n)=>{const s={expire:1e4,utf8:!1,...n};Mf(e)&&s.utf8&&(e=new TextEncoder().encode(e),s.mime+=";charset=UTF-8");const r=URL.createObjectURL(e instanceof Blob?e:new Blob([e],{type:s.mime})),i=document.createElement("a");i.setAttribute("download",t),i.setAttribute("href",r),document.body.appendChild(i),i.click(),document.body.removeChild(i),s.expire>0&&setTimeout(()=>URL.revokeObjectURL(r),s.expire)},Nf=(t,e,n="png",s=.95)=>{const r=`image/${n}`;t.toBlob(i=>i?Df(`${e}.${n}`,i,{mime:r}):console.warn("can't download canvas"),r,s)},$f=[0,31,59,90,120,151,181,212,243,273,304,334],Cf=1e3,Of=60*Cf,Lf=(t,e)=>typeof t?.[e]=="function",Bf=t=>typeof t=="number",Pa=t=>typeof t=="string",Tf=t=>Pa(t)||Bf(t)?new Date(t):Lf(t,"toDate")?t.toDate():t,Ga=t=>!(t%4)&&(!!(t%100)||!(t%400));function Ua(t,e=Object.create(null)){return(...n)=>{const s=n.join("-");return s in e?e[s]:e[s]=t(...n)}}const kf=Ua((t,e)=>t.repeat(e)),Jr=Ua((t,e=" ")=>{const n=kf(String(e),t);return(s,r)=>s==null?n:(s=s.toString(),r=r!==void 0?r:s.length,r<t?n.substring(r)+s:s)}),dt=Jr(2,"0"),Pf=Jr(3,"0"),Gf=Jr(4,"0"),Uf=t=>typeof t=="function",Ff={months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],sepHM:".",date:["dd","/DM","MM","/MY","yyyy"],time:["h","/HM","mm"," ","a"],units:{y:{s:"y",p:"y"},M:{s:"m",p:"m"},d:{s:"d",p:"d"},h:{s:"h",p:"h"},m:{s:"min",p:"min"},s:{s:"s",p:"s"},t:{s:"ms",p:"ms"}},less:"< %s",past:"%s ago",now:"just now",future:"in %s"},zf=t=>{const e={sepED:" ",sepDM:"/",sepMY:"/",sepHM:":",date:["E","/ED","d","/DM","MMM","/MY","yyyy"],time:["H","/HM","mm"],...t};return!e.dateTime&&(e.dateTime=[...e.date,", ",...e.time]),e};let pe=zf(Ff);const Hf=(t,e,n)=>$f[e]+n+~~(e>1&&Ga(t)),qf=(t,e,n)=>{const s=new Date(Date.UTC(t,0,1)).getDay()||7;if(!e){if(s===5&&n<4)return 53;if(s===6&&n<3)return 52+~~Ga(t-1);if(s===7&&n<2)return 52}const r=(s<5?8:15)-s;return Math.ceil((Hf(t,e,n)-r)/7+1)},rr={yyyy:t=>Gf(t.getFullYear()),yy:t=>dt(t.getFullYear()%100),MMM:t=>pe.months[t.getMonth()],MM:t=>dt(t.getMonth()+1),M:t=>String(t.getMonth()+1),dd:t=>dt(t.getDate()),d:t=>String(t.getDate()),E:t=>pe.days[t.getDay()],ww:t=>dt(rr.w(t,!1)),w:t=>String(qf(t.getFullYear(),t.getMonth(),t.getDate())),q:t=>String((t.getMonth()/3|0)+1),HH:t=>dt(t.getHours()),H:t=>String(t.getHours()),hh:t=>{const e=t.getHours()%12;return dt(e>0?e:12)},h:t=>{const e=t.getHours()%12;return String(e>0?e:12)},mm:t=>dt(t.getMinutes()),m:t=>String(t.getMinutes()),ss:t=>dt(t.getSeconds()),s:t=>String(t.getSeconds()),SS:t=>Pf(t.getMilliseconds()),S:t=>String(t.getMilliseconds()),A:t=>t.getHours()<12?"AM":"PM",a:t=>t.getHours()<12?"am":"pm",Z:(t,e=!1)=>{const n=e?0:t.getTimezoneOffset(),s=Math.abs(n);return`${n<0?"+":"-"}${dt(s/60|0)}:${dt(s%60)}`},ZZ:(t,e=!1)=>e?"Z":rr.Z(t,e),"/DM":()=>pe.sepDM,"/ED":()=>pe.sepED,"/HM":()=>pe.sepHM,"/MY":()=>pe.sepMY},Vf=t=>(e=Date.now(),n=!1)=>{let s=Tf(e);return n&&(s=new Date(s.getTime()+s.getTimezoneOffset()*Of)),t.map(r=>Pa(r)?r.startsWith("\\")?r.substring(1):rr[r]?.(s,n)??r:Uf(r)?r(s,n):r).join("")},Yf=Vf(["yyyy","MM","dd","-","HH","mm","ss"]);var vt=(t=>(t[t.ALPHA=0]="ALPHA",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t[t.RED=3]="RED",t))(vt||{});const Wf=["rotateCW","rotate180","rotateCCW"],jf=(t,e=t,n,s={})=>{const r=document.createElement("canvas");return ir(r,t,e,s.dpr),s.pixelated&&(r.style.imageRendering="pixelated"),n?.appendChild(r),{canvas:r,ctx:r.getContext("2d",s.ctx)}},Ee=(t,e=t,n,s)=>jf(t,e,n,{dpr:1,...s}),ir=(t,e,n,s=window.devicePixelRatio||1)=>(s!==1&&(t.style.width=`${e}px`,t.style.height=`${n}px`),t.width=e*s,t.height=n*s,s);function Xf(t,e,n,s){let r,i;if(v(t)){const c=Ee(t,e,n,s);r=c.canvas,i=c.ctx}else r=t,i=r.getContext("2d");const o=i.getImageData(0,0,r.width,r.height),a=new Uint32Array(o.data.buffer);return{canvas:r,ctx:i,img:o,data:a}}const $n=(t,e={})=>{const n=Reflect.ownKeys(t),s=Reflect.ownKeys(e),r=Symbol("isa");function i(o){for(let a of n){const c=Object.getOwnPropertyDescriptor(o.prototype,a);(!c||c.configurable)&&Object.defineProperty(o.prototype,a,{value:t[a],writable:!0})}return Object.defineProperty(o.prototype,r,{value:!0}),o}for(let o of s)Object.defineProperty(i,o,{value:e[o],enumerable:e.propertyIsEnumerable(o)});return Object.defineProperty(i,Symbol.hasInstance,{value:o=>!!o[r]}),i};$n({order(){return[0]},includes(t){return t>=0&&t<this.size[0]},indexAt(t){return this.includes(t)?this.indexAtUnsafe(t):-1},indexAtUnsafe(t){return this.offset+(t|0)*this.stride[0]},getAt(t){return this.includes(t)?this.data[this.indexAtUnsafe(t)]:0},getAtUnsafe(t){return this.data[this.indexAtUnsafe(t)]},setAt(t,e){return this.includes(t)?(this.data[this.indexAtUnsafe(t)]=e,!0):!1},setAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t)]=e,!0}});const Fa=$n({order(){return Math.abs(this.stride[1])>Math.abs(this.stride[0])?[1,0]:[0,1]},includes(t,e){const n=this.size;return t>=0&&t<n[0]&&e>=0&&e<n[1]},indexAt(t,e){return this.includes(t,e)?this.indexAtUnsafe(t,e):-1},indexAtUnsafe(t,e){return this.offset+(t|0)*this.stride[0]+(e|0)*this.stride[1]},getAt(t,e){return this.includes(t,e)?this.data[this.indexAtUnsafe(t,e)]:0},getAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t,e)]},setAt(t,e,n){return this.includes(t,e)?(this.data[this.indexAtUnsafe(t,e)]=n,!0):!1},setAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e)]=n,!0}});$n({order(){return za(this.stride)},includes(t,e,n){const s=this.size;return t>=0&&t<s[0]&&e>=0&&e<s[1]&&n>=0&&n<s[2]},indexAt(t,e,n){return this.includes(t,e,n)?this.indexAtUnsafe(t,e,n):-1},indexAtUnsafe(t,e,n){const s=this.stride;return this.offset+(t|0)*s[0]+(e|0)*s[1]+(n|0)*s[2]},getAt(t,e,n){return this.includes(t,e,n)?this.data[this.indexAtUnsafe(t,e,n)]:0},getAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e,n)]},setAt(t,e,n,s){return this.includes(t,e,n)?(this.data[this.indexAtUnsafe(t,e,n)]=s,!0):!1},setAtUnsafe(t,e,n,s){return this.data[this.indexAtUnsafe(t,e,n)]=s,!0}});$n({order(){return za(this.stride)},includes(t,e,n,s){const r=this.size;return t>=0&&t<r[0]&&e>=0&&e<r[1]&&n>=0&&n<r[2]&&s>=0&&s<r[3]},indexAt(t,e,n,s){return this.includes(t,e,n,s)?this.indexAtUnsafe(t,e,n,s):-1},indexAtUnsafe(t,e,n,s){const r=this.stride;return this.offset+(t|0)*r[0]+(e|0)*r[1]+(n|0)*r[2]+(s|0)*r[3]},getAt(t,e,n,s){return this.includes(t,e,n,s)?this.data[this.indexAtUnsafe(t,e,n,s)]:0},getAtUnsafe(t,e,n,s){return this.data[this.indexAtUnsafe(t,e,n,s)]},setAt(t,e,n,s,r){return this.includes(t,e,n,s)?(this.data[this.indexAtUnsafe(t,e,n,s)]=r,!0):!1},setAtUnsafe(t,e,n,s,r){return this.data[this.indexAtUnsafe(t,e,n,s)]=r,!0}});const za=t=>[...t].map((e,n)=>[e,n]).sort((e,n)=>Math.abs(n[0])-Math.abs(e[0])).map(e=>e[1]),xf=t=>{const e=(t>>>24)/255;return t&4278190080|(t>>>16&255)*e<<16|(t>>>8&255)*e<<8|(t&255)*e},Zf=t=>{const e=(t>>>24)/255;return e>0?(t&4278190080|Math.min(255,(t>>>16&255)/e)<<16|Math.min(255,(t>>>8&255)/e)<<8|Math.min(255,(t&255)/e))>>>0:t},Jf=t=>{const e=t>>>24;return(t>>>16&255)<=e&&(t>>>8&255)<=e&&(t&255)<=e},Kf=(t,e,n,s=1)=>I(t.length>=e*n*s,"pixel buffer too small"),Qf=(t,e,n)=>t?(Ha(t,e,n),t):new ImageData(e,n),Ha=(t,e,n)=>I(t.width===e&&t.height===n,"imagedata has wrong dimensions"),Bn=(t,e)=>{const n=t.channels[e];return I(n!=null,`invalid channel ID: ${e}`),n},t1=t=>I(!!t.alpha,"missing alpha channel"),e1=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/255,or=(t,e,n,s,r,i,o=0,a=0)=>(t|=0,e|=0,n|=0,s|=0,t<0&&(n+=t,o-=t,t=0),e<0&&(s+=e,a-=e,e=0),[t,e,ut(n,0,r-t),ut(s,0,i-e),o,a]),ji=(t,e,n={})=>{const s=t.width,r=e.width;let i,o,a,c,l,u;return[i,o,l,u]=or(n.sx||0,n.sy||0,n.w||s,n.h||t.height,s,t.height),[a,c,l,u,i,o]=or(n.dx||0,n.dy||0,l,u,r,e.height,i,o),{sx:i,sy:o,dx:a,dy:c,rw:l,rh:u}},n1=(t,e,n)=>{for(let s=t.length;s-- >0;)t[s]=n(t[s],e)},s1=(t,e,n,s)=>{for(let r=t.length;r-- >0;)t[r]=s(t[r],n(e[r]))},r1=(t,e,n,s,r)=>{const i=~r;for(let o=t.length;o-- >0;)t[o]=t[o]&i|n(s(e[o]))&r},Xi=(t,e,n)=>{const s=e.fromABGR,r=e.toABGR;for(let i=t.length;i-- >0;)t[i]=s(n(r(t[i])))},xi=t=>(t&255)<<16|t>>16&255|t&4278255360,i1=(t,e,n={})=>(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):e).putImageData(t.toImageData(n.data),n.x||0,n.y||0),ar=(t,e)=>e>0?`(${t} << ${e})`:e<0?`(${t} >>> ${-e})`:`${t}`,Kr=(t,e)=>ar(t,-e),qa=t=>`0x${t.toString(16)}`,o1=t=>{const e=8-t,n=(1<<t)-1;return new Function("luma",`return (x) => ${Kr("luma(x)",e)} & ${n};`)(e1)},a1=t=>{let e;if(t!==8){const n=(1<<t)-1,s=255/n;e=`(((x & ${n}) * ${s}) | 0)`}else e="x";return new Function("x",`return 0xff000000 | (${e} * 0x010101);`)},c1=t=>new Function("x","return ("+t.map(e=>{const n=e.abgrShift+(8-e.size);return`(${Kr("x",n)} & ${qa(e.maskA)})`}).join(" | ")+") >>> 0;"),l1=(t,e)=>{const n=t.map(r=>{if(r.size!==8){const i=r.mask0,o=255/i,a=Kr("x",r.shift);return ar(`((${a} & ${i}) * ${o})`,24-r.lane*8)}else return ar(`(x & ${qa(r.maskA)})`,r.abgrShift)}).join(" | "),s=e?"":"0xff000000 | ";return new Function("x",`return (${s}${n}) >>> 0;`)},u1=(t,e,n)=>{const s=1<<t.size,r=s-1,i=r<<n>>>0,o=~i>>>0,a=t.lane!=null?t.lane:e,c=u=>u>>>n&r,l=(u,f)=>u&o|(f&r)<<n;return{size:t.size,num:s,abgrShift:24-a*8-n,lane:a,shift:n,mask0:r,maskA:i,int:c,setInt:l,float:u=>c(u)/r,setFloat:(u,f)=>l(u,y(f)*r)}},Qr=t=>{I(t.channels.length>0,"no channel specs given");const e=t.channels.reduce(([n,s],r,i)=>(s-=r.size,n.push(u1(r,i,s)),[n,s]),[[],t.size])[0];return{__packed:!0,type:t.type,size:t.size,alpha:t.alpha||0,channels:e,fromABGR:t.fromABGR||c1(e),toABGR:t.toABGR||l1(e,!!t.alpha)}},cr=Qr({type:"u32",size:32,alpha:8,channels:[{size:8,lane:vt.ALPHA},{size:8,lane:vt.BLUE},{size:8,lane:vt.GREEN},{size:8,lane:vt.RED}],fromABGR:Zn,toABGR:Zn}),f1=(t,e,n=e,s,r)=>{const i=v(e)&&v(n)?Ee(e,n,s,r):Ee(t.width,t.height,s,r);return i.ctx.drawImage(t,0,0,i.canvas.width,i.canvas.height),i},d1=async(t,e="anonymous")=>{const n=new Image;return n.crossOrigin=e,n.src=t,await n.decode(),n},h1=d1;function g1(t,e="linear",n="clamp"){const s=!!t.format.__float,r=t.format.channels.length===1?"1":"",i=`${e[0]}${n[0]}${r}`,o=(s?{nc1:Tn,nw1:kn,nr1:Pn,nc:Tn,nw:kn,nr:Pn,lc1:a=>Ls(Ut(a)),lw1:a=>Ls(Ft(a)),lr1:a=>Ls(zt(a)),lc:a=>Ts(a,Tn(a)),lw:a=>Ts(a,kn(a)),lr:a=>Ts(a,Pn(a)),cc1:a=>Ps(Ut(a)),cw1:a=>Ps(Ft(a)),cr1:a=>Ps(zt(a)),cc:a=>Us(a,Tn(a)),cw:a=>Us(a,kn(a)),cr:a=>Us(a,Pn(a))}:{nc1:Ut,nw1:Ft,nr1:zt,nc:Ut,nw:Ft,nr:zt,lc1:a=>jn(Ut(a)),lw1:a=>jn(Ft(a)),lr1:a=>jn(zt(a)),lc:a=>Bs(a,Ut(a)),lw:a=>Bs(a,Ft(a)),lr:a=>Bs(a,zt(a)),cc1:a=>ks(a,Ut(a)),cw1:a=>ks(a,Ft(a)),cr1:a=>ks(a,zt(a)),cc:a=>Gs(a,Ut(a)),cw:a=>Gs(a,Ft(a)),cr:a=>Gs(a,zt(a))})[i];return I(!!o,`missing impl for ${i}`),o(t)}const Ut=({data:t,width:e,height:n})=>(s,r)=>s>=0&&s<e&&r>=0&&r<n?t[(r|0)*e+(s|0)]:0,Ft=({data:t,width:e,height:n})=>(s,r)=>t[ts(r|0,n)*e+ts(s|0,e)],zt=({data:t,width:e,height:n})=>{const s=e-1,r=n-1;return(i,o)=>t[ut(o|0,0,r)*e+ut(i|0,0,s)]},Tn=({data:t,width:e,height:n,stride:[s,r]})=>(i,o)=>{let a;return i>=0&&i<e&&o>=0&&o<n?(a=(o|0)*r+(i|0)*s,t.slice(a,a+s)):[0]},kn=({data:t,width:e,height:n,stride:[s,r]})=>(i,o)=>{let a=ts(o|0,n)*r+ts(i|0,e)*s;return t.slice(a,a+s)},Pn=({data:t,width:e,height:n,stride:[s,r]})=>{const i=e-1,o=n-1;return(a,c)=>{let l=ut(c|0,0,o)*r+ut(a|0,0,i)*s;return t.slice(l,l+s)}},Je=(t,e,n,s,r=4)=>ca(t[s],t[s+r],t[s+2*r],t[s+3*r],e,n),jn=t=>(e,n)=>(e-=.5,n-=.5,ca(t(e,n),t(e+1,n),t(e,n+1),t(e+1,n+1),P(e),P(n))),Ls=t=>(t=jn(t),(e,n)=>[t(e,n)]),Bs=(t,e)=>{const{fromABGR:n,toABGR:s}=t.format,r=new Uint32Array(4),i=new Uint8Array(r.buffer);return(o,a)=>{o-=.5,a-=.5,r[0]=s(e(o,a)),r[1]=s(e(o+1,a)),r[2]=s(e(o,a+1)),r[3]=s(e(o+1,a+1));const c=P(o),l=P(a);return n(Je(i,c,l,0)|Je(i,c,l,1)<<8|Je(i,c,l,2)<<16|Je(i,c,l,3)<<24)>>>0}},Ts=({stride:[t]},e)=>{const n=new Float32Array(t*4);return(s,r)=>{s-=.5,r-=.5,n.set(e(s,r),0),n.set(e(s+1,r),t),n.set(e(s,r+1),t*2),n.set(e(s+1,r+1),t*3);const i=P(s),o=P(r);let a=[];for(let c=0;c<t;c++)a.push(Je(n,i,o,c,t));return a}},Va=t=>(e,n)=>{e-=.5,n-=.5;const s=e-1,r=e+1,i=e+2,o=n-1,a=n+1,c=n+2;return la(t(s,o),t(e,o),t(r,o),t(i,o),t(s,n),t(e,n),t(r,n),t(i,n),t(s,a),t(e,a),t(r,a),t(i,a),t(s,c),t(e,c),t(r,c),t(i,c),P(e),P(n))},ks=(t,e)=>{const n=t.format.channels[0].mask0;return e=Va(e),(s,r)=>ut(e(s,r),0,n)},Ps=t=>(t=Va(t),(e,n)=>[t(e,n)]),Ya=(t,e,n,s,r=4)=>la(t[s],t[s+r],t[s+2*r],t[s+3*r],t[s+4*r],t[s+5*r],t[s+6*r],t[s+7*r],t[s+8*r],t[s+9*r],t[s+10*r],t[s+11*r],t[s+12*r],t[s+13*r],t[s+14*r],t[s+15*r],e,n),Gn=(t,e,n,s,r=4)=>ut(Ya(t,e,n,s,r),0,255),Gs=(t,e)=>{const{fromABGR:n,toABGR:s}=t.format,r=new Uint32Array(16),i=new Uint8Array(r.buffer);return(o,a)=>{o-=.5,a-=.5;const c=o-1,l=o+1,u=o+2,f=a-1,d=a+1,h=a+2,g=P(o),p=P(a);return r[0]=s(e(c,f)),r[1]=s(e(o,f)),r[2]=s(e(l,f)),r[3]=s(e(u,f)),r[4]=s(e(c,a)),r[5]=s(e(o,a)),r[6]=s(e(l,a)),r[7]=s(e(u,a)),r[8]=s(e(c,d)),r[9]=s(e(o,d)),r[10]=s(e(l,d)),r[11]=s(e(u,d)),r[12]=s(e(c,h)),r[13]=s(e(o,h)),r[14]=s(e(l,h)),r[15]=s(e(u,h)),n(Gn(i,g,p,0)|Gn(i,g,p,1)<<8|Gn(i,g,p,2)<<16|Gn(i,g,p,3)<<24)>>>0}},Us=({stride:[t]},e)=>{const n=new Float32Array(t*16);return(s,r)=>{s-=.5,r-=.5;const i=s-1,o=s+1,a=s+2,c=r-1,l=r+1,u=r+2,f=P(s),d=P(r);n.set(e(i,c),0),n.set(e(s,c),t),n.set(e(o,c),2*t),n.set(e(a,c),3*t),n.set(e(i,r),4*t),n.set(e(s,r),5*t),n.set(e(o,r),6*t),n.set(e(a,r),7*t),n.set(e(i,l),8*t),n.set(e(s,l),9*t),n.set(e(o,l),10*t),n.set(e(a,l),11*t),n.set(e(i,u),12*t),n.set(e(s,u),13*t),n.set(e(o,u),14*t),n.set(e(a,u),15*t);let h=[];for(let g=0;g<t;g++)h.push(Ya(n,f,d,g,t));return h}};var m1=Object.getOwnPropertyDescriptor,p1=(t,e,n,s)=>{for(var r=s>1?void 0:s?m1(e,n):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(r=o(r)||r);return r};function b1(...t){return t[0]instanceof Dt?t[0].as(t[1]):new Dt(...t)}const _1=(t,e,n,s=n)=>v1(f1(t,n,s).canvas,e),v1=(t,e=cr)=>{const{data:n}=Xf(t),s=t.width,r=t.height;let i;if(e===cr)i=n;else{i=Yn(e.type,s*r);const o=n,a=e.fromABGR;for(let c=i.length;c-- >0;)i[c]=a(o[c])}return new Dt(s,r,e,i)};let Dt=class{size;stride;format;data;constructor(t,e,n=cr,s){this.size=[t,e],this.stride=[1,t],this.format=n.__packed?n:Qr(n),this.data=s||Yn(n.type,t*e)}get pixels(){return this.data}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}get dim(){return 2}*[Symbol.iterator](){yield*this.data}as(t){return this.getRegion(0,0,this.width,this.height,t)}copy(){const t=this.empty();return t.data.set(this.data),t}empty(){return new Dt(this.width,this.height,this.format)}order(){}includes(t,e){}indexAt(t,e){}indexAtUnsafe(t,e){}getAt(t,e){}getAtUnsafe(t,e){}setAt(t,e,n){}setAtUnsafe(t,e,n){}getChannelAt(t,e,n,s=!1){const r=Bn(this.format,n),i=this.getAt(t,e);return s?r.float(i):r.int(i)}setChannelAt(t,e,n,s,r=!1){const i=Bn(this.format,n),o=this.getAt(t,e);return r?i.setFloat(o,s):i.setInt(o,s),this}blend(t,e,n){let s=this.width,r=e.width;const{sx:i,sy:o,dx:a,dy:c,rw:l,rh:u}=ji(this,e,n);if(l<1||u<1)return e;const f=this.data,d=e.data,h=this.format.toABGR,g=e.format.toABGR,p=e.format.fromABGR;for(let _=(i|0)+(o|0)*s,m=(a|0)+(c|0)*r,M=0;M<u;M++,_+=s,m+=r)for(let D=0;D<l;D++)d[m+D]=p(t(h(f[_+D]),g(d[m+D])));return e}blit(t,e){let n=this.width,s=t.width;const{sx:r,sy:i,dx:o,dy:a,rw:c,rh:l}=ji(this,t,e);if(c<1||l<1)return t;const u=this.data,f=t.data,d=this.format.toABGR,h=t.format.fromABGR,g=this.format!==t.format?(p,_)=>{for(let m=0;m<c;m++)f[_+m]=h(d(u[p+m]))}:(p,_)=>f.set(u.subarray(p,p+c),_);for(let p=(r|0)+(i|0)*n,_=(o|0)+(a|0)*s,m=0;m<l;m++,p+=n,_+=s)g(p,_);return t}blitCanvas(t,e={}){i1(this,t,e)}setImageData(t){Ha(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,s=this.format.fromABGR;for(let r=e.length;r-- >0;)n[r]=s(e[r]);return this}toImageData(t){t=Qf(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,s=this.format.toABGR;for(let r=e.length;r-- >0;)e[r]=s(n[r]);return t}getRegion(t,e,n,s,r){const[i,o,a,c]=or(t,e,n,s,this.width,this.height);if(!(a<1||c<1))return this.blit(new Dt(a,c,r||this.format),{sx:i,sy:o,w:a,h:c})}getChannel(t){const e=Bn(this.format,t),n=new Dt(this.width,this.height,{type:L0(e.size),size:e.size,channels:[{size:e.size,lane:vt.RED}],fromABGR:o1(e.size),toABGR:a1(e.size)}),s=this.data,r=n.data,i=e.int;for(let o=s.length;o-- >0;)r[o]=i(s[o]);return n}setChannel(t,e){const n=Bn(this.format,t),s=this.data,r=n.setInt;if(v(e))n1(s,e,r);else{const i=e.data,o=e.format.channels[0];Kf(i,this.width,this.height),n.size===o.size?s1(s,i,o.int,r):r1(s,i,this.format.fromABGR,e.format.toABGR,n.maskA)}return this}invert(){const{data:t,format:e}=this,n=Math.pow(2,e.size-e.alpha)-1;for(let s=t.length;s-- >0;)t[s]^=n;return this}premultiply(){return t1(this.format),Xi(this.data,this.format,xf),this}postmultiply(){return Xi(this.data,this.format,Zf),this}isPremultiplied(){const t=this.data,e=this.format.toABGR;for(let n=t.length;n-- >0;)if(!Jf(e(t[n])))return!1;return!0}forEach(t){const e=this.data;for(let n=e.length;n-- >0;)e[n]=t(e[n],n);return this}fill(t){this.data.fill(t)}flipX(){const{data:t,width:e}=this;for(let n=0;n<t.length;n+=e)t.subarray(n,n+e).reverse();return this}flipY(){const{data:t,width:e}=this,n=Yn(this.format.type,e);for(let s=0,r=t.length-e;s<r;s+=e,r-=e)n.set(t.subarray(s,s+e)),t.copyWithin(s,r,r+e),t.set(n,r);return this}rotateByID(t){return t>0?this[Wf[t-1]]():this}rotateCW(){const{width:t,height:e}=this,n=e-1;return this._rotate((s,r)=>s*e+n-r),this.size[0]=e,this.size[1]=t,this}rotateCCW(){const{width:t,height:e}=this,n=t-1;return this._rotate((s,r)=>(n-s)*e+r),this.size[0]=e,this.size[1]=t,this}rotate180(){const{width:t,height:e}=this,n=t-1,s=e-1;return this._rotate((r,i)=>(s-i)*t+n-r),this}scale(t,e="linear"){return I(t>0,"scale must be > 0"),this.resize(this.width*t,this.height*t,e)}resize(t,e,n="linear"){t|=0,e|=0,I(t>0&&e>0,"target width & height must be > 0");const s=b1(t,e,this.format),r=s.data,i=t>0?this.width/t:0,o=e>0?this.height/e:0;n=k(n)?g1(this,n,"repeat"):n;for(let a=0,c=0;a<e;a++){const l=a*o;for(let u=0;u<t;u++,c++)r[c]=n(u*i,l)}return s}upsize(){const{width:t,height:e,data:n}=this,s=new Dt(t*2,e*2,this.format),r=s.data;for(let i=0,o=0;i<e;i++)for(let a=0,c=i*t*4;a<t;a++,o++,c+=2)r[c]=n[o];return s}_rotate(t){const{data:e,format:n,width:s,height:r}=this,i=Yn(n.type,s*r);for(let o=0;o<r;o++)for(let a=0;a<s;a++)i[t(a,o)]=e[o*s+a];this.data=i}};Dt=p1([Fa],Dt);const y1=Qr({type:"u32",size:32,alpha:8,channels:[{size:8,lane:vt.ALPHA},{size:8,lane:vt.RED},{size:8,lane:vt.GREEN},{size:8,lane:vt.BLUE}],fromABGR:xi,toABGR:xi});class Zt{constructor(e,n){this.mode=e,this.value=n}deref(){return this.value}}const A1={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",grey:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32",transparent:"0000",rebeccapurple:"639"};let w1={canvas:"fff",canvastext:"000",linktext:"001ee4",visitedtext:"4e2386",activetext:"eb3323",buttonface:"ddd",buttontext:"000",buttonborder:"000",field:"fff",fieldtext:"000",highlight:"bbd5fb",highlighttext:"000",mark:"000",marktext:"fff",graytext:"808080"};const Wa=(t,e,n)=>B(t||e,e[0],e[1],e[2],n),E1=t=>t.mode,R1=t=>(t&3840)*4352|(t&240)*272|(t&15)*17,S1=t=>((t&61440)*69632|(t&3840)*4352|(t&240)*272|(t&15)*17)>>>0,ys=(t,e)=>B(t||[],(e>>>16&255)*nt,(e>>>8&255)*nt,(e&255)*nt,(e>>>24)*nt),ja=(t,e)=>B(t||[],(e&255)*nt,(e>>>8&255)*nt,(e>>>16&255)*nt,(e>>>24)*nt),I1=t=>{t=(k(t)?t:t.deref()).toLowerCase();const e=A1[t]||w1[t];if(e||t[0]==="#")return new Zt("srgb",ys([],D1(e||t)));const n=t.split(/[(),/ ]+/),[s,r,i,o,a]=n;switch(I(n.length===5||n.length===6,`invalid color: ${t}`),s){case"rgb":case"rgba":return new Zt("srgb",[q(r,1,nt,!0),q(i,1,nt,!0),q(o,1,nt,!0),be(a)]);case"hsl":case"hsla":return new Zt("hsl",[Fs(r),Zi(i),Zi(o),be(a)]);case"lab":return new Zt("lab50",[q(r),q(i,1.25),q(o,1.25),be(a)]);case"lch":return new Zt(s,[q(r),q(i,1.5),Fs(o),be(a)]);case"oklab":return new Zt(s,[q(r,1,1),q(i,.4,1),q(o,.4,1),be(a)]);case"oklch":return new Zt(s,[q(r,1,1),q(i,.4,1),Fs(o),be(a)]);default:At(`color mode: ${s}`)}},M1={rad:O,grad:400,turn:1,deg:360},Fs=t=>{const e=/^(-?[0-9.]+)(deg|rad|grad|turn)?$/.exec(t);return I(!!e,`expected hue, got: ${t}`),P(parseFloat(e[1])/(M1[e[2]]||360))},be=t=>t?q(t,1,1,!0):1,Zi=(t,e=!0)=>{I(/^([0-9.]+)%$/.test(t),`expected percentage, got: ${t}`);const n=parseFloat(t)/100;return e?y(n):n},q=(t,e=1,n=.01,s=!1)=>{I(/^-?[0-9.]+%?$/.test(t),`expected number or percentage, got: ${t}`);const r=parseFloat(t)*(t.endsWith("%")?.01*e:n);return s?y(r):r},D1=t=>{const e=/^#?([0-9a-f]{3,8})$/i.exec(t);if(e){const n=e[1],s=parseInt(n,16);switch(n.length){case 3:return(R1(s)|4278190080)>>>0;case 4:return Ui(S1(s),8);case 6:return(s|4278190080)>>>0;case 8:return Ui(s,8)}}return ct(`invalid hex color: "${t}"`)},N1=_a((t,e=3,n=",",s="[",r="]")=>{const i=typeof e=="number"?ya(e):e;switch(t){case 1:return o=>`${s}${i(o[0])}${r}`;case 2:return o=>`${s}${i(o[0])}${n}${i(o[1])}${r}`;case 3:return o=>`${s}${i(o[0])}${n}${i(o[1])}${n}${i(o[2])}${r}`;case 4:return o=>`${s}${i(o[0])}${n}${i(o[1])}${n}${i(o[2])}${n}${i(o[3])}${r}`;default:return o=>{const a=[];for(let c=0;c<o.length;c++)a.push(i(o[c]));return`${s}${a.join(n)}${r}`}}}),Xa=t=>{const e=t.channels||{},n=t.order,s=n.length;n.reduce((d,h)=>(d[h]={range:[0,1],...e[h]},d),e);const r=Object.freeze(n.map(d=>e[d].range[0])),i=Object.freeze(n.map(d=>e[d].range[1])),o=ie([],r),a=ie([],i);o[s-1]=1;const c=n.findIndex(d=>!!e[d].hue),l=class{constructor(d,h=0,g=1){this.offset=h,this.stride=g,this.buf=d||[0,0,0,0],this.offset=h,this.stride=g}buf;get mode(){return t.mode}get length(){return s}get range(){return[r,i]}get[Symbol.toStringTag](){return t.mode}get xyz(){return[this[0],this[1],this[2]]}[Symbol.iterator](){return U0(this.buf,this.length,this.offset,this.stride)}copy(){return new l(this.deref())}copyView(){return new l(this.buf,this.offset,this.stride)}empty(){return new l}deref(){return[this[0],this[1],this[2],this[3]]}set(d){return ie(this,d)}clamp(){return c>=0&&(this[c]=P(this[c])),k0(null,this,r,i),this}eqDelta(d,h=U){return oa(this,d,h)}randomize(d){return wa(this,o,a,d)}toJSON(){return this.deref()}toString(){return N1(4,4)(this)}};A0(l.prototype,n),Fi(t.mode,t.from),Fi("rgb",{[t.mode]:t.toRgb});const u=(d,h,g)=>{const p=new l(...g);return h!==t.mode?Sa(p,d,t.mode,h):p.set(d)},f=(d,...h)=>d==null?new l:k(d)?f(I1(d),...h):gs(d)?k(d.mode)?u(d,d.mode,h):new l(d,...h):at(d,"deref")?u(d.deref(),d.mode,h):v(d)?h.length&&h.every(v)?new l(...J0([d,...h])):u(ys([],d),"srgb",h):ct(`can't create a ${t.mode} color from: ${d}`);return f.class=l,f.range=[r,i],f.random=(d,h,g,p)=>new l(h,g,p).randomize(d),f.mapBuffer=(d,h=d.length/s|0,g=0,p=1,_=s)=>B0(l,d,h,g,p,_),f},lr=(t,e=Ia)=>Gr(t,e),xa=t=>Gr(t,W0),$1=t=>((t>>>16&255)*76+(t>>>8&255)*150+(t&255)*29)/65025,C1=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/65025,O1=t=>$1(t[0]),L1=t=>C1(t[0]),ti=(t,e,n=1)=>(e=P(e)*6,B(t||[],y(Math.abs(e-3)-1),y(2-Math.abs(e-2)),y(2-Math.abs(e-4)),n)),Za=(t,e)=>{const n=e[0];let s=e[1];const r=e[2],i=ti(t||e,n,Y(e[3])),o=lr(i);return r<o?s*=r/o:o<1&&(s*=(1-r)/(1-o)),K(i,y((i[0]-o)*s+r),y((i[1]-o)*s+r),y((i[2]-o)*s+r))},Ja=(t,e)=>{t=Yr(t||e,e);const n=t[1],s=t[2];if(n<1e-6)return K(t,s,s,s);const r=t[0]*6%6,i=s*(1-n),o=1-Math.abs(r%2-1);let a=3*s*n/(1+o);const c=a*o+i;switch(a+=i,r|0){case 0:return K(t,a,c,i);case 1:return K(t,c,a,i);case 2:return K(t,i,a,c);case 3:return K(t,i,c,a);case 4:return K(t,c,i,a);case 5:return K(t,a,i,c);default:return K(t,i,i,i)}},Ka=(t,e)=>{const n=y(e[1]),s=y(e[2]);t=ti(t||e,e[0],Y(e[3]));const r=(1-Math.abs(2*s-1))*n;return K(t,(t[0]-.5)*r+s,(t[1]-.5)*r+s,(t[2]-.5)*r+s)},Qa=(t,e)=>{t=Yr(t||e,e);const n=t[1],s=t[2];return ti(t,e[0],t[3]),K(t,((t[0]-1)*n+1)*s,((t[1]-1)*n+1)*s,((t[2]-1)*n+1)*s)},As=(t,e)=>B(t||e,Ns(e[0]),Ns(e[1]),Ns(e[2]),Y(e[3])),B1=(t,e)=>As(null,ys(t,e)),T1=(t,e)=>As(null,ja(t,e)),k1=[4.0767416621,-1.2684380046,-.0041960863,-3.307711591,2.6097574011,-.7034186147,.2309699292,-.3413193965,1.707614701],P1=(t,{0:e,1:n,2:s,3:r})=>Na(t,k1,[(e+.3963377774*n+.2158037573*s)**3,(e-.1055613458*n-.0638541728*s)**3,(e-.0894841775*n-1.291485548*s)**3,r]),G1=(t,e)=>{const{0:n,1:s,2:r}=e;return B(t||e,Gi(r*n,s),r,Gi(r*(1-n-s),s),Y(e[3]))},U1=(t,e,n=Ia)=>{const s=e[0],r=(2-2*n[2])*e[1],i=(2-2*n[0])*e[2];return B(t||e,s+i,s-n[2]/n[1]*r-n[0]/n[1]*i,s+r,Y(e[3]))},ws=Xa({mode:"rgb",order:["r","g","b","alpha"],from:{abgr32:(t,e)=>T1(t,e[0]),argb32:(t,e)=>B1(t,e[0]),hcy:Za,hsi:Ja,hsl:Ka,hsv:Qa,lab50:ss,lab65:Oa,lch:[Ca,ss],oklab:P1,rgb:ie,srgb:As,xyy:[G1,nr],xyz50:jr,xyz65:nr,ycc:U1},toRgb:ie}),cn=Xa({mode:"srgb",order:["r","g","b","alpha"],from:{abgr32:(t,e)=>ja(t,e[0]),argb32:(t,e)=>ys(t,e[0]),hcy:Za,hsi:Ja,hsl:Ka,hsv:Qa,rgb:an},toRgb:As});function F1(t,...e){let[n,s,r,i,o,a,c,l]=e;switch(e.length){case 1:return(...u)=>t(n,...u);case 2:return(...u)=>t(n,s,...u);case 3:return(...u)=>t(n,s,r,...u);case 4:return(...u)=>t(n,s,r,i,...u);case 5:return(...u)=>t(n,s,r,i,o,...u);case 6:return(...u)=>t(n,s,r,i,o,a,...u);case 7:return(...u)=>t(n,s,r,i,o,a,c,...u);case 8:return(...u)=>t(n,s,r,i,o,a,c,l,...u);default:ct()}}const z1=()=>Zn,H1=(t,e)=>$t(H(([n,s,r,i])=>y(n+s*Math.cos(O*(r*e+i)))),oe(),Js(...t)),Ji=(t,e,n)=>$t(Mn(H(F1(H1,e)),z1()),oe(),Ea(t-1)),Ki=(t,e)=>{t=Hi([],t),e=Hi([],e);const n=[...H(([s,r])=>.5*(s-r),Js(t,e))];return[[...H(([s,r])=>s-r,Js(t,n))],n,[-.5,-.5,-.5,-.5],[0,0,0,0]]},q1=Bt(E1,{lch:"lab",oklab:"lab",ycc:"lab",xyy:"hcy"},{argb32:O1,abgr32:L1,hcy:t=>t[2],lab:t=>t[0],rgb:lr,srgb:xa,xyz:t=>t[1],[X]:t=>lr(ws(t))}),W=(t,e,n)=>{const s=t[e];t[e]=t[n],t[n]=s},V1=(...t)=>{const[e,n,s]=t,r=t.length;switch(r){case 0:return W;case 1:return(i,o,a)=>{W(i,o,a),W(e,o,a)};case 2:return(i,o,a)=>{W(i,o,a),W(e,o,a),W(n,o,a)};case 3:return(i,o,a)=>{W(i,o,a),W(e,o,a),W(n,o,a),W(s,o,a)};default:return(i,o,a)=>{W(i,o,a);for(let c=r;c-- >0;)W(t[c],o,a)}}};function ur(t,e=Zr,n=W,s=0,r=t.length-1){if(s<r){const i=t[s+(r-s>>1)];let o=s-1,a=r+1;for(;;){do o++;while(e(t[o],i)<0);do a--;while(e(t[a],i)>0);if(o>=a)break;n(t,o,a)}ur(t,e,n,s,a),ur(t,e,n,a+1,r)}return t}const Y1=(t,e,n=Zr)=>{const s=Be(e)?t.map(e):e;return I(s.length===t.length,"keys.length != src.length"),ur(s,n,V1(t)),t},tc=(t,e)=>t-e,W1=(t,e)=>e-t,j1=(t,e,n=!1)=>Y1(t,e,n?W1:tc),qe=.072,Ve=.213,X1=.285,Ye=.715,x1=.787,Z1=.928,Re=rf,J1=(t,...e)=>e.reduce(of,t),ec=t=>[1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0],K1=(t,e=.5*(1-t))=>[t,0,0,0,e,0,t,0,0,e,0,0,t,0,e,0,0,0,1,0],Q1=t=>[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],Qi=t=>[Ve+x1*t,Ye-Ye*t,qe-qe*t,0,0,Ve-Ve*t,Ye+X1*t,qe-qe*t,0,0,Ve-Ve*t,Ye-Ye*t,qe+Z1*t,0,0,0,0,0,1,0];function fr(t){return t?gn(fr(),t):_s(()=>({}),(e,[n,s])=>(e[n]=s,e))}function dr(...t){const e=mu(dr,t);if(e!==void 0)return e;const n=t[0];return _s(()=>!1,n?(s,r)=>n(r)?Mi(!0):s:(s,r)=>r?Mi(!0):s)}function nc(t,e){return Ue(e)?Ko(nc(t),k(e)?[e]:e):n=>{const s=n[2],r=(i,o)=>{const a=t(o);if(a){for(let c of a)if(i=r(i,c),Ot(i))break;return i}return s(i,o)};return In(n,r)}}function td(t){return nc(e=>df(e)?e:void 0,t)}const ed=(t,e=0,n=t.length,s=ue)=>{for(I(e>=0&&n>=e&&n<=t.length,`illegal range ${e}..${n}`);n>e+1;){const r=s.minmax(e,n)|0,i=t[r];t[r]=t[--n],t[n]=i}return t},nd=(t,e=t.length,n=ue)=>ed(t,0,e,n),sc=t=>t!=null,Cn=t=>typeof t=="boolean",sd=t=>t instanceof Map,rd=()=>typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node<"u",id=new Set(["__proto__","prototype","constructor"]),zs=t=>id.has(t),od=t=>S(t)?t.some(zs):k(t)?t.indexOf(".")!==-1?t.split(".").some(zs):zs(t):!1,ad=(t,e,n=o=>o,s=Zr,r=0,i=t.length-1)=>{const o=n(e);for(;r<=i;){const a=r+i>>>1,c=s(n(t[a]),o);if(c<0)r=a+1;else if(c>0)i=a-1;else return a}return-r-1};function*Hs(t){for(let e in t)t.hasOwnProperty(e)&&(yield t[e])}const cd=t=>t,ld=(t,e,n,s)=>{if(n===void 0||s===void 0){const r=t.timeBounds();n=n??r[0],s=s??r[1]}return H(r=>(r=ne(n,s,r),[r,t.at(r)]),Ea(e))};class Te{constructor(e,n,s){this.impl=e,this.stops=n,I(n.length>=2,"require at least 2 keyframes/stops");const r={domain:cd,...s};this.domain=r.domain,this.sort()}domain;copy(){return new Te(this.impl,this.stops.map(e=>e.slice()))}empty(){return new Te(this.impl,[])}at(e){const{domain:n,impl:s,stops:r}=this,i=r.length-1,o=r[0],a=r[i];e=n(e,o[0],a[0]);const c=this.timeIndex(e);return c<0?o[1]:c>=i?a[1]:s.at(r,c,e)}samples(e=100,n,s){return ld(this,e,n,s)}bounds(){const{impl:e,stops:n}=this,s=n.length;let r=null,i=null;for(let o=s;o-- >0;){const a=n[o][1];r=e.min(r,a),i=e.max(i,a)}return{min:r,max:i,minT:n[0][0],maxT:n[s-1][0]}}timeBounds(){return[this.stops[0][0],Zo(this.stops)[0]]}setStopAt(e,n,s=.01){const r=this.closestIndex(e,s);return r<0?(this.stops.push([e,n]),this.sort(),!0):(this.stops[r][1]=n,!1)}removeStopAt(e,n=.01){return this.stops.length>2?this.removeStopAtIndex(this.closestIndex(e,n)):!1}removeStopAtIndex(e){const n=this.stops;return e<0||e>=n.length||n.length<=2?!1:(n.splice(e,1),!0)}closestIndex(e,n=.01){const s=this.stops;for(let r=s.length;r-- >0;)if(qu(e,s[r][0])<n)return r;return-1}clampedIndexTime(e,n,s=.01){const r=this.stops,i=r.length-1;return e==0?Math.min(n,r[1][0]-s):e===i?Math.max(n,r[i-1][0]+s):ut(n,r[e-1][0]+s,r[e+1][0]-s)}sort(){this.stops.sort((e,n)=>e[0]-n[0])}uniform(){const e=this.stops.length-1;this.stops.forEach((n,s)=>n[0]=s/e)}timeIndex(e){const n=this.stops,s=n.length;if(s<256){for(let i=s;i-- >0;)if(e>=n[i][0])return i;return-1}const r=ad(n,[e,null],i=>i[0],tc);return r<-1?-(r+2):r}}const ud=(t,e)=>new Te(fd,t,e),fd={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>{const s=t.length-1,r=t[Math.max(e-1,0)],[i,o]=t[Math.max(e,0)],[a,c]=t[Math.min(e+1,s)],l=t[Math.min(e+2,s)],u=Oi(r[1],c,0,r[0],a),f=Oi(o,l[1],0,i,l[0]);return Wu(o,u,c,f,Tr(n,i,a))}},dd=(t,e)=>new Te(hd,t,e),hd={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>{const s=t[e],r=t[e+1];return et(n,s[0],r[0],s[1],r[1])}},rc=4,Un=1<<rc,ic=8,gd=1<<ic,ht=4095;let oc=4,ac=.5;const qs=t=>.5*(1-Math.cos(t*Math.PI));let rt;const md=function(t,e=0,n=0){if(rt==null){rt=new Array(ht+1);for(let _=0;_<ht+1;_++)rt[_]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),n<0&&(n=-n);let s=Math.floor(t),r=Math.floor(e),i=Math.floor(n),o=t-s,a=e-r,c=n-i,l,u,f=0,d=.5,h,g,p;for(let _=0;_<oc;_++){let m=s+(r<<rc)+(i<<ic);l=qs(o),u=qs(a),h=rt[m&ht],h+=l*(rt[m+1&ht]-h),g=rt[m+Un&ht],g+=l*(rt[m+Un+1&ht]-g),h+=u*(g-h),m+=gd,g=rt[m&ht],g+=l*(rt[m+1&ht]-g),p=rt[m+Un&ht],p+=l*(rt[m+Un+1&ht]-p),g+=u*(p-g),h+=qs(c)*(g-h),f+=h*d,d*=ac,s<<=1,o*=2,r<<=1,a*=2,i<<=1,c*=2,o>=1&&(s++,o--),a>=1&&(r++,a--),c>=1&&(i++,c--)}return f},pd=function(t,e){t>0&&(oc=t),e>0&&(ac=e)},hr={sinTimesCos:vd,sinFractCos:Rd,sinPlusCos:yd,sinPlusSin:Ad,cos:wd,sin:Ed,hopalong:Sd,clifford:Id,deJong:Md,gumowskiMira:$d,bedhead:Dd,fractalDream:Nd,perlin:_d,radial:gr,macMillan:Cd,juan:Od,nAttractor:Ld},bd=(t,e=Object.keys(hr))=>{const n=E(e,t);let s=1,r=10;switch(n){case"fractalDream":case"clifford":r=t.minmaxInt(1,30);break;case"perlin":r=t.minmaxInt(1,20);break;case"bedhead":case"deJong":r=t.minmaxInt(1,50);break;case"hopalong":default:r=t.minmaxInt(1,100);break}const i=t.minmaxInt(s,r);return{type:n,opts:{scale:[i,i],amplitude:t.minmax(.5,20),a:t.minmax(-15,15),b:t.minmax(-15,15),c:t.minmax(-15,15),d:t.minmax(-15,15),mode:1,center:[t.minmax(-.5,.5),t.minmax(-.5,.5)],falloff:t.minmax(.01,.3),lod:t.minmaxInt(0,5)},conversion:E(["multiplyByPI","aCos","aSin"],t)}};function _d([t,e],n){const s=n.lod?n.lod:4,r=n.falloff?n.falloff:.5;return pd(s,r),(md(t,e)-.5)*2}function vd([t,e],n){return Math.sin(t)*Math.cos(e)}function yd([t,e],n){return(Math.sin(t)+Math.cos(e))*.5}function Ad([t,e],n){return(Math.sin(t)+Math.sin(e))*.5}function wd([t,e],n){return Math.cos(t)}function Ed([t,e],n){return Math.sin(t)}function Rd([t,e],n){return Math.sin(t)/Math.cos(e)}function Tt([t,e],[n,s],r=1){return r===0?Math.atan2(s,n)/st:Math.atan2(s-e,n-t)/st}function Sd([t,e],{a:n=1,b:s=1,c:r=1,mode:i=0}){const o=e-1-Math.sqrt(Math.abs(s*t-1-r))*Math.sign(t-1),a=n-t-1;return Tt([t,e],[o,a],i)}function Id([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=Math.sin(n*e)+r*Math.cos(n*t),c=Math.sin(s*t)+i*Math.cos(s*e);return Tt([t,e],[a,c],o)}function Md([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=Math.sin(n*e)-Math.cos(s*t),c=Math.sin(r*t)-Math.cos(i*e);return Tt([t,e],[a,c],o)}function Dd([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=Math.sin(t*e/s)*e+Math.cos(n*t-e),c=t+Math.sin(e)/s;return Tt([t,e],[a,c],o)}function Nd([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=Math.sin(s*e)+r*Math.sin(s*t),c=Math.sin(n*t)+i*Math.sin(n*e);return Tt([t,e],[a,c],o)}function $d([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=n*t+(1-n)*2*t*t/(1+t*t),c=s*e*a,l=a-t;return Tt([t,e],[c,l],o)}function Cd([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=e,c=-a+2*n*e/(1-e*e)+s*e;return Tt([t,e],[a,c],o)}function Od([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=Math.cos(n*t),c=Math.sin(s*e),l=a*a-c*c,u=2*Math.cos(r*t)*Math.sin(i*e);return Tt([t,e],[l,u],o)}function Ld([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=n*Math.sin(e-e*(e*e+1)/2)+s*Math.tanh(t-t*(t*t+1)/2),c=r*Math.sin(t-t*(t*t+1)/2)+i/Math.cosh(e-e*(e*e+1)/2);return Tt([t,e],[a,c],o)}function gr([t,e],{center:n=[0,0],exchangeInputs:s=!1}){const[r,i]=s?[n[1],n[0]]:n;return Math.atan2(e-i,t-r)/st}function cc(t,e,n=!0){if(t<=e[0])return e[0];let s=0;for(;s<e.length-1;){if(t<=e[s+1])return n?t-e[s]<e[s+1]-t?e[s]:e[s+1]:e[s];s++}return e[e.length-1]}function Bd(t,e=[-1,1]){const n=[];if(t>1)for(let s=0;s<=t;s++)n.push(e[0]+(e[1]-e[0])*s/t);return n}function Td(t,e,n,s,r=!0){const i=n.amplitude?n.amplitude:1;let[o,a]=e;n.scale&&(o*=n.scale[0],a*=n.scale[1]);let c=t(n.exchangeInputs?[a,o]:[o,a],n);return s==null||s.length==0?c*i:i*cc(c,s,r)}function kd(t,e,n,s,r=!0){if(hr[t])return Td(hr[t],e,n,s,r);throw new Error(`noise '${t}' is not implemented.`)}function to(t,{type:e="perlin",opts:n={scale:[1,1]},rotation:s=0,conversion:r="multiplyByPI",quantizationArray:i=[],quantizeToClosest:o=!0}){const a=e||"perlin";if(a==="radial"){const[f,d]=n.exchangeInputs?[t[1],t[0]]:t;return i==null||i.length==0?gr([f,d],n)*st:cc(gr([f,d],n),i,o)*st}const c=kd(a,t,n,i,o),l=n.amplitude?n.amplitude:1;let u=1;switch(r){case"aCos":u=s+Math.acos(c/l);break;case"aSin":u=s+Math.asin(c/l);break;default:u=s+st*c}return Wl(u)}const Pd=async t=>{const e=[];return t.length>0&&e.push(...(await Promise.all(t.map(n=>h1(n)))).map(n=>_1(n,y1))),e},Gd={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>t[e+1][1]},Ud=(t,e)=>new Te(Gd,t,e);function lc(t,e){for(const n of e)if(jt(n,t))return!0;return!1}function Fn(t,e){let n=0;for(const s of e){if(jt(s,t))return n;n++}return-1}const We=t=>[((t=Math.floor(t))>>16&255)/255,(t>>8&255)/255,(255&t)/255],Vs=(t,e)=>t==="hermite"?ud(e):t==="linear"?dd(e):Ud(e),Fd=(t,e,n,s)=>{const[r,i]=es([],e,n,s,[0,0],[t.width,t.height]);return t.getAt(Math.floor(r),Math.floor(i))},qt=(t,e,n)=>ml(t,e,n)(),zn=0xfffffffffn,zd=t=>new Uint32Array([Number(t>>96n&zn),Number(t>>64n&zn),Number(t>>32n&zn),Number(t&zn)]),Hd=t=>zd(BigInt("0x"+t.replace(/-/g,"").substring(0,32))),qd=(t,e,n=lt)=>{for(let s=t.length;s-- >0;)if(n(e,t[s]))return s;return-1};[...Ji(10,Ki([0,0,.102],[.933,.996,1])).map(t=>sr(Re(null,Qi(.8),t)))],[...Ji(10,Ki([.067,0,0,1],[1,.996,.933,1])).map(t=>sr(Re(null,Qi(.8),t)))];const eo={0:[2120566,15130821,16291640,13845523,271427,.01,1.01,1.1],1:[4562234,16777215,6596594,4145473,1973791,0,1,1.2],2:[4470864,12303972,15397070,12633537,8225937,0,1.05,1.5],3:[13354938,15131351,2633011,3159101,4540754,.03,1,1],5:[12442047,3031122,16762967,16777215,4268596,-.03,1,1.5],6:[16250866,12965997,2497557,15001283,15752483,0,1,1],7:[5871085,279433,16580427,16755973,8171460,-.04,1,1.2],8:[13762590,2589067,7179309,15508269,15425574,.01,1,1],9:[1529984,16708813,10072218,7631457,2766650,0,1,1.02],11:[11907778,5930364,14344183,2305075,10535377,0,1,1.1],12:[10289158,1659231,6661793,15566395,15354668,0,1,1],13:[13515281,469832,2384251,16707790,16288806,.01,1,1.15],14:[13553870,1644825,15814693,16777215,15132902,0,1,1.15],15:[1317406,15791103,4211788,3751743,2041382,0,1,1],16:[657672,2241339,15392981,13020303,6180927,0,1,1.9],17:[3368330,8829912,7704143,16166445,15885337,0,1,1.12],18:[16711422,16168524,15351084,3817281,6535886,0,1,1.1],19:[7289398,13139994,14797476,9608602,5534304,0,1,1.2],20:[13859385,13784116,7498570,15786420,15508823,0,1,1.1],21:[9831194,16427286,16515070,7169902,1776414,0,1,1.1],22:[42733,8370176,863316,16142621,16757760,0,1.02,1.1],23:[5777159,9907463,16730942,16757263,16770376,0,1.01,1.05],24:[15718311,3939072,8763312,15848851,16328960,0,1,1.26],27:[6124414,16579836,135451,4145221,3156271,0,1,2],28:[9947562,13732155,15702825,3610381,13942932,0,1.05,1.2],29:[14303591,16044894,16177326,3031127,540023,0,1.02,1.1],30:[14155826,2829634,9279918,15594228,15672124,0,1,1],31:[6575426,8371106,16119484,15051558,12471335,0,1,1.15],32:[15125682,14530706,11569512,8344889,10249796,0,1.03,1.05],34:[2994148,13099310,16120284,3223857,4036282,0,1.02,1.2],35:[2735890,11272015,572861,15866687,16750868,0,1.05,1.1],36:[402725,1332558,15194544,16034598,792857,.01,1.03,1.04],37:[4004864,8763055,15783315,16263680,15718568,0,1.03,1.04],38:[15971407,15193272,14338478,1844529,16400720,.01,1.04,1.3],40:[14719784,15459775,2831168,1916524,5136224,0,1.03,1.07],41:[9667969,12965348,8283473,4612962,8951467,0,1.05,1.6],42:[1716574,10208227,15266296,3770568,15821646,0,1,1.15],44:[16706750,16154427,16008999,2952226,16245696,0,1.01,1.02],45:[14342093,10727818,5800279,3824192,3427905,0,1.03,1.16],47:[2508371,2792847,15320170,16032353,15167313,0,1,1.12],48:[6319160,2635288,16710368,14524766,12348453,0,1.03,1.1],49:[15260604,8761251,0,5308418,11494980,0,1,1],50:[3084589,12921662,8323635,16702104,8323635]};Object.keys(eo).map(t=>{const e=eo[t];return[We(e[4]),We(e[0]),We(e[1]),We(e[2]),We(e[3])]});const Vd=(t,e)=>Yd(j1(t.map(n=>ws(n)),xa,e)),Yd=t=>({bg:[t[0]],fg:t.slice(1).reverse()}),uc=(t,e,n,s=.001,r=!0)=>fn(t.supportData.distanceToCenter,0,e,r?n:s,r?s:n),Wd=t=>Math.sqrt(Math.pow(t/2,2)+Math.pow(.5,2)),jd=(t,e,n,s)=>(n===void 0&&(n=-e/2),s===void 0&&(s=e/2),et(t[0],n,s,0,1)),Xd=(t,e)=>{let n;return(t.update!==void 0||e.update!==void 0)&&(n=(s,r)=>Math.min(t.update?t.update(s,r):Number.MAX_VALUE,e.update?e.update(s,r):Number.MAX_VALUE)),{get:(s,r)=>Math.min(t.get(s,r),e.get(s,r)),update:n,info:"min("+t.info+", "+e.info+")",aux:t.aux}},Ht=(t,e=0,n=1,s={},r=!1)=>{let i=[],o=0,a=1,c=t,l=0,u=s.cutoff??0,f=s.valueTransform??(g=>g),d=s.outputTransform??(g=>g);t==="width"||t==="height"?(i=t==="width"?["pos",0]:["pos",1],o=s.minValue??-.5,a=s.maxValue??.5):t==="agent ID"||t==="agent generation"?(i=t==="agent ID"?["ID"]:["generation"],o=s.minValue??0,a=s.maxValue??1):t==="space traveled"?(i=["spaceTraveled"],o=s.minValue??0,a=s.maxValue??1,l=1):t==="distance from center"&&(o=s.minValue??0,a=s.maxValue??Math.SQRT2);const h=(g,p)=>{const _=l===0?g:p;let m=0;if(i.length>0){const D=_[i[0]];i.length>1?m=D[i[1]]:m=D}m=f(m);let M=0;switch(t){case"random":M=s.rnd.minmax(e,n);break;case"distance from center":M=uc(g,a,e,n);break;case"pos inside bounds":lc(g.pos,s.bounds)?M=e:M=n;break;case"image luminance":if(g.supportData.features&&g.supportData.features.length>s.imageIndex){const D=q1(g.supportData.features[s.imageIndex]);D<u?M=1e-5:M=fn(D,o,a,e,n)}else M=a;break;default:M=fn(m,o,a,e,n);break}return d(M)};return{get:(g,p)=>h(g,p),update:r?(g,p)=>h(g,p):void 0,info:c,aux:[e,n]}};function xd(t,e,n,{decimatePercentage:s=0,elasticity:r=[0,0],minSize:i=.01,margin:o=0,shakeAmount:a=[[0,0],[0,0]],shuffleResult:c=!1},l){let u=n,f=e;Array.isArray(e)&&Array.isArray(n)?l.probability(.5)?u=Array.isArray(n)?l.minmaxInt(n[0],n[1]+1):n:f=Array.isArray(e)?l.minmaxInt(e[0],e[1]+1):e:v(n)&&v(e)&&(l.probability(.5)?u=[n,n]:f=[e,e]);let d=v(u)?0:1,h=t;if(d===1){let m=u;u=f,f=m,h=vn([t.pos[1],t.pos[0]],[t.size[1],t.size[0]])}const g=Zd(h,u,f,r,i,o,l),p=[...td(g)];d===1&&p.forEach(m=>{m.pos=[m.pos[1],m.pos[0]],m.size=[m.size[1],m.size[0]]});const _=Math.floor(p.length*s);return _>0&&Kd(p,_,l),Jd(p,a[0],a[1],l),c&&nd(p,p.length,l),p}function Zd(t,e,n,s,r,i=0,o){const a=[];for(let c=0;c<e;c++){const l=[];a.push(l);let u=Array.isArray(n)?o.minmaxInt(n[0],n[1]+1):n;const f=[(t.size[0]-(u+1)*i)/u,(t.size[1]-(e+1)*i)/e];if(s[0]===0&&s[1]===0||f[0]<=r||u===1)for(let d=0;d<u;d++){const h=vn([t.pos[0]+i+d*(f[0]+i),t.pos[1]+i+c*(f[1]+i)],[f[0],f[1]]);l.push(h)}else{let d=t.pos[0]+i,h=t.pos[1]+i+c*(f[1]+i);for(let g=0;g<u;g++){let p=Math.min(Math.max(f[0]+o.minmax(s[0],s[1]),r),t.pos[0]+t.size[0]-((u-(g+1))*(r+i)+d+i));g===u-1&&(p=t.pos[0]+t.size[0]-i-d);const _=vn([d,h],[p,f[1]]);d+=p+i,l.push(_)}}}return a}function Jd(t,[e,n],[s,r],i){return t.forEach(o=>{const a=i.minmax(e,n),c=i.minmax(s,r);o.pos=[o.pos[0]+a,o.pos[1]+c]}),t}function Kd(t,e,n){for(let s=0;s<e;s++){const r=n.minmaxInt(0,t.length);t.splice(r,1)}return t}const Qd=Object.freeze([1,0,0,1]),th=Object.freeze([1,0,0,0,1,0,0,0,1]),fc=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),rs={default:{matrix:fc,offset:[0,0,0,0]}},eh={brightness:0,contrast:0,filterMatrix:rs.default.matrix,filterOffset:rs.default.offset,exposure:0,saturation:0,simmetry:0,info:"default"};function nh(t){const e=1+t,n=.2126,s=.7152,r=.0722,i=(1-e)*n,o=(1-e)*s,a=(1-e)*r;return[i+e,i,i,0,o,o+e,o,0,a,a,a+e,0,0,0,0,1]}function ei(t){const e=nh(t.saturation||0);let n=t.filterMatrix||rs.default.matrix,s=t.filterOffset||rs.default.offset;return J1(ec(t.brightness||0),K1(1+(t.contrast||0),-.5*(t.contrast||0)),Q1(1+(t.exposure||0)),[e[0],e[4],e[8],e[12],0,e[1],e[5],e[9],e[13],0,e[2],e[6],e[10],e[14],0,e[3],e[7],e[11],e[15],0],[n[0],n[4],n[8],n[12],s[0],n[1],n[5],n[9],n[13],s[1],n[2],n[6],n[10],n[14],s[2],n[3],n[7],n[11],n[15],s[3]])}function sh(t,e){const n=ei(e);t.colors.bg=t.colors.bg.map(s=>Re([],n,cn(s))),t.colors.fg=t.colors.fg.map(s=>Re([],n,cn(s))),t.background?.colors&&(t.background.colors=t.background.colors.map(s=>Re([],n,cn(s))))}const rh=["20d57945-4f8b-442e-b79a-112515735693","5d030ffe-89fb-4fb8-b791-da6eae875996","4f706548-1d55-4e4a-bdda-a701d6f65065","15e0343b-7b0e-4406-a41c-e22ce873dc58","bca582ba-2e02-4282-9b46-f604d4255c4c","9677cb84-e6c2-4e43-89b0-51d8d5f19eb0","e2b971ea-ccdb-48d4-b278-7fd57c2ffef7","e882f2f7-2556-4e70-8d54-120c139e2a7c"],no={parcel:["#DBCBB2","#0A121C"],dark:["#111111","#FCFCFC"],blueprint_dark:["#191B27","#D2D4C5"],grey:["#373737","#D9D9D9"],severance:["#BBCFD4","#1B2937","#5C7F68","#223C33"]},ih=(t,e,n)=>({name:"area_lights",background:({bounds:s,colors:r,scalingFactor:i})=>({shapes:s.aux,fill:E([[0,1,0],[0,1,0,1]],t.RND_STYLE),draw:E([[1],[1,1,1,0]],t.RND_STYLE),weights:s.aux.map(()=>1.5*t.RND_STYLE.minmaxInt(1,5)*i),rounds:[0],colors:r.fg,info:"all-inverted"}),aspectRatio:e/n,halfDiagonal:({aspectRatio:s})=>Wd(s),scalingFactor:.3*Math.max(e,n)/1e3,gridSize:[e,n],assets:["./assets/"+E(["skagen.jpeg","contorted-wood.jpg"],t.RND_STYLE)],style:({aspectRatio:s,bounds:r})=>{const i={type:"line | sanding",alphaDecay:c=>c*c/1.5,grainsFactorRange:[100,725],minAlpha:.001,followBounds:!0,sizeFactor:E([.35,.5],t.RND_STYLE),doubleSided:!1,sameStyleOutsideBounds:t.RND_STYLE.probability(.2),sandedLineProbability:t.RND_STYLE.minmax(.9,1),sameWeightFactor:t.RND_STYLE.probability(.5),allSanded:t.RND_STYLE.probability(.6),maxLength:[.05,.2],multiplyByImageLuminance:{index:-1,range:[0,1]}};return{aux:i,get:(c,l)=>{const u=jt(xs([0,0],.45*s),c.pos);let f=c.pos[0]>(.25-.5)*s||c.pos[0]<(.75-.5)*s?1:.5;return f*=c.pos[1]>.25-.5||c.pos[1]<.75-.5?1:.5,{...i,type:t.RND_STYLE.probability(i.sandedLineProbability)&&(u||i.allSanded)?"line | sanding":"line",grainsFactor:t.RND_STYLE.minmaxInt(i.grainsFactorRange[0],i.grainsFactorRange[1]),maxLength:t.RND_STYLE.minmax(i.maxLength[0],i.maxLength[1])*f,sizeFactor:i.sameWeightFactor?i.sizeFactor:E([.35,.5,1],t.RND_STYLE),followBounds:!0}},update:(c,l)=>({type:c.attribs.style.type==="line"?"line":i.sameStyleOutsideBounds||lc(c.pos,r.aux)?"line | sanding":t.RND_STYLE.probability(.95)?"line":"line | sanding"})}},colors:()=>{const s=dl(no,t.RND_COLORS),r={...Vd(no[s]),info:s};return{fg:[r.fg[0]],bg:r.bg,info:r.info}},vector_field:({aspectRatio:s,agentFactory:r,bounds:i,halfDiagonal:o})=>{const a=[],c=t.RND_NOISE.minmaxInt(2,8),l=[];for(let m=0;m<c;m++)a.push({...bd(t.RND_NOISE,["sinTimesCos","sinPlusCos","sinPlusSin","cos","sin","hopalong","clifford","deJong","gumowskiMira","fractalDream","perlin","macMillan"]),rotation:0,quantizationArray:qt([[],Bd(t.RND_NOISE.minmaxInt(3,10))],[6,1],t.RND_NOISE),conversion:E(["aCos"],t.RND_NOISE)}),l.push(a[m]);const u=[[0,0],[.2,1],[.4,0],[.6,0],[.8,1],[1,0]],f=qt([Vs("hermite",u),Vs("linear",u),Vs("step",u)],[2,2,2],t.RND_NOISE),d="space traveled",h=["id","width","bounds-interp","distanceFromCenter","generation","id-nomix"],g=E(h,t.RND_NOISE);return{aux:l,info:{interpolatedBy:d,choice:g},get:(m,M)=>{const D=h[Math.floor(M.iterations/5e3)%h.length],N=[];for(let L=0;L<c;L++)N.push(to(m.pos,a[L]));const kt=N[0];let Pt=f.at(M.spaceTraveled/r.maxSpaceTraveled);if(D==="id-nomix"){const L=m.ID%(c-1);return N[L+1]}else if(D==="id"){const L=m.ID%(c-1);return ne(kt,N[L+1],Pt)}else if(D==="bounds-interp"){const L=Fn(m.pos,i.aux);return L<0?kt:ne(kt,N[L%(c-1)+1],Pt)}else if(D==="distanceFromCenter"){const L=m.supportData.distanceToCenter/o,Gt=Math.floor(L*(c-1));return ne(kt,N[Gt+1],Pt)}else if(D==="generation"){const L=m.generation%(c-1)/(c-1),Gt=Math.floor(L*(c-1));return ne(kt,N[Gt+1],Pt)}else{const L=jd(m.pos,s),Gt=Math.floor(L*(c-1));return ne(kt,N[Gt+1],Pt)}},getAt:(m,M)=>to(m,a[0])}},agentFactory:({bounds:s})=>{let r=0;for(const i of s.aux)r+=se(i);return{maxNewPerIteration:10,maxIterations:E([4e3],t.RND_SYSTEM),maxSpaceTraveled:qt([20,30,40,50,60,80,100],[r<.25?1:0,r>.2&&r<.4?1:0,r>.35?1:0,r>.35?1:0,r>.4?1:0,r>.4?1:0,r>.45?1:0],t.RND_SYSTEM),newPerIteration:0,maxActive:50,branch:t.RND_SYSTEM.minmaxInt(2,8),initialAgents:30,maxAgents:E([2e4],t.RND_SYSTEM),directions:[[0,1],[0,-1],[1,0],[-1,0]],initPolicy:i=>i.agents.length<30?"randomFree":"randomOccupied",neverEnding:!0,maxColliding:1e3}},agent:()=>{const s=E([[2,2],[1,2],[.5,1],[.1,.5],[.1,.2],[.03,.05]],t.RND);return{get:r=>({angled:!1,step:.01,fuzziness:0,chance:1,maxLength:t.RND.minmax(s[0],s[1]),maxIteration:1e3,minSpaceBeforeDrawing:.3/Math.max(e,n)})}},bounds:({aspectRatio:s})=>{const r=Ze([0,0],[s,1]),i=Ze([0,0],[s-.3,.7]);let o=t.RND_BOUNDS.probability(.5);const a=o?[i]:[r];let c=[r];t.RND_BOUNDS.minmaxInt(1,24);const l=E([t.RND_BOUNDS.minmaxInt(2,7),[2,6]],t.RND_BOUNDS),u=E([t.RND_BOUNDS.minmaxInt(1,5),[1,4]],t.RND_BOUNDS);c=xd(o?Ze([0,0],[s-.25,.75]):Ze([0,0],[s-.15,1-.15]),u,l,{decimatePercentage:qt([0,t.RND_BOUNDS.minmax(0,.3)],[1,2],t.RND_BOUNDS),elasticity:[-.2,.2],minSize:.05,margin:t.RND_BOUNDS.minmax(.01,.02),shuffleResult:t.RND_BOUNDS.probability(.5),shakeAmount:E([void 0,[[-.002,.002],[-.002,.002]]],t.RND_BOUNDS)},t.RND_BOUNDS);let f=c;return{get:d=>({init:f,update:c,overall:a}),aux:f,info:f.length}},stroke:({colors:s,bounds:r,background:i})=>{const o=(a,c)=>{const l=Fn(a.pos,r.aux);return l<0||i?.fill[l%i.fill.length]===0?s.fg[0]:s.bg[0]};return qt([{info:"true inverted",get:o,update:o},{info:"inverted",get:(a,c)=>{const l=Fn(a.pos,r.aux);return l<0||l%2===0?s.fg[0]:s.bg[0]},update:a=>{const c=Fn(a.pos,r.aux);return c<0||c%2===1?s.fg[0]:s.bg[0]}},{info:"fg",get:(a,c)=>s.fg[0]}],[5,0,1],t.RND_STYLE)},weight:({agentFactory:s,halfDiagonal:r,bounds:i,scalingFactor:o})=>{const a=o,[c,l]=E([[7.5*a,.75*a],[9*a,.75*a]],t.RND_STYLE);return qt([Xd({get:(u,f)=>fn(u.ID%s.maxAgents,0,s.maxAgents,c,l),info:"agent ID",aux:[c,l]},Ht("distance from center",c,l,{maxValue:r*.75},!0)),Ht("pos inside bounds",c,l,{bounds:i.aux},!0),Ht("pos inside bounds",c,0,{bounds:i.aux},!0),{...Ht("random",l,c,{rnd:t.RND_STYLE}),update:u=>{const f=Math.min(u.attribs.weight,uc(u,r*.75,c));return u.history.length<.008&&f<6?4.5*o:f},info:"random / distance from center"},Ht("distance from center",c*.75,l,{maxValue:r*.75},!0)],[1,1,1,1,1],t.RND_STYLE)},alpha:({agentFactory:s,bounds:r})=>{const[i,o]=E([[.81,.2],[.5,.02],[1,.01]],t.RND_STYLE);return E([{get:(a,c)=>fn(a.ID%s.maxAgents,0,s.maxAgents,i,o),info:"agent ID",aux:[i,o]},Ht("pos inside bounds",i,o,{bounds:r.aux},!0),Ht("random",o,i,{rnd:t.RND_STYLE}),Ht("image luminance",0,1,{imageIndex:0},!1)],t.RND_STYLE)},postprocess:{...eh,fadeAmount:.001}}),oh=Sn(()=>"WebGL"),T=t=>{throw new oh(t)},ah={alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},ch=(t={})=>{const e=t.canvas?k(t.canvas)?document.getElementById(t.canvas):t.canvas:document.createElement("canvas");t.width&&(e.width=t.width),t.height&&(e.height=t.height),t.autoScale!==!1&&ir(e,e.width,e.height),t.parent?.appendChild(e);const n=e.getContext(t.version!==1?"webgl2":"webgl",{...ah,...t.opts});return n||T("WebGL unavailable"),t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost),{canvas:e,gl:n,ext:dc(n,t.ext),resize:(s,r)=>{ir(e,s,r,t.autoScale!==!1?window.devicePixelRatio:1),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight)}}},dc=(t,e,n=!0)=>{const s={};if(e)for(let r of e)s[r]=t.getExtension(r),n&&!s[r]&&T(`extension ${r} not available`);return s},Xt=(t,e,n=!0)=>{let s;n&&(s=e.fill)&&s!=="none"&&((s=e.fillRule)?t.fill(s):t.fill()),(s=e.stroke)&&s!=="none"&&t.stroke(),(s=e.clip)&&t.clip(s===!0?"nonzero":s)},mr=(t,e,n,s,r=0,i=O,o=!1)=>{t.beginPath(),t.arc(n[0],n[1],s,r,i,o),Xt(t,e)},pr=(t,e,n,s,r=0,i=0,o=O,a=!1)=>{t.beginPath(),t.ellipse(n[0],n[1],s[0],s[1],r,i,o,a),Xt(t,e)},ni=sr,Es=(t,e)=>k(e)?e[0]==="$"?t.grads[e.substring(1)]:e:ni(e),hc=(t,{from:e,to:n},s)=>{const r=t.createLinearGradient(e[0],e[1],n[0],n[1]);for(let i of s)r.addColorStop(i[0],ni(i[1]));return r},gc=(t,{from:e,to:n,r1:s,r2:r},i)=>{const o=t.createRadialGradient(e[0],e[1],s,n[0],n[1],r);for(let a of i)o.addColorStop(a[0],ni(a[1]));return o},mc=(t,e,{width:n,height:s},r,i,o,a)=>{if(at(r,"toImageData")&&(r=r.toImageData()),r instanceof ImageData){t.putImageData(r,i[0],i[1]);return}n=n||r.width,s=s||r.height,o?t.drawImage(r,o[0],o[1],a?a[0]:n,a?a[1]:s,i[0],i[1],n,s):t.drawImage(r,i[0],i[1],n,s)},lh={align:"left",alpha:1,baseline:"alphabetic",compose:"source-over",dash:[],dashOffset:0,direction:"inherit",fill:"#000",filter:"none",font:"10px sans-serif",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",shadowX:0,shadowY:0,smooth:!0,stroke:"#000",weight:1},pc={align:"textAlign",alpha:"globalAlpha",baseline:"textBaseline",clip:"clip",compose:"globalCompositeOperation",dash:"setLineDash",dashOffset:"lineDashOffset",direction:"direction",fill:"fillStyle",fillRule:"fillRule",filter:"filter",font:"font",lineCap:"lineCap",lineJoin:"lineJoin",miterLimit:"miterLimit",shadowBlur:"shadowBlur",shadowColor:"shadowColor",shadowX:"shadowOffsetX",shadowY:"shadowOffsetY",smooth:"imageSmoothingEnabled",stroke:"strokeStyle",weight:"lineWidth"},so=(t,e=!1)=>({attribs:{...t.attribs},grads:{...t.grads},edits:[],restore:e}),uh=(t,e,n)=>{let s;if(n){dh(t,n)&&(s=so(e,!0));for(let r in n){const i=pc[r];if(i){const o=n[r];o!=null&&e.attribs[r]!==o&&(!s&&(s=so(e)),s.attribs[r]=o,s.edits.push(r),bc(t,e,r,i,o))}else(r==="__background"||r==="__clear")&&(t.save(),t.resetTransform(),r==="__clear"?n[r]&&t.clearRect(0,0,t.canvas.width,t.canvas.height):(t.fillStyle=Es(e,n[r]),t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.restore())}return s}},fh=(t,e,n)=>{if(n.restore){t.restore();return}const s=n.edits,r=e.attribs;for(let i=s.length;i-- >0;){const o=s[i],a=r[o];bc(t,e,o,pc[o],a??lh[o])}},ro=(t,e,n)=>{!t.grads&&(t.grads={}),t.grads[e]=n},bc=(t,e,n,s,r)=>{switch(n){case"fill":case"stroke":case"shadowColor":t[s]=Es(e,r);break;case"dash":t[s].call(t,r);break;case"clip":case"fillRule":break;default:t[s]=r}},dh=(t,e)=>{let n;return(n=e.transform)||e.setTransform||e.translate||e.scale||e.rotate?(t.save(),n?t.transform(n[0],n[1],n[2],n[3],n[4],n[5]):(n=e.setTransform)?t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]):((n=e.translate)&&t.translate(n[0],n[1]),(n=e.rotate)&&t.rotate(n),(n=e.scale)&&(gs(n)?t.scale(n[0],n[1]):t.scale(n,n))),!0):!1},Mt=(t,e,n,s)=>{e.stroke!=="none"&&(t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(s[0],s[1]),t.stroke())},br=(t,e,n)=>{if(e.stroke!=="none"){t.beginPath();for(let{0:s,1:r}of n)t.moveTo(s[0],s[1]),t.lineTo(r[0],r[1]);t.stroke()}},_r=(t,e,n,s)=>{let r;(r=e.fill)&&r!=="none"&&io(t,n,s,"fill","fillRect"),(r=e.stroke)&&r!=="none"&&io(t,n,s,"stroke","strokeRect")},io=(t,e,n,s,r)=>{const{start:i=0,cstride:o=1,estride:a=2,size:c=1}=e;let l=e&&e.num!=null?e.num:(n.length-i)/a|0;if(e.shape==="circle")for(let u=i;l-- >0;u+=a)t.beginPath(),t.arc(n[u],n[u+o],c,0,O),t[s]();else{const u=c/2;for(let f=i;l-- >0;f+=a)t[r](n[f]-u,n[f+o]-u,c,c)}},vr=(t,e,n)=>{t.beginPath();let s=[0,0];for(let r=0,i=n.length;r<i;r++){const o=n[r];let a=o[1],c,l;switch(o[0]){case"m":a=[s[0]+a[0],s[1]+a[1]];case"M":t.moveTo(a[0],a[1]),s=a;break;case"l":a=[s[0]+a[0],s[1]+a[1]];case"L":t.lineTo(a[0],a[1]),s=a;break;case"h":a=[s[0]+a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"H":a=[a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"v":a=[s[0],s[1]+a],t.lineTo(a[0],a[1]),s=a;break;case"V":a=[s[0],a],t.lineTo(a[0],a[1]),s=a;break;case"c":c=o[2],l=o[3],l=[s[0]+l[0],s[1]+l[1]],t.bezierCurveTo(s[0]+a[0],s[1]+a[1],s[0]+c[0],s[1]+c[1],l[0],l[1]),s=l;break;case"C":c=o[2],l=o[3],t.bezierCurveTo(a[0],a[1],c[0],c[1],l[0],l[1]),s=l;break;case"q":c=o[2],c=[s[0]+c[0],s[1]+c[1]],t.quadraticCurveTo(s[0]+a[0],s[1]+a[1],c[0],c[1]),s=c;break;case"Q":c=o[2],t.quadraticCurveTo(a[0],a[1],c[0],c[1]),s=c;break;case"A":case"a":{c=o[2],l=o[6],o[0]==="a"&&(l=[s[0]+l[0],s[1]+l[1]]);const{center:[u,f],start:d,end:h}=Hu(s,l,[a,c],o[3],o[4],o[5]);t.ellipse(u,f,a,c,o[3],d,h,!o[5]),s=l;break}case"r":c=o[2],c=[s[0]+c[0],s[1]+c[1]],t.arcTo(s[0]+a[0],s[1]+a[1],c[0],c[1],o[3]),s=c;break;case"R":c=o[2],t.arcTo(a[0],a[1],c[0],c[1],o[3]),s=c;break;case"z":case"Z":t.closePath()}}Xt(t,e)},yr=(t,e,n,s)=>{let r;(r=e.fill)&&r!=="none"&&oo(t,n,s,"fill","fillRect"),(r=e.stroke)&&r!=="none"&&oo(t,n,s,"stroke","strokeRect")},oo=(t,e,n,s,r)=>{const i=e?.size||1;if(e.shape==="circle")for(let o of n)t.beginPath(),t.arc(o[0],o[1],i,0,O),t[s]();else{const o=i/2;for(let a of n)t[r](a[0]-o,a[1]-o,i,i)}},Ar=(t,e,n)=>{n.length<2||(_c(t,n),t.closePath(),Xt(t,e))},wr=(t,e,n,s)=>{s.length<2||(vc(t,n,s),t.closePath(),Xt(t,e))},_c=(t,e)=>{let n=e[0];t.beginPath(),t.moveTo(n[0],n[1]);for(let s=1,r=e.length;s<r;s++)n=e[s],t.lineTo(n[0],n[1])},vc=(t,e,n)=>{const{start:s=0,cstride:r=1,estride:i=2}=e;let o=e?.num??(n.length-s)/i|0;t.beginPath(),t.moveTo(n[s],n[s+r]);for(let a=s+i;o-- >1;a+=i)t.lineTo(n[a],n[a+r])},Er=(t,e,n)=>{n.length<2||e.stroke=="none"||(_c(t,n),Xt(t,e,!1))},Rr=(t,e,n,s)=>{s.length<2||(vc(t,n,s),Xt(t,e,!1))},Sr=(t,e,n,s,r,i)=>{let o;if(i!==void 0){t.beginPath(),t.roundRect(n[0],n[1],s,r,i),Xt(t,e);return}(o=e.fill)&&o!=="none"&&t.fillRect(n[0],n[1],s,r),(o=e.stroke)&&o!=="none"&&t.strokeRect(n[0],n[1],s,r)},yc=(t,e,n,s,r)=>{let i;(i=e.fill)&&i!=="none"&&t.fillText(s.toString(),n[0],n[1],r),(i=e.stroke)&&i!=="none"&&t.strokeText(s.toString(),n[0],n[1],r)},yn=(t,e,n={attribs:{},edits:[]})=>{if(!e)return;if(at(e,"toHiccup")){yn(t,e.toHiccup(),n);return}if(S(e[0])){for(let o of e)yn(t,o,n);return}const s=e[1];if(s?.__skip)return;const r=uh(t,n,s),i=r?r.attribs:n.attribs;switch(e[0]){case"g":case"defs":hh(t,r,n,e);break;case"linearGradient":ro(n,s.id,hc(t,s,e[2]));break;case"radialGradient":ro(n,s.id,gc(t,s,e[2]));break;case"points":yr(t,i,s,e[2]);break;case"packedPoints":_r(t,i,s,e[2]);break;case"line":Mt(t,i,e[2],e[3]);break;case"lines":br(t,i,e[2]);break;case"hline":Mt(t,i,[-1e6,e[2]],[1e6,e[2]]);break;case"vline":Mt(t,i,[e[2],-1e6],[e[2],1e6]);break;case"polyline":Er(t,i,e[2]);break;case"packedPolyline":Rr(t,i,s,e[2]);break;case"polygon":Ar(t,i,e[2]);break;case"packedPolygon":wr(t,i,s,e[2]);break;case"path":vr(t,i,e[2]);break;case"rect":Sr(t,i,e[2],e[3],e[4],e[5]??s?.r);break;case"circle":case"arc":mr(t,i,e[2],e[3],e[4],e[5],e[6]);break;case"ellipse":pr(t,i,e[2],e[3],e[4],e[5],e[6],e[7]);break;case"text":yc(t,i,e[2],e[3],e[4]);break;case"img":mc(t,i,s,e[2],e[3],e[4],e[5])}r&&fh(t,n,r)},hh=(t,e,n,s)=>{const r=s.length,i=s[0]==="g"&&e||n;for(let o=2;o<r;o++)yn(t,s[o],i)},gh={align:"left",alpha:1,baseline:"alphabetic",compose:"source-over",dash:[],dashOffset:0,direction:"inherit",fill:"#000",filter:"none",font:"10px sans-serif",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",shadowX:0,shadowY:0,smooth:!0,stroke:"#000",weight:1},Ac={align:"textAlign",alpha:"globalAlpha",baseline:"textBaseline",clip:"clip",compose:"globalCompositeOperation",dash:"setLineDash",dashOffset:"lineDashOffset",direction:"direction",fill:"fillStyle",fillRule:"fillRule",filter:"filter",font:"font",lineCap:"lineCap",lineJoin:"lineJoin",miterLimit:"miterLimit",shadowBlur:"shadowBlur",shadowColor:"shadowColor",shadowX:"shadowOffsetX",shadowY:"shadowOffsetY",smooth:"imageSmoothingEnabled",stroke:"strokeStyle",weight:"lineWidth"},ao=(t,e=!1)=>({attribs:{...t.attribs},grads:{...t.grads},edits:[],restore:e}),co=(t,e,n)=>{let s;if(n){mh(t,n)&&(s=ao(e,!0));for(let r in n){const i=Ac[r];if(i){const o=n[r];o!=null&&e.attribs[r]!==o&&(!s&&(s=ao(e)),s.attribs[r]=o,s.edits.push(r),wc(t,e,r,i,o))}else(r==="__background"||r==="__clear")&&(t.save(),t.resetTransform(),r==="__clear"?n[r]&&t.clearRect(0,0,t.canvas.width,t.canvas.height):(t.fillStyle=Es(e,n[r]),t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.restore())}return s}},lo=(t,e,n)=>{if(n.restore){t.restore();return}const s=n.edits,r=e.attribs;for(let i=s.length;i-- >0;){const o=s[i],a=r[o];wc(t,e,o,Ac[o],a??gh[o])}},uo=(t,e,n)=>{!t.grads&&(t.grads={}),t.grads[e]=n},wc=(t,e,n,s,r)=>{switch(n){case"fill":case"stroke":case"shadowColor":t[s]=Es(e,r);break;case"dash":t[s].call(t,r);break;case"clip":case"fillRule":break;default:t[s]=r}},mh=(t,e)=>{let n;return(n=e.transform)||e.setTransform||e.translate||e.scale||e.rotate?(t.save(),n?t.transform(n[0],n[1],n[2],n[3],n[4],n[5]):(n=e.setTransform)?t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]):((n=e.translate)&&t.translate(n[0],n[1]),(n=e.rotate)&&t.rotate(n),(n=e.scale)&&(gs(n)?t.scale(n[0],n[1]):t.scale(n,n))),!0):!1};function fo(t){const e=Math.max(0,Math.min(1,t)),n=Math.floor(e*16777215),s=(n>>16&255)/255,r=(n>>8&255)/255,i=(n&255)/255;return[s,r,i,1]}const ph={WEBGL_draw_buffers:{gl:!0,alias:"GL_EXT_draw_buffers"},OES_standard_derivatives:{gl:!0,alias:"GL_OES_standard_derivatives"}};var si=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(si||{});const Ec={fragColor:["vec4",0]};var ke=(t=>(t[t.ALPHA=6406]="ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.R16F=33325]="R16F",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32F=33326]="R32F",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.R8=33321]="R8",t[t.R8_SNORM=36756]="R8_SNORM",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.RED=6403]="RED",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RG16F=33327]="RG16F",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32F=33328]="RG32F",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RG8=33323]="RG8",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RGB=6407]="RGB",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB16I=36233]="RGB16I",t[t.RGB16UI=36215]="RGB16UI",t[t.RGB32F=34837]="RGB32F",t[t.RGB32I=36227]="RGB32I",t[t.RGB32UI=36209]="RGB32UI",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.RGB8=32849]="RGB8",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGB8I=36239]="RGB8I",t[t.RGB8UI=36221]="RGB8UI",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA=6408]="RGBA",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGBA16F=34842]="RGBA16F",t[t.RGBA16I=36232]="RGBA16I",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGBA32F=34836]="RGBA32F",t[t.RGBA32I=36226]="RGBA32I",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGBA4=32854]="RGBA4",t[t.RGBA8=32856]="RGBA8",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGBA8I=36238]="RGBA8I",t[t.RGBA8UI=36220]="RGBA8UI",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t))(ke||{}),Ke=(t=>(t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t))(Ke||{}),Se=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t))(Se||{}),is=(t=>(t[t.LINEAR=9729]="LINEAR",t[t.NEAREST=9728]="NEAREST",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t))(is||{}),os=(t=>(t[t.REPEAT=10497]="REPEAT",t[t.CLAMP=33071]="CLAMP",t[t.REPEAT_MIRROR=33648]="REPEAT_MIRROR",t))(os||{});const b=(t,e,n,s=!1,r=!1,i=s)=>({format:t,types:e,render:s,renderExt:i,filter:r,num:n}),ln={6406:b(6406,[5121,1,5131,2,36193,2,5126,4],1,!0,!0),6402:b(6402,[5123,2,5125,4],1,!0),33189:b(6402,[5123,2,5125,4],1,!0),33190:b(6402,[5125,4],1,!0),36012:b(6402,[5126,4],1,!0),34041:b(34041,[34042,4],1,!0),35056:b(34041,[34042,4],1,!0),36013:b(34041,[36269,4],1,!0),6410:b(6410,[5121,2,5131,4,36193,4,5126,8],2,!0,!0),6409:b(6409,[5121,1,5131,2,36193,2,5126,4],1,!0,!0),35898:b(6407,[5126,12,5131,6,35899,4],3,!1,!0,!0),33325:b(6403,[5126,4,5131,2],1,!1,!0,!0),33331:b(36244,[5122,2],1,!0),33332:b(36244,[5123,2],1,!0),33326:b(6403,[5126,4],1,!1,!1,!0),33333:b(36244,[5124,4],1,!0),33334:b(36244,[5125,4],1,!0),36756:b(6403,[5120,1],1,!1,!0),33321:b(6403,[5121,1],1,!0,!0),33329:b(36244,[5120,1],1,!0),33330:b(36244,[5121,1],1,!0),33327:b(33319,[5126,8,5131,4],2,!1,!0,!0),33337:b(33320,[5122,4],2,!0),33338:b(33320,[5123,4],2,!0),33328:b(33319,[5126,8],2,!1,!1,!0),33339:b(33320,[5124,8],2,!0),33340:b(33320,[5125,8],2,!0),36757:b(33319,[5120,2],2,!1,!0),33323:b(33319,[5121,2],2,!0,!0),33335:b(33320,[5120,2],2,!0),33336:b(33320,[5121,2],2,!0),6407:b(6407,[5121,3,5131,6,36193,6,5126,12,33635,2],3,!0,!0),32857:b(6408,[33640,4],4,!0,!0),36975:b(36249,[33640,4],4,!0),34843:b(6407,[5126,12,5131,6],3,!1,!0),36233:b(36248,[5122,6],3),36215:b(36248,[5123,6],3),34837:b(6407,[5126,12],3),36227:b(36248,[5124,12],3),36209:b(36248,[5125,12],3),32855:b(6408,[5121,4,32820,2,33640,4],4,!0,!0),36194:b(6407,[5121,3,33635,2],3,!0,!0),36758:b(6407,[5120,3],3,!1,!0),32849:b(6407,[5121,3],3,!0,!0),36239:b(36248,[5120,3],3),36221:b(36248,[5121,3],3),35901:b(6407,[5126,12,5131,6,35902,4],3,!1,!0),6408:b(6408,[5121,4,5131,8,36193,8,5126,16,32819,2,32820,2],4,!0,!0),34842:b(6408,[5126,16,5131,8],4,!1,!0,!0),36232:b(36249,[5122,8],4,!0),36214:b(36249,[5123,8],4,!0),34836:b(6408,[5126,16],4,!1,!1,!0),36226:b(36249,[5124,16],4,!0),36208:b(36249,[5125,16],4,!0),32854:b(6408,[5121,4,32819,2],4,!0,!0),36759:b(6408,[5120,4],4,!1,!0),32856:b(6408,[5121,4],4,!0,!0),36238:b(36249,[5120,4],4,!0),36220:b(36249,[5121,4],4,!0),35907:b(6408,[5121,4],4,!0,!0),35905:b(6407,[5121,3],3,!1,!0)},Pe=t=>typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,ho=t=>t.type===Ke.FLOAT||t.type===Ke.HALF_FLOAT||t.type===Ke.HALF_FLOAT_OES||t.type===Ke.FLOAT_32_UNSIGNED_INT_24_8_REV,go=(t,e=new Map)=>n=>{e.has(n)||(e.set(n,!0),t(n))};var ot=(t=>(t.GLES_100="100",t.GLES_300="300 es",t))(ot||{});const Ie="vec2",bh="vec3",Me="vec4",Rc="bool",On="float",Rs="int",ri="uint",Sc="sampler2D",_h="sampler3D",vh=/^[iub]?vec[234]$/,yh=/^mat[234]$/,Ah=t=>Lt(t)&&!!t.tag&&!!t.type,Fe=t=>vh.test(t.type),Ic=t=>yh.test(t.type),he=(t,e,n)=>t===e.type&&n===e.info?e:{tag:"lit",type:t,info:n,val:e},Mc=t=>he(Rc,v(t)?!!t:t),Et=t=>he(On,Cn(t)?t&1:t),ii=t=>he(Rs,Cn(t)?t&1:v(t)?t|0:t),Dc=t=>he(ri,Cn(t)?t&1:v(t)?t>>>0:t),Nc=(t,e)=>n=>v(n)||n!==void 0&&!Fe(n)&&n.type!==t?e(n):n,wh=Nc(On,Et),Eh=Nc(Rs,ii);Mc(!0);Mc(!1);const oi=Et(0),$c=Et(1);Et(2);Et(.5);const Cc=ii(0);ii(1);Dc(0);Dc(1);Et(Math.PI);Et(Math.PI*2);Et(Math.PI/2);Et(Math.SQRT2);Et((1+Math.sqrt(5))/2);const Oc=(t,e)=>n=>[n[0]===void 0?e:t(n[0]),...n.slice(1).map(t)],ai=Oc(wh,oi),Rh=Oc(Eh,Cc),Sh=(t,e="")=>t[0]+e.substring(1),ci=(t,e)=>Fe(t[0])?Sh(t[0].type,e[t.length]):e[t.length],Lc=(t,e,n)=>he(t,n=e(n),ci(n,["n","n"])),Ih=(t,e,n)=>he(t,n=e(n),ci(n,["n","n","vn"])),Mh=(t,e,n)=>he(t,n=e(n),n.length===2?Fe(n[1])?n[0].type[0]+n[1].type[0]:"vn":ci(n,["n","n",void 0,"vnn"]));function li(...t){return Lc(Ie,ai,t)}function ui(...t){return Ih(bh,ai,t)}function Bc(...t){return Mh(Me,ai,t)}function Dh(...t){return Lc("ivec2",Rh,t)}li(0);li(1);li(2);ui(0);ui(1);ui(2);const Nh=t=>t.replace("[]","");let $h=0;const fi=(t="_s")=>`${t}${($h++).toString(36)}`;function tt(t,...e){let n,s,r;switch(e.length){case 0:k(t)||(r=t,t=r.type);break;case 1:k(e[0])?n=e[0]:e[0].tag?r=e[0]:s=e[0];break;case 2:k(e[0])?[n,s]=e:[s,r]=e;break;case 3:[n,s,r]=e;break;default:ct()}return{tag:"sym",type:t,id:n||fi(),opts:s||{},init:r}}const mo=(t,e,n)=>tt(t,e,{q:"in",type:"in",...n}),po=(t,e,n)=>tt(t,e,{q:"out",type:"out",...n}),bo=(t,e,n)=>tt(t,e,{q:"in",type:"uni",...n}),Ch=t=>Bt(e=>e.tag,{},{[X]:e=>At(`no impl for AST node type: '${e.tag}'`),...t}),_o=/[};]$/,Oh=t=>{const e={type:"fs",version:ot.GLES_300,versionPragma:!0,prelude:"",...t},n=e.type==="vs",s=e.prec!==void 0?u=>u===(u|0)?u+".0":u.toFixed(e.prec):u=>u===(u|0)?u+".0":String(u),r=u=>u,i=(u,f=", ")=>u.map(l).join(f),o=u=>`${u.id}(${i(u.args)})`,a=(u,f=!1)=>{const{id:d,type:h,opts:g,init:p}=u,_=[];if(g.type){let m;e.version<ot.GLES_300?n?m={in:"attribute",out:"varying",uni:"uniform"}[g.type]:(m={in:"varying",out:null,uni:"uniform"}[g.type],!m&&At("GLSL 100 doesn't support fragment shader output variables")):(g.loc!=null&&_.push(`layout(location=${g.loc}) `),g.smooth!=null&&_.push(g.smooth+" "),m=g.type==="uni"?"uniform":g.type),_.push(m+" ")}else g.const&&_.push("const "),f&&g.q&&_.push(g.q+" ");return g.prec&&_.push(g.prec+" "),_.push(r(Nh(h))," ",d),g.num&&_.push(`[${g.num}]`),p&&_.push(" = ",l(p)),_.join("")},c=u=>`${l(u.val)}[${l(u.id)}]`,l=Ch({arg:u=>a(u,!0),array_init:u=>e.version>=ot.GLES_300?`${u.type}(${i(u.init)})`:At(`array initializers not available in GLSL ${e.version}`),assign:u=>l(u.l)+" = "+l(u.r),ctrl:u=>u.id,call:o,call_i:u=>u.id==="texture"&&e.version<ot.GLES_300?`${u.id}${u.args[0].type.substring(7)}(${i(u.args)})`:o(u),decl:u=>a(u.id),fn:u=>`${r(u.type)} ${u.id}(${i(u.args)}) ${l(u.scope)}`,for:u=>`for(${u.init?l(u.init):""}; ${l(u.test)}; ${u.iter?l(u.iter):""}) ${l(u.scope)}`,idx:c,idxm:c,if:u=>{const f=`if (${l(u.test)}) `+l(u.t);return u.f?f+" else "+l(u.f):f},lit:u=>{const f=u.val;switch(u.type){case"bool":return Cn(f)?String(f):`bool(${l(f)})`;case"float":return v(f)?s(f):`float(${l(f)})`;case"int":return v(f)?String(f):`int(${l(f)})`;case"uint":return v(f)?`${f}u`:`uint(${l(f)})`;default:return Fe(u)||Ic(u)?`${u.type}(${i(f)})`:At(`unknown type: ${u.type}`)}},op1:u=>u.post?`(${l(u.val)}${u.op})`:`(${u.op}${l(u.val)})`,op2:u=>`(${l(u.l)} ${u.op} ${l(u.r)})`,ret:u=>"return"+(u.val?" "+l(u.val):""),scope:u=>{let f=u.body.map(l).reduce((d,h)=>(d.push(_o.test(h)?h:h+";"),d),[]).join(`
`);return f+=u.body.length&&!_o.test(f)?";":"",u.global?(e.prelude&&(f=e.prelude+`
`+f),e.versionPragma&&(f=`#version ${e.version}
`+f),f):`{
${f}
}`},swizzle:u=>`${l(u.val)}.${u.id}`,sym:u=>u.id,ternary:u=>`(${l(u.test)} ? ${l(u.t)} : ${l(u.f)})`,while:u=>`while (${l(u.test)}) ${l(u.scope)}`});return Object.assign(l,{gl_FragColor:tt(Me,"gl_FragColor"),gl_FragCoord:tt(Me,"gl_FragCoord",{const:!0}),gl_FragData:tt("vec4[]","gl_FragData",{num:1}),gl_FrontFacing:tt("bool","gl_FrontFacing",{const:!0}),gl_PointCoord:tt(Ie,"gl_PointCoord",{const:!0}),gl_PointSize:tt(On,"gl_PointSize"),gl_Position:tt(Me,"gl_Position")}),l};function Tc(t,e){for(let n of e)t.delete(n);return t}const Lh=(t,e)=>{if(t===e)return!0;if(!(e instanceof Map)||t.size!==e.size)return!1;for(let n of t.entries())if(!lt(e.get(n[0]),n[1]))return!1;return!0},Bh=(t,e)=>{if(t===e)return!0;if(!(e instanceof Set)||t.size!==e.size)return!1;for(let n of t.keys())if(!e.has(n))return!1;return!0},Th="modulepreload",kh=function(t){return"/"+t},vo={},Ph=function(e,n,s){let r=Promise.resolve();if(n&&n.length>0){let o=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");r=o(n.map(l=>{if(l=kh(l),l in vo)return;vo[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":Th,u||(d.as="script"),d.crossOrigin="",d.href=l,c&&d.setAttribute("nonce",c),document.head.appendChild(d),u)return new Promise((h,g)=>{d.addEventListener("load",h),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};let An=null;rd()&&Ph(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]).then(t=>{An=t.inspect});const Gh=(t,e)=>[...H(n=>An(n,e),t)].join(", "),Uh=(t,e)=>[...H(([n,s])=>`${An(n,e)} => ${An(s,e)}`,t)].join(", "),kc=$n({[Symbol.for("nodejs.util.inspect.custom")](t,e){const n=this[Symbol.toStringTag],s={...e,depth:e.depth===null?null:e.depth-1};return t>=0?[`${n}(${this.size||0}) {`,An?this instanceof Set?Gh(this,s):this instanceof Map?Uh(this,s):"":"","}"].join(" "):e.stylize(`[${n}]`,"special")}});function as(t,e){if(sd(t))for(let n of e)t.set(n[0],n[1]);else for(let n of e)t.add(n);return t}var Fh=Object.getOwnPropertyDescriptor,zh=(t,e,n,s)=>{for(var r=s>1?void 0:s?Fh(e,n):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(r=o(r)||r);return r};const Kt=new WeakMap,Rt=t=>Kt.get(t).vals;let F=class extends Set{constructor(t,e={}){super(),Kt.set(this,{equiv:e.equiv||lt,vals:[]}),t&&this.into(t)}*[Symbol.iterator](){yield*Rt(this)}get[Symbol.species](){return F}get[Symbol.toStringTag](){return"ArraySet"}get size(){return Rt(this).length}copy(){const{equiv:t,vals:e}=Kt.get(this),n=new F(null,{equiv:t});return Kt.get(n).vals=e.slice(),n}empty(){return new F(null,this.opts())}clear(){Rt(this).length=0}first(){if(this.size)return Rt(this)[0]}add(t){return!this.has(t)&&Rt(this).push(t),this}into(t){return as(this,t)}has(t){return this.get(t,x)!==x}get(t,e){const{equiv:n,vals:s}=Kt.get(this),r=qd(s,t,n);return r>=0?s[r]:e}delete(t){const{equiv:e,vals:n}=Kt.get(this);for(let s=n.length;s-- >0;)if(e(n[s],t))return n.splice(s,1),!0;return!1}disj(t){return Tc(this,t)}equiv(t){return Bh(this,t)}forEach(t,e){const n=Rt(this);for(let s=n.length;s-- >0;){const r=n[s];t.call(e,r,r,this)}}*entries(){for(let t of Rt(this))yield[t,t]}*keys(){yield*Rt(this)}*values(){yield*Rt(this)}opts(){return{equiv:Kt.get(this).equiv}}};F=zh([kc],F);var Hh=Object.getOwnPropertyDescriptor,qh=(t,e,n,s)=>{for(var r=s>1?void 0:s?Hh(e,n):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(r=o(r)||r);return r};const Z=new WeakMap,Hn=t=>Z.get(t).map;let ce=class extends Map{constructor(t,e){super();const n={equiv:lt,keys:F,...e};Z.set(this,{keys:new n.keys(null,{equiv:n.equiv}),map:new Map,opts:n}),t&&this.into(t)}[Symbol.iterator](){return this.entries()}get[Symbol.species](){return ce}get[Symbol.toStringTag](){return"EquivMap"}get size(){return Z.get(this).keys.size}clear(){const{keys:t,map:e}=Z.get(this);t.clear(),e.clear()}empty(){return new ce(null,Z.get(this).opts)}copy(){const{keys:t,map:e,opts:n}=Z.get(this),s=new ce;return Z.set(s,{keys:t.copy(),map:new Map(e),opts:n}),s}equiv(t){return Lh(this,t)}delete(t){const{keys:e,map:n}=Z.get(this);return t=e.get(t,x),t!==x?(n.delete(t),e.delete(t),!0):!1}dissoc(t){return Tc(this,t)}forEach(t,e){for(let n of Hn(this))t.call(e,n[1],n[0],this)}get(t,e){const{keys:n,map:s}=Z.get(this);return t=n.get(t,x),t!==x?s.get(t):e}has(t){return Z.get(this).keys.has(t)}set(t,e){const{keys:n,map:s}=Z.get(this),r=n.get(t,x);return r!==x?s.set(r,e):(n.add(t),s.set(t,e)),this}into(t){return as(this,t)}entries(){return Hn(this).entries()}keys(){return Hn(this).keys()}values(){return Hn(this).values()}opts(){return Z.get(this).opts}};ce=qh([kc],ce);const Vh=(t,e)=>at(t,"copy")?t.copy():new(t[Symbol.species]||e)(t),Pc=(t,e,n)=>{if(t.size<e.size){const s=t;t=e,e=s}return n=n?as(n,t):Vh(t,Set),t===e?n:as(n,e)};class wn{dependencies;dependents;constructor(e){if(this.dependencies=new ce,this.dependents=new ce,e)for(let[n,s]of e)s!=null?this.addDependency(n,s):this.addNode(n)}*[Symbol.iterator](){yield*this.sort()}get[Symbol.species](){return wn}copy(){const e=new wn;for(let n of this.dependencies)e.dependencies.set(n[0],n[1].copy());for(let n of this.dependents)e.dependents.set(n[0],n[1].copy());return e}addNode(e){return!this.dependencies.has(e)&&this.dependencies.set(e,new F),this}addDependency(e,n){(lt(e,n)||this.depends(n,e))&&ct(`Circular dependency between: ${e} & ${n}`);let s=this.dependencies.get(e);return this.dependencies.set(e,s?s.add(n):new F([n])),s=this.dependents.get(n),this.dependents.set(n,s?s.add(e):new F([e])),this}addDependencies(e,n){for(let s of n)this.addDependency(e,s)}removeEdge(e,n){let s=this.dependencies.get(e);return s&&s.delete(n),s=this.dependents.get(n),s&&s.delete(e),this}removeNode(e){return this.dependencies.delete(e),this}depends(e,n){return this.transitiveDependencies(e).has(n)}dependent(e,n){return this.transitiveDependents(e).has(n)}immediateDependencies(e){return this.dependencies.get(e)||new F}immediateDependents(e){return this.dependents.get(e)||new F}isLeaf(e){return this.immediateDependents(e).size===0}isRoot(e){return this.immediateDependencies(e).size===0}nodes(){return Pc(new F(this.dependencies.keys()),new F(this.dependents.keys()))}leaves(){return Yt(e=>this.isLeaf(e),this.nodes())}roots(){return Yt(e=>this.isRoot(e),this.nodes())}transitiveDependencies(e){return Ir(this.dependencies,e)}transitiveDependents(e){return Ir(this.dependents,e)}sort(){const e=[],n=this.copy();let s=new F(n.leaves());for(;;){if(!s.size)return e.reverse();const r=s.first();s.delete(r);for(let i of[...n.immediateDependencies(r)])n.removeEdge(r,i),n.isLeaf(i)&&s.add(i);e.push(r),n.removeNode(r)}}}const Ir=(t,e)=>{const n=t.get(e);return n?gn(_s(null,(s,r)=>Pc(s,Ir(t,r))),n,n):new F},Gc=t=>{let e;switch(t.tag){case"scope":return t.body;case"fn":return t.scope.body;case"for":return e=[t.test,...t.scope.body],t.init&&e.push(t.init),t.iter&&e.push(t.iter),e;case"while":return[t.test,...t.scope.body];case"if":return e=[t.test,...t.t.body],t.f&&e.push(...t.f.body),e}},Yh=t=>Gc(t)||(t.tag==="scope"?t.body:t.tag==="ternary"?[t.test,t.t,t.f]:t.tag==="ret"?t.val!==void 0?[t.val]:void 0:t.tag==="call"||t.tag==="call_i"?t.args:t.tag==="sym"&&t.init?[t.init]:t.tag==="decl"?[t.id]:t.tag==="op1"||t.tag==="swizzle"?[t.val]:t.tag==="op2"?[t.l,t.r]:t.tag==="assign"?[t.r]:Fe(t)||Ic(t)||Ah(t.val)?t.val:void 0),cs=(t,e,n,s,r=!0)=>{if(S(s))s.forEach(i=>n=cs(t,e,n,i,r));else{r&&(n=t(n,s));const i=e(s);i&&(n=cs(t,e,n,i,r)),!r&&(n=t(n,s))}return n},Uc=(t,e=new wn)=>t.deps?.length?t.deps.reduce((n,s)=>Uc(s,n.addDependency(t,s)),e):e.addNode(t),Wh=t=>({tag:"decl",type:t.type,id:t}),Fc=(t,e=!1)=>({tag:"scope",type:"void",body:t.filter(n=>n!=null).map(n=>n.tag==="sym"?Wh(n):n),global:e}),jh=t=>{const e=t.filter(s=>s.tag!=="fn"),n=t.reduce((s,r)=>r.tag==="fn"?Uc(r,s):s,new wn);return Fc(e.concat(n.sort()),!0)},ls=fa.childLogger("webgl"),Xh={a:"",v:"",u:"",o:""},xh={[ot.GLES_100]:{number:100,attrib:(t,e,n)=>`attribute ${S(e)?e[0]:e} ${n.a}${t};`,varying:{vs:(t,e,n)=>_e("varying",e,n.v+t),fs:(t,e,n)=>_e("varying",e,n.v+t)},uniform:(t,e,n)=>_e("uniform",e,n.u+t),output:(t,e,n)=>S(e)?`#define ${n.o}${t} gl_FragData[${e[1]}]`:""},[ot.GLES_300]:{number:300,attrib:(t,e,n)=>S(e)?`layout(location=${e[1]}) in ${e[0]} ${n.a}${t};`:`in ${e} ${n.a}${t};`,varying:{vs:(t,e,n)=>_e("out",e,n.v+t),fs:(t,e,n)=>_e("in",e,n.v+t)},uniform:(t,e,n)=>_e("uniform",e,n.u+t),output:(t,e,n)=>S(e)?`layout(location=${e[1]}) out ${e[0]} ${n.o}${t};`:`out ${e} ${n.o}${t};`}},_e=(t,e,n)=>{const s=S(e)?e[0]:e;return s.indexOf("[]")>0?`${t} ${s.replace("[]","")} ${n}[${e[1]}];`:`${t} ${s} ${n};`},zc=(t,e,n="")=>{let s=">=";return e||(e=n,n=null,s="<"),`#if __VERSION__ ${s} ${t}
${e}${n?`
#else
${n}`:""}
#endif`};zc(300,"","#define texture texture2D");const yo=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp int;
precision highp float;
#else
precision mediump int;
precision mediump float;
#endif
${zc(300,"precision lowp sampler3D;")}
#ifndef PI
#define PI 3.141592653589793
#endif
#ifndef TAU
#define TAU 6.283185307179586
#endif
#ifndef HALF_PI
#define HALF_PI 1.570796326794896
#endif
`,St=t=>(e,n,s=0)=>{let r;return i=>{i=i===void 0?s:i,i!==r&&(e["uniform1"+t](n,i),r=i)}},w=(t,e)=>(n,s,r=e)=>{let i=[];return o=>{o=o===void 0?r:o,Lr(i,o)||(n["uniform"+t](s,o),i=[...o])}},ve=(t,e)=>(n,s,r=e)=>{let i=[];return o=>{o=o===void 0?r:o,Lr(i,o)||(n["uniformMatrix"+t](s,!1,o),i=[...o])}},It=[0],Zh={bool:St("i"),float:St("f"),int:St("i"),uint:St("ui"),bvec2:w("2iv",gt),bvec3:w("3iv",mt),bvec4:w("4iv",xt),ivec2:w("2iv",gt),ivec3:w("3iv",mt),ivec4:w("4iv",xt),vec2:w("2fv",gt),vec3:w("3fv",mt),vec4:w("4fv",xt),mat2:ve("2fv",Qd),mat3:ve("3fv",th),mat4:ve("4fv",fc),sampler2D:St("i"),sampler2DShadow:St("i"),sampler3D:St("i"),samplerCube:St("i"),samplerCubeShadow:St("i"),"bool[]":w("1iv",It),"float[]":w("1fv",It),"int[]":w("1iv",It),"uint[]":w("1uiv",It),"bvec2[]":w("2iv",gt),"bvec3[]":w("3iv",mt),"bvec4[]":w("4iv",xt),"ivec2[]":w("2iv",gt),"ivec3[]":w("3iv",mt),"ivec4[]":w("4iv",xt),"vec2[]":w("2fv",gt),"vec3[]":w("3fv",mt),"vec4[]":w("4fv",xt),"mat2[]":ve("2fv",gt),"mat3[]":ve("3fv",mt),"mat4[]":ve("4fv",xt),"sampler2D[]":w("1iv",It),"sampler2DShadow[]":w("1iv",It),"sampler3D[]":w("1iv",It),"samplerCube[]":w("1iv",It),"samplerCubeShadow[]":w("1iv",It)},Jh=/ERROR: \d+:(\d+): (.*)/;class di{gl;program;attribs;uniforms;state;warnAttrib=go(e=>ls.warn(`unknown attrib: ${e} (no further warnings will be shown...)`));warnUni=go(e=>ls.warn(`unknown uniform: ${e} (no further warnings will be shown...)`));constructor(e,n,s,r,i){this.gl=e,this.program=n,this.attribs=s,this.uniforms=r,this.state=i||{}}withState(e){return new di(this.gl,this.program,this.attribs,this.uniforms,{...this.state,...e})}bind(e){return this.program?(this.gl.useProgram(this.program),this.bindAttribs(e.attribs),this.bindUniforms(e.uniforms),!0):!1}unbind(){let e;for(let n in this.attribs)(e=this.attribs[n])&&this.gl.disableVertexAttribArray(e.loc);return this.gl.useProgram(null),!0}release(){return this.program?(this.gl.deleteProgram(this.program),delete this.program,!0):!1}bindAttribs(e){const n=this.gl;let s;for(let r in e)if(s=this.attribs[r]){const i=e[r];i.buffer.bind(),n.enableVertexAttribArray(s.loc),n.vertexAttribPointer(s.loc,i.size||3,Aa(i.type||n.FLOAT),i.normalized||!1,i.stride||0,i.offset||0)}else this.warnAttrib(r)}bindUniforms(e={}){const n=this.uniforms;for(let s in e){const r=n[s];if(r){let i=e[s];i=Be(i)?i(n,e):ff(i),r.setter(i)}else this.warnUni(s)}for(let s in n)if(n.hasOwnProperty(s)&&(!e||!sc(e[s]))){const r=n[s],i=r.defaultFn?r.defaultFn(n,e):r.defaultVal;r.setter(i)}}prepareState(e=this.state){const n=this.gl;e.depth!==void 0&&this.setState(n.DEPTH_TEST,e.depth),e.cull!==void 0&&(this.setState(n.CULL_FACE,e.cull),e.cullMode&&n.cullFace(e.cullMode)),e.blend!==void 0&&(this.setState(n.BLEND,e.blend),e.blendFn&&n.blendFunc(e.blendFn[0],e.blendFn[1]),e.blendEq!==void 0&&n.blendEquation(e.blendEq)),e.stencil!==void 0&&(this.setState(n.STENCIL_TEST,e.stencil),e.stencilFn&&n.stencilFunc(e.stencilFn[0],e.stencilFn[1],e.stencilFn[2]),e.stencilOp&&n.stencilOp(e.stencilOp[0],e.stencilOp[1],e.stencilOp[2]),e.stencilMask!==void 0&&n.stencilMask(e.stencilMask))}setState(e,n){n?this.gl.enable(e):this.gl.disable(e)}}const Hc=(t,e,n)=>{const s=Pe(t)?ot.GLES_300:ot.GLES_100,r=Be(e.vs)?Eo(e,"vs",s,n):Ro(e,"vs",s),i=Be(e.fs)?Eo(e,"fs",s,n):Ro(e,"fs",s),o=ls;o.debug(r),o.debug(i),e.ext&&Qh(t,e.ext);const a=So(t,t.VERTEX_SHADER,r),c=So(t,t.FRAGMENT_SHADER,i),l=t.createProgram()||T("error creating shader program");if(t.attachShader(l,a),t.attachShader(l,c),t.linkProgram(l),t.getProgramParameter(l,t.LINK_STATUS)){const u=sg(t,l,e.attribs),f=rg(t,l,e.uniforms);return t.deleteShader(a),t.deleteShader(c),new di(t,l,u,f,e.state)}throw new Error(`Error linking shader: ${t.getProgramInfoLog(l)}`)},qn=(t,e,n)=>{let s=[];for(let r in t)t.hasOwnProperty(r)&&s.push(e(r,t[r],n));return s.push(""),s.join(`
`)},Kh=(t,e,n)=>{const s=ph[t],r=n===ot.GLES_300;return s&&(!r&&s.gl||r&&s.gl2)?`#extension ${s&&s.alias||t} : ${Cn(e)?e?"enable":"disable":e}
`:""},Qh=(t,e)=>{for(let n in e){const s=e[n];(s===!0||s==="require")&&dc(t,[n],s==="require")}},qc=(t,e)=>{let n=t.pre?t.replacePrelude?t.pre:t.pre+`
`+yo:yo;if(t.ext)for(let s in t.ext)n+=Kh(s,t.ext[s],e);return n},Ao=(t,e,n)=>{for(let s in e){const r=e[s];n[s]=S(r)?t(r[0],s,{loc:r[1]}):t(r,s)}},tg=t=>{const[e,n]=S(t)?[t[0],{num:t[1]}]:[t,{}];return/(u?int|[ui]vec[234])/.test(e)&&(n.smooth="flat"),[e,n]},wo=(t,e,n)=>{for(let s in t.varying){const[r,i]=tg(t.varying[s]);n[s]=e(r,s,i)}},eg=(t,e)=>{for(let n in t.uniforms){const s=t.uniforms[n];e[n]=S(s)?bo(s[0],n,s[0].indexOf("[]")>0?{num:s[1]}:void 0):bo(s,n)}},Eo=(t,e,n,s={})=>{let r=qc(t,n);const i={},o={},a={},c={};if(t.uniforms&&eg(t,c),e==="vs")Ao(mo,t.attribs,i),t.varying&&wo(t,po,o);else{t.varying&&wo(t,mo,i);const u=t.outputs||Ec;if(n>=ot.GLES_300)Ao(po,u,o);else for(let f in u){const d=u[f];S(d)&&d[0]==="vec4"?(r+=`#define ${f} gl_FragData[${d[1]}]
`,a[f]=tt("vec4",f)):At(`GLSL ${n} doesn't support output vars`)}}const l=Oh({type:e,version:n,prelude:r,prec:s.prec});return l(jh([...Hs(c),...Hs(i),...Hs(o),...t[e](l,c,i,{...o,...a})]))+(t.post?`
`+t.post:"")},Ro=(t,e,n)=>{const s=xh[n],r={...Xh,...t.declPrefixes},i=e==="vs";let o="";return o+=`#version ${n}
`,o+=qc(t,n),t.generateDecls!==!1&&(o+=i?qn(t.attribs,s.attrib,r):qn(t.outputs||Ec,s.output,r),o+=qn(t.varying,s.varying[e],r),o+=qn(t.uniforms,s.uniform,r)),o+=t[e],t.post&&(o+=`
`+t.post),o},So=(t,e,n)=>{const s=t.createShader(e)||T("error creating shader");return t.shaderSource(s,n),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:ng(t,s,n)},ng=(t,e,n)=>{const s=n.split(`
`),i=t.getShaderInfoLog(e).split(`
`).map(o=>{const a=Jh.exec(o),c=a?a[1]:null;if(c)return`line ${c}: ${a[2]}
${s[parseInt(c)-1]}`}).filter(sc).join(`
`);return T(`Error compiling shader:
${i}`)},sg=(t,e,n)=>{const s={};for(let r in n){const i=n[r],[o,a]=S(i)?i:[i,null],c=r;a!=null?(t.bindAttribLocation(e,a,c),s[r]={type:o,loc:a}):s[r]={type:o,loc:t.getAttribLocation(e,c)}}return s},rg=(t,e,n={})=>{const s={};for(let r in n){const i=n[r];let o,a,c,l,u;S(i)?([o,a,c]=i,l=o.indexOf("[]")<0?a:c,Be(l)&&(u=l,l=void 0)):o=i;const f=t.getUniformLocation(e,r);if(f!=null){const d=Zh[o];d?s[r]={loc:f,setter:d(t,f,l),defaultFn:u,defaultVal:l,type:o}:T(`invalid uniform type: ${o}`)}else ls.warn(`unknown uniform: ${r}`)}return s};class Vc{gl;buffer;target;mode;data;constructor(e,n,s=e.ARRAY_BUFFER,r=e.STATIC_DRAW,i=!1){this.gl=e,this.buffer=e.createBuffer()||T("error creating WebGL buffer"),this.target=s,this.mode=r,n&&(this.set(n),i&&(this.data=n))}bind(){return this.gl.bindBuffer(this.target,this.buffer),!0}unbind(){return this.gl.bindBuffer(this.target,null),!0}release(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),delete this.buffer),!0}update(){this.data&&this.set(this.data)}set(e,n=this.mode){this.bind(),this.gl.bufferData(this.target,e,n),this.data&&(this.data=e)}setChunk(e,n=0){this.bind(),this.gl.bufferSubData(this.target,n,e),this.data&&this.data.set(e,n>>>I0[O0(e)])}}const ig=(t,e,n=t.ARRAY_BUFFER,s=t.STATIC_DRAW,r=!1)=>new Vc(t,e,n,s,r),Io=(t,e,n=t.STATIC_DRAW)=>(e.attribPool?e.attribs=Do(t,e.attribPool,void 0,t.ARRAY_BUFFER,n):Mo(t,e.attribs,n),e.instancePool?e.instances={attribs:Do(t,e.instancePool,void 0,t.ARRAY_BUFFER,n),num:e.instancePool.capacity}:e.instances&&Mo(t,e.instances.attribs,n),og(t,e.indices,n),e.mode==null&&(e.mode=si.TRIANGLES),Lt(e.shader)&&(e.shader=Hc(t,e.shader)),e),Yc=(t,e,n,s)=>{e.buffer?e.data&&e.buffer.set(e.data):e.buffer=new Vc(t,e.data,n,s,e.retain)},Mo=(t,e,n)=>{if(e)for(let s in e)Yc(t,e[s],t.ARRAY_BUFFER,n);return e},og=(t,e,n=t.STATIC_DRAW)=>(e&&Yc(t,e,t.ELEMENT_ARRAY_BUFFER,n),e),Do=(t,e,n,s=t.ARRAY_BUFFER,r=t.STATIC_DRAW)=>{const i=ig(t,e.bytes(),s,r,!0),o={};for(let a of Object.keys(e.specs)){const c=e.specs[a];o[a]={buffer:i,size:c.size,type:Aa(c.type),stride:e.byteStride,offset:c.byteOffset}}return o},Wc=t=>e=>{if(e)for(let n=e.length,s;n-- >0;)(s=e[n])&&s[t](n)},ag=Wc("bind"),cg=Wc("unbind");class lg{gl;tex;target;format;filter;wrap;type;size;constructor(e,n={}){this.gl=e,this.tex=e.createTexture()||T("error creating WebGL texture"),this.configure({filter:is.NEAREST,wrap:os.CLAMP,...n})}configure(e={},n=!0){const s=this.gl,r=e.target||this.target||Se.TEXTURE_2D,i=e.format||this.format||ke.RGBA,o=ln[i],a=e.type||this.type||o.types[0];return!this.target&&(this.target=r),this.format=i,this.type=a,s.bindTexture(this.target,this.tex),e.flip!==void 0&&s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.flip?1:0),e.premultiply!==void 0&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiply?1:0),this.configureImage(r,e),e.mipmap&&s.generateMipmap(r),this.configureFilter(r,e),this.configureWrap(r,e),this.configureLOD(r,e),this.configureLevels(r,e),n&&s.bindTexture(this.target,null),!0}configureImage(e,n){n.image!==void 0&&(e===Se.TEXTURE_3D?this.configureImage3d(e,n):this.configureImage2d(e,n))}configureImage2d(e,n){const s=n.level||0,r=n.pos||[0,0,0],{image:i,width:o,height:a}=n,l=ln[this.format].format,{gl:u,type:f,format:d}=this;o&&a?n.sub?u.texSubImage2D(e,s,r[0],r[1],o,a,l,f,i):(s===0&&(this.size=[o,a]),u.texImage2D(e,s,d,o,a,0,l,f,i)):n.sub?u.texSubImage2D(e,s,r[0],r[1],l,f,i):(i!=null&&s===0&&(this.size=[i.width,i.height]),u.texImage2D(e,s,d,l,f,i))}configureImage3d(e,n){const{image:s,width:r,height:i,depth:o}=n;if(!(r&&i&&o))return;const a=n.level||0,c=n.pos||[0,0,0],u=ln[this.format].format,{gl:f,type:d,format:h}=this;n.sub?f.texSubImage3D(e,a,c[0],c[1],c[2],r,i,o,u,d,s):(a===0&&(this.size=[r,i,o]),f.texImage3D(e,a,h,r,i,o,0,u,d,s))}configureFilter(e,n){const s=this.gl,r=n.filter||this.filter||is.NEAREST;let i,o;S(r)?(i=r[0],o=r[1]||i,this.filter=[i,o]):(this.filter=[r,r,r],i=o=r),s.texParameteri(e,s.TEXTURE_MIN_FILTER,i),s.texParameteri(e,s.TEXTURE_MAG_FILTER,o)}configureWrap(e,n){const s=this.gl,r=n.wrap||this.wrap||os.CLAMP;let i,o,a;S(r)?(i=r[0],o=r[1]||i,a=r[2]||i,this.wrap=[i,o,a]):(i=o=a=r,this.wrap=[r,r,r]),s.texParameteri(e,s.TEXTURE_WRAP_S,i),s.texParameteri(e,s.TEXTURE_WRAP_T,o),Pe(s)&&e===s.TEXTURE_3D&&s.texParameteri(e,s.TEXTURE_WRAP_R,a)}configureLOD(e,n){const s=this.gl;if(n.lod){const[r,i]=n.lod;r&&s.texParameterf(e,s.TEXTURE_MIN_LOD,r),i&&s.texParameterf(e,s.TEXTURE_MAX_LOD,i)}}configureLevels(e,n){const s=this.gl;if(n.minMaxLevel){const[r,i]=n.minMaxLevel;s.texParameteri(e,s.TEXTURE_BASE_LEVEL,r),s.texParameteri(e,s.TEXTURE_MAX_LEVEL,i)}}bind(e=0){const n=this.gl;return n.activeTexture(n.TEXTURE0+e),n.bindTexture(this.target,this.tex),!0}unbind(e=0){const n=this.gl;return n.activeTexture(n.TEXTURE0+e),n.bindTexture(this.target,null),!0}release(){return this.tex?(this.gl.deleteTexture(this.tex),delete this.tex,delete this.gl,!0):!1}}const De=(t,e)=>new lg(t,e),ug=(t,e={})=>{const n=S(t)?t:[t];for(let s=0,r=n.length;s<r;s++){const i=n[s],o=i.indices,a=i.shader.gl;e.bindTex!==!1&&ag(i.textures),e.shaderState!==!1&&i.shader.prepareState(),e.bindShader!==!1&&i.shader.bind(i),o?.buffer?(o.buffer.bind(),i.instances?No(a,i):a.drawElements(i.mode,i.num,o.data instanceof Uint32Array?a.UNSIGNED_INT:a.UNSIGNED_SHORT,0)):i.instances?No(a,i):a.drawArrays(i.mode,0,i.num),e.unbindShader!==!1&&i.shader.unbind(null),e.unbindTex&&cg(i.textures)}},No=(t,e)=>{const n=Pe(t),s=n?void 0:t.getExtension("ANGLE_instanced_arrays");n||s||T("instancing not supported");const r=e.shader.attribs,i=e.instances.attribs;e.shader.bindAttribs(i);for(let o in i){const a=r[o];if(a){let c=i[o].divisor;c=c!==void 0?c:1,n?t.vertexAttribDivisor(a.loc,c):s.vertexAttribDivisorANGLE(a.loc,c)}}if(e.indices){const o=e.indices.data instanceof Uint32Array?t.UNSIGNED_INT:t.UNSIGNED_SHORT;n?t.drawElementsInstanced(e.mode,e.num,o,0,e.instances.num):s.drawElementsInstancedANGLE(e.mode,e.num,o,0,e.instances.num)}else n?t.drawArraysInstanced(e.mode,0,e.num,e.instances.num):s.drawArraysInstancedANGLE(e.mode,0,e.num,e.instances.num);for(let o in i){const a=r[o];a&&(n?t.vertexAttribDivisor(a.loc,0):s.vertexAttribDivisorANGLE(a.loc,0))}e.shader.unbind(null)};class fg{gl;buffer;format;width;height;constructor(e,n){this.gl=e,this.buffer=e.createRenderbuffer()||T("error creating RBO"),this.configure(n)}bind(){return this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.buffer),!0}unbind(){return this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),!0}release(){return this.gl.deleteRenderbuffer(this.buffer),delete this.buffer,!0}configure(e,n=!0){const s=this.gl;return this.bind(),this.format=e.format||s.DEPTH_COMPONENT16,this.width=e.width,this.height=e.height,s.renderbufferStorage(s.RENDERBUFFER,e.format||s.DEPTH_COMPONENT16,e.width,e.height),n?this.unbind():!0}}const dg=36064,hg=36063;class gg{gl;fbo;ext;maxAttachments;constructor(e,n){this.gl=e,this.fbo=e.createFramebuffer()||T("error creating FBO"),this.ext=!Pe(e)&&n?.tex&&n.tex.length>1?e.getExtension("WEBGL_draw_buffers")||T("missing WEBGL_draw_buffers ext"):void 0,this.maxAttachments=e.getParameter(hg),n&&this.configure(n)}bind(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),!0}unbind(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),!0}release(){return this.gl.deleteFramebuffer(this.fbo),delete this.fbo,delete this.ext,!0}configure(e,n=!0){const s=this.gl;if(this.bind(),e.tex){I(e.tex.length<this.maxAttachments,`too many attachments (max. ${this.maxAttachments})`);const r=[];for(let i=0;i<e.tex.length;i++){const o=e.tex[i];I(!!(ln[o.format].render||ln[o.format].renderExt),`texture #${i} has non-renderable format`);const a=dg+i;s.framebufferTexture2D(s.FRAMEBUFFER,a,s.TEXTURE_2D,o.tex,0),r[i]=a}this.ext?this.ext.drawBuffersWEBGL(r):Pe(s)&&s.drawBuffers(r)}return e.depth&&(e.depth instanceof fg?s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e.depth.buffer):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,e.depth.tex,0)),this.validate(),n?this.unbind():!0}validate(){const e=this.gl,n=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(n){case e.FRAMEBUFFER_COMPLETE:return!0;case e.FRAMEBUFFER_UNSUPPORTED:T("FBO unsupported");case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:T("FBO incomplete attachment");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:T("FBO incomplete dimensions");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:T("FBO incomplete missing attachment");default:return T(`FBO error: ${n}`)}}}const mg=(t,e)=>new gg(t,e),En=(t,e)=>(I(t.tag!=="swizzle"||t.val.tag==="sym","can't assign to non-symbol swizzle"),{tag:"assign",type:t.type,l:t,r:e}),pg=t=>{const[e,n,s]=k(t)?[t]:t;return{tag:"arg",type:e,id:n||fi(),opts:{q:"in",...s}}};function bg(t,e,n,s){e=e||fi();const r=n.map(pg),i=s(...r.map(c=>tt(c.type,c.id,c.opts))).filter(c=>c!=null);cs((c,l)=>(l.tag==="ret"&&(I(l.type===t,`wrong return type for function '${e}', expected ${t}, got ${l.type}`),c++),c),Gc,0,i);const o=cs((c,l)=>(l.tag==="call"&&l.fn&&c.push(l.fn),c),Yh,[],i),a=(...c)=>_g(a,...c);return Object.assign(a,{tag:"fn",type:t,id:e,args:r,deps:o,scope:Fc(i)})}const Ss=t=>bg("void","main",[],t);function _g(t,...e){return k(t)?{tag:"call",type:e[0],id:t,args:e.slice(1)}:{tag:"call",type:t.type,id:t.id,args:e,fn:t}}const $o=(t,e,...n)=>({tag:"call_i",type:e,id:t,args:n});function vg(t,e){const n=t.type[0],s=(r,i)=>e.length===1?r:i+e.length;return{tag:"swizzle",type:n==="i"?s(Rs,"ivec"):n==="u"?s(ri,"uvec"):n==="b"?s(Rc,"bvec"):s(On,"vec"),val:t,id:e}}function yg(t){return vg(t,"xy")}const Co=t=>{const e=t.type[0],n=t.type.indexOf("Shadow")>0;return e==="s"?n?On:Me:e==="i"?n?Rs:"ivec4":e==="u"?n?ri:"uvec4":ct(`unknown sampler type ${t.type}`)},jc=(t,e,n,s)=>{const r=s?$o(t,Co(e),e,...n,s):$o(t,Co(e),e,...n);return!Fe(r)&&(r.info="n"),r};function Ag(t,e,n){return jc("texture",t,[e],n)}function wg(t,e,n){return jc("texelFetch",t,[e,n])}const hi=(t={})=>{let{size:e=2,uv:n=!0,center:s=!0}=t;e*=.5;const r=s?0:e;return{attribs:{position:{data:new Float32Array([r-e,r-e,r+e,r-e,r-e,r+e,r+e,r+e]),size:2},...n?{uv:{data:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}:null},uniforms:{},shader:null,mode:si.TRIANGLE_STRIP,num:4}},Eg=(t,e,n)=>[Ss(()=>[En(t.gl_Position,Bc(n.position,oi,$c))])],Rg=(t,e,n,s)=>[Ss(()=>[En(s.v_uv,n.uv),En(t.gl_Position,Bc(n.position,oi,$c))])],Sg=(t,e,n,s)=>[Ss(()=>[En(s.fragColor,Ag(e.tex,n.v_uv))])],Xc={vs:Rg,fs:Sg,attribs:{position:Ie,uv:Ie},varying:{v_uv:Ie},uniforms:{tex:Sc},state:{depth:!1},ext:{}},xc=t=>{const e=t.gl,n=t.passes.length;I(n>0,"require at least one shader pass");const s=!t.passes[n-1].outputs.length,r=Ng(t),i=Ig(t,r),o=$g(t,r,s),a=(g,p,_=!0)=>{_&&o[g].bind();const m=t.passes[g],M=i[g],D=M.shader,N=m.outputs.length?r[m.outputs[0]].size:[e.drawingBufferWidth,e.drawingBufferHeight];D.uniforms.resolution&&(M.uniforms.resolution=N),D.uniforms.time&&(M.uniforms.time=p),e.viewport(0,0,N[0],N[1]),ug(M),_&&o[g].unbind()},c=g=>{for(let p=0;p<o.length;p++)a(p,g);s&&a(n-1,g,!1)},l=()=>{c((Date.now()-f)*.001),u&&(d=requestAnimationFrame(l))};let u,f=Date.now(),d;return{start(){f=Date.now(),u=!0,d=requestAnimationFrame(l)},stop(){u&&(u=!1,cancelAnimationFrame(d))},update(g){c(g)},singlePass(g,p){a(g,p,g<o.length)},passes:t.passes,fbos:o,models:i,textures:r}},Ig=(t,e)=>{const n=t.gl,s=Io(n,hi({uv:!1}));return t.passes.map(r=>{const i=r.model?Io(n,r.model):{...s};return i.shader=Dg(n,r,e),i.uniforms={...r.uniformVals},r.inputs.length>0&&(i.textures=r.inputs.map(o=>e[o])),i})},Mg={[Se.TEXTURE_2D]:Sc,[Se.TEXTURE_3D]:_h,[Se.TEXTURE_CUBE_MAP]:"samplerCube"},Dg=(t,e,n)=>{const s=Pe(t),r=e.outputs.length,i={...e.ext},o={vs:e.vs||Eg,fs:e.fs,attribs:e.attribs||{position:Ie},varying:e.varying,uniforms:{...e.uniforms,...$t(Ta((l,u)=>[`input${l}`,[Mg[n[u].target],l]]),fr(),e.inputs)},outputs:r?$t(H(l=>[`output${l}`,[Me,l]]),fr(),ka(r)):void 0,state:e.state,pre:e.pre,post:e.post,replacePrelude:e.replacePrelude,generateDecls:e.generateDecls,ext:i},a=dr(l=>ho(n[l]),e.inputs),c=dr(l=>ho(n[l]),e.outputs);return s||(a&&(i.OES_texture_float="require"),r>1&&(i.WEBGL_draw_buffers="require")),c&&(i[s?"EXT_color_buffer_float":"WEBGL_color_buffer_float"]="require",s&&(i.EXT_float_blend="require")),Hc(t,o)},Ng=t=>Object.keys(t.textures).reduce((e,n)=>(e[n]=De(t.gl,{width:t.width,height:t.height,depth:t.depth,filter:is.NEAREST,wrap:os.CLAMP,image:null,...t.textures[n]}),e),{}),$g=(t,e,n)=>(n?t.passes.slice(0,t.passes.length-1):t.passes).map(s=>mg(t.gl,{tex:s.outputs.map(r=>e[r])})),Zc=(t,e)=>(I(t.length===e.length,"require same number of in/out textures"),{fs:(n,s,r,i)=>[Ss(()=>[...H(o=>En(i[`output${o}`],wg(s[`input${o}`],Dh(yg(n.gl_FragCoord)),Cc)),ka(t.length))])],inputs:t,outputs:e});class Cg{constructor(e,n,s){this.gl=e;const r=ei(n);this.canvasTex=De(this.gl),this.backgroundTex=De(this.gl),this.fadeAmount=n.fadeAmount||0,this.pipeline=xc({gl:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,textures:{curr:{format:ke.RGBA32F},next:{format:ke.RGBA32F},canvasTex:{},backgroundTex:{}},passes:[{model:hi({uv:!0}),...Xc,fs:`
                    #define saturate(a) clamp( a, 0.0, 1.0 )
                    
                    void main() {
                        vec4 src = texture(input0, v_uv / uvScale + uvOffset );
                        vec4 background = texture(input2, v_uv / uvScale + uvOffset );
                        vec4 c;

                        if (src.a > 0.00001) {
                            
                            c = matrix * src + offset;

                        } else {
                            c = src;
                        }

                        // read previous frame
                        vec4 prev = texture(input1, v_uv);
                        // fade it
                        prev = vec4(mix(background.rgb, prev.rgb, 1.0 - fadeAmount), prev.a);
                        
                        // alpha blend canvas and prev
                        output0 = vec4( c.rgb * c.a + (1.0-c.a) * prev.rgb, max(c.a, prev.a));
                    }`,inputs:["canvasTex","curr","backgroundTex"],outputs:["next"],uniforms:{canvasTex:"sampler2D",backgroundTex:"sampler2D",curr:"sampler2D",fadeAmount:["float",this.fadeAmount],fadeColor:["vec4",new Float32Array(ie(null,ws(s)))],matrix:["mat4",new Float32Array([r[0],r[5],r[10],r[15],r[1],r[6],r[11],r[16],r[2],r[7],r[12],r[17],r[3],r[8],r[13],r[18]])],offset:["vec4",[r[4],r[9],r[14],r[19]]],uvScale:["vec2",[1,1]],uvOffset:["vec2",[0,0]]},state:{blend:!1,blendFn:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEq:e.FUNC_ADD}},Zc(["next"],["curr"]),{fs:`void main() { 
                      
                      vec4 l = texelFetch(input0, ivec2(gl_FragCoord.xy), 0);
                      vec4 b = texelFetch(input1, ivec2(gl_FragCoord.xy), 0); // background
                    
                      // alpha compose background and current frame
                      fragColor = vec4(l.a * l.rgb + (1.0 - l.a) * b.rgb, 1.0); }`,inputs:["curr","backgroundTex"],outputs:[]}]})}pipeline;canvasTex;backgroundTex;fadeAmount;updateImage(e,n){this.pipeline.textures.canvasTex.configure({image:e,width:e.width,height:e.height,flip:!0}),this.pipeline.textures.backgroundTex.configure({image:n,width:n.width,height:n.height,flip:!0})}draw(e,n,s){s!==void 0&&(this.fadeAmount=s,this.pipeline.models[0].uniforms.fadeAmount=this.fadeAmount),this.updateImage(e,n),this.pipeline.update()}}class Og{constructor(e,n,s){this.gl=e;const r=ei(n);this.canvasTex=De(this.gl),this.alphaTex=De(this.gl),this.backgroundTex=De(this.gl),this.fadeAmount=n.fadeAmount||0,this.alphaBoost=s||1,this.pipeline=xc({gl:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,textures:{curr:{format:ke.RGBA32F},next:{format:ke.RGBA32F},canvasTex:{},alphaTex:{},backgroundTex:{}},passes:[{model:hi({uv:!0}),...Xc,fs:`
                    #define saturate(a) clamp( a, 0.0, 1.0 )

                    float decodeAlpha(vec3 rgb) {
                        return dot(rgb, vec3(1.0, 1.0/256.0, 1.0/65536.0));
                    }
                    
                    void main() {
                        vec4 src = texture(input0, v_uv / uvScale + uvOffset );
                        float alpha = min(alphaBoost * src.a * decodeAlpha(texture(input3, v_uv / uvScale + uvOffset).rgb), 1.0);
                        vec4 background = texture(input2, v_uv / uvScale + uvOffset );
                        vec4 c;

                        if (alpha > 0.00001) {
                            
                            c = matrix * src + offset;

                        } else {
                            c = src;
                        }

                        // read previous frame
                        vec4 prev = texture(input1, v_uv);
                        // fade it
                        prev = vec4(mix(background.rgb, prev.rgb, 1.0 - fadeAmount), prev.a);
                        
                        // alpha blend canvas and prev
                        output0 = vec4( c.rgb * alpha + (1.0-alpha) * prev.rgb, max(alpha, prev.a));
                    }`,inputs:["canvasTex","curr","backgroundTex","alphaTex"],outputs:["next"],uniforms:{canvasTex:"sampler2D",backgroundTex:"sampler2D",alphaTex:"sampler2D",curr:"sampler2D",fadeAmount:["float",this.fadeAmount],alphaBoost:["float",this.alphaBoost],matrix:["mat4",new Float32Array([r[0],r[5],r[10],r[15],r[1],r[6],r[11],r[16],r[2],r[7],r[12],r[17],r[3],r[8],r[13],r[18]])],offset:["vec4",[r[4],r[9],r[14],r[19]]],uvScale:["vec2",[1,1]],uvOffset:["vec2",[0,0]]},state:{blend:!1,blendFn:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEq:e.FUNC_ADD}},Zc(["next"],["curr"]),{fs:`void main() { 
                      
                      vec4 l = texelFetch(input0, ivec2(gl_FragCoord.xy), 0);
                      vec4 b = texelFetch(input1, ivec2(gl_FragCoord.xy), 0); // background
                    
                      // alpha compose background and current frame
                      fragColor = vec4(l.a * l.rgb + (1.0 - l.a) * b.rgb, 1.0); }`,inputs:["curr","backgroundTex"],outputs:[]}]})}pipeline;canvasTex;alphaTex;backgroundTex;fadeAmount;alphaBoost;updateImage(e,n,s){this.pipeline.textures.canvasTex.configure({image:e,width:e.width,height:e.height,flip:!0}),this.pipeline.textures.alphaTex.configure({image:s,width:s.width,height:s.height,flip:!0}),this.pipeline.textures.backgroundTex.configure({image:n,width:n.width,height:n.height,flip:!0})}draw(e,n,s,r){r!==void 0&&(this.fadeAmount=r,this.pipeline.models[0].uniforms.fadeAmount=this.fadeAmount),this.updateImage(e,n,s),this.pipeline.update()}}const Lg=(t,e)=>{t.useWebGL||sh(e,e.postprocess);const n={drawCanvas:Ee(t.width,t.height,document.body,{ctx:{colorSpace:"display-p3"}}),useWebGL:t.useWebGL,useSeparateAlpha:t.useWebGL&&t.useSeparateAlpha};return t.useWebGL&&(n.backgroundCanvas=Ee(t.width,t.height,document.body,{ctx:{colorSpace:"display-p3"}}),n.canvas=ch({width:t.width,height:t.height,parent:document.body,version:2,autoScale:!1,opts:{preserveDrawingBuffer:!0}}),"drawingBufferColorSpace"in n.canvas.gl&&t.useDisplayP3&&(n.canvas.gl.drawingBufferColorSpace="display-p3"),n.drawCanvas.canvas.style.display="none",n.backgroundCanvas.canvas.style.display="none",t.useSeparateAlpha?(n.alphaCanvas=Ee(t.width,t.height,document.body),n.alphaCanvas.canvas.style.display="none",n.webGLPipe=new Og(n.canvas.gl,e.postprocess,1.2)):n.webGLPipe=new Cg(n.canvas.gl,e.postprocess,e.colors.bg[0])),n},Bg=(t,e,n)=>{t.drawCanvas.canvas.width=e,t.drawCanvas.canvas.height=n,t.useWebGL&&(t.backgroundCanvas.canvas.width=e,t.backgroundCanvas.canvas.height=n,t.canvas.canvas.width=e,t.canvas.canvas.height=n,t.useSeparateAlpha&&(t.alphaCanvas.canvas.width=e,t.alphaCanvas.canvas.height=n))},Jc=t=>t.useWebGL?t.canvas.canvas:t.drawCanvas.canvas,Tg=(t,e)=>{yn(t.useWebGL?t.backgroundCanvas.canvas.getContext("2d"):t.drawCanvas.canvas.getContext("2d"),e)},kg=(t,e,n)=>{t.useWebGL&&(t.drawCanvas.ctx.clearRect(0,0,t.drawCanvas.canvas.width,t.drawCanvas.canvas.height),t.useSeparateAlpha&&t.alphaCanvas.ctx.clearRect(0,0,t.alphaCanvas.canvas.width,t.alphaCanvas.canvas.height)),t.useSeparateAlpha?us(t.drawCanvas.canvas.getContext("2d"),t.alphaCanvas.canvas.getContext("2d"),e):yn(t.drawCanvas.canvas.getContext("2d"),e),t.useWebGL&&(t.useSeparateAlpha?t.webGLPipe.draw(t.drawCanvas.canvas,t.backgroundCanvas.canvas,t.alphaCanvas.canvas,n):t.webGLPipe.draw(t.drawCanvas.canvas,t.backgroundCanvas.canvas,n))},us=(t,e,n,s={attribs:{},edits:[]},r={attribs:{},edits:[]})=>{if(!n)return;if(at(n,"toHiccup")){us(t,e,n.toHiccup(),s,r);return}if(S(n[0])){for(let u of n)us(t,e,u,s,r);return}const i=n[1];if(i?.__skip)return;const o=co(t,s,$(i)),a=co(e,r,C(i)),c=o?o.attribs:s.attribs,l=a?a.attribs:r.attribs;switch(n[0]){case"g":case"defs":Pg(t,e,o,s,a,r,n);break;case"linearGradient":uo(s,i.id,hc(t,i,n[2]));break;case"radialGradient":uo(s,i.id,gc(t,i,n[2]));break;case"points":yr(t,$(c),$(i),n[2]),yr(e,C(l),C(i),n[2]);break;case"packedPoints":_r(t,$(c),$(i),n[2]),_r(e,C(l),C(i),n[2]);break;case"line":Mt(e,C(l),n[2],n[3]),Mt(t,$(c),n[2],n[3]);break;case"lines":br(t,$(c),n[2]),br(e,C(l),n[2]);break;case"hline":Mt(t,$(c),[-1e6,n[2]],[1e6,n[2]]),Mt(e,C(l),[-1e6,n[2]],[1e6,n[2]]);break;case"vline":Mt(t,$(c),[n[2],-1e6],[n[2],1e6]),Mt(e,C(l),[n[2],-1e6],[n[2],1e6]);break;case"polyline":Er(t,$(c),n[2]),Er(e,C(l),n[2]);break;case"packedPolyline":Rr(t,$(c),$(i),n[2]),Rr(e,C(l),C(i),n[2]);break;case"polygon":Ar(t,$(c),n[2]),Ar(e,C(l),n[2]);break;case"packedPolygon":wr(t,$(c),$(i),n[2]),wr(e,C(l),C(i),n[2]);break;case"path":vr(t,$(c),n[2]),vr(e,C(l),n[2]);break;case"rect":Sr(t,$(c),n[2],n[3],n[4],n[5]??i?.r),Sr(e,C(l),n[2],n[3],n[4],n[5]??i?.r);break;case"circle":case"arc":mr(t,$(c),n[2],n[3],n[4],n[5],n[6]),mr(e,C(l),n[2],n[3],n[4],n[5],n[6]);break;case"ellipse":pr(t,$(c),n[2],n[3],n[4],n[5],n[6],n[7]),pr(e,C(l),n[2],n[3],n[4],n[5],n[6],n[7]);break;case"text":yc(t,c,n[2],n[3],n[4]);break;case"img":mc(t,c,i,n[2],n[3],n[4],n[5])}o&&lo(t,s,o),a&&lo(e,r,a)},Pg=(t,e,n,s,r,i,o)=>{const a=o.length,c=o[0]==="g"&&n||s,l=o[0]==="g"&&r||i;for(let u=2;u<a;u++)us(t,e,o[u],c,l)},$=t=>{const e={...t};return e.alpha=1,e},C=t=>{const e={...t};return e.stroke&&(e.stroke=fo(t.alpha?t.alpha:1)),t.fill&&(e.fill=fo(t.alpha?t.alpha:1)),e.alpha=1,e},Gg={};var Oo={};const Ug=(t,e,n=!1)=>{const s=typeof global<"u"?global:typeof window<"u"?window:void 0;s&&(n||(typeof process<"u"&&Oo!==void 0?Oo.UMBRELLA_GLOBALS:!Gg))&&(s[t]=e)},gi=t=>S(t)?(t.every(e=>k(e)&&e!==""||v(e))||Kc(t),t):k(t)?t.length>0?gi(t.split(".")):[]:t!=null?[t]:[],Fg=(t,e)=>{if(t==null)return!1;e=gi(e);for(let n=e.length-1,s=0;s<=n;s++){const r=e[s];if(!t.hasOwnProperty(r)||(t=t[r],t==null&&s<n))return!1}return!0},zg=t=>{const e=gi(t);return od(e)&&Kc(t),e},Kc=t=>ct(`illegal path: ${JSON.stringify(t)}`);function Hg(t){const e=zg(t);let[n,s,r,i]=e;switch(e.length){case 0:return(o,a)=>a;case 1:return(o,a)=>o?(o[n]=a,o):void 0;case 2:return(o,a)=>{let c;return o&&(c=o[n])?(c[s]=a,o):void 0};case 3:return(o,a)=>{let c;return o&&(c=o[n])&&(c=c[s])?(c[r]=a,o):void 0};case 4:return(o,a)=>{let c;return o&&(c=o[n])&&(c=c[s])&&(c=c[r])?(c[i]=a,o):void 0};default:return(o,a)=>{let c=o;const l=e.length-1;for(let u=0;u<l;u++)if(!(c=c[e[u]]))return;return c[e[l]]=a,o}}}const Qc=(t,e,n)=>Hg(e)(t,n),qg=/^(function\s+\w+)?\s*\(\{([\w\s,:]+)\}/;function Vg(t,e){const n={prefix:"@",unwrap:!0,...e};return Lt(t)?tl(t,n):S(t)?el(t,n):t}const tl=(t,e,n,s=[],r={},i=[])=>{n=n||t;for(let o in t)Rn(n,[...s,o],r,i,e);return!e.unwrap||s.length?t:sl(t,r)},el=(t,e,n,s=[],r={},i=[])=>{n=n||t;for(let o=0,a=t.length;o<a;o++)Rn(n,[...s,o],r,i,e);return!e.unwrap||s.length?t:sl(t,r)},Rn=(t,e,n,s,r)=>{const i=e.join("/");s.indexOf(i)>=0&&ct(`cyclic references not allowed: ${i}`);let[o,a]=nl(t,e);if(!n[i]){if(a)return n[i]=!0,o;let c=x;s.push(i),Lt(o)?tl(o,{...r,unwrap:!1},t,e,n,s):S(o)?el(o,{...r,unwrap:!1},t,e,n,s):!r.onlyFnRefs&&k(o)&&o.startsWith(r.prefix)?c=Rn(t,Lo(e,o,r.prefix.length),n,s,r):Be(o)?c=Wg(o,l=>Rn(t,Lo(e,l,0),n,s,r),i,n):Fg(t,e)||(o=Yg(t,e,n,s,r)),c!==x&&(Qc(t,e,c),o=c),n[i]=!0,s.pop()}return o},Yg=(t,e,n,s,r)=>{let i=s.pop(),o;for(let a=1,c=e.length;a<=c;a++)o=Rn(t,e.slice(0,a),n,s,r);return s.push(i),o},Wg=(t,e,n,s)=>{const r=qg.exec(t.toString());let i;if(r){const o=r[2].replace(/\s|(,\s*$)/g,"").split(/,/g).map(a=>a.split(":")[0]).reduce((a,c)=>(a[c]=e(c),a),{});i=t(o,e)}else i=t(e);return mi(i,n,s),i},mi=(t,e,n)=>{n[e]=!0,Lt(t)?jg(t,e,n):S(t)&&Xg(t,e,n)},jg=(t,e,n)=>{let s,r;for(let i in t)s=t[i],r=e+"/"+i,mi(s,r,n)},Xg=(t,e,n)=>{let s,r;for(let i=0,o=t.length;i<o;i++)s=t[i],r=e+"/"+i,mi(s,r,n)},Lo=(t,e,n=1)=>{if(e.charAt(n)==="/")return e.substring(n+1).split("/");t=t.slice(0,t.length-1);const s=e.substring(n).split("/");for(let r=0,i=s.length;r<i;r++)if(s[r]==="..")!t.length&&ct(`invalid lookup path: ${e}`),t.pop();else return t.concat(s.slice(r));return!t.length&&ct(`invalid lookup path: ${e}`),t};class Bo{constructor(e){this._value=e}deref(){return this._value}}const nl=(t,e)=>{const n=e.length-1;let s=t,r=t instanceof Bo;for(let i=0;s!=null&&i<=n;i++)s=s[e[i]],s instanceof Bo&&(r=!0,s=s.deref());return[s,r]},sl=(t,e)=>{for(let n in e){const s=n.split("/"),r=nl(t,s);r[1]&&Qc(t,s,r[0])}return t},rl=(t,e,n)=>{t.attribs.stroke??=n.stroke.get(t,e);const s=n.stroke.update?n.stroke.update(t,e):t.attribs.stroke;t.attribs.weight??=n.weight.get(t,e);const r=n.weight.update?n.weight.update(t,e):t.attribs.weight;t.attribs.alpha??=n.alpha.get(t,e);const i=n.alpha.update?n.alpha.update(t,e):t.attribs.alpha;return{stroke:s,weight:r,alpha:i}},xg=(t,e,n)=>(t.attribs.style??=n.style.get(t,e),n.style.update?{...t.attribs.style,...n.style.update(t,e)}:t.attribs.style),Zg=(t,e,n)=>n.map(s=>Fd(s,t.pos,[-e.aspectRatio/2,-.5],[e.aspectRatio/2,.5])),To=(t,e,n,s,r,i=0,o)=>({ID:t,parent:o,active:!0,pos:e,dir:n,bounds:s,generation:i,history:{positions:[],length:0},supportData:{features:[],distanceToCenter:0,velocity:[0,0]},opts:r,attribs:{},lastDrawnAtLength:0}),Jg=(t,e,n,s)=>{const{pos:r,bounds:i,history:o,opts:a}=t,{step:c,fuzziness:l,maxLength:u}=a;if(t.active){o.positions.push(Cr(r));const f=e(t,s!==void 0?c*s/1e3:c,[l,l]);jt(i,r)&&!n(t)&&o.length<=u?o.length+=f:t.active=!1}return t},Kg=(t,e)=>(n,s)=>{const{pos:r,dir:i}=n,o=Le([],kr([],i,e.vector_field.get(n,t,[0])),s);return Ct(null,r,o),n.supportData.velocity=o,Dn(o)},Qg=(t,e)=>(n,s)=>{const[r,i]=n.pos;return il(n,t,s,e),le(n.supportData.velocity,n.pos,[r,i]),Dn(n.supportData.velocity)},tm=(t,e)=>(n,s)=>{const{pos:r,dir:i}=n,[o,a]=r;il(n,t,s,e);const c=Le([],kr([],i,e.vector_field.get(n,t,[0])),s);return Ct(null,r,c),le(n.supportData.velocity,n.pos,[o,a]),Dn(n.supportData.velocity)},em=(t,e)=>(t.supportData.features=Zg(t,e.preset,e.images),t.supportData.distanceToCenter=Dn(t.pos),t),il=(t,e,n,s)=>{s.domain_warping&&Ct(null,t.pos,ps([],s.domain_warping.get(t,e),n))},nm={warped:Qg,vector_field:Kg,warped_vector_field:tm},sm=(t,e)=>t.active?e>0?t.history.length-t.lastDrawnAtLength>=e:!0:!1;var rm=Object.getOwnPropertyDescriptor,im=(t,e,n,s)=>{for(var r=s>1?void 0:s?rm(e,n):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(r=o(r)||r);return r};let Mr=class{constructor(t,e,n,s,r=void 0,i=(o,a)=>{}){this.space=n,this.rnd=s,this.data=new Array(t*e).fill(r),this.size=[t,e],this.stride=[1,t],this.spaceMin=n.pos,this.spaceMax=Q([],n.pos,n.size),this.freeValue=r;for(let o=0;o<t;o++)for(let a=0;a<e;a++)this.setAtUnsafe(o,a,i(o,a))}size;stride;spaceMin;spaceMax;data=[];freeValue;agents=[];clear(){const[t,e]=this.size;for(let n=0;n<t;n++)for(let s=0;s<e;s++)this.setAtUnsafe(n,s,this.freeValue)}setAgents(t){this.agents=t}fromSpaceToGrid(t){const[e,n]=es([],t,this.spaceMin,this.spaceMax,[0,0],this.size);return[Math.floor(e),Math.floor(n)]}fromGridToSpace(t){return es([],t,[0,0],this.size,this.spaceMin,this.spaceMax)}isFree(t){const e=this.fromSpaceToGrid(t);return this.isCellFree(e[0],e[1])}checkCollision(t,e,n=!1,s=0){const r=this.fromSpaceToGrid(t.pos);return this.isCellFree(r[0],r[1],e,t,s)?(n&&this.setAt(r[0],r[1],t),!1):!0}isCellFree(t,e,n=0,s,r=0){if(this.includes(t,e)){const i=this.getAt(t,e);return i===this.freeValue||s!==void 0&&i===s||i.ID<r}}randomFree(t,e=0){let n=0;for(;n<1e4;){const s=Wi(t,1,this.rnd);if(s&&s.length>0){const r=this.fromSpaceToGrid(s[0]);if(this.isCellFree(Math.floor(r[0]),Math.floor(r[1]),0,void 0,e))return{pos:s[0],agent:void 0};n++}}return{pos:void 0,agent:void 0}}freeLine(t,e,n,s,r,i=!0,o=0){const a=s*Math.min(this.width,this.height),c=Le([],n,1),l=this.fromSpaceToGrid(e);let u=Ct([],l,c),f=this.fromGridToSpace(u),d=0;for(;(!r||jt(r,f))&&(!i||this.isCellFree(Math.floor(u[0]),Math.floor(u[1]),0,t,o))&&d<a;)Ct(null,u,c),f=this.fromGridToSpace(u),d++;return[f[0],f[1]]}randomOccupied(t,e="random point"){let n=0;for(;n<1e4;){if(e==="random point"){const s=Wi(t,1,this.rnd);if(s){const r=this.fromSpaceToGrid(s[0]);if(!this.isCellFree(Math.floor(r[0]),Math.floor(r[1]),0))return{pos:[s[0][0],s[0][1]],agent:this.getAt(Math.floor(r[0]),Math.floor(r[1]))}}}else if(this.agents.length>0){const s=qt(this.agents,this.agents.map(r=>r.history.length),this.rnd);if(s.history.length>0){const r=E(s.history.positions,this.rnd);if(jt(t,r))return{agent:s,pos:[r[0]+this.rnd.minmax(-.001,.001),r[1]+this.rnd.minmax(-.001,.001)]}}}n++}return{pos:void 0,agent:void 0}}setAtUnsafe(t,e,n){}setAt(t,e,n){}getAt(t,e){}getAtUnsafe(t,e){}includes(t,e){}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}};Mr=im([Fa],Mr);const om=(t,e,n=[])=>({preset:t,agents:[],spaceManager:e,images:n,iterations:0,spaceTraveled:0,agentsToCreate:0,iterationSpawnableAgents:0,activeAgents:0}),am=(t,e,n,s)=>{let r,i;if(t.iterations+=1,t.iterations<e.agentFactory.maxIterations&&t.spaceTraveled<e.agentFactory.maxSpaceTraveled||e.agentFactory.neverEnding){const o=h=>t.spaceManager.checkCollision(h,0,!0,t.agents.length-e.agentFactory.maxColliding),a=$t(Mn(Yt(h=>h.active),H(h=>(em(h,t),Jg(h,nm[h.opts.type?h.opts.type:"vector_field"](t,e),o,s)))),oe(),t.agents);i=$t(Yt(h=>h.active),oe(),a),t.activeAgents=i.length;const c=$t(Yt(h=>!h.active),oe(),a);t.spaceTraveled=t.agents.reduce((h,g)=>h+g.history.length,0),t.agentsToCreate+=c.length*e.agentFactory.branch+e.agentFactory.newPerIteration,t.iterationSpawnableAgents+=e.agentFactory.maxNewPerIteration,r=Math.min(t.agentsToCreate,t.iterationSpawnableAgents,e.agentFactory.maxActive-i.length),e.agentFactory.neverEnding||(r=Math.min(r,e.agentFactory.maxAgents-t.agents.length)),t.agentsCreated=0;let l=0;const f=e.bounds.get(t).init.map(h=>se(h)),d=f.reduce((h,g)=>h+g,0);for(;t.agentsCreated<r&&l<300;)ol(t,e,f,d,n)&&t.agentsCreated++,l++;return t.iterationSpawnableAgents-=t.agentsCreated,!0}return t.iterations>=e.agentFactory.maxIterations&&console.log("max iterations reached"),t.spaceTraveled>=e.agentFactory.maxSpaceTraveled&&console.log("max length reached"),!1},ol=(t,e,n,s,r)=>{let i=!1;const o=e.agentFactory.initPolicy(t),a=e.bounds.get(t);if(o==="randomFree"){const c=s>0?qt(a.init,n,r):E(a.init,r),{pos:l,agent:u}=t.spaceManager.randomFree(c),f=E(e.agentFactory.initialDirections?.length>0?e.agentFactory.initialDirections:e.agentFactory.directions,r);l&&f&&(t.agents.push(To(t.agents.length,l,f,E(a.overall,r),e.agent.get(t))),i=!0,t.agentsToCreate--)}else if(o==="randomOccupied"){const{pos:c,agent:l}=t.spaceManager.randomOccupied(E(a.update,r));c&&l&&(t.agents.push(To(t.agents.length,c,E([[l.dir[1],-l.dir[0]],[-l.dir[1],l.dir[0]]],r),l.bounds,e.agent.get(t),l.generation+1,l)),i=!0,t.agentsToCreate--)}return i},cm=(t,e,n)=>{const s=[],r=le([],e,t),i=Dn(r);let o=n.grains.proportional?Math.floor(i*n.grains.factor):n.grains.factor;const a=1/(o-1);for(let c=0;c<o;c++){let l;n.grains.distribution&&n.grains.distribution==="sin"?l=[t[0]+(e[0]-t[0])*Math.sin(Math.sin(c*a)),t[1]+(e[1]-t[1])*Math.sin(Math.sin(c*a))]:l=z0([],t,e,[c/o,c/o]);let u=n.alpha.min?n.alpha.min:0,f=n.alpha.max===void 0?1:n.alpha.max,d=ut(ne(u,f,n.alpha.decay(1-c/o)),u,f),h=n.color.color;const g=new sn([l],{stroke:h,size:n.size,weight:n.shapeAttribs.weight,shape:"circle",alpha:d,fill:n.shapeAttribs.filled?h:void 0});s.push(g)}return s},lm=(t,e,n)=>{let s=rl(t,e,e.preset),r=xg(t,e,e.preset);const i=[];return r.type.includes("line")&&i.push(um(t,e)),r.type.includes("sanding")&&i.push(fm(t,e,{...s,...r})),r.type.includes("square")&&i.push(hm(t,e,{...s,...r},n)),r.type.includes("circle")&&i.push(dm(t,e,{...s,...r},n)),t.lastDrawnAtLength=t.history.length,de(s,i)},um=(t,e,n=1)=>b0(t.history.positions.at(-n),t.pos,rl(t,e,e.preset)),fm=(t,e,n)=>{const s=[];if(n.type.includes("sanding")){n.color!==void 0&&(n.stroke=n.color);let i=Le([],kr([],t.supportData.velocity,Vn));const o=ko(t.pos,e.spaceManager.freeLine(t,t.pos,i,n.maxLength*(n.multiplyLengthFactor??1),n.followBounds?t.bounds:void 0,!0,e.agents.length-e.preset.agentFactory.maxColliding),n);if(s.push(...o),n.shadingLength>0){const a=ko(t.pos,Ct([],t.pos,Le([],[-i[0],-i[1]],n.shadingLength)),{...n,minAlpha:0,stroke:n.shadingColor!==void 0?n.shadingColor:Re([],ec(-.8),ws(n.stroke)),grainsFactor:n.grainsFactor});s.push(...a)}}return de(n,s)},ko=(t,e,n)=>cm(t,e,{grains:{factor:n.grainsFactor,proportional:!0,distribution:n.grainsDistribution},alpha:{min:n.minAlpha,max:n.maxAlpha>0?n.maxAlpha:n.alpha,decay:n.alphaDecay,multiplyByImage:void 0,luminanceRange:n.multiplyByImageLuminance?n.multiplyByImageLuminance.range:[0,1]},color:{color:n.stroke,fromImage:n.colorFromImage!==void 0?n.colorFromImage.index:void 0},size:Math.max(1e-4,n.weight*n.sizeFactor),shapeAttribs:{weight:n.weightFactor?n.weightFactor*n.weight:n.weight*.5,filled:!0}}),dm=(t,e,n,s)=>{const r=[];return r.push(xs(t.pos,Math.min(n.weight,.6),{...n,alpha:.001})),s.probability(0)&&r.push(xs(t.pos,s.minmax(.001,.01),{...n,fill:Wa([],cn(E(e.preset.colors.fg,s)),s.minmax(.2,.6))})),de(n,r)},hm=(t,e,n,s)=>{const r=[];return s.probability(5e-4)&&r.push(Ze(t.pos,[s.minmax(.001,.3),s.minmax(.001,.3)],{...n,fill:Wa([],cn(E(e.preset.colors.fg,s)),s.minmax(.2,.6))})),de(n,r)},gm=(t,e,n,s,r,i)=>{const o=[];return t.forEach((a,c)=>{if(e[c%e.length]){const l=r[c%r.length],u={weight:s[c%s.length],stroke:l};n[c%n.length]&&(u.fill=l),i&&(u.r=i[c%i.length]),a.attribs=u,o.push(a)}}),de({lineCap:"round",radius:300},o)};let Ne,pi,it;addEventListener("beforeunload",t=>{console.log("beforeunload"),pi=[]});const mm=async(t,e,n,s)=>{const r=Vg({...t(e,n,s)},{onlyFnRefs:!0});return Ne={preset:r,iterations:0,presetId:r.name,lineSlice:-1},pi=await Pd(r.assets),r.assets.length>0&&console.log("using images "+r.assets.map(i=>i).join(", ")),Ug("state",Ne),Ne},pm=t=>{const{preset:e}=Ne,{gridSize:n,aspectRatio:s}=e;it=om(e,new Mr(Math.floor(n[0]),Math.floor(n[1]),vn([-s/2,-.5],[s,1]),t.RND,0,(o,a)=>0),pi),window.agents=it;const r=e.bounds.get(it).init.map(o=>se(o)),i=r.reduce((o,a)=>o+a,0);for(let o=0;o<e.agentFactory.initialAgents;o++)ol(it,e,r,i,t.RND);return it.agentsToCreate=0,it},bm=(t,e)=>{const{preset:n}=Ne;return am(it,n,t.RND,e)},_m=(t,e,n,s=!1,r=!1,i=!1)=>{const{preset:o}=Ne,a=s||r,c=it.preset.agent.get(it).minSpaceBeforeDrawing||0,l=$t(Mn(Yt(f=>f.active&&f.history.positions.length>0&&sm(f,c)),H(f=>lm(f,it,n))),oe(),it.agents),u=de({lineCap:"round",lineJoin:"round"},l);return a&&(i||s)&&u.children.unshift(al(t,f=>f,o.background)),e(u)},al=(t,e,n,s)=>{const r=[];return s&&r.push(vn(t,{fill:s})),n&&r.push(e(gm(n.shapes,n.draw,n.fill,n.weights,n.colors,n.rounds))),de({lineCap:"round"},r)},vm=(t=!1)=>{const e=document.createElement("div");e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.padding="12px 16px",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.fontFamily="monospace",e.style.fontSize="2vw",e.style.borderRadius="4px",e.style.zIndex="1000",e.style.display=t?"block":"none",e.style.pointerEvents="none",e.style.whiteSpace="pre-line",document.body.appendChild(e);let n=t;return{element:e,isVisible:n,toggle:()=>{n=!n,e.style.display=n?"block":"none"},update:(i,o,a,c)=>{n&&(e.textContent=`Frame: ${i}
        FPS: ${o}
        SpaceTraveled: ${a.spaceTraveled.toFixed(2)}
        Agents: ${a.agents.length}
        ActiveAgents: ${a.activeAgents}
        AgentsCreated: ${a.agentsCreated}
        Preset: ${c.presetId}`)}}};$genart.configure({id:"layer-trippy",allowExternalConfig:!1});await $genart.waitForAdapter();const un=await $genart.setParams({hash:$genart.params.choice({name:"Hash",desc:"seed for random",edit:"protected",options:["random",...rh],default:"random"}),numAgents:$genart.params.range({name:"Max Active Agents",desc:"Max number of active agents",edit:"protected",min:1,max:200,step:1,default:20}),speed:$genart.params.range({name:"speed multiplier",desc:"speed multiplier of the drawing system",edit:"protected",min:.1,max:10,step:.1,default:2}),fade:$genart.params.range({name:"fade multiplier",desc:"fade multiplier of the drawing system",edit:"protected",min:0,max:10,step:.01,default:1})});$genart.random.reset();let Qt=$genart.random,Dr=$genart.seed;un("hash")!=="random"&&(Dr=un("hash"),Qt=new $genart.prng.SFC32(Hd(Dr)));const fs={RND:new Jt(Qt.rnd),RND_COLORS:new Jt(Qt.copy().rnd),RND_STYLE:new Jt(Qt.copy().rnd),RND_BOUNDS:new Jt(Qt.copy().rnd),RND_NOISE:new Jt(Qt.copy().rnd),RND_SYSTEM:new Jt(Qt.copy().rnd)};let ym=!0,Am=!1,wm=!0,Nr,cl,re,Po=1*60,Em=!1,Rm=-1,Go=0,Uo=0,Sm=!1;const ds=await mm(ih,fs,$genart.screen.width,$genart.screen.height),{preset:Qe}=ds;console.log($genart.seed,Qe);$genart.on("genart:param-change",({paramID:t,param:e})=>{console.log("param change:",t,e)});$genart.on("genart:resize",({screen:t})=>{console.log("resize",t),ll()});let te,ee,bi;const ll=()=>{({width:te,height:ee}=$genart.screen),re||(re=Lg({useWebGL:ym,width:te,height:ee,useDisplayP3:wm,useSeparateAlpha:Am},Qe),bi=vm(Sm)),Bg(re,te,ee),cl=pm(fs),Nr=t=>Qs(Ks(t,[te/Qe.aspectRatio,ee]),[te/2,ee/2]),Tg(re,al([te,ee],Nr,Qe.background,Qe.colors.bg[0]))};ll();$genart.setUpdate((t,e)=>{const{preset:n}=ds;n.agentFactory.maxActive=un("numAgents"),Uo=(n.postprocess.fadeAmount||0)*un("fade");const s=Math.min(t-Go,100);Go=t;let r=!0;if(Po<=0){r=r&&bm(fs,s*un("speed"));const i=r&&_m([te,ee],Nr,fs.RND_STYLE,Em);r&&kg(re,i,Uo),r||console.log("stop")}return Po--,e===0&&$genart.capture(Jc(re)),e===Rm&&ul(),bi.update(e,Math.round(1e3/Math.max(s,1)),cl,ds),r});window.onkeydown=t=>{switch(t.key){case"x":ul();break;case"o":bi.toggle();break}};const ul=()=>{Nf(Jc(re),`${ds.presetId}-${Dr}-${Yf()}`,"png"),console.log("saved to image")};
