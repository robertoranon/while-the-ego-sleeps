(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const ir=1/2**32;class Fa{float(e=1){return this.int()*ir*e}probability(e){return this.float()<e}norm(e=1){return(this.int()*ir-.5)*2*e}normMinMax(e,n){const s=this.minmax(e,n);return this.float()<.5?s:-s}minmax(e,n){return this.float()*(n-e)+e}minmaxInt(e,n){e|=0;const s=(n|0)-e;return s?e+this.int()%s:e}minmaxUint(e,n){e>>>=0;const s=(n>>>0)-e;return s?e+this.int()%s:e}}class Jt extends Fa{constructor(e){super(),this.rnd=e}float(e=1){return this.rnd()*e}norm(e=1){return(this.rnd()-.5)*2*e}int(){return this.rnd()*4294967296>>>0}}const ce=new Jt(Math.random),w=(t,e=ce,n=0,s=t.length)=>t[e.minmax(n,s)|0],za=(t,e=ce)=>w(Object.keys(t),e),yn=(t,e=n=>n!==void 0?": "+n:"")=>class extends Error{origMessage;constructor(n){super(t(n)+e(n)),this.origMessage=n!==void 0?String(n):""}},Ha={};var rr={};const qa=yn(()=>"Assertion failed"),S=(typeof process<"u"&&rr!==void 0?rr.UMBRELLA_ASSERTS:!Ha)?(t,e)=>{if(typeof t=="function"&&!t()||!t)throw new qa(typeof e=="function"?e():e)}:()=>{},Va=(t,e,n=ce)=>{const s=t.length;S(s>0,"no choices given");const i=e?t.map((o,c)=>[e[c]||0,o]).sort((o,c)=>c[0]-o[0]):t.map(o=>[1,o]),r=i.reduce((o,c)=>o+c[0],0);return r<=0&&console.warn("total weights <= 0"),()=>{const o=n.float(r);let c=r;for(let a=0;a<s;a++)if(c-=i[a][0],c<=o)return i[a][1]}},Ya=(t,e=t,n,s={})=>{const i=document.createElement("canvas");return Fs(i,t,e,s.dpr),s.pixelated&&(i.style.imageRendering="pixelated"),n?.appendChild(i),{canvas:i,ctx:i.getContext("2d",s.ctx)}},rn=(t,e=t,n,s)=>Ya(t,e,n,{dpr:1,...s}),Fs=(t,e,n,s=window.devicePixelRatio||1)=>(s!==1&&(t.style.width=`${e}px`,t.style.height=`${n}px`),t.width=e*s,t.height=n*s,s);let vt=20;const ja=yn(()=>"unsupported operation"),At=t=>{throw new ja(t)},P=(t=1,e,...n)=>{const s=[,,].concat(n),i=(...r)=>{const o=s[r[t].length]||e;return o?o(...r):At(`no impl for vec size ${r[t].length}`)};return i.add=(r,o)=>s[r]=o,i.default=r=>e=r,i.impl=r=>r!=null&&s[r]||e,i},Be=(t,e=1,n=!0)=>{const s=n?(c,a,l)=>{!c&&(c=a);for(let u=a.length;u-- >0;)c[u]=t(a[u],l[u]);return c}:(c,a,l)=>{!c&&(c=l);for(let u=a.length;u-- >0;)c[u]=t(a[u],l[u]);return c},i=n?(c,a,l)=>(!c&&(c=a),c[0]=t(a[0],l[0]),c[1]=t(a[1],l[1]),c):(c,a,l)=>(!c&&(c=l),c[0]=t(a[0],l[0]),c[1]=t(a[1],l[1]),c),r=n?(c,a,l)=>(!c&&(c=a),c[0]=t(a[0],l[0]),c[1]=t(a[1],l[1]),c[2]=t(a[2],l[2]),c):(c,a,l)=>(!c&&(c=l),c[0]=t(a[0],l[0]),c[1]=t(a[1],l[1]),c[2]=t(a[2],l[2]),c),o=n?(c,a,l)=>(!c&&(c=a),c[0]=t(a[0],l[0]),c[1]=t(a[1],l[1]),c[2]=t(a[2],l[2]),c[3]=t(a[3],l[3]),c):(c,a,l)=>(!c&&(c=l),c[0]=t(a[0],l[0]),c[1]=t(a[1],l[1]),c[2]=t(a[2],l[2]),c[3]=t(a[3],l[3]),c);return[P(e,s,i,r,o),i,r,o]},Eo=(t,e)=>t+e,Wa=(t,e)=>t/e,wo=(t,e,n)=>t*e+n,Ro=(t,e,n)=>t+(e-t)*n,So=(t,e)=>t*e,Io=(t,e)=>t-e,Xa=(t,e,n)=>(t-e)*n,[xa,Za,Ja,lm]=Be(Eo),Ot=xa,J=Za,be=Ja,ls=(t,e=1)=>{const n=(o,c,a)=>{!o&&(o=c);for(let l=c.length;l-- >0;)o[l]=t(c[l],a);return o},s=(o,c,a)=>(!o&&(o=c),o[0]=t(c[0],a),o[1]=t(c[1],a),o),i=(o,c,a)=>(!o&&(o=c),o[0]=t(c[0],a),o[1]=t(c[1],a),o[2]=t(c[2],a),o),r=(o,c,a)=>(!o&&(o=c),o[0]=t(c[0],a),o[1]=t(c[1],a),o[2]=t(c[2],a),o[3]=t(c[3],a),o);return[P(e,n,s,i,r),s,i,r]},[um,Ka,Qa,fm]=ls(Eo),Mo=Ka,tl=Qa,or=-1/0,cr=1/0,el=Object.freeze([or,or]),nl=Object.freeze([cr,cr]),ht=Object.freeze([0,0]),sl=Object.freeze([1,0]),dt=Object.freeze([0,0,0]),xt=Object.freeze([0,0,0,0]),il=(t,e=1)=>{const n=(o,c,a,l)=>{!o&&(o=c);for(let u=c.length;u-- >0;)o[u]=t(c[u],a,l[u]);return o},s=(o,c,a,l)=>(!o&&(o=c),o[0]=t(c[0],a,l[0]),o[1]=t(c[1],a,l[1]),o),i=(o,c,a,l)=>(!o&&(o=c),o[0]=t(c[0],a,l[0]),o[1]=t(c[1],a,l[1]),o[2]=t(c[2],a,l[2]),o),r=(o,c,a,l)=>(!o&&(o=c),o[0]=t(c[0],a,l[0]),o[1]=t(c[1],a,l[1]),o[2]=t(c[2],a,l[2]),o[3]=t(c[3],a,l[3]),o);return[P(e,n,s,i,r),s,i,r]},[rl,ol,cl,hm]=il(wo),xe=rl,qn=ol,zs=cl,[al,ll,ul,dm]=Be(Math.max),Hs=al,Vn=ll,ar=ul,k=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t),Nt=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t),ne=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t),Et=P(1,(t,e)=>{!t&&(t=[]);for(let n=e.length;n-- >0;)t[n]=e[n];return t},k,Nt,ne),y=t=>typeof t=="number",lr=Object.getPrototypeOf,Ct=t=>{let e;return t!=null&&typeof t=="object"&&((e=lr(t))===null||lr(e)===null)},fl=(t,e=0)=>new Array(t).fill(e),pi=t=>{if(t.length){const e=t[t.length-1];return Ct(e)?t.pop():(e==null&&t.pop(),void 0)}},hl=t=>{const e=pi(t);return t.length?t.length===2?[t[0],t[1],e]:[void 0,t[0],e]:[void 0,void 0,e]},dl=t=>{const e=pi(t);return t.length?t.length===2?[t[0],t[1],e]:y(t[0])?[void 0,t[0],e]:[t[0],void 0,e]:[void 0,void 0,e]},x=(t,e=2)=>y(t)?fl(e,t):t,gl=t=>t instanceof Set,wt=(t,e)=>typeof t?.[e]=="function",ml=t=>gl(t)?t:new Set(t),pl=(t,e)=>{const n=ml(e),s={};for(let i in t)t.hasOwnProperty(i)&&!n.has(i)&&(s[i]=t[i]);return s},_i=t=>wt(t,"copy")?t.copy():Et([],t),bi=t=>t.map(_i),A=(t,...e)=>t?e.length?pl({...t},e):{...t}:void 0,qe=t=>A(t.attribs,"__samples"),jt=(t,e,n)=>new t(n||bi(e.points),A(e.attribs));class Ie{constructor(e=[0,0,0],n=1,s){this.pos=e,this.attribs=s,this.size=ar(null,x(n,3),dt)}type="aabb";dim=3;size;copy(){return new Ie(Nt([],this.pos),Nt([],this.size),A(this.attribs))}withAttribs(e){return new Ie(this.pos,this.size,e)}min(){return Nt([],this.pos)}max(){return be([],this.pos,this.size)}offset(e){const n=zs([],this.size,.5,this.pos);return ar(null,tl(null,this.size,e*2),dt),zs(this.pos,this.size,-.5,n),this}toHiccup(){return["aabb",this.attribs,this.pos,this.size]}}const D=Array.isArray,yi=t=>t!=null&&typeof t!="function"&&t.length!==void 0,_l=yn(()=>"illegal argument(s)"),it=t=>{throw new _l(t)},bl=t=>((t==null||!t[Symbol.iterator])&&it(`value is not iterable: ${t}`),t),Do=t=>D(t)?t:[...bl(t)];class us{constructor(e,n){this.attribs=n,this.points=e?Do(e):[]}points;*[Symbol.iterator](){yield*this.points}clear(){this.points.length=0}}const ur=Object.getPrototypeOf({}),Mn="function",fr="string",rt=(t,e)=>{let n;if(t===e)return!0;if(t!=null){if(typeof t.equiv===Mn)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===Mn)return e.equiv(t)}else return t==e;return typeof t===fr||typeof e===fr?!1:(n=Object.getPrototypeOf(t),(n==null||n===ur)&&(n=Object.getPrototypeOf(e),n==null||n===ur)?Al(t,e):typeof t!==Mn&&t.length!==void 0&&typeof e!==Mn&&e.length!==void 0?vi(t,e):t instanceof Set&&e instanceof Set?yl(t,e):t instanceof Map&&e instanceof Map?vl(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},vi=(t,e,n=rt)=>{let s=t.length;if(s===e.length)for(;s-- >0&&n(t[s],e[s]););return s<0},yl=(t,e,n=rt)=>t.size===e.size&&n([...t.keys()].sort(),[...e.keys()].sort()),vl=(t,e,n=rt)=>t.size===e.size&&n([...t].sort(),[...e].sort()),Al=(t,e,n=rt)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let s in t)if(!e.hasOwnProperty(s)||!n(t[s],e[s]))return!1;return!0},et=Math.PI,$=et*2,Gn=et/2;let U=1e-6;const Ai=(t,e=1)=>[Math.cos(t)*e,Math.sin(t)*e],El=t=>(t%=$,t<0?$+t:t),wl=t=>(t=Math.abs(t),t>et?$-t:t),ot=(t,e,n)=>t<e?e:t>n?n:t,v=t=>t<0?0:t>1?1:t,No=(t,e,n)=>t>=e&&t<=n,Ei=(t,e,n)=>n!==e?(t-e)/(n-e):0,Q=(t,e,n,s,i)=>s+(i-s)*Ei(t,e,n),on=(t,e,n,s,i)=>s+(i-s)*v(Ei(t,e,n)),Rl=(t,e,n)=>e+(n-e)*v(t),[Sl,Il,Ml,gm]=Be(So),Dl=Sl,Y=Il,Ue=Ml,Nl=(t,e)=>(n,s,i)=>{n?n!==s&&Et(n,s):n=s;const r=Math.sin(i),o=Math.cos(i),c=s[t],a=s[e];return n[t]=c*o-a*r,n[e]=c*r+a*o,n},$o=Nl(0,1),wi=$o,Oo=(t,e,n,s,i=[])=>J(null,$o(null,Y(i,Ai(s),e),n),t),[$l,Ol,Ll,mm]=ls(So),fs=$l,Ae=Ol,qs=Ll,Cl=(t,e,n,s,i,r,o)=>(!t&&(t=e),xe(t,s,o,xe(t,n,r,fs(t,e,i)))),Bl=(t,e,n,s,i,r,o,c,a)=>(!t&&(t=e),xe(t,i,a,xe(t,s,c,xe(t,n,o,fs(t,e,r))))),Tl=(t,e,n,s,i,r)=>{const o=1-r,c=o*o,a=r*r;return Bl(t,e,n,s,i,c*o,3*c*r,3*a*o,a*r)},Pl=(t,e)=>{const n=pi(e);return new t(e.length===1?e[0]:e,n)},Ul=(t,e)=>S(t===e,`require ${e} points`);class Me{constructor(e=[0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}type="circle";dim=2;copy(){return new Me(k([],this.pos),this.r,A(this.attribs))}withAttribs(e){return new Me(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class Vt extends us{type="poly";dim=2;add(...e){this.points.push(...e)}copy(){return jt(Vt,this)}copyTransformed(e){return jt(Vt,this,e(this.points))}withAttribs(e){return new Vt(this.points,e)}toHiccup(){return["polygon",this.attribs,this.points]}}class De{constructor(e=[0,0],n=[1,1],s){this.pos=e,this.attribs=s,this.r=x(n)}type="ellipse";dim=2;r;copy(){return new De(k([],this.pos),k([],this.r),A(this.attribs))}withAttribs(e){return new De(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class Ze{constructor(e,n){this.attribs=e,this.children=n?Do(n):[]}type="group";dim=2;children;*[Symbol.iterator](){yield*this.children}add(...e){return this.children.push(...e),this}clear(){this.children.length=0}copy(){return this.copyTransformed(e=>e.copy())}copyTransformed(e){return new Ze(A(this.attribs),this.children.map(e))}withAttribs(e){return new Ze(e,this.children)}equiv(e){return e instanceof Ze&&rt(this.attribs,e.attribs)&&rt(this.children,e.children)}toHiccup(){return["g",this.attribs,...this.children.map(e=>e.toHiccup())]}}const hr=(t,e)=>y(t)?[t,0,!1]:[t.theta?Math.floor($/t.theta):t.dist?Math.floor($/(t.dist/e)):t.num||vt,(t.start||0)*$,t.last===!0],ct=(t,e)=>{if(e){const n=e.__samples;return y(t)?y(n)?n:{num:t,...n}:y(n)?{...t,num:n}:{...t,...n}}return t},Gl=(t,e)=>t[0]===e[0]?["V",e[1]]:t[1]===e[1]?["H",e[0]]:["L",e];class Je extends us{type="line";dim=2;constructor(e,n){super(e,n),Ul(this.points.length,2)}copy(){return jt(Je,this)}copyTransformed(e){return jt(Je,this,e(this.points))}withAttribs(e){return new Je(this.points,e)}toHiccup(){return[this.type,this.attribs,this.points[0],this.points[1]]}toHiccupPathSegments(){return[Gl(this.points[0],this.points[1])]}}const Lo=t=>t[t.length-1],Yn=t=>t,Te=t=>typeof t?.[Symbol.iterator]=="function",vn=(t,e)=>[t[0],t[1],e];class cn{value;constructor(e){this.value=e}deref(){return this.value}}const dr=t=>new cn(t),Lt=t=>t instanceof cn,kl=t=>t instanceof cn?t:new cn(t),an=t=>t instanceof cn?t.deref():t,Fl=()=>t=>{const e=t[2];return vn(t,(n,s)=>{if(s){for(let i of an(s)||[])if(n=e(n,i),Lt(n))break}return Lt(s)?kl(n):n})},zl=yn(()=>"illegal arity"),Ri=t=>{throw new zl(t)};function Co(...t){let[e,n,s,i,r,o,c,a,l,u]=t;switch(t.length){case 0:Ri(0);case 1:return e;case 2:return(...h)=>e(n(...h));case 3:return(...h)=>e(n(s(...h)));case 4:return(...h)=>e(n(s(i(...h))));case 5:return(...h)=>e(n(s(i(r(...h)))));case 6:return(...h)=>e(n(s(i(r(o(...h))))));case 7:return(...h)=>e(n(s(i(r(o(c(...h)))))));case 8:return(...h)=>e(n(s(i(r(o(c(a(...h))))))));case 9:return(...h)=>e(n(s(i(r(o(c(a(l(...h)))))))));case 10:default:const f=(...h)=>e(n(s(i(r(o(c(a(l(u(...h))))))))));return t.length===10?f:Co(f,...t.slice(10))}}const hs=t=>wt(t,"xform")?t.xform():t;function An(...t){return t=t.map(hs),Co.apply(null,t)}const W=Symbol(),gr=()=>{},Hl=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:Ri(t.length);function ln(...t){const e=t[0],n=e[0],s=e[1],i=e[2];t=Hl(t);const r=t[0]==null?n():t[0],o=t[1];return an(s(wt(o,"$reduce")?o.$reduce(i,r):yi(o)?ql(i,r,o):Vl(i,r,o)))}const ql=(t,e,n)=>{for(let s=0,i=n.length;s<i;s++)if(e=t(e,n[s]),Lt(e)){e=e.deref();break}return e},Vl=(t,e,n)=>{for(let s of n)if(e=t(e,s),Lt(e)){e=e.deref();break}return e},ds=(t,e)=>[t,Yn,e],Yl=(t,e)=>{const n=e.length-1;return Te(e[n])?e.length>1?ln(t.apply(null,e.slice(0,n)),e[n]):ln(t(),e[0]):void 0};function se(t){return t?[...t]:ds(()=>[],(e,n)=>(e.push(n),e))}function*Bo(t,e){const n=hs(t)(se()),s=n[1],i=n[2];for(let r of e){const o=i([],r);if(Lt(o)){yield*an(s(o.deref()));return}o.length&&(yield*o)}yield*an(s([]))}function*gs(t,e){const n=hs(t)([gr,gr,(s,i)=>i])[2];for(let s of e){let i=n(W,s);if(Lt(i)){i=an(i.deref()),i!==W&&(yield i);return}i!==W&&(yield i)}}const jl=(t,e,n=gs)=>{const s=e.length-1;return Te(e[s])?e.length>1?n(t.apply(null,e.slice(0,s)),e[s]):n(t(),e[0]):void 0};function F(t,e){return Te(e)?gs(F(t),e):n=>{const s=n[2];return vn(n,(i,r)=>s(i,t(r)))}}function jn(t,e){return Te(e)?Bo(jn(t),e):An(F(t),Fl())}class Ke extends us{type="points";dim=2;copy(){return jt(Ke,this)}copyTransformed(e){return jt(Ke,this,e(this.points))}withAttribs(e){return new Ke(this.points,e)}toHiccup(){return[this.type,this.attribs,this.points]}}class ie extends us{type="poly3";dim=3;add(...e){this.points.push(...e)}copy(){return jt(ie,this)}copyTransformed(e){return jt(ie,this,e(this.points))}withAttribs(e){return new ie(this.points,e)}toHiccup(){return["polygon3",this.attribs,this.points]}}class un{constructor(e,n,s){this.pos=e,this.dir=n,this.attribs=s}type="ray";dim=2;copy(){return new un(k([],this.pos),k([],this.dir),A(this.attribs))}withAttribs(e){return new un(this.pos,this.dir,e)}toHiccup(){return["line",this.attribs,this.pos,qn([],this.dir,1e6,this.pos)]}}class fn{constructor(e,n,s){this.pos=e,this.dir=n,this.attribs=s}type="ray3";dim=3;copy(){return new fn(Nt([],this.pos),Nt([],this.dir),A(this.attribs))}withAttribs(e){return new fn(this.pos,this.dir,e)}toHiccup(){return["line3",this.attribs,this.pos,zs([],this.dir,1e6,this.pos)]}}class H{constructor(e=[0,0],n=1,s){this.pos=e,this.attribs=s,this.size=Vn(null,x(n),ht)}type="rect";dim=2;size;copy(){return new H(k([],this.pos),k([],this.size),A(this.attribs))}withAttribs(e){return new H(this.pos,this.size,e)}min(){return k([],this.pos)}max(){return J([],this.pos,this.size)}offset(e){const n=qn([],this.size,.5,this.pos);return Vn(null,Mo(null,this.size,e*2),ht),qn(this.pos,this.size,-.5,n),this}toHiccup(){return[this.type,this.attribs,this.pos,this.size[0],this.size[1]]}}class hn{constructor(e=[0,0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}type="sphere";dim=3;copy(){return new hn(Nt([],this.pos),this.r,A(this.attribs))}withAttribs(e){return new hn(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class dn{constructor(e,n,s){this.pos=e,this.body=n,this.attribs=s}type="text";dim=2;copy(){return new dn(Et([],this.pos),this.body,A(this.attribs))}withAttribs(e){return new dn(this.pos,this.body,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.body]}}const[Wl,Xl,pm,_m]=Be(Math.min),Vs=Wl,To=Xl,[xl,Zl,Jl,bm]=Be(Io),oe=xl,Wn=Zl,Kl=Jl,[ym,Ql,vm,Am]=ls(Io),mr=Ql,tu=(t,e,n)=>new Ie(t,Kl([],e,t),n),eu=(t,e,n,s)=>tu(t,e,s).offset(n),Po=(t,e=1)=>{const n=(o,c)=>{!o&&(o=c);for(let a=c.length;a-- >0;)o[a]=t(c[a]);return o},s=(o,c)=>(!o&&(o=c),o[0]=t(c[0]),o[1]=t(c[1]),o),i=(o,c)=>(!o&&(o=c),o[0]=t(c[0]),o[1]=t(c[1]),o[2]=t(c[2]),o),r=(o,c)=>(!o&&(o=c),o[0]=t(c[0]),o[1]=t(c[1]),o[2]=t(c[2]),o[3]=t(c[3]),o);return[P(e,n,s,i,r),s,i,r]},[Em,nu,wm,Rm]=Po(Math.abs),su=nu,Z=(t,e,n,s)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t),L=(t,e,n,s,i)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t[3]=i,t),Uo=(t,e)=>t[0]*e[1]-t[1]*e[0],Go=(t,e)=>t[0]*e[0]+t[1]*e[1],Si=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],iu=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],ru=P(0,(t,e)=>{let n=0;for(let s=t.length;s-- >0;)n+=t[s]*e[s];return n},Go,Si,iu),ko=t=>t[0]*t[0]+t[1]*t[1],Fo=t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2],ou=t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3],Ii=P(0,t=>{let e=0;for(let n=t.length;n-- >0;)e+=t[n]*t[n];return e},ko,Fo,ou),En=t=>Math.sqrt(Ii(t)),pr=(t,e,n=!1)=>{const s=Math.atan2(Uo(t,e),Go(t,e));return n?wl(s):s},[Sm,cu,Im,Mm]=Be(Wa),_r=cu,au=Math.abs,bt=(t,e,n=U)=>au(t-e)<=n,zo=(t,e,n=U)=>t.length===e.length&&bt(t[0],e[0],n)&&bt(t[1],e[1],n),lu=(t,e,n=U)=>t.length===e.length&&bt(t[0],e[0],n)&&bt(t[1],e[1],n)&&bt(t[2],e[2],n),Ho=(t,e,n=U)=>t.length===e.length&&bt(t[0],e[0],n)&&bt(t[1],e[1],n)&&bt(t[2],e[2],n)&&bt(t[3],e[3],n),Ve=P(0,(t,e,n=U)=>wt(t,"eqDelta")?t.eqDelta(e,n):wt(e,"eqDelta")?e.eqDelta(t,n):uu(t,e,t.length,n),zo,lu,Ho),uu=(t,e,n,s=U,i=0,r=0,o=1,c=1)=>{for(;n>0;n--,i+=o,r+=c)if(!bt(t[i],e[r],s))return!1;return!0},fu=(t,e,n=U)=>{for(let s=e.length;s-- >0;)if(Ve(t,e[s],n))return!0;return!1},[hu,Dm,Nm,$m]=Po(t=>-t),du=hu,[Om,gu,Lm,Cm]=ls(Math.pow),mu=gu,qo=(t,e=1)=>{const n=(o,c,a,l)=>{!o&&(o=c);for(let u=c.length;u-- >0;)o[u]=t(c[u],a[u],l);return o},s=(o,c,a,l)=>(!o&&(o=c),o[0]=t(c[0],a[0],l),o[1]=t(c[1],a[1],l),o),i=(o,c,a,l)=>(!o&&(o=c),o[0]=t(c[0],a[0],l),o[1]=t(c[1],a[1],l),o[2]=t(c[2],a[2],l),o),r=(o,c,a,l)=>(!o&&(o=c),o[0]=t(c[0],a[0],l),o[1]=t(c[1],a[1],l),o[2]=t(c[2],a[2],l),o[3]=t(c[3],a[3],l),o);return[P(e,n,s,i,r),s,i,r]},[Bm,pu,Tm,Pm]=qo(Xa),_u=pu,bu=(t,e,n,s=0,i=!1,r=!1)=>{const o=su([],n);if(zo(t,e)||o[0]<U||o[1]<U)return;s%=$;const c=_u([],t,e,.5),a=Math.cos(s),l=Math.sin(s),u=[a*c[0]+l*c[1],-l*c[0]+a*c[1]],[f,h]=mu([],u,2),g=f/(o[0]*o[0])+h/(o[1]*o[1]);g>1&&Ae(o,o,Math.sqrt(g));const[d,p]=o,b=d*d,m=p*p,I=Math.max(0,(b*m-b*h-m*f)/(b*h+m*f)),M=(i!==r?1:-1)*Math.sqrt(I),N=[M*(d*u[1]/p),M*(-(p*u[0])/d)],Pt=[a*N[0]-l*N[1]+(t[0]+e[0])/2,l*N[0]+a*N[1]+(t[1]+e[1])/2],Ut=_r(null,Wn([],u,N),o),O=_r(null,Wn(null,du([],u),N),o),Gt=pr(sl,Ut);let fe=pr(Ut,O);return!r&&fe>0?fe-=$:r&&fe<0&&(fe+=$),fe%=$,{center:Pt,r:o,axis:s,start:Gt,end:Gt+fe,xl:i,cw:r}},yu=(t,e)=>Math.abs(t-e),vu=(t,e=U)=>t>e?1:t<-e?-1:0,te=(t,e,n)=>t+(e-t)*n,Vo=(t,e,n,s,i,r)=>{const o=1-i,c=1-r;return t*o*c+e*i*c+n*o*r+s*i*r},Au=(t,e,n,s,i)=>{const r=i*i,o=1-i,c=o*o;return t*c*o+e*3*c*i+n*3*r*o+s*r*i},Eu=(t,e,n,s,i)=>{const r=i-1,o=i*i,c=r*r,a=(1+2*i)*c,l=i*c,u=o*(3-2*i),f=o*r;return a*t+l*e+u*n+f*s},Ge=(t,e,n,s,i)=>{s*=.5;const r=-.5*t+1.5*e-1.5*n+s,o=t-2.5*e+2*n-s,c=-.5*t+.5*n,a=e,l=i*i;return i*l*r+l*o+i*c+a},Yo=(t,e,n,s,i,r,o,c,a,l,u,f,h,g,d,p,b,m)=>Ge(Ge(t,e,n,s,b),Ge(i,r,o,c,b),Ge(a,l,u,f,b),Ge(h,g,d,p,b),m),br=(t,e,n=.5,s=0,i=2)=>n*((e-t)/(i-s)),wu=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1];return n*n+s*s},Ru=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1],i=t[2]-e[2];return n*n+s*s+i*i},Su=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1],i=t[2]-e[2],r=t[3]-e[3];return n*n+s*s+i*i+r*r},wn=P(0,(t,e)=>{let n=0;for(let s=t.length;s-- >0;){const i=t[s]-e[s];n+=i*i}return n},wu,Ru,Su),Iu=(t,e)=>Math.sqrt(wn(t,e)),[Mu,Um,Gm,km]=qo(Ro),Xn=Mu;function Ys(...t){return new Me(...dl(t))}var gt=(t=>(t[t.FINE=0]="FINE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.SEVERE=4]="SEVERE",t[t.NONE=5]="NONE",t))(gt||{});let Du=0;class Nu{constructor(e,n=gt.FINE,s){this.parent=s,this.id=e||`logger-${Du++}`,this.level=typeof n=="string"?gt[n]:n}id;level;addChild(e){return e.parent=this,e}enabled(e){return this.level<=e}fine(...e){this.log(gt.FINE,e)}debug(...e){this.log(gt.DEBUG,e)}info(...e){this.log(gt.INFO,e)}warn(...e){this.log(gt.WARN,e)}severe(...e){this.log(gt.SEVERE,e)}none(){}log(e,n){this.level<=e&&this.logEntry([e,this.id,Date.now(),...n])}}const jo=Object.freeze({level:gt.NONE,addChild(t){return t},childLogger:()=>jo,enabled:()=>!1,fine(){},debug(){},info(){},warn(){},severe(){},none(){},logEntry(){}});class Mi extends Nu{set(e){this.parent=e}childLogger(e,n){return new Mi(e,n??this.level,this)}logEntry(e){this.parent.logEntry(e)}}const Wo=new Mi("root",gt.FINE,jo),$u=Wo.childLogger("defmulti"),j=Symbol();function Bt(t,e,n){const s={},i=e?Ou(e):{},r=(...o)=>{const c=t(...o),a=s[c]||Ye(s,i,c)||s[j];return a?a(...o):At(`missing implementation for: "${c.toString()}"`)};return r.add=(o,c)=>(s[o]&&$u.warn(`overwriting '${o.toString()}' impl`),s[o]=c,!0),r.addAll=o=>{let c=!0;for(let a in o)c=r.add(a,o[a])&&c;return j in o&&r.setDefault(o[j]),c},r.setDefault=o=>r.add(j,o),r.remove=o=>s[o]?(delete s[o],!0):!1,r.callable=(...o)=>{const c=t(...o);return!!(s[c]||Ye(s,i,c)||s[j])},r.isa=(o,c)=>{let a=i[o];!a&&(i[o]=a=new Set),a.add(c)},r.impls=()=>{const o=new Map;for(let c in s)o.set(c,s[c]);for(let c in i){const a=Ye(s,i,c);a&&o.set(c,a)}return s[j]&&o.set(j,s[j]),o},r.implForID=o=>s[String(o)]||Ye(s,i,o)||s[j],r.rels=()=>i,r.parents=o=>i[o],r.ancestors=o=>new Set(Xo([],i,o)),r.dependencies=function*(){for(let o in i)for(let c of i[o])yield[o,c];for(let o in s)!i[o]&&(yield[o,void 0])},n&&r.addAll(n),r}const Ye=(t,e,n)=>{const s=e[n];if(s)for(let i of s){let r=t[i]||Ye(t,e,i);if(r)return r}},Xo=(t,e,n)=>{const s=e[n];if(s)for(let i of s)t.push(i),Xo(t,e,i);return t},Ou=t=>{const e={};for(let n in t){const s=t[n];e[n]=s instanceof Set?s:Array.isArray(s)?new Set(s):new Set([s])}return e},ae=t=>t.type,Lu=(t,e)=>(t[0]=e,t[1]=e,t),Cu=(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t),Bu=(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t[3]=e,t);P(0,(t,e)=>{for(let n=t.length;n-- >0;)t[n]=e;return t},Lu,Cu,Bu);const Tu=t=>Array(t).fill(0),Pu=t=>wt(t,"empty")?t.empty():Tu(t.length),Di=(t,e,n)=>{const s=oe([],n,e),i=Ii(s);return i>1e-6?ru(oe([],t,e),s)/i:void 0},xo=(t,e,n,s,i=!1,r=0)=>{const o=Di(t,e,n);if(o!==void 0&&(!i||o>=r&&o<=1-r))return s=s||Pu(t),o<=0?Et(s,e):o>=1?Et(s,n):Xn(s,e,n,o)},Uu=(t,e,n=!1,s=[])=>{if(!e.length)return;const i=[],r=e.length-1;let o=1/0,c,a;for(n?(c=r,a=0):(c=0,a=1);a<=r;c=a,a++)if(xo(t,e[c],e[a],i)){const l=wn(t,i);l<o&&(o=l,Et(s,i))}return o<1/0?s:void 0},Ni=(t,e,n)=>(s,i,r=1)=>{!s&&(s=i);const o=Math.sqrt(t(i));return o>=U?e(s,i,r/o):s!==i?n(s,i):s},Ne=Ni(Ii,fs,Et),Gu=Ni(ko,Ae,k),ku=Ni(Fo,qs,Nt);class $i{points;index;constructor(e,n=!1){n?(this.points=e.slice(),this.points.push(e[0])):this.points=e,this.buildIndex()}totalLength(){const e=this.index;return e?e[e.length-1]:0}pointAt(e){const n=this.points,s=n.length-1;if(s<0)return;if(s===0||e<=0)return n[0];if(e>=1)return n[s];const i=this.index,r=e*i[s];for(let o=1;o<=s;o++)if(i[o]>=r)return Xn([],n[o-1],n[o],(r-i[o-1])/(i[o]-i[o-1]))}closestPoint(e){return Uu(e,this.points)}closestT(e){const{index:n,points:s}=this,i=[],r=[];let o=1/0,c=-1;for(let a=0,l=n.length-1;a<l;a++)if(xo(e,s[a],s[a+1],i)){const u=wn(e,i);u<o&&(o=u,c=a,Et(r,i))}return c>=0?Rl(Di(e,s[c],s[c+1])||0,n[c],n[c+1])/this.totalLength():void 0}segmentAt(e){let n=this.indexAt(e);if(n!==void 0)return n=Math.max(1,n),[this.points[n-1],this.points[n]]}tangentAt(e,n=1){const s=this.segmentAt(e);return s?Ne(null,oe([],s[1],s[0]),n):void 0}splitAt(e){if(e<=0||e>=1)return[this.points];const n=this.pointAt(e);if(!n)return;const s=Math.max(1,this.indexAt(e)),i=this.points.slice(0,s),r=this.points.slice(s);return Ve(i[s-1],n)||i.push(n),Ve(r[0],n)||r.unshift(n),[i,r]}splitNear(e){const n=this.closestT(e);return n!==void 0?this.splitAt(n):void 0}extractRange(e,n){if(e>n){const a=e;e=n,n=a}const s=this.pointAt(e),i=this.pointAt(n);if(!(s&&i))return;const r=Math.max(1,this.indexAt(e)),o=Math.max(1,this.indexAt(n)),c=this.points.slice(r,o);return(!c.length||!Ve(c[0],s))&&c.unshift(s),Ve(c[c.length-1],i)||c.push(i),c}indexAt(e){const s=this.points.length-1;if(s<0)return;if(s===0||e<=0)return 0;if(e>=1)return s;const i=this.index,r=e*i[s];for(let o=1;o<=s;o++)if(i[o]>=r)return o}sampleUniform(e,n=!1,s=[]){const{index:i,points:r}=this,o=this.totalLength(),c=e/o,a=i.length;for(let l=0,u=1;l<1;l+=c){const f=l*o;for(;f>=i[u]&&u<a;)u++;if(u>=a)break;const h=i[u-1];s.push(Xn([],r[u-1],r[u],(f-h)/(i[u]-h)))}return n&&s.push(Et([],r[r.length-1])),s}sampleFixedNum(e,n=!1,s){return this.sampleUniform(this.totalLength()/e,n,s)}buildIndex(){const e=[0],n=this.points,s=n.length;for(let i=0,r=1;r<s;i=r,r++)e[r]=e[i]+Iu(n[i],n[r]);this.index=e}}const yr=Math.cos,vr=Math.sin,Zo=P(1),Fu=Zo.add(2,(t,e,n=ht)=>J(t||e,Ai(e[1],e[0]),n));Zo.add(3,(t,e,n=dt)=>{const s=e[0],i=e[1],r=e[2],o=yr(i);return Z(t||e,s*o*yr(r)+n[0],s*o*vr(r)+n[1],s*vr(i)+n[2])});const Jo=(t,e,n,s,i,r)=>{if(Ct(r)&&r.dist!==void 0)return new $i(Jo(t,e,n,s,i,r.num||vt)).sampleUniform(r.dist,r.last!==!1);r=y(r)?{num:r,last:!0}:{num:vt,...r};let o=i-s,c=r.theta?Math.round(o/r.theta):r.num;o/=c,r.last!==!1&&c++;const a=new Array(c);for(let l=0;l<c;l++)a[l]=Oo(t,e,n,s+l*o);return a},Ar=(t,e,n=!1,s=!1)=>{if(zu(e)){const i=new $i(t,n);return Ct(e)?n?e.dist?i.sampleUniform(e.dist,e.last):i.sampleFixedNum(e.num||vt,e.last):e.dist?i.sampleUniform(e.dist,e.last!==!1):i.sampleFixedNum(e.num||vt,e.last!==!1):i.sampleFixedNum(e||vt,!n)}return s?bi(t):t},zu=t=>t!==void 0&&(y(t)||t.dist!=null||t.last!=null||t.num!=null),Ko=t=>function e(n,s){if(Ct(s)&&s.dist!==void 0)return new $i(e(n,s.num||vt)).sampleUniform(s.dist,s.last!==!1);s=y(s)?{num:s,last:!0}:{num:vt,...s};const i=[];return t(i,n,s.num),s.last&&i.push(Et([],n[n.length-1])),i},Hu=Ko((t,[e,n,s,i],r)=>{const o=1/r;for(let c=0;c<r;c++)t.push(Tl([],e,n,s,i,c*o))}),qu=(t,e,n,s,i)=>{const r=1-i;return Cl(t,e,n,s,r*r,2*r*i,i*i)},Vu=Ko((t,[e,n,s],i)=>{const r=1/i;for(let o=0;o<i;o++)t.push(qu([],e,n,s,o*r))}),Oi=(t,e=1,n=!0)=>{const s=n?(c,a,l,u)=>{!c&&(c=a);for(let f=a.length;f-- >0;)c[f]=t(a[f],l[f],u[f]);return c}:(c,a,l,u)=>{!c&&(c=u);for(let f=a.length;f-- >0;)c[f]=t(a[f],l[f],u[f]);return c},i=n?(c,a,l,u)=>(!c&&(c=a),c[0]=t(a[0],l[0],u[0]),c[1]=t(a[1],l[1],u[1]),c):(c,a,l,u)=>(!c&&(c=u),c[0]=t(a[0],l[0],u[0]),c[1]=t(a[1],l[1],u[1]),c),r=n?(c,a,l,u)=>(!c&&(c=a),c[0]=t(a[0],l[0],u[0]),c[1]=t(a[1],l[1],u[1]),c[2]=t(a[2],l[2],u[2]),c):(c,a,l,u)=>(!c&&(c=u),c[0]=t(a[0],l[0],u[0]),c[1]=t(a[1],l[1],u[1]),c[2]=t(a[2],l[2],u[2]),c),o=n?(c,a,l,u)=>(!c&&(c=a),c[0]=t(a[0],l[0],u[0]),c[1]=t(a[1],l[1],u[1]),c[2]=t(a[2],l[2],u[2]),c[3]=t(a[3],l[3],u[3]),c):(c,a,l,u)=>(!c&&(c=u),c[0]=t(a[0],l[0],u[0]),c[1]=t(a[1],l[1],u[1]),c[2]=t(a[2],l[2],u[2]),c[3]=t(a[3],l[3],u[3]),c);return[P(e,s,i,r,o),i,r,o]},[Fm,Yu,zm,Hm]=Oi(wo),ju=Yu,pt=Bt(ae,{bpatch:"points",cubic3:"cubic",group3:"group",line:"polyline",line3:"polyline",path3:"path",points3:"points",poly3:"poly",polyline3:"polyline",quad:"poly",quad3:"poly",quadratic3:"quadratic",tri:"poly",tri3:"poly"},{aabb:({pos:t,size:e})=>{const[n,s,i]=t,[r,o,c]=be([],t,e);return[[n,s,i],[n,s,c],[r,s,c],[r,s,i],[n,o,i],[n,o,c],[r,o,c],[r,o,i]]},arc:(t,e)=>Jo(t.pos,t.r,t.axis,t.start,t.end,ct(e,t.attribs)),circle:(t,e=vt)=>{e=ct(e,t.attribs);const n=t.pos,s=t.r;let[i,r,o]=hr(e,s);const c=$/i;o&&i++;const a=new Array(i);for(let l=0;l<i;l++)a[l]=Fu(null,[s,r+l*c],n);return a},complexpoly:(t,e)=>{const n=pt(t.boundary,e);for(let s of t.children)n.push(...pt(s,e));return n},cubic:(t,e)=>Hu(t.points,ct(e,t.attribs)),ellipse:(t,e=vt)=>{e=ct(e,t.attribs);const n=[],s=t.pos,i=t.r;let[r,o,c]=hr(e,Math.max(t.r[0],t.r[1]));const a=$/r;c&&r++;for(let l=0;l<r;l++)n[l]=ju([],Ai(o+l*a),i,s);return n},extra:()=>[],group:(t,e)=>(e=ct(e,t.attribs),t.children.reduce((n,s)=>n.concat(pt(s,e)),[])),path:(t,e)=>{e=ct(e,t.attribs);const n=y(e)?{num:e}:e,s=[],i=r=>{const o=Lo(r)?.type==="z";for(let c=r.length-1,a=0;a<=c;a++){const l=r[a];l.geo&&s.push(...pt(l.geo,{...n,last:!o&&a===c}))}};i(t.segments);for(let r of t.subPaths)i(r);return s},points:t=>t.points.slice(),poly:(t,e)=>Ar(t.points,ct(e,t.attribs),!0,!0),polyline:(t,e)=>Ar(t.points,ct(e,t.attribs),!1,!0),quadratic:(t,e)=>Vu(t.points,ct(e,t.attribs)),rect:(t,e)=>{e=ct(e,t.attribs);const n=t.pos,s=J([],n,t.size),i=[k([],n),[s[0],n[1]],s,[n[0],s[1]]];return e!=null?pt(new Vt(i),e):i}}),Qo=Bt(ae,{circle:"points",complexpoly:"group",ellipse:"points",line:"points",line3:"points3",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",rect:"points",tri:"points",tri3:"points3"},{aabb:t=>{const[e,n,s,i,r,o,c,a]=pt(t);return[[o,c,a,r],[i,e,n,s],[s,i,a,c],[e,n,o,r],[n,s,c,o],[i,e,r,a]].map(l=>new ie(bi(l),qe(t)))},arc:(t,e)=>{const n=[_i(t.pos),...pt(t,e)];return[new Vt(n,qe(t))]},group:(t,e)=>[...jn(n=>Qo(n,e),t)],path:(t,e)=>Er(Vt,t,e),path3:(t,e)=>Er(ie,t,e),points:(t,e)=>[new Vt(pt(t,e),qe(t))],points3:(t,e)=>[new ie(pt(t,e),qe(t))]}),Er=(t,e,n)=>{const s=e.empty();return s.attribs=e.attribs,[e.segments,...e.subPaths].map(i=>(s.segments=i,new t(pt(s,n),qe(e))))},xn=(t,e)=>t-e*Math.floor(t/e),T=t=>t-Math.floor(t),wr=(t,e=1)=>Math.round(t/e)*e,le=(t={},e)=>new Ze(t,e);function Wu(...t){return Pl(Je,t)}const Qe=(t,e,n)=>{const s=t[0],i=t[1];return(e[0]-s)*(n[1]-i)-(n[0]-s)*(e[1]-i)},Xu=(t,e,n,s=U)=>vu(Qe(t,e,n),s),xu=(t,e,n,s=U)=>Xu(t,e,n,s)<0,Rr=(t,e)=>e!==0?t/e:0,Zu=(t,e,n,s=!0,i=!0)=>{const r=n>0?s?function(){return this.buf[this.offset+n*this.stride]}:function(){return this.buf[this.offset+n]}:function(){return this.buf[this.offset]},o=n>0?s?function(c){this.buf[this.offset+n*this.stride]=c}:function(c){this.buf[this.offset+n]=c}:function(c){this.buf[this.offset]=c};i&&Object.defineProperty(t,n,{get:r,set:o,enumerable:!0}),Object.defineProperty(t,e,{get:r,set:o,enumerable:!0})},Ju=(t,e,n,s)=>e.forEach((i,r)=>Zu(t,i,r,n,s)),$e=t=>typeof t=="function";function tc(t,e=Object.create(null)){return(...n)=>{const s=JSON.stringify(n);return s!==void 0?s in e?e[s]:e[s]=t.apply(null,n):t.apply(null,n)}}function ec(t,e=Object.create(null)){return(...n)=>{const s=n.join("-");return s in e?e[s]:e[s]=t(...n)}}const Ku=ec((t,e)=>t.repeat(e)),nc=tc((t,e=!1)=>e?n=>Qu(n)||n.toFixed(t):n=>n.toFixed(t)),Qu=t=>isNaN(t)?"NaN":t===1/0?"+∞":t===-1/0?"-∞":void 0,t0={5120:"i8",5121:"u8",5122:"i16",5123:"u16",5124:"i32",5125:"u32",5126:"f32"},e0={i8:5120,u8:5121,u8c:5121,i16:5122,u16:5123,i32:5124,u32:5125,f32:5126,f64:void 0},n0={i8:0,u8:0,u8c:0,i16:1,u16:1,i32:2,u32:2,i64:3,u64:3,f32:2,f64:3},s0={f32:Float32Array,f64:Float64Array},i0={i8:Int8Array,i16:Int16Array,i32:Int32Array},r0={u8:Uint8Array,u8c:Uint8ClampedArray,u16:Uint16Array,u32:Uint32Array},o0={i64:BigInt64Array,u64:BigUint64Array},js={...s0,...i0,...r0},c0=t=>{const e=t0[t];return e!==void 0?e:t},sc=t=>{const e=e0[t];return e!==void 0?e:t};function kn(t,...e){const n=o0[t];return new(n||js[c0(t)])(...e)}const a0=t=>{if(Array.isArray(t))return"f64";for(let e in js)if(t instanceof js[e])return e;return"f64"},l0=t=>t>16?"u32":t>8?"u16":"u8",u0=(t,e,n,s,i,r)=>{const o=[];for(;n-- >0;)o.push(new t(e,s,i)),s+=r;return o},[qm,Vm,Ym,f0]=Oi(ot),h0=f0,vs=(t,e,n=0,s=0,i=1,r=1)=>t[n]*e[s]+t[n+i]*e[s+r]+t[n+2*i]*e[s+2*r],R=(t,e,n=0,s=0,i=1,r=1)=>t[n]*e[s]+t[n+i]*e[s+r]+t[n+2*i]*e[s+2*r]+t[n+3*i]*e[s+3*r],Zn=(t,e,n,s,i,r)=>(!t&&(t=e),t[0]=Q(e[0],n[0],s[0],i[0],r[0]),t[1]=Q(e[1],n[1],s[1],i[1],r[1]),t),d0=(t,e,n,s,i,r)=>(!t&&(t=e),t[0]=Q(e[0],n[0],s[0],i[0],r[0]),t[1]=Q(e[1],n[1],s[1],i[1],r[1]),t[2]=Q(e[2],n[2],s[2],i[2],r[2]),t),g0=(t,e,n,s,i,r)=>(!t&&(t=e),t[0]=Q(e[0],n[0],s[0],i[0],r[0]),t[1]=Q(e[1],n[1],s[1],i[1],r[1]),t[2]=Q(e[2],n[2],s[2],i[2],r[2]),t[3]=Q(e[3],n[3],s[3],i[3],r[3]),t);P(1,(t,e,n,s,i,r)=>{!t&&(t=e);for(let o=e.length;o-- >0;)t[o]=Q(e[o],n[o],s[o],i[o],r[o]);return t},Zn,d0,g0);function*m0(t,e,n,s){for(;e-- >0;)yield t[n],n+=s}const Sr=(t,e)=>(t>>>e|t<<32-e)>>>0,[p0,jm,Wm,Xm]=Oi(Ro),_0=p0,ic=P(1,(t,e,n,s=ce)=>{!t&&(t=e);for(let i=e.length;i-- >0;)t[i]=s.minmax(e[i],n[i]);return t});function*rc(t,e=!0,n=!1){if(t>0)for(let s=0,i=e?t+1:t;s<i;s++)yield n?1-s/t:s/t}function $t(...t){return b0($t,ln,t)}const b0=(t,e,n)=>{let s,i;switch(n.length){case 4:i=n[3],s=n[2];break;case 3:i=n[2];break;case 2:return F(r=>t(n[0],n[1],r));default:Ri(n.length)}return e(hs(n[0])(n[1]),s,i)};function*Ws(...t){const e=t.map(n=>n[Symbol.iterator]());for(;;){const n=[];for(let s of e){let i=s.next();if(i.done)return;n.push(i.value)}yield n}}function gn(...t){return new H(...hl(t))}const y0=(t,e,n)=>new H(t,Wn([],e,t),n),he=(t,e,n,s)=>y0(t,e,s).offset(n),je=(t,e,n)=>(e=x(e),new H(qn([],e,-.5,t),e,n)),oc=(t,e)=>n=>n.map(s=>s.geo?{type:s.type,geo:t(s.geo)}:s.point?{type:s.type,point:e(s.point)}:{...s}),Xs=Bt(ae,{bpatch:"points",complexpoly:"group",cubic:"points",cubic3:"points3",group3:"group",line:"points",line3:"points3",path3:"path",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",quadratic:"points",quadratic3:"points3",tri:"points",tri3:"points3"},{aabb:(t,e)=>(e=x(e,3),new Ie(Ue([],t.pos,e),Ue([],t.size,e),A(t.attribs))),arc:(t,e)=>{e=x(e);const n=t.copy();return Y(null,n.pos,e),Y(null,n.r,e),n},circle:(t,e)=>y(e)?new Me(Ae([],t.pos,e),t.r*e,A(t.attribs)):new De(Y([],t.pos,e),Ae([],e,t.r),A(t.attribs)),ellipse:(t,e)=>(e=x(e),new De(Y([],t.pos,e),Y([],t.r,e),A(t.attribs))),extra:t=>t,group:(t,e)=>t.copyTransformed(n=>Xs(n,e)),path:(t,e)=>(e=x(e),t.copyTransformed(oc(n=>Xs(n,e),n=>Dl([],n,e)))),points:(t,e)=>t.copyTransformed(n=>n.map(y(e)?s=>Ae([],s,e):s=>Y([],s,e))),points3:(t,e)=>t.copyTransformed(n=>n.map(y(e)?s=>qs([],s,e):s=>Ue([],s,e))),ray:(t,e)=>(e=x(e),new un(Y([],t.pos,e),Gu(null,Y([],t.dir,e)),A(t.attribs))),ray3:(t,e)=>(e=x(e),new fn(Ue([],t.pos,e),ku(null,Ue([],t.dir,e)),A(t.attribs))),rect:(t,e)=>(e=x(e),new H(Y([],t.pos,e),Y([],t.size,e),A(t.attribs))),sphere:(t,e)=>y(e)?new hn(qs([],t.pos,e),t.r*e,A(t.attribs)):At("can't non-uniformly scale sphere"),text:(t,e)=>new dn(Y([],t.pos,x(e)),t.body,A(t.attribs))}),xs=Bt(ae,{bpatch:"points",cubic:"points",cubic3:"points3",complexpoly:"group",group3:"group",line:"points",line3:"points3",path3:"path",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",quadratic:"points",quadratic3:"points3",tri:"points",tri3:"points3"},{aabb:(t,e)=>new Ie(be([],t.pos,e),Nt([],t.size),A(t.attribs)),arc:(t,e)=>{const n=t.copy();return J(null,n.pos,e),n},circle:(t,e)=>new Me(J([],t.pos,e),t.r,A(t.attribs)),ellipse:(t,e)=>new De(J([],t.pos,e),k([],t.r),A(t.attribs)),extra:t=>t,group:(t,e)=>t.copyTransformed(n=>xs(n,e)),path:(t,e)=>t.copyTransformed(oc(n=>xs(n,e),n=>Ot([],n,e))),points:(t,e)=>t.copyTransformed(n=>n.map(s=>J([],s,e))),points3:(t,e)=>t.copyTransformed(n=>n.map(s=>be([],s,e))),ray:(t,e)=>new un(J([],t.pos,e),t.dir,A(t.attribs)),ray3:(t,e)=>new fn(be([],t.pos,e),t.dir,A(t.attribs)),rect:(t,e)=>new H(J([],t.pos,e),k([],t.size),A(t.attribs)),sphere:(t,e)=>new hn(be([],t.pos,e),t.r,A(t.attribs)),text:(t,e)=>new dn(J([],t.pos,e),t.body,A(t.attribs))}),v0=t=>{const e=t.length-1;if(e<2)return 0;let n=0,s=t[e],i=t[0];for(let r=0;r<=e;s=i,i=t[++r])n+=Uo(s,i);return n/2},ee=Bt(ae,{group3:"group",quad:"poly"},{[j]:()=>0,aabb:({size:[t,e,n]})=>2*(t*e+t*n+e*n),arc:t=>.5*Math.abs(t.start-t.end)*t.r[0]*t.r[1],circle:t=>et*t.r**2,complexpoly:(t,e)=>ee(t.boundary,e)-t.children.reduce((n,s)=>n+ee(s,e),0),ellipse:t=>et*t.r[0]*t.r[1],group:({children:t})=>t.reduce((e,n)=>e+ee(n,!1),0),path:(t,e)=>t.closed?Qo(t).reduce((n,s)=>n+ee(s,e),0):0,plane:()=>1/0,poly:(t,e)=>{const n=v0(t.points);return e?n:Math.abs(n)},rect:t=>t.size[0]*t.size[1],sphere:t=>4*et*t.r**2,tri:(t,e)=>{const n=.5*Qe(...t.points);return e?n:Math.abs(n)}}),B=t=>typeof t=="string",tn={},Ir=(t,e)=>{for(let n in e){const s=e[n];if(D(s)){const[i,r,o,c]=s;e[n]=s.length===2?(a,l)=>r(a,i(a,l)):s.length===3?(a,l)=>o(a,r(a,i(a,l))):(a,l)=>c(a,o(a,r(a,i(a,l))))}}tn[t]={...tn[t],...e}},cc=(t,e,n,s)=>{const i=tn[n];S(!!i,`no conversions available for ${n}`);let r=i[s];return r?r(t,e):tn.rgb[s]?i.rgb(t,tn.rgb[s]([],e)):At(`can't convert: ${s} -> ${n}`)},A0=(t=0)=>e=>(e*100).toFixed(t)+"%",E0=[.299,.587,.114],ac=[.2126,.7152,.0722],w0=[3.1338561,-.9787684,.0719453,-1.6168667,1.9161415,-.2289914,-.4906146,.033454,1.4052427],R0=[3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252],S0=[.96422,1,.82521],I0=[.95047,1,1.08883];let Jn=nc(3),Mr=A0(3);const tt=1/255,q=(t,e=1)=>t!=null?v(t):e,M0=t=>{if(typeof t[0]=="number")switch(t.length){case 1:return t.push(0,0,1),[t];case 2:return t.push(0,1),[t];case 3:return t.push(1),[t];default:return[t]}return t},lc=t=>{const e=Jn(T(t[0])*360),n=Mr(v(t[1])),s=Mr(v(t[2])),i=q(t[3]);return i<1?`hsla(${e},${n},${s},${Jn(i)})`:`hsl(${e},${n},${s})`},Dr=(t,e,n=1)=>L(t||e,v(e[0]),v(e[1]),v(e[2]),q(e[3],n)),Li=(t,e,n=1)=>L(t||e,T(e[0]),v(e[1]),v(e[2]),q(e[3],n)),D0=(t,e)=>{t=Li(t||e,e);const n=t[1],s=t[2],i=(2-n)*s/2;return t[2]=i,t[1]=i&&i<1?n*s/(i<.5?i*2:2-i*2):n,t},N0=t=>lc(D0([],t)),Nr="0123456789abcdef",Zs=t=>Nr[t>>>4&15]+Nr[t&15],$0=t=>Zs(t>>>8)+Zs(t&255),O0=t=>Zs(t>>>16)+$0(t),Ci=ec((t,e,n="")=>{const s=Ku("0",e);return i=>(i=(i>>>0).toString(t),n+(i.length<e?s.substring(i.length)+i:i))});Ci(2,8);Ci(2,16);Ci(2,32);const uc=O0,Js=t=>{const e=t>>>24;return e<255?`rgba(${t>>16&255},${t>>8&255},${t&255},${Jn(e*tt)})`:`#${uc(t&16777215)}`},L0=t=>(t&255)<<16|t>>16&255|t&4278255360,C0=L0,fc=(t,e,n,s=!1)=>{const i=vs(e,n,0,0,3),r=vs(e,n,1,0,3),o=vs(e,n,2,0,3),c=q(n[3]);return s?L(t||n,v(i),v(r),v(o),c):L(t||n,i,r,o,c)},B0=(t,e,n,s=!0)=>{t=L(t||n,n[0],n[1],n[2],q(n[3]));const i=R(t,e,0,0)+e[4],r=R(t,e,0,5)+e[9],o=R(t,e,0,10)+e[14],c=R(t,e,0,15)+e[19];return s?L(t,v(i),v(r),v(o),v(c)):L(t,i,r,o,c)},T0=(t,e)=>[R(e,t,0,0,1,5),R(e,t,0,1,1,5),R(e,t,0,2,1,5),R(e,t,0,3,1,5),R(e,t,0,4,1,5)+e[4],R(e,t,5,0,1,5),R(e,t,5,1,1,5),R(e,t,5,2,1,5),R(e,t,5,3,1,5),R(e,t,5,4,1,5)+e[9],R(e,t,10,0,1,5),R(e,t,10,1,1,5),R(e,t,10,2,1,5),R(e,t,10,3,1,5),R(e,t,10,4,1,5)+e[14],R(e,t,15,0,1,5),R(e,t,15,1,1,5),R(e,t,15,2,1,5),R(e,t,15,3,1,5),R(e,t,15,4,1,5)+e[19]],As=t=>{const e=t**3;return e>.008856?e:(t-16/116)/7.787},hc=(t,e,n=S0)=>{const s=(e[0]+.16)/1.16;return L(t||e,As(e[1]/5+s)*n[0],As(s)*n[1],As(s-e[2]/2)*n[2],q(e[3]))},P0=(t,e)=>hc(t,e,I0),dc=(t,e)=>{let{1:n,2:s}=e;s*=$;const i=q(e[3]);return n>0?L(t||e,e[0],Math.cos(s)*n,Math.sin(s)*n,i):L(t||e,e[0],0,0,i)},Bi=(t,e,n=w0)=>fc(t,n,e),Ks=(t,e)=>Bi(t,e,R0),Kn=(t,e)=>Bi(null,hc(t,e)),gc=(t,e)=>Ks(null,P0(t,e)),Es=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,ws=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4),en=(t,e)=>L(t||e,Es(e[0]),Es(e[1]),Es(e[2]),q(e[3])),Rs=(t,e=0)=>(t<0?0:t>1?1:t)*255+.5<<e,ye=t=>{const e=Rs(t[0]),n=Rs(t[1]),s=Rs(t[2]),i=q(t[3]);return i<1?`rgba(${e},${n},${s},${Jn(i)})`:`#${uc(e<<16|n<<8|s)}`},U0=t=>ye(en([],t)),mc={abgr32:t=>Js(C0(t[0])),argb32:t=>Js(t[0]),hsl:lc,hsv:N0,lab50:t=>ye(en(null,Kn([],t))),lab65:t=>ye(en(null,gc([],t))),lch:t=>ye(en(null,Kn(null,dc([],t)))),rgb:U0,srgb:ye};({...mc});let G0=mc;const Qs=(t,e=G0)=>{let n;return B(t)?t:y(t)?Js(t):t.mode?(n=e[t.mode])?n(t):e.rgb(cc([],t,"rgb",t.mode)):ye(t)},k0=t=>t!=null&&typeof t.deref=="function",F0=t=>k0(t)?t.deref():t,z0=t=>t!=null&&typeof t!="string"&&typeof t[Symbol.iterator]=="function",H0=(t,e,n,s,i)=>{const r=k([],nl),o=k([],el),c=[],a=l=>{Oo(t,e,n,l,c),To(null,r,c),Vn(null,o,c)};if(a(s),a(i),s>i){const l=s;s=i,i=l}for(let l=wr(s,Gn),u=wr(i,Gn);l<u;l+=Gn)No(l,s,i)&&a(l);return[r,o]},$r=(t,e=0,n=t.length)=>{let s=1/0,i=1/0,r=-1/0,o=-1/0;for(let c=e;c<n;c++){const[a,l]=t[c];a<s&&(s=a),a>r&&(r=a),l<i&&(i=l),l>o&&(o=l)}return[[s,i],[r,o]]},q0=(t,e=0,n=t.length)=>{let s=1/0,i=1/0,r=1/0,o=-1/0,c=-1/0,a=-1/0;for(let l=e;l<n;l++){const[u,f,h]=t[l];u<s&&(s=u),u>o&&(o=u),f<i&&(i=f),f>c&&(c=f),h<r&&(r=h),h>a&&(a=h)}return[[s,i,r],[o,c,a]]},V0=(t,e,n,s,i,r,o)=>{t[n]=Math.min(s,o),e[n]=Math.max(s,o);const c=-s+i,a=s-2*i+r,l=-s+3*i-3*r+o;let u=a*a-c*l;if(u>0){u=Math.sqrt(u);const f=h=>{if(h>0&&h<1){const g=Au(s,i,r,o,h);t[n]=Math.min(t[n],g),e[n]=Math.max(e[n],g)}};f(c/(-a-u)),f(c/(-a+u))}},Or=(t,e,n,s)=>{const i=[],r=[];for(let o=t.length;o-- >0;)V0(i,r,o,t[o],e[o],n[o],s[o]);return[i,r]},Y0=(t,e,n)=>{const s=v((t-e)/(t-2*e+n)),i=1-s;return i*i*t+2*i*s*e+s*s*n},j0=(t,e,n)=>{for(let s=t.length;s-- >0;)if(!No(t[s],e[s],n[s]))return!1;return!0},W0=(t,e,n)=>{const s=Vs([],t,n),i=Hs([],t,n);if(!j0(e,s,i)){const r=[];for(let o=t.length;o-- >0;)r[o]=Y0(t[o],e[o],n[o]);Vs(null,s,r),Hs(null,i,r)}return[s,i]};function Yt(t,e){return Te(e)?gs(Yt(t),e):n=>{const s=n[2];return vn(n,(i,r)=>t(r)?s(i,r):i)}}const Ss=(t,e)=>{let n=t.length-1;if(n<0)return;let s=e(t[n]);if(!s)return;let{pos:i,size:r}=s;for(;n-- >0;)s=e(t[n]),s&&([i,r]=X0(i,r,s.pos,s.size));return[i,r]},X0=(t,e,n,s)=>{const i=Ot([],t,e),r=Ot([],n,s),o=Vs([],t,n);return[o,oe(null,Hs(null,i,r),o)]},Fn=Bt(ae,{aabb:"rect",bpatch:"points",poly:"points",polyline:"points",quad:"points",tri:"points"},{arc:(t,e=0)=>he(...H0(t.pos,t.r,t.axis,t.start,t.end),e),bpatch:({points:t},e=0)=>he(...$r([...jn(n=>Or(...n),[[t[0],t[1],t[2],t[3]],[t[3],t[7],t[11],t[15]],[t[12],t[13],t[14],t[15]],[t[0],t[4],t[8],t[12]]])]),e),circle:(t,e=0)=>new H(mr([],t.pos,t.r+e),Ae(null,[2,2],t.r+e)),complexpoly:(t,e=0)=>{const n=Ss([t.boundary,...t.children],Fn);return n?new H(...n).offset(e):void 0},cubic:({points:t},e=0)=>he(...Or(t[0],t[1],t[2],t[3]),e),ellipse:(t,e=0)=>{const n=Mo([],t.r,e);return new H(Wn([],t.pos,n),Y(null,[2,2],n))},extra:()=>{},group:(t,e=0)=>{const n=Ss(t.children,Fn);return n?new H(...n).offset(e):void 0},line:({points:[t,e]},n=0)=>he(To([],t,e),Vn([],t,e),n),path:(t,e=0)=>{const n=i=>gs(An(F(r=>r.geo),Yt(r=>!!r)),i),s=Ss([...n(t.segments),...jn(n,t.subPaths)],Fn);return s?new H(...s).offset(e):void 0},points:(t,e=0)=>he(...$r(t.points),e),points3:(t,e=0)=>eu(...q0(t.points),e),quadratic:({points:t},e=0)=>he(...W0(t[0],t[1],t[2]),e),rect:(t,e=0)=>e===0?t.copy():t.copy().offset(e),text:(t,e=0)=>new H(mr([],t.pos,e),e*2)}),pc=(t,e,n,s=U)=>{const i=Di(t,e,n);return i!==void 0?wn(t,Xn([],e,n,v(i)))<s*s:!1},x0=(t,e,n,s=U)=>{const i=e.length;let[r,o]=[0,1];for(;o<i;r=o,o++)if(pc(t,e[r],e[o],s))return!0;return!1},Z0=(t,e,n)=>wn(e,t)<=n*n,J0=(t,e,n,s)=>{const i=xu(e,n,s)?1:-1;return i*Qe(e,s,t)>=0&&i*Qe(n,e,t)>=0&&i*Qe(s,n,t)>=0},Is=(t,e)=>{const n=e.length-1,s=t[0],i=t[1];let r=e[n],o=e[0],c=0;for(let a=0;a<=n;r=o,o=e[++a])c=K0(s,i,r[0],r[1],o[0],o[1],c);return c},K0=(t,e,n,s,i,r,o)=>(s<e&&r>=e||r<e&&s>=e)&&(n<=t||i<=t)?o^~~(n+(e-s)/(r-s)*(i-n)<t):o,Ti=P(0),Q0=Ti.add(2,([t,e],n,s)=>t>=n[0]&&t<=n[0]+s[0]&&e>=n[1]&&e<=n[1]+s[1]),tf=Ti.add(3,([t,e,n],s,i)=>t>=s[0]&&t<=s[0]+i[0]&&e>=s[1]&&e<=s[1]+i[1]&&n>=s[2]&&n<=s[2]+i[2]);Ti.default((t,e,n)=>{for(let s=t.length;s-- >0;){const i=t[s],r=e[s];if(i<r||i>r+n[s])return!1}return!0});const Pi=P(0);Pi.add(2,([t,e],n,s)=>t>=n[0]-s[0]&&t<=n[0]+s[0]&&e>=n[1]-s[1]&&e<=n[1]+s[1]);Pi.add(3,([t,e,n],s,i)=>t>=s[0]-i[0]&&t<=s[0]+i[0]&&e>=s[1]-i[1]&&e<=s[1]+i[1]&&n>=s[2]-i[2]&&n<=s[2]+i[2]);Pi.default((t,e,n)=>{for(let s=t.length;s-- >0;){const i=t[s],r=e[s],o=n[s];if(i<r-o||i>r+o)return!1}return!0});const Wt=Bt(ae,{group3:"group",points3:"points",quad:"poly",sphere:"circle"},{[j]:()=>!1,aabb:(t,e)=>tf(e,t.pos,t.size),circle:(t,e)=>Z0(e,t.pos,t.r),complexpoly:(t,e)=>Is(e,t.boundary.points)?!t.children.some(n=>Is(e,n.points)):!1,group:(t,e)=>t.children.some(n=>Wt(n,e)),line:(t,e)=>pc(e,t.points[0],t.points[1]),points:({points:t},e)=>fu(e,t),poly:(t,e)=>Is(e,t.points)>0,polyline:(t,e)=>x0(e,t.points),rect:(t,e)=>Q0(e,t.pos,t.size),tri:(t,e)=>J0(e,...t.points)}),Lr=(t,e,n=ce,s=[])=>{const i=Fn(t);if(!i)return;const r=i.pos,o=i.max();for(;e-- >0;)for(;;){const c=ic([],r,o,n);if(Wt(t,c)){s.push(c);break}}return s};function _c(...t){return jl(_c,t)||(e=>{const n=e[2],s=t[0];let i=t[1]||0;return vn(e,(r,o)=>n(r,s(i++,o)))})}function bc(t,e,n){return new ef(t,e,n)}class ef{from;to;step;constructor(e,n,s){e===void 0?(e=0,n=1/0):n===void 0&&(n=e,e=0),s=s===void 0?e<n?1:-1:s,this.from=e,this.to=n,this.step=s}*[Symbol.iterator](){let{from:e,to:n,step:s}=this;if(s>0)for(;e<n;)yield e,e+=s;else if(s<0)for(;e>n;)yield e,e+=s}$reduce(e,n){const s=this.step;if(s>0)for(let i=this.from,r=this.to;i<r&&!Lt(n);i+=s)n=e(n,i);else for(let i=this.from,r=this.to;i>r&&!Lt(n);i+=s)n=e(n,i);return n}}const Ui=(t,e)=>t===e?0:t==null?e==null?0:-1:e==null?t==null?0:1:typeof t.compare=="function"?t.compare(e):typeof e.compare=="function"?-e.compare(t):t<e?-1:t>e?1:0,Xt=(t,e,n=!0)=>{let s;n&&(s=e.fill)&&s!=="none"&&((s=e.fillRule)?t.fill(s):t.fill()),(s=e.stroke)&&s!=="none"&&t.stroke(),(s=e.clip)&&t.clip(s===!0?"nonzero":s)},nf=(t,e,n,s,i=0,r=$,o=!1)=>{t.beginPath(),t.arc(n[0],n[1],s,i,r,o),Xt(t,e)},sf=(t,e,n,s,i=0,r=0,o=$,c=!1)=>{t.beginPath(),t.ellipse(n[0],n[1],s[0],s[1],i,r,o,c),Xt(t,e)},Gi=Qs,yc=(t,e)=>B(e)?e[0]==="$"?t.grads[e.substring(1)]:e:Gi(e),rf=(t,{from:e,to:n},s)=>{const i=t.createLinearGradient(e[0],e[1],n[0],n[1]);for(let r of s)i.addColorStop(r[0],Gi(r[1]));return i},of=(t,{from:e,to:n,r1:s,r2:i},r)=>{const o=t.createRadialGradient(e[0],e[1],s,n[0],n[1],i);for(let c of r)o.addColorStop(c[0],Gi(c[1]));return o},cf=(t,e,{width:n,height:s},i,r,o,c)=>{if(wt(i,"toImageData")&&(i=i.toImageData()),i instanceof ImageData){t.putImageData(i,r[0],r[1]);return}n=n||i.width,s=s||i.height,o?t.drawImage(i,o[0],o[1],c?c[0]:n,c?c[1]:s,r[0],r[1],n,s):t.drawImage(i,r[0],r[1],n,s)},af={align:"left",alpha:1,baseline:"alphabetic",compose:"source-over",dash:[],dashOffset:0,direction:"inherit",fill:"#000",filter:"none",font:"10px sans-serif",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",shadowX:0,shadowY:0,smooth:!0,stroke:"#000",weight:1},vc={align:"textAlign",alpha:"globalAlpha",baseline:"textBaseline",clip:"clip",compose:"globalCompositeOperation",dash:"setLineDash",dashOffset:"lineDashOffset",direction:"direction",fill:"fillStyle",fillRule:"fillRule",filter:"filter",font:"font",lineCap:"lineCap",lineJoin:"lineJoin",miterLimit:"miterLimit",shadowBlur:"shadowBlur",shadowColor:"shadowColor",shadowX:"shadowOffsetX",shadowY:"shadowOffsetY",smooth:"imageSmoothingEnabled",stroke:"strokeStyle",weight:"lineWidth"},Cr=(t,e=!1)=>({attribs:{...t.attribs},grads:{...t.grads},edits:[],restore:e}),lf=(t,e,n)=>{let s;if(n){ff(t,n)&&(s=Cr(e,!0));for(let i in n){const r=vc[i];if(r){const o=n[i];o!=null&&e.attribs[i]!==o&&(!s&&(s=Cr(e)),s.attribs[i]=o,s.edits.push(i),Ac(t,e,i,r,o))}else(i==="__background"||i==="__clear")&&(t.save(),t.resetTransform(),i==="__clear"?n[i]&&t.clearRect(0,0,t.canvas.width,t.canvas.height):(t.fillStyle=yc(e,n[i]),t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.restore())}return s}},uf=(t,e,n)=>{if(n.restore){t.restore();return}const s=n.edits,i=e.attribs;for(let r=s.length;r-- >0;){const o=s[r],c=i[o];Ac(t,e,o,vc[o],c??af[o])}},Br=(t,e,n)=>{!t.grads&&(t.grads={}),t.grads[e]=n},Ac=(t,e,n,s,i)=>{switch(n){case"fill":case"stroke":case"shadowColor":t[s]=yc(e,i);break;case"dash":t[s].call(t,i);break;case"clip":case"fillRule":break;default:t[s]=i}},ff=(t,e)=>{let n;return(n=e.transform)||e.setTransform||e.translate||e.scale||e.rotate?(t.save(),n?t.transform(n[0],n[1],n[2],n[3],n[4],n[5]):(n=e.setTransform)?t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]):((n=e.translate)&&t.translate(n[0],n[1]),(n=e.rotate)&&t.rotate(n),(n=e.scale)&&(yi(n)?t.scale(n[0],n[1]):t.scale(n,n))),!0):!1},Ms=(t,e,n,s)=>{e.stroke!=="none"&&(t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(s[0],s[1]),t.stroke())},hf=(t,e,n)=>{if(e.stroke!=="none"){t.beginPath();for(let{0:s,1:i}of n)t.moveTo(s[0],s[1]),t.lineTo(i[0],i[1]);t.stroke()}},df=(t,e,n,s)=>{let i;(i=e.fill)&&i!=="none"&&Tr(t,n,s,"fill","fillRect"),(i=e.stroke)&&i!=="none"&&Tr(t,n,s,"stroke","strokeRect")},Tr=(t,e,n,s,i)=>{const{start:r=0,cstride:o=1,estride:c=2,size:a=1}=e;let l=e&&e.num!=null?e.num:(n.length-r)/c|0;if(e.shape==="circle")for(let u=r;l-- >0;u+=c)t.beginPath(),t.arc(n[u],n[u+o],a,0,$),t[s]();else{const u=a/2;for(let f=r;l-- >0;f+=c)t[i](n[f]-u,n[f+o]-u,a,a)}},gf=(t,e,n)=>{t.beginPath();let s=[0,0];for(let i=0,r=n.length;i<r;i++){const o=n[i];let c=o[1],a,l;switch(o[0]){case"m":c=[s[0]+c[0],s[1]+c[1]];case"M":t.moveTo(c[0],c[1]),s=c;break;case"l":c=[s[0]+c[0],s[1]+c[1]];case"L":t.lineTo(c[0],c[1]),s=c;break;case"h":c=[s[0]+c,s[1]],t.lineTo(c[0],c[1]),s=c;break;case"H":c=[c,s[1]],t.lineTo(c[0],c[1]),s=c;break;case"v":c=[s[0],s[1]+c],t.lineTo(c[0],c[1]),s=c;break;case"V":c=[s[0],c],t.lineTo(c[0],c[1]),s=c;break;case"c":a=o[2],l=o[3],l=[s[0]+l[0],s[1]+l[1]],t.bezierCurveTo(s[0]+c[0],s[1]+c[1],s[0]+a[0],s[1]+a[1],l[0],l[1]),s=l;break;case"C":a=o[2],l=o[3],t.bezierCurveTo(c[0],c[1],a[0],a[1],l[0],l[1]),s=l;break;case"q":a=o[2],a=[s[0]+a[0],s[1]+a[1]],t.quadraticCurveTo(s[0]+c[0],s[1]+c[1],a[0],a[1]),s=a;break;case"Q":a=o[2],t.quadraticCurveTo(c[0],c[1],a[0],a[1]),s=a;break;case"A":case"a":{a=o[2],l=o[6],o[0]==="a"&&(l=[s[0]+l[0],s[1]+l[1]]);const{center:[u,f],start:h,end:g}=bu(s,l,[c,a],o[3],o[4],o[5]);t.ellipse(u,f,c,a,o[3],h,g,!o[5]),s=l;break}case"r":a=o[2],a=[s[0]+a[0],s[1]+a[1]],t.arcTo(s[0]+c[0],s[1]+c[1],a[0],a[1],o[3]),s=a;break;case"R":a=o[2],t.arcTo(c[0],c[1],a[0],a[1],o[3]),s=a;break;case"z":case"Z":t.closePath()}}Xt(t,e)},mf=(t,e,n,s)=>{let i;(i=e.fill)&&i!=="none"&&Pr(t,n,s,"fill","fillRect"),(i=e.stroke)&&i!=="none"&&Pr(t,n,s,"stroke","strokeRect")},Pr=(t,e,n,s,i)=>{const r=e?.size||1;if(e.shape==="circle")for(let o of n)t.beginPath(),t.arc(o[0],o[1],r,0,$),t[s]();else{const o=r/2;for(let c of n)t[i](c[0]-o,c[1]-o,r,r)}},pf=(t,e,n)=>{n.length<2||(Ec(t,n),t.closePath(),Xt(t,e))},_f=(t,e,n,s)=>{s.length<2||(wc(t,n,s),t.closePath(),Xt(t,e))},Ec=(t,e)=>{let n=e[0];t.beginPath(),t.moveTo(n[0],n[1]);for(let s=1,i=e.length;s<i;s++)n=e[s],t.lineTo(n[0],n[1])},wc=(t,e,n)=>{const{start:s=0,cstride:i=1,estride:r=2}=e;let o=e?.num??(n.length-s)/r|0;t.beginPath(),t.moveTo(n[s],n[s+i]);for(let c=s+r;o-- >1;c+=r)t.lineTo(n[c],n[c+i])},bf=(t,e,n)=>{n.length<2||e.stroke=="none"||(Ec(t,n),Xt(t,e,!1))},yf=(t,e,n,s)=>{s.length<2||(wc(t,n,s),Xt(t,e,!1))},vf=(t,e,n,s,i,r)=>{let o;if(r!==void 0){t.beginPath(),t.roundRect(n[0],n[1],s,i,r),Xt(t,e);return}(o=e.fill)&&o!=="none"&&t.fillRect(n[0],n[1],s,i),(o=e.stroke)&&o!=="none"&&t.strokeRect(n[0],n[1],s,i)},Af=(t,e,n,s,i)=>{let r;(r=e.fill)&&r!=="none"&&t.fillText(s.toString(),n[0],n[1],i),(r=e.stroke)&&r!=="none"&&t.strokeText(s.toString(),n[0],n[1],i)},Oe=(t,e,n={attribs:{},edits:[]})=>{if(!e)return;if(wt(e,"toHiccup")){Oe(t,e.toHiccup(),n);return}if(D(e[0])){for(let o of e)Oe(t,o,n);return}const s=e[1];if(s?.__skip)return;const i=lf(t,n,s),r=i?i.attribs:n.attribs;switch(e[0]){case"g":case"defs":Ef(t,i,n,e);break;case"linearGradient":Br(n,s.id,rf(t,s,e[2]));break;case"radialGradient":Br(n,s.id,of(t,s,e[2]));break;case"points":mf(t,r,s,e[2]);break;case"packedPoints":df(t,r,s,e[2]);break;case"line":Ms(t,r,e[2],e[3]);break;case"lines":hf(t,r,e[2]);break;case"hline":Ms(t,r,[-1e6,e[2]],[1e6,e[2]]);break;case"vline":Ms(t,r,[e[2],-1e6],[e[2],1e6]);break;case"polyline":bf(t,r,e[2]);break;case"packedPolyline":yf(t,r,s,e[2]);break;case"polygon":pf(t,r,e[2]);break;case"packedPolygon":_f(t,r,s,e[2]);break;case"path":gf(t,r,e[2]);break;case"rect":vf(t,r,e[2],e[3],e[4],e[5]??s?.r);break;case"circle":case"arc":nf(t,r,e[2],e[3],e[4],e[5],e[6]);break;case"ellipse":sf(t,r,e[2],e[3],e[4],e[5],e[6],e[7]);break;case"text":Af(t,r,e[2],e[3],e[4]);break;case"img":cf(t,r,s,e[2],e[3],e[4],e[5])}i&&uf(t,n,i)},Ef=(t,e,n,s)=>{const i=s.length,r=s[0]==="g"&&e||n;for(let o=2;o<i;o++)Oe(t,s[o],r)},wf=t=>typeof t=="string",Rf=(t,e,n)=>{const s={expire:1e4,utf8:!1,...n};wf(e)&&s.utf8&&(e=new TextEncoder().encode(e),s.mime+=";charset=UTF-8");const i=URL.createObjectURL(e instanceof Blob?e:new Blob([e],{type:s.mime})),r=document.createElement("a");r.setAttribute("download",t),r.setAttribute("href",i),document.body.appendChild(r),r.click(),document.body.removeChild(r),s.expire>0&&setTimeout(()=>URL.revokeObjectURL(i),s.expire)},Sf=(t,e,n="png",s=.95)=>{const i=`image/${n}`;t.toBlob(r=>r?Rf(`${e}.${n}`,r,{mime:i}):console.warn("can't download canvas"),i,s)},If=[0,31,59,90,120,151,181,212,243,273,304,334],Mf=1e3,Df=60*Mf,Nf=(t,e)=>typeof t?.[e]=="function",$f=t=>typeof t=="number",Rc=t=>typeof t=="string",Of=t=>Rc(t)||$f(t)?new Date(t):Nf(t,"toDate")?t.toDate():t,Sc=t=>!(t%4)&&(!!(t%100)||!(t%400));function Ic(t,e=Object.create(null)){return(...n)=>{const s=n.join("-");return s in e?e[s]:e[s]=t(...n)}}const Lf=Ic((t,e)=>t.repeat(e)),ki=Ic((t,e=" ")=>{const n=Lf(String(e),t);return(s,i)=>s==null?n:(s=s.toString(),i=i!==void 0?i:s.length,i<t?n.substring(i)+s:s)}),at=ki(2,"0"),Cf=ki(3,"0"),Bf=ki(4,"0"),Tf=t=>typeof t=="function",Pf={months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],sepHM:".",date:["dd","/DM","MM","/MY","yyyy"],time:["h","/HM","mm"," ","a"],units:{y:{s:"y",p:"y"},M:{s:"m",p:"m"},d:{s:"d",p:"d"},h:{s:"h",p:"h"},m:{s:"min",p:"min"},s:{s:"s",p:"s"},t:{s:"ms",p:"ms"}},less:"< %s",past:"%s ago",now:"just now",future:"in %s"},Uf=t=>{const e={sepED:" ",sepDM:"/",sepMY:"/",sepHM:":",date:["E","/ED","d","/DM","MMM","/MY","yyyy"],time:["H","/HM","mm"],...t};return!e.dateTime&&(e.dateTime=[...e.date,", ",...e.time]),e};let de=Uf(Pf);const Gf=(t,e,n)=>If[e]+n+~~(e>1&&Sc(t)),kf=(t,e,n)=>{const s=new Date(Date.UTC(t,0,1)).getDay()||7;if(!e){if(s===5&&n<4)return 53;if(s===6&&n<3)return 52+~~Sc(t-1);if(s===7&&n<2)return 52}const i=(s<5?8:15)-s;return Math.ceil((Gf(t,e,n)-i)/7+1)},ti={yyyy:t=>Bf(t.getFullYear()),yy:t=>at(t.getFullYear()%100),MMM:t=>de.months[t.getMonth()],MM:t=>at(t.getMonth()+1),M:t=>String(t.getMonth()+1),dd:t=>at(t.getDate()),d:t=>String(t.getDate()),E:t=>de.days[t.getDay()],ww:t=>at(ti.w(t,!1)),w:t=>String(kf(t.getFullYear(),t.getMonth(),t.getDate())),q:t=>String((t.getMonth()/3|0)+1),HH:t=>at(t.getHours()),H:t=>String(t.getHours()),hh:t=>{const e=t.getHours()%12;return at(e>0?e:12)},h:t=>{const e=t.getHours()%12;return String(e>0?e:12)},mm:t=>at(t.getMinutes()),m:t=>String(t.getMinutes()),ss:t=>at(t.getSeconds()),s:t=>String(t.getSeconds()),SS:t=>Cf(t.getMilliseconds()),S:t=>String(t.getMilliseconds()),A:t=>t.getHours()<12?"AM":"PM",a:t=>t.getHours()<12?"am":"pm",Z:(t,e=!1)=>{const n=e?0:t.getTimezoneOffset(),s=Math.abs(n);return`${n<0?"+":"-"}${at(s/60|0)}:${at(s%60)}`},ZZ:(t,e=!1)=>e?"Z":ti.Z(t,e),"/DM":()=>de.sepDM,"/ED":()=>de.sepED,"/HM":()=>de.sepHM,"/MY":()=>de.sepMY},Ff=t=>(e=Date.now(),n=!1)=>{let s=Of(e);return n&&(s=new Date(s.getTime()+s.getTimezoneOffset()*Df)),t.map(i=>Rc(i)?i.startsWith("\\")?i.substring(1):ti[i]?.(s,n)??i:Tf(i)?i(s,n):i).join("")},zf=Ff(["yyyy","MM","dd","-","HH","mm","ss"]),Hf=yn(()=>"WebGL"),C=t=>{throw new Hf(t)},qf={alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},Vf=(t={})=>{const e=t.canvas?B(t.canvas)?document.getElementById(t.canvas):t.canvas:document.createElement("canvas");t.width&&(e.width=t.width),t.height&&(e.height=t.height),t.autoScale!==!1&&Fs(e,e.width,e.height),t.parent?.appendChild(e);const n=e.getContext(t.version!==1?"webgl2":"webgl",{...qf,...t.opts});return n||C("WebGL unavailable"),t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost),{canvas:e,gl:n,ext:Mc(n,t.ext),resize:(s,i)=>{Fs(e,s,i,t.autoScale!==!1?window.devicePixelRatio:1),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight)}}},Mc=(t,e,n=!0)=>{const s={};if(e)for(let i of e)s[i]=t.getExtension(i),n&&!s[i]&&C(`extension ${i} not available`);return s};var yt=(t=>(t[t.ALPHA=0]="ALPHA",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t[t.RED=3]="RED",t))(yt||{});const Yf=["rotateCW","rotate180","rotateCCW"];function jf(t,e,n,s){let i,r;if(y(t)){const a=rn(t,e,n,s);i=a.canvas,r=a.ctx}else i=t,r=i.getContext("2d");const o=r.getImageData(0,0,i.width,i.height),c=new Uint32Array(o.data.buffer);return{canvas:i,ctx:r,img:o,data:c}}const Rn=(t,e={})=>{const n=Reflect.ownKeys(t),s=Reflect.ownKeys(e),i=Symbol("isa");function r(o){for(let c of n){const a=Object.getOwnPropertyDescriptor(o.prototype,c);(!a||a.configurable)&&Object.defineProperty(o.prototype,c,{value:t[c],writable:!0})}return Object.defineProperty(o.prototype,i,{value:!0}),o}for(let o of s)Object.defineProperty(r,o,{value:e[o],enumerable:e.propertyIsEnumerable(o)});return Object.defineProperty(r,Symbol.hasInstance,{value:o=>!!o[i]}),r};Rn({order(){return[0]},includes(t){return t>=0&&t<this.size[0]},indexAt(t){return this.includes(t)?this.indexAtUnsafe(t):-1},indexAtUnsafe(t){return this.offset+(t|0)*this.stride[0]},getAt(t){return this.includes(t)?this.data[this.indexAtUnsafe(t)]:0},getAtUnsafe(t){return this.data[this.indexAtUnsafe(t)]},setAt(t,e){return this.includes(t)?(this.data[this.indexAtUnsafe(t)]=e,!0):!1},setAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t)]=e,!0}});const Dc=Rn({order(){return Math.abs(this.stride[1])>Math.abs(this.stride[0])?[1,0]:[0,1]},includes(t,e){const n=this.size;return t>=0&&t<n[0]&&e>=0&&e<n[1]},indexAt(t,e){return this.includes(t,e)?this.indexAtUnsafe(t,e):-1},indexAtUnsafe(t,e){return this.offset+(t|0)*this.stride[0]+(e|0)*this.stride[1]},getAt(t,e){return this.includes(t,e)?this.data[this.indexAtUnsafe(t,e)]:0},getAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t,e)]},setAt(t,e,n){return this.includes(t,e)?(this.data[this.indexAtUnsafe(t,e)]=n,!0):!1},setAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e)]=n,!0}});Rn({order(){return Nc(this.stride)},includes(t,e,n){const s=this.size;return t>=0&&t<s[0]&&e>=0&&e<s[1]&&n>=0&&n<s[2]},indexAt(t,e,n){return this.includes(t,e,n)?this.indexAtUnsafe(t,e,n):-1},indexAtUnsafe(t,e,n){const s=this.stride;return this.offset+(t|0)*s[0]+(e|0)*s[1]+(n|0)*s[2]},getAt(t,e,n){return this.includes(t,e,n)?this.data[this.indexAtUnsafe(t,e,n)]:0},getAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e,n)]},setAt(t,e,n,s){return this.includes(t,e,n)?(this.data[this.indexAtUnsafe(t,e,n)]=s,!0):!1},setAtUnsafe(t,e,n,s){return this.data[this.indexAtUnsafe(t,e,n)]=s,!0}});Rn({order(){return Nc(this.stride)},includes(t,e,n,s){const i=this.size;return t>=0&&t<i[0]&&e>=0&&e<i[1]&&n>=0&&n<i[2]&&s>=0&&s<i[3]},indexAt(t,e,n,s){return this.includes(t,e,n,s)?this.indexAtUnsafe(t,e,n,s):-1},indexAtUnsafe(t,e,n,s){const i=this.stride;return this.offset+(t|0)*i[0]+(e|0)*i[1]+(n|0)*i[2]+(s|0)*i[3]},getAt(t,e,n,s){return this.includes(t,e,n,s)?this.data[this.indexAtUnsafe(t,e,n,s)]:0},getAtUnsafe(t,e,n,s){return this.data[this.indexAtUnsafe(t,e,n,s)]},setAt(t,e,n,s,i){return this.includes(t,e,n,s)?(this.data[this.indexAtUnsafe(t,e,n,s)]=i,!0):!1},setAtUnsafe(t,e,n,s,i){return this.data[this.indexAtUnsafe(t,e,n,s)]=i,!0}});const Nc=t=>[...t].map((e,n)=>[e,n]).sort((e,n)=>Math.abs(n[0])-Math.abs(e[0])).map(e=>e[1]),Wf=t=>{const e=(t>>>24)/255;return t&4278190080|(t>>>16&255)*e<<16|(t>>>8&255)*e<<8|(t&255)*e},Xf=t=>{const e=(t>>>24)/255;return e>0?(t&4278190080|Math.min(255,(t>>>16&255)/e)<<16|Math.min(255,(t>>>8&255)/e)<<8|Math.min(255,(t&255)/e))>>>0:t},xf=t=>{const e=t>>>24;return(t>>>16&255)<=e&&(t>>>8&255)<=e&&(t&255)<=e},Zf=(t,e,n,s=1)=>S(t.length>=e*n*s,"pixel buffer too small"),Jf=(t,e,n)=>t?($c(t,e,n),t):new ImageData(e,n),$c=(t,e,n)=>S(t.width===e&&t.height===n,"imagedata has wrong dimensions"),Dn=(t,e)=>{const n=t.channels[e];return S(n!=null,`invalid channel ID: ${e}`),n},Kf=t=>S(!!t.alpha,"missing alpha channel"),Qf=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/255,ei=(t,e,n,s,i,r,o=0,c=0)=>(t|=0,e|=0,n|=0,s|=0,t<0&&(n+=t,o-=t,t=0),e<0&&(s+=e,c-=e,e=0),[t,e,ot(n,0,i-t),ot(s,0,r-e),o,c]),Ur=(t,e,n={})=>{const s=t.width,i=e.width;let r,o,c,a,l,u;return[r,o,l,u]=ei(n.sx||0,n.sy||0,n.w||s,n.h||t.height,s,t.height),[c,a,l,u,r,o]=ei(n.dx||0,n.dy||0,l,u,i,e.height,r,o),{sx:r,sy:o,dx:c,dy:a,rw:l,rh:u}},t1=(t,e,n)=>{for(let s=t.length;s-- >0;)t[s]=n(t[s],e)},e1=(t,e,n,s)=>{for(let i=t.length;i-- >0;)t[i]=s(t[i],n(e[i]))},n1=(t,e,n,s,i)=>{const r=~i;for(let o=t.length;o-- >0;)t[o]=t[o]&r|n(s(e[o]))&i},Gr=(t,e,n)=>{const s=e.fromABGR,i=e.toABGR;for(let r=t.length;r-- >0;)t[r]=s(n(i(t[r])))},kr=t=>(t&255)<<16|t>>16&255|t&4278255360,s1=(t,e,n={})=>(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):e).putImageData(t.toImageData(n.data),n.x||0,n.y||0),ni=(t,e)=>e>0?`(${t} << ${e})`:e<0?`(${t} >>> ${-e})`:`${t}`,Fi=(t,e)=>ni(t,-e),Oc=t=>`0x${t.toString(16)}`,i1=t=>{const e=8-t,n=(1<<t)-1;return new Function("luma",`return (x) => ${Fi("luma(x)",e)} & ${n};`)(Qf)},r1=t=>{let e;if(t!==8){const n=(1<<t)-1,s=255/n;e=`(((x & ${n}) * ${s}) | 0)`}else e="x";return new Function("x",`return 0xff000000 | (${e} * 0x010101);`)},o1=t=>new Function("x","return ("+t.map(e=>{const n=e.abgrShift+(8-e.size);return`(${Fi("x",n)} & ${Oc(e.maskA)})`}).join(" | ")+") >>> 0;"),c1=(t,e)=>{const n=t.map(i=>{if(i.size!==8){const r=i.mask0,o=255/r,c=Fi("x",i.shift);return ni(`((${c} & ${r}) * ${o})`,24-i.lane*8)}else return ni(`(x & ${Oc(i.maskA)})`,i.abgrShift)}).join(" | "),s=e?"":"0xff000000 | ";return new Function("x",`return (${s}${n}) >>> 0;`)},a1=(t,e,n)=>{const s=1<<t.size,i=s-1,r=i<<n>>>0,o=~r>>>0,c=t.lane!=null?t.lane:e,a=u=>u>>>n&i,l=(u,f)=>u&o|(f&i)<<n;return{size:t.size,num:s,abgrShift:24-c*8-n,lane:c,shift:n,mask0:i,maskA:r,int:a,setInt:l,float:u=>a(u)/i,setFloat:(u,f)=>l(u,v(f)*i)}},zi=t=>{S(t.channels.length>0,"no channel specs given");const e=t.channels.reduce(([n,s],i,r)=>(s-=i.size,n.push(a1(i,r,s)),[n,s]),[[],t.size])[0];return{__packed:!0,type:t.type,size:t.size,alpha:t.alpha||0,channels:e,fromABGR:t.fromABGR||o1(e),toABGR:t.toABGR||c1(e,!!t.alpha)}},si=zi({type:"u32",size:32,alpha:8,channels:[{size:8,lane:yt.ALPHA},{size:8,lane:yt.BLUE},{size:8,lane:yt.GREEN},{size:8,lane:yt.RED}],fromABGR:Yn,toABGR:Yn}),l1=(t,e,n=e,s,i)=>{const r=y(e)&&y(n)?rn(e,n,s,i):rn(t.width,t.height,s,i);return r.ctx.drawImage(t,0,0,r.canvas.width,r.canvas.height),r},u1=async(t,e="anonymous")=>{const n=new Image;return n.crossOrigin=e,n.src=t,await n.decode(),n},f1=u1;function h1(t,e="linear",n="clamp"){const s=!!t.format.__float,i=t.format.channels.length===1?"1":"",r=`${e[0]}${n[0]}${i}`,o=(s?{nc1:Nn,nw1:$n,nr1:On,nc:Nn,nw:$n,nr:On,lc1:c=>Ds(kt(c)),lw1:c=>Ds(Ft(c)),lr1:c=>Ds(zt(c)),lc:c=>$s(c,Nn(c)),lw:c=>$s(c,$n(c)),lr:c=>$s(c,On(c)),cc1:c=>Ls(kt(c)),cw1:c=>Ls(Ft(c)),cr1:c=>Ls(zt(c)),cc:c=>Bs(c,Nn(c)),cw:c=>Bs(c,$n(c)),cr:c=>Bs(c,On(c))}:{nc1:kt,nw1:Ft,nr1:zt,nc:kt,nw:Ft,nr:zt,lc1:c=>zn(kt(c)),lw1:c=>zn(Ft(c)),lr1:c=>zn(zt(c)),lc:c=>Ns(c,kt(c)),lw:c=>Ns(c,Ft(c)),lr:c=>Ns(c,zt(c)),cc1:c=>Os(c,kt(c)),cw1:c=>Os(c,Ft(c)),cr1:c=>Os(c,zt(c)),cc:c=>Cs(c,kt(c)),cw:c=>Cs(c,Ft(c)),cr:c=>Cs(c,zt(c))})[r];return S(!!o,`missing impl for ${r}`),o(t)}const kt=({data:t,width:e,height:n})=>(s,i)=>s>=0&&s<e&&i>=0&&i<n?t[(i|0)*e+(s|0)]:0,Ft=({data:t,width:e,height:n})=>(s,i)=>t[xn(i|0,n)*e+xn(s|0,e)],zt=({data:t,width:e,height:n})=>{const s=e-1,i=n-1;return(r,o)=>t[ot(o|0,0,i)*e+ot(r|0,0,s)]},Nn=({data:t,width:e,height:n,stride:[s,i]})=>(r,o)=>{let c;return r>=0&&r<e&&o>=0&&o<n?(c=(o|0)*i+(r|0)*s,t.slice(c,c+s)):[0]},$n=({data:t,width:e,height:n,stride:[s,i]})=>(r,o)=>{let c=xn(o|0,n)*i+xn(r|0,e)*s;return t.slice(c,c+s)},On=({data:t,width:e,height:n,stride:[s,i]})=>{const r=e-1,o=n-1;return(c,a)=>{let l=ot(a|0,0,o)*i+ot(c|0,0,r)*s;return t.slice(l,l+s)}},We=(t,e,n,s,i=4)=>Vo(t[s],t[s+i],t[s+2*i],t[s+3*i],e,n),zn=t=>(e,n)=>(e-=.5,n-=.5,Vo(t(e,n),t(e+1,n),t(e,n+1),t(e+1,n+1),T(e),T(n))),Ds=t=>(t=zn(t),(e,n)=>[t(e,n)]),Ns=(t,e)=>{const{fromABGR:n,toABGR:s}=t.format,i=new Uint32Array(4),r=new Uint8Array(i.buffer);return(o,c)=>{o-=.5,c-=.5,i[0]=s(e(o,c)),i[1]=s(e(o+1,c)),i[2]=s(e(o,c+1)),i[3]=s(e(o+1,c+1));const a=T(o),l=T(c);return n(We(r,a,l,0)|We(r,a,l,1)<<8|We(r,a,l,2)<<16|We(r,a,l,3)<<24)>>>0}},$s=({stride:[t]},e)=>{const n=new Float32Array(t*4);return(s,i)=>{s-=.5,i-=.5,n.set(e(s,i),0),n.set(e(s+1,i),t),n.set(e(s,i+1),t*2),n.set(e(s+1,i+1),t*3);const r=T(s),o=T(i);let c=[];for(let a=0;a<t;a++)c.push(We(n,r,o,a,t));return c}},Lc=t=>(e,n)=>{e-=.5,n-=.5;const s=e-1,i=e+1,r=e+2,o=n-1,c=n+1,a=n+2;return Yo(t(s,o),t(e,o),t(i,o),t(r,o),t(s,n),t(e,n),t(i,n),t(r,n),t(s,c),t(e,c),t(i,c),t(r,c),t(s,a),t(e,a),t(i,a),t(r,a),T(e),T(n))},Os=(t,e)=>{const n=t.format.channels[0].mask0;return e=Lc(e),(s,i)=>ot(e(s,i),0,n)},Ls=t=>(t=Lc(t),(e,n)=>[t(e,n)]),Cc=(t,e,n,s,i=4)=>Yo(t[s],t[s+i],t[s+2*i],t[s+3*i],t[s+4*i],t[s+5*i],t[s+6*i],t[s+7*i],t[s+8*i],t[s+9*i],t[s+10*i],t[s+11*i],t[s+12*i],t[s+13*i],t[s+14*i],t[s+15*i],e,n),Ln=(t,e,n,s,i=4)=>ot(Cc(t,e,n,s,i),0,255),Cs=(t,e)=>{const{fromABGR:n,toABGR:s}=t.format,i=new Uint32Array(16),r=new Uint8Array(i.buffer);return(o,c)=>{o-=.5,c-=.5;const a=o-1,l=o+1,u=o+2,f=c-1,h=c+1,g=c+2,d=T(o),p=T(c);return i[0]=s(e(a,f)),i[1]=s(e(o,f)),i[2]=s(e(l,f)),i[3]=s(e(u,f)),i[4]=s(e(a,c)),i[5]=s(e(o,c)),i[6]=s(e(l,c)),i[7]=s(e(u,c)),i[8]=s(e(a,h)),i[9]=s(e(o,h)),i[10]=s(e(l,h)),i[11]=s(e(u,h)),i[12]=s(e(a,g)),i[13]=s(e(o,g)),i[14]=s(e(l,g)),i[15]=s(e(u,g)),n(Ln(r,d,p,0)|Ln(r,d,p,1)<<8|Ln(r,d,p,2)<<16|Ln(r,d,p,3)<<24)>>>0}},Bs=({stride:[t]},e)=>{const n=new Float32Array(t*16);return(s,i)=>{s-=.5,i-=.5;const r=s-1,o=s+1,c=s+2,a=i-1,l=i+1,u=i+2,f=T(s),h=T(i);n.set(e(r,a),0),n.set(e(s,a),t),n.set(e(o,a),2*t),n.set(e(c,a),3*t),n.set(e(r,i),4*t),n.set(e(s,i),5*t),n.set(e(o,i),6*t),n.set(e(c,i),7*t),n.set(e(r,l),8*t),n.set(e(s,l),9*t),n.set(e(o,l),10*t),n.set(e(c,l),11*t),n.set(e(r,u),12*t),n.set(e(s,u),13*t),n.set(e(o,u),14*t),n.set(e(c,u),15*t);let g=[];for(let d=0;d<t;d++)g.push(Cc(n,f,h,d,t));return g}};var d1=Object.getOwnPropertyDescriptor,g1=(t,e,n,s)=>{for(var i=s>1?void 0:s?d1(e,n):e,r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(i)||i);return i};function m1(...t){return t[0]instanceof Dt?t[0].as(t[1]):new Dt(...t)}const p1=(t,e,n,s=n)=>_1(l1(t,n,s).canvas,e),_1=(t,e=si)=>{const{data:n}=jf(t),s=t.width,i=t.height;let r;if(e===si)r=n;else{r=kn(e.type,s*i);const o=n,c=e.fromABGR;for(let a=r.length;a-- >0;)r[a]=c(o[a])}return new Dt(s,i,e,r)};let Dt=class{size;stride;format;data;constructor(t,e,n=si,s){this.size=[t,e],this.stride=[1,t],this.format=n.__packed?n:zi(n),this.data=s||kn(n.type,t*e)}get pixels(){return this.data}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}get dim(){return 2}*[Symbol.iterator](){yield*this.data}as(t){return this.getRegion(0,0,this.width,this.height,t)}copy(){const t=this.empty();return t.data.set(this.data),t}empty(){return new Dt(this.width,this.height,this.format)}order(){}includes(t,e){}indexAt(t,e){}indexAtUnsafe(t,e){}getAt(t,e){}getAtUnsafe(t,e){}setAt(t,e,n){}setAtUnsafe(t,e,n){}getChannelAt(t,e,n,s=!1){const i=Dn(this.format,n),r=this.getAt(t,e);return s?i.float(r):i.int(r)}setChannelAt(t,e,n,s,i=!1){const r=Dn(this.format,n),o=this.getAt(t,e);return i?r.setFloat(o,s):r.setInt(o,s),this}blend(t,e,n){let s=this.width,i=e.width;const{sx:r,sy:o,dx:c,dy:a,rw:l,rh:u}=Ur(this,e,n);if(l<1||u<1)return e;const f=this.data,h=e.data,g=this.format.toABGR,d=e.format.toABGR,p=e.format.fromABGR;for(let b=(r|0)+(o|0)*s,m=(c|0)+(a|0)*i,I=0;I<u;I++,b+=s,m+=i)for(let M=0;M<l;M++)h[m+M]=p(t(g(f[b+M]),d(h[m+M])));return e}blit(t,e){let n=this.width,s=t.width;const{sx:i,sy:r,dx:o,dy:c,rw:a,rh:l}=Ur(this,t,e);if(a<1||l<1)return t;const u=this.data,f=t.data,h=this.format.toABGR,g=t.format.fromABGR,d=this.format!==t.format?(p,b)=>{for(let m=0;m<a;m++)f[b+m]=g(h(u[p+m]))}:(p,b)=>f.set(u.subarray(p,p+a),b);for(let p=(i|0)+(r|0)*n,b=(o|0)+(c|0)*s,m=0;m<l;m++,p+=n,b+=s)d(p,b);return t}blitCanvas(t,e={}){s1(this,t,e)}setImageData(t){$c(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,s=this.format.fromABGR;for(let i=e.length;i-- >0;)n[i]=s(e[i]);return this}toImageData(t){t=Jf(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,s=this.format.toABGR;for(let i=e.length;i-- >0;)e[i]=s(n[i]);return t}getRegion(t,e,n,s,i){const[r,o,c,a]=ei(t,e,n,s,this.width,this.height);if(!(c<1||a<1))return this.blit(new Dt(c,a,i||this.format),{sx:r,sy:o,w:c,h:a})}getChannel(t){const e=Dn(this.format,t),n=new Dt(this.width,this.height,{type:l0(e.size),size:e.size,channels:[{size:e.size,lane:yt.RED}],fromABGR:i1(e.size),toABGR:r1(e.size)}),s=this.data,i=n.data,r=e.int;for(let o=s.length;o-- >0;)i[o]=r(s[o]);return n}setChannel(t,e){const n=Dn(this.format,t),s=this.data,i=n.setInt;if(y(e))t1(s,e,i);else{const r=e.data,o=e.format.channels[0];Zf(r,this.width,this.height),n.size===o.size?e1(s,r,o.int,i):n1(s,r,this.format.fromABGR,e.format.toABGR,n.maskA)}return this}invert(){const{data:t,format:e}=this,n=Math.pow(2,e.size-e.alpha)-1;for(let s=t.length;s-- >0;)t[s]^=n;return this}premultiply(){return Kf(this.format),Gr(this.data,this.format,Wf),this}postmultiply(){return Gr(this.data,this.format,Xf),this}isPremultiplied(){const t=this.data,e=this.format.toABGR;for(let n=t.length;n-- >0;)if(!xf(e(t[n])))return!1;return!0}forEach(t){const e=this.data;for(let n=e.length;n-- >0;)e[n]=t(e[n],n);return this}fill(t){this.data.fill(t)}flipX(){const{data:t,width:e}=this;for(let n=0;n<t.length;n+=e)t.subarray(n,n+e).reverse();return this}flipY(){const{data:t,width:e}=this,n=kn(this.format.type,e);for(let s=0,i=t.length-e;s<i;s+=e,i-=e)n.set(t.subarray(s,s+e)),t.copyWithin(s,i,i+e),t.set(n,i);return this}rotateByID(t){return t>0?this[Yf[t-1]]():this}rotateCW(){const{width:t,height:e}=this,n=e-1;return this._rotate((s,i)=>s*e+n-i),this.size[0]=e,this.size[1]=t,this}rotateCCW(){const{width:t,height:e}=this,n=t-1;return this._rotate((s,i)=>(n-s)*e+i),this.size[0]=e,this.size[1]=t,this}rotate180(){const{width:t,height:e}=this,n=t-1,s=e-1;return this._rotate((i,r)=>(s-r)*t+n-i),this}scale(t,e="linear"){return S(t>0,"scale must be > 0"),this.resize(this.width*t,this.height*t,e)}resize(t,e,n="linear"){t|=0,e|=0,S(t>0&&e>0,"target width & height must be > 0");const s=m1(t,e,this.format),i=s.data,r=t>0?this.width/t:0,o=e>0?this.height/e:0;n=B(n)?h1(this,n,"repeat"):n;for(let c=0,a=0;c<e;c++){const l=c*o;for(let u=0;u<t;u++,a++)i[a]=n(u*r,l)}return s}upsize(){const{width:t,height:e,data:n}=this,s=new Dt(t*2,e*2,this.format),i=s.data;for(let r=0,o=0;r<e;r++)for(let c=0,a=r*t*4;c<t;c++,o++,a+=2)i[a]=n[o];return s}_rotate(t){const{data:e,format:n,width:s,height:i}=this,r=kn(n.type,s*i);for(let o=0;o<i;o++)for(let c=0;c<s;c++)r[t(c,o)]=e[o*s+c];this.data=r}};Dt=g1([Dc],Dt);const b1=zi({type:"u32",size:32,alpha:8,channels:[{size:8,lane:yt.ALPHA},{size:8,lane:yt.RED},{size:8,lane:yt.GREEN},{size:8,lane:yt.BLUE}],fromABGR:kr,toABGR:kr});class Zt{constructor(e,n){this.mode=e,this.value=n}deref(){return this.value}}const y1={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",grey:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32",transparent:"0000",rebeccapurple:"639"};let v1={canvas:"fff",canvastext:"000",linktext:"001ee4",visitedtext:"4e2386",activetext:"eb3323",buttonface:"ddd",buttontext:"000",buttonborder:"000",field:"fff",fieldtext:"000",highlight:"bbd5fb",highlighttext:"000",mark:"000",marktext:"fff",graytext:"808080"};const Bc=(t,e,n)=>L(t||e,e[0],e[1],e[2],n),A1=t=>t.mode,E1=t=>(t&3840)*4352|(t&240)*272|(t&15)*17,w1=t=>((t&61440)*69632|(t&3840)*4352|(t&240)*272|(t&15)*17)>>>0,ms=(t,e)=>L(t||[],(e>>>16&255)*tt,(e>>>8&255)*tt,(e&255)*tt,(e>>>24)*tt),Tc=(t,e)=>L(t||[],(e&255)*tt,(e>>>8&255)*tt,(e>>>16&255)*tt,(e>>>24)*tt),R1=t=>{t=(B(t)?t:t.deref()).toLowerCase();const e=y1[t]||v1[t];if(e||t[0]==="#")return new Zt("srgb",ms([],I1(e||t)));const n=t.split(/[(),/ ]+/),[s,i,r,o,c]=n;switch(S(n.length===5||n.length===6,`invalid color: ${t}`),s){case"rgb":case"rgba":return new Zt("srgb",[z(i,1,tt,!0),z(r,1,tt,!0),z(o,1,tt,!0),ge(c)]);case"hsl":case"hsla":return new Zt("hsl",[Ts(i),Fr(r),Fr(o),ge(c)]);case"lab":return new Zt("lab50",[z(i),z(r,1.25),z(o,1.25),ge(c)]);case"lch":return new Zt(s,[z(i),z(r,1.5),Ts(o),ge(c)]);case"oklab":return new Zt(s,[z(i,1,1),z(r,.4,1),z(o,.4,1),ge(c)]);case"oklch":return new Zt(s,[z(i,1,1),z(r,.4,1),Ts(o),ge(c)]);default:At(`color mode: ${s}`)}},S1={rad:$,grad:400,turn:1,deg:360},Ts=t=>{const e=/^(-?[0-9.]+)(deg|rad|grad|turn)?$/.exec(t);return S(!!e,`expected hue, got: ${t}`),T(parseFloat(e[1])/(S1[e[2]]||360))},ge=t=>t?z(t,1,1,!0):1,Fr=(t,e=!0)=>{S(/^([0-9.]+)%$/.test(t),`expected percentage, got: ${t}`);const n=parseFloat(t)/100;return e?v(n):n},z=(t,e=1,n=.01,s=!1)=>{S(/^-?[0-9.]+%?$/.test(t),`expected number or percentage, got: ${t}`);const i=parseFloat(t)*(t.endsWith("%")?.01*e:n);return s?v(i):i},I1=t=>{const e=/^#?([0-9a-f]{3,8})$/i.exec(t);if(e){const n=e[1],s=parseInt(n,16);switch(n.length){case 3:return(E1(s)|4278190080)>>>0;case 4:return Sr(w1(s),8);case 6:return(s|4278190080)>>>0;case 8:return Sr(s,8)}}return it(`invalid hex color: "${t}"`)},M1=tc((t,e=3,n=",",s="[",i="]")=>{const r=typeof e=="number"?nc(e):e;switch(t){case 1:return o=>`${s}${r(o[0])}${i}`;case 2:return o=>`${s}${r(o[0])}${n}${r(o[1])}${i}`;case 3:return o=>`${s}${r(o[0])}${n}${r(o[1])}${n}${r(o[2])}${i}`;case 4:return o=>`${s}${r(o[0])}${n}${r(o[1])}${n}${r(o[2])}${n}${r(o[3])}${i}`;default:return o=>{const c=[];for(let a=0;a<o.length;a++)c.push(r(o[a]));return`${s}${c.join(n)}${i}`}}}),Pc=t=>{const e=t.channels||{},n=t.order,s=n.length;n.reduce((h,g)=>(h[g]={range:[0,1],...e[g]},h),e);const i=Object.freeze(n.map(h=>e[h].range[0])),r=Object.freeze(n.map(h=>e[h].range[1])),o=ne([],i),c=ne([],r);o[s-1]=1;const a=n.findIndex(h=>!!e[h].hue),l=class{constructor(h,g=0,d=1){this.offset=g,this.stride=d,this.buf=h||[0,0,0,0],this.offset=g,this.stride=d}buf;get mode(){return t.mode}get length(){return s}get range(){return[i,r]}get[Symbol.toStringTag](){return t.mode}get xyz(){return[this[0],this[1],this[2]]}[Symbol.iterator](){return m0(this.buf,this.length,this.offset,this.stride)}copy(){return new l(this.deref())}copyView(){return new l(this.buf,this.offset,this.stride)}empty(){return new l}deref(){return[this[0],this[1],this[2],this[3]]}set(h){return ne(this,h)}clamp(){return a>=0&&(this[a]=T(this[a])),h0(null,this,i,r),this}eqDelta(h,g=U){return Ho(this,h,g)}randomize(h){return ic(this,o,c,h)}toJSON(){return this.deref()}toString(){return M1(4,4)(this)}};Ju(l.prototype,n),Ir(t.mode,t.from),Ir("rgb",{[t.mode]:t.toRgb});const u=(h,g,d)=>{const p=new l(...d);return g!==t.mode?cc(p,h,t.mode,g):p.set(h)},f=(h,...g)=>h==null?new l:B(h)?f(R1(h),...g):yi(h)?B(h.mode)?u(h,h.mode,g):new l(h,...g):wt(h,"deref")?u(h.deref(),h.mode,g):y(h)?g.length&&g.every(y)?new l(...M0([h,...g])):u(ms([],h),"srgb",g):it(`can't create a ${t.mode} color from: ${h}`);return f.class=l,f.range=[i,r],f.random=(h,g,d,p)=>new l(g,d,p).randomize(h),f.mapBuffer=(h,g=h.length/s|0,d=0,p=1,b=s)=>u0(l,h,g,d,p,b),f},ii=(t,e=ac)=>Si(t,e),Uc=t=>Si(t,E0),D1=t=>((t>>>16&255)*76+(t>>>8&255)*150+(t&255)*29)/65025,N1=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/65025,$1=t=>D1(t[0]),O1=t=>N1(t[0]),Hi=(t,e,n=1)=>(e=T(e)*6,L(t||[],v(Math.abs(e-3)-1),v(2-Math.abs(e-2)),v(2-Math.abs(e-4)),n)),Gc=(t,e)=>{const n=e[0];let s=e[1];const i=e[2],r=Hi(t||e,n,q(e[3])),o=ii(r);return i<o?s*=i/o:o<1&&(s*=(1-i)/(1-o)),Z(r,v((r[0]-o)*s+i),v((r[1]-o)*s+i),v((r[2]-o)*s+i))},kc=(t,e)=>{t=Li(t||e,e);const n=t[1],s=t[2];if(n<1e-6)return Z(t,s,s,s);const i=t[0]*6%6,r=s*(1-n),o=1-Math.abs(i%2-1);let c=3*s*n/(1+o);const a=c*o+r;switch(c+=r,i|0){case 0:return Z(t,c,a,r);case 1:return Z(t,a,c,r);case 2:return Z(t,r,c,a);case 3:return Z(t,r,a,c);case 4:return Z(t,a,r,c);case 5:return Z(t,c,r,a);default:return Z(t,r,r,r)}},Fc=(t,e)=>{const n=v(e[1]),s=v(e[2]);t=Hi(t||e,e[0],q(e[3]));const i=(1-Math.abs(2*s-1))*n;return Z(t,(t[0]-.5)*i+s,(t[1]-.5)*i+s,(t[2]-.5)*i+s)},zc=(t,e)=>{t=Li(t||e,e);const n=t[1],s=t[2];return Hi(t,e[0],t[3]),Z(t,((t[0]-1)*n+1)*s,((t[1]-1)*n+1)*s,((t[2]-1)*n+1)*s)},ps=(t,e)=>L(t||e,ws(e[0]),ws(e[1]),ws(e[2]),q(e[3])),L1=(t,e)=>ps(null,ms(t,e)),C1=(t,e)=>ps(null,Tc(t,e)),B1=[4.0767416621,-1.2684380046,-.0041960863,-3.307711591,2.6097574011,-.7034186147,.2309699292,-.3413193965,1.707614701],T1=(t,{0:e,1:n,2:s,3:i})=>fc(t,B1,[(e+.3963377774*n+.2158037573*s)**3,(e-.1055613458*n-.0638541728*s)**3,(e-.0894841775*n-1.291485548*s)**3,i]),P1=(t,e)=>{const{0:n,1:s,2:i}=e;return L(t||e,Rr(i*n,s),i,Rr(i*(1-n-s),s),q(e[3]))},U1=(t,e,n=ac)=>{const s=e[0],i=(2-2*n[2])*e[1],r=(2-2*n[0])*e[2];return L(t||e,s+r,s-n[2]/n[1]*i-n[0]/n[1]*r,s+i,q(e[3]))},_s=Pc({mode:"rgb",order:["r","g","b","alpha"],from:{abgr32:(t,e)=>C1(t,e[0]),argb32:(t,e)=>L1(t,e[0]),hcy:Gc,hsi:kc,hsl:Fc,hsv:zc,lab50:Kn,lab65:gc,lch:[dc,Kn],oklab:T1,rgb:ne,srgb:ps,xyy:[P1,Ks],xyz50:Bi,xyz65:Ks,ycc:U1},toRgb:ne}),Hc=Pc({mode:"srgb",order:["r","g","b","alpha"],from:{abgr32:(t,e)=>Tc(t,e[0]),argb32:(t,e)=>ms(t,e[0]),hcy:Gc,hsi:kc,hsl:Fc,hsv:zc,rgb:en},toRgb:ps});function G1(t,...e){let[n,s,i,r,o,c,a,l]=e;switch(e.length){case 1:return(...u)=>t(n,...u);case 2:return(...u)=>t(n,s,...u);case 3:return(...u)=>t(n,s,i,...u);case 4:return(...u)=>t(n,s,i,r,...u);case 5:return(...u)=>t(n,s,i,r,o,...u);case 6:return(...u)=>t(n,s,i,r,o,c,...u);case 7:return(...u)=>t(n,s,i,r,o,c,a,...u);case 8:return(...u)=>t(n,s,i,r,o,c,a,l,...u);default:it()}}const k1=()=>Yn,F1=(t,e)=>$t(F(([n,s,i,r])=>v(n+s*Math.cos($*(i*e+r)))),se(),Ws(...t)),zr=(t,e,n)=>$t(An(F(G1(F1,e)),k1()),se(),rc(t-1)),Hr=(t,e)=>{t=Dr([],t),e=Dr([],e);const n=[...F(([s,i])=>.5*(s-i),Ws(t,e))];return[[...F(([s,i])=>s-i,Ws(t,n))],n,[-.5,-.5,-.5,-.5],[0,0,0,0]]},z1=Bt(A1,{lch:"lab",oklab:"lab",ycc:"lab",xyy:"hcy"},{argb32:$1,abgr32:O1,hcy:t=>t[2],lab:t=>t[0],rgb:ii,srgb:Uc,xyz:t=>t[1],[j]:t=>ii(_s(t))}),V=(t,e,n)=>{const s=t[e];t[e]=t[n],t[n]=s},H1=(...t)=>{const[e,n,s]=t,i=t.length;switch(i){case 0:return V;case 1:return(r,o,c)=>{V(r,o,c),V(e,o,c)};case 2:return(r,o,c)=>{V(r,o,c),V(e,o,c),V(n,o,c)};case 3:return(r,o,c)=>{V(r,o,c),V(e,o,c),V(n,o,c),V(s,o,c)};default:return(r,o,c)=>{V(r,o,c);for(let a=i;a-- >0;)V(t[a],o,c)}}};function ri(t,e=Ui,n=V,s=0,i=t.length-1){if(s<i){const r=t[s+(i-s>>1)];let o=s-1,c=i+1;for(;;){do o++;while(e(t[o],r)<0);do c--;while(e(t[c],r)>0);if(o>=c)break;n(t,o,c)}ri(t,e,n,s,c),ri(t,e,n,c+1,i)}return t}const q1=(t,e,n=Ui)=>{const s=$e(e)?t.map(e):e;return S(s.length===t.length,"keys.length != src.length"),ri(s,n,H1(t)),t},qc=(t,e)=>t-e,V1=(t,e)=>e-t,Y1=(t,e,n=!1)=>q1(t,e,n?V1:qc),ke=.072,Fe=.213,j1=.285,ze=.715,W1=.787,X1=.928,oi=B0,x1=(t,...e)=>e.reduce(T0,t),Vc=t=>[1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0],Z1=(t,e=.5*(1-t))=>[t,0,0,0,e,0,t,0,0,e,0,0,t,0,e,0,0,0,1,0],J1=t=>[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],qr=t=>[Fe+W1*t,ze-ze*t,ke-ke*t,0,0,Fe-Fe*t,ze+j1*t,ke-ke*t,0,0,Fe-Fe*t,ze-ze*t,ke+X1*t,0,0,0,0,0,1,0];function ci(t){return t?ln(ci(),t):ds(()=>({}),(e,[n,s])=>(e[n]=s,e))}function ai(...t){const e=Yl(ai,t);if(e!==void 0)return e;const n=t[0];return ds(()=>!1,n?(s,i)=>n(i)?dr(!0):s:(s,i)=>i?dr(!0):s)}function Yc(t,e){return Te(e)?Bo(Yc(t),B(e)?[e]:e):n=>{const s=n[2],i=(r,o)=>{const c=t(o);if(c){for(let a of c)if(r=i(r,a),Lt(r))break;return r}return s(r,o)};return vn(n,i)}}function K1(t){return Yc(e=>z0(e)?e:void 0,t)}const Q1=(t,e=0,n=t.length,s=ce)=>{for(S(e>=0&&n>=e&&n<=t.length,`illegal range ${e}..${n}`);n>e+1;){const i=s.minmax(e,n)|0,r=t[i];t[i]=t[--n],t[n]=r}return t},th=(t,e=t.length,n=ce)=>Q1(t,0,e,n),jc=t=>t!=null,Sn=t=>typeof t=="boolean",eh=t=>t instanceof Map,nh=()=>typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node<"u",sh=new Set(["__proto__","prototype","constructor"]),Ps=t=>sh.has(t),ih=t=>D(t)?t.some(Ps):B(t)?t.indexOf(".")!==-1?t.split(".").some(Ps):Ps(t):!1,rh=(t,e,n=o=>o,s=Ui,i=0,r=t.length-1)=>{const o=n(e);for(;i<=r;){const c=i+r>>>1,a=s(n(t[c]),o);if(a<0)i=c+1;else if(a>0)r=c-1;else return c}return-i-1};function*Us(t){for(let e in t)t.hasOwnProperty(e)&&(yield t[e])}const oh=t=>t,ch=(t,e,n,s)=>{if(n===void 0||s===void 0){const i=t.timeBounds();n=n??i[0],s=s??i[1]}return F(i=>(i=te(n,s,i),[i,t.at(i)]),rc(e))};class Le{constructor(e,n,s){this.impl=e,this.stops=n,S(n.length>=2,"require at least 2 keyframes/stops");const i={domain:oh,...s};this.domain=i.domain,this.sort()}domain;copy(){return new Le(this.impl,this.stops.map(e=>e.slice()))}empty(){return new Le(this.impl,[])}at(e){const{domain:n,impl:s,stops:i}=this,r=i.length-1,o=i[0],c=i[r];e=n(e,o[0],c[0]);const a=this.timeIndex(e);return a<0?o[1]:a>=r?c[1]:s.at(i,a,e)}samples(e=100,n,s){return ch(this,e,n,s)}bounds(){const{impl:e,stops:n}=this,s=n.length;let i=null,r=null;for(let o=s;o-- >0;){const c=n[o][1];i=e.min(i,c),r=e.max(r,c)}return{min:i,max:r,minT:n[0][0],maxT:n[s-1][0]}}timeBounds(){return[this.stops[0][0],Lo(this.stops)[0]]}setStopAt(e,n,s=.01){const i=this.closestIndex(e,s);return i<0?(this.stops.push([e,n]),this.sort(),!0):(this.stops[i][1]=n,!1)}removeStopAt(e,n=.01){return this.stops.length>2?this.removeStopAtIndex(this.closestIndex(e,n)):!1}removeStopAtIndex(e){const n=this.stops;return e<0||e>=n.length||n.length<=2?!1:(n.splice(e,1),!0)}closestIndex(e,n=.01){const s=this.stops;for(let i=s.length;i-- >0;)if(yu(e,s[i][0])<n)return i;return-1}clampedIndexTime(e,n,s=.01){const i=this.stops,r=i.length-1;return e==0?Math.min(n,i[1][0]-s):e===r?Math.max(n,i[r-1][0]+s):ot(n,i[e-1][0]+s,i[e+1][0]-s)}sort(){this.stops.sort((e,n)=>e[0]-n[0])}uniform(){const e=this.stops.length-1;this.stops.forEach((n,s)=>n[0]=s/e)}timeIndex(e){const n=this.stops,s=n.length;if(s<256){for(let r=s;r-- >0;)if(e>=n[r][0])return r;return-1}const i=rh(n,[e,null],r=>r[0],qc);return i<-1?-(i+2):i}}const ah=(t,e)=>new Le(lh,t,e),lh={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>{const s=t.length-1,i=t[Math.max(e-1,0)],[r,o]=t[Math.max(e,0)],[c,a]=t[Math.min(e+1,s)],l=t[Math.min(e+2,s)],u=br(i[1],a,0,i[0],c),f=br(o,l[1],0,r,l[0]);return Eu(o,u,a,f,Ei(n,r,c))}},uh=(t,e)=>new Le(fh,t,e),fh={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>{const s=t[e],i=t[e+1];return Q(n,s[0],i[0],s[1],i[1])}},Wc=4,Cn=1<<Wc,Xc=8,hh=1<<Xc,lt=4095;let xc=4,Zc=.5;const Gs=t=>.5*(1-Math.cos(t*Math.PI));let nt;const dh=function(t,e=0,n=0){if(nt==null){nt=new Array(lt+1);for(let b=0;b<lt+1;b++)nt[b]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),n<0&&(n=-n);let s=Math.floor(t),i=Math.floor(e),r=Math.floor(n),o=t-s,c=e-i,a=n-r,l,u,f=0,h=.5,g,d,p;for(let b=0;b<xc;b++){let m=s+(i<<Wc)+(r<<Xc);l=Gs(o),u=Gs(c),g=nt[m&lt],g+=l*(nt[m+1&lt]-g),d=nt[m+Cn&lt],d+=l*(nt[m+Cn+1&lt]-d),g+=u*(d-g),m+=hh,d=nt[m&lt],d+=l*(nt[m+1&lt]-d),p=nt[m+Cn&lt],p+=l*(nt[m+Cn+1&lt]-p),d+=u*(p-d),g+=Gs(a)*(d-g),f+=g*h,h*=Zc,s<<=1,o*=2,i<<=1,c*=2,r<<=1,a*=2,o>=1&&(s++,o--),c>=1&&(i++,c--),a>=1&&(r++,a--)}return f},gh=function(t,e){t>0&&(xc=t),e>0&&(Zc=e)},li={sinTimesCos:_h,sinFractCos:Eh,sinPlusCos:bh,sinPlusSin:yh,cos:vh,sin:Ah,hopalong:wh,clifford:Rh,deJong:Sh,gumowskiMira:Dh,bedhead:Ih,fractalDream:Mh,perlin:ph,radial:ui,macMillan:Nh,juan:$h,nAttractor:Oh},mh=(t,e=Object.keys(li))=>{const n=w(e,t);let s=1,i=10;switch(n){case"fractalDream":case"clifford":i=t.minmaxInt(1,30);break;case"perlin":i=t.minmaxInt(1,20);break;case"bedhead":case"deJong":i=t.minmaxInt(1,50);break;case"hopalong":default:i=t.minmaxInt(1,100);break}const r=t.minmaxInt(s,i);return{type:n,opts:{scale:[r,r],amplitude:t.minmax(.5,20),a:t.minmax(-15,15),b:t.minmax(-15,15),c:t.minmax(-15,15),d:t.minmax(-15,15),mode:1,center:[t.minmax(-.5,.5),t.minmax(-.5,.5)],falloff:t.minmax(.01,.3),lod:t.minmaxInt(0,5)},conversion:w(["multiplyByPI","aCos","aSin"],t)}};function ph([t,e],n){const s=n.lod?n.lod:4,i=n.falloff?n.falloff:.5;return gh(s,i),(dh(t,e)-.5)*2}function _h([t,e],n){return Math.sin(t)*Math.cos(e)}function bh([t,e],n){return(Math.sin(t)+Math.cos(e))*.5}function yh([t,e],n){return(Math.sin(t)+Math.sin(e))*.5}function vh([t,e],n){return Math.cos(t)}function Ah([t,e],n){return Math.sin(t)}function Eh([t,e],n){return Math.sin(t)/Math.cos(e)}function Tt([t,e],[n,s],i=1){return i===0?Math.atan2(s,n)/et:Math.atan2(s-e,n-t)/et}function wh([t,e],{a:n=1,b:s=1,c:i=1,mode:r=0}){const o=e-1-Math.sqrt(Math.abs(s*t-1-i))*Math.sign(t-1),c=n-t-1;return Tt([t,e],[o,c],r)}function Rh([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const c=Math.sin(n*e)+i*Math.cos(n*t),a=Math.sin(s*t)+r*Math.cos(s*e);return Tt([t,e],[c,a],o)}function Sh([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const c=Math.sin(n*e)-Math.cos(s*t),a=Math.sin(i*t)-Math.cos(r*e);return Tt([t,e],[c,a],o)}function Ih([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const c=Math.sin(t*e/s)*e+Math.cos(n*t-e),a=t+Math.sin(e)/s;return Tt([t,e],[c,a],o)}function Mh([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const c=Math.sin(s*e)+i*Math.sin(s*t),a=Math.sin(n*t)+r*Math.sin(n*e);return Tt([t,e],[c,a],o)}function Dh([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const c=n*t+(1-n)*2*t*t/(1+t*t),a=s*e*c,l=c-t;return Tt([t,e],[a,l],o)}function Nh([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const c=e,a=-c+2*n*e/(1-e*e)+s*e;return Tt([t,e],[c,a],o)}function $h([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const c=Math.cos(n*t),a=Math.sin(s*e),l=c*c-a*a,u=2*Math.cos(i*t)*Math.sin(r*e);return Tt([t,e],[l,u],o)}function Oh([t,e],{a:n=1,b:s=1,c:i=1,d:r=1,mode:o=0}){const c=n*Math.sin(e-e*(e*e+1)/2)+s*Math.tanh(t-t*(t*t+1)/2),a=i*Math.sin(t-t*(t*t+1)/2)+r/Math.cosh(e-e*(e*e+1)/2);return Tt([t,e],[c,a],o)}function ui([t,e],{center:n=[0,0],exchangeInputs:s=!1}){const[i,r]=s?[n[1],n[0]]:n;return Math.atan2(e-r,t-i)/et}function Jc(t,e,n=!0){if(t<=e[0])return e[0];let s=0;for(;s<e.length-1;){if(t<=e[s+1])return n?t-e[s]<e[s+1]-t?e[s]:e[s+1]:e[s];s++}return e[e.length-1]}function Lh(t,e=[-1,1]){const n=[];if(t>1)for(let s=0;s<=t;s++)n.push(e[0]+(e[1]-e[0])*s/t);return n}function Ch(t,e,n,s,i=!0){const r=n.amplitude?n.amplitude:1;let[o,c]=e;n.scale&&(o*=n.scale[0],c*=n.scale[1]);let a=t(n.exchangeInputs?[c,o]:[o,c],n);return s==null||s.length==0?a*r:r*Jc(a,s,i)}function Bh(t,e,n,s,i=!0){if(li[t])return Ch(li[t],e,n,s,i);throw new Error(`noise '${t}' is not implemented.`)}function Vr(t,{type:e="perlin",opts:n={scale:[1,1]},rotation:s=0,conversion:i="multiplyByPI",quantizationArray:r=[],quantizeToClosest:o=!0}){const c=e||"perlin";if(c==="radial"){const[f,h]=n.exchangeInputs?[t[1],t[0]]:t;return r==null||r.length==0?ui([f,h],n)*et:Jc(ui([f,h],n),r,o)*et}const a=Bh(c,t,n,r,o),l=n.amplitude?n.amplitude:1;let u=1;switch(i){case"aCos":u=s+Math.acos(a/l);break;case"aSin":u=s+Math.asin(a/l);break;default:u=s+et*a}return El(u)}const Th=async t=>{const e=[];return t.length>0&&e.push(...(await Promise.all(t.map(n=>f1(n)))).map(n=>p1(n,b1))),e},Ph={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>t[e+1][1]},Uh=(t,e)=>new Le(Ph,t,e);function Kc(t,e){for(const n of e)if(Wt(n,t))return!0;return!1}function Bn(t,e){let n=0;for(const s of e){if(Wt(s,t))return n;n++}return-1}const He=t=>[((t=Math.floor(t))>>16&255)/255,(t>>8&255)/255,(255&t)/255],ks=(t,e)=>t==="hermite"?ah(e):t==="linear"?uh(e):Uh(e),Gh=(t,e,n,s)=>{const[i,r]=Zn([],e,n,s,[0,0],[t.width,t.height]);return t.getAt(Math.floor(i),Math.floor(r))},qt=(t,e,n)=>Va(t,e,n)(),Tn=0xfffffffffn,kh=t=>new Uint32Array([Number(t>>96n&Tn),Number(t>>64n&Tn),Number(t>>32n&Tn),Number(t&Tn)]),Fh=t=>kh(BigInt("0x"+t.replace(/-/g,"").substring(0,32))),zh=(t,e,n=rt)=>{for(let s=t.length;s-- >0;)if(n(e,t[s]))return s;return-1};[...zr(10,Hr([0,0,.102],[.933,.996,1])).map(t=>Qs(oi(null,qr(.8),t)))],[...zr(10,Hr([.067,0,0,1],[1,.996,.933,1])).map(t=>Qs(oi(null,qr(.8),t)))];const Yr={0:[2120566,15130821,16291640,13845523,271427,.01,1.01,1.1],1:[4562234,16777215,6596594,4145473,1973791,0,1,1.2],2:[4470864,12303972,15397070,12633537,8225937,0,1.05,1.5],3:[13354938,15131351,2633011,3159101,4540754,.03,1,1],5:[12442047,3031122,16762967,16777215,4268596,-.03,1,1.5],6:[16250866,12965997,2497557,15001283,15752483,0,1,1],7:[5871085,279433,16580427,16755973,8171460,-.04,1,1.2],8:[13762590,2589067,7179309,15508269,15425574,.01,1,1],9:[1529984,16708813,10072218,7631457,2766650,0,1,1.02],11:[11907778,5930364,14344183,2305075,10535377,0,1,1.1],12:[10289158,1659231,6661793,15566395,15354668,0,1,1],13:[13515281,469832,2384251,16707790,16288806,.01,1,1.15],14:[13553870,1644825,15814693,16777215,15132902,0,1,1.15],15:[1317406,15791103,4211788,3751743,2041382,0,1,1],16:[657672,2241339,15392981,13020303,6180927,0,1,1.9],17:[3368330,8829912,7704143,16166445,15885337,0,1,1.12],18:[16711422,16168524,15351084,3817281,6535886,0,1,1.1],19:[7289398,13139994,14797476,9608602,5534304,0,1,1.2],20:[13859385,13784116,7498570,15786420,15508823,0,1,1.1],21:[9831194,16427286,16515070,7169902,1776414,0,1,1.1],22:[42733,8370176,863316,16142621,16757760,0,1.02,1.1],23:[5777159,9907463,16730942,16757263,16770376,0,1.01,1.05],24:[15718311,3939072,8763312,15848851,16328960,0,1,1.26],27:[6124414,16579836,135451,4145221,3156271,0,1,2],28:[9947562,13732155,15702825,3610381,13942932,0,1.05,1.2],29:[14303591,16044894,16177326,3031127,540023,0,1.02,1.1],30:[14155826,2829634,9279918,15594228,15672124,0,1,1],31:[6575426,8371106,16119484,15051558,12471335,0,1,1.15],32:[15125682,14530706,11569512,8344889,10249796,0,1.03,1.05],34:[2994148,13099310,16120284,3223857,4036282,0,1.02,1.2],35:[2735890,11272015,572861,15866687,16750868,0,1.05,1.1],36:[402725,1332558,15194544,16034598,792857,.01,1.03,1.04],37:[4004864,8763055,15783315,16263680,15718568,0,1.03,1.04],38:[15971407,15193272,14338478,1844529,16400720,.01,1.04,1.3],40:[14719784,15459775,2831168,1916524,5136224,0,1.03,1.07],41:[9667969,12965348,8283473,4612962,8951467,0,1.05,1.6],42:[1716574,10208227,15266296,3770568,15821646,0,1,1.15],44:[16706750,16154427,16008999,2952226,16245696,0,1.01,1.02],45:[14342093,10727818,5800279,3824192,3427905,0,1.03,1.16],47:[2508371,2792847,15320170,16032353,15167313,0,1,1.12],48:[6319160,2635288,16710368,14524766,12348453,0,1.03,1.1],49:[15260604,8761251,0,5308418,11494980,0,1,1],50:[3084589,12921662,8323635,16702104,8323635]};Object.keys(Yr).map(t=>{const e=Yr[t];return[He(e[4]),He(e[0]),He(e[1]),He(e[2]),He(e[3])]});const Hh=(t,e)=>qh(Y1(t.map(n=>_s(n)),Uc,e)),qh=t=>({bg:[t[0]],fg:t.slice(1).reverse()}),Qc=(t,e,n,s=.001,i=!0)=>on(t.supportData.distanceToCenter,0,e,i?n:s,i?s:n),Vh=t=>Math.sqrt(Math.pow(t/2,2)+Math.pow(.5,2)),Yh=(t,e,n,s)=>(n===void 0&&(n=-e/2),s===void 0&&(s=e/2),Q(t[0],n,s,0,1)),jh=(t,e)=>{let n;return(t.update!==void 0||e.update!==void 0)&&(n=(s,i)=>Math.min(t.update?t.update(s,i):Number.MAX_VALUE,e.update?e.update(s,i):Number.MAX_VALUE)),{get:(s,i)=>Math.min(t.get(s,i),e.get(s,i)),update:n,info:"min("+t.info+", "+e.info+")",aux:t.aux}},Ht=(t,e=0,n=1,s={},i=!1)=>{let r=[],o=0,c=1,a=t,l=0,u=s.cutoff??0,f=s.valueTransform??(d=>d),h=s.outputTransform??(d=>d);t==="width"||t==="height"?(r=t==="width"?["pos",0]:["pos",1],o=s.minValue??-.5,c=s.maxValue??.5):t==="agent ID"||t==="agent generation"?(r=t==="agent ID"?["ID"]:["generation"],o=s.minValue??0,c=s.maxValue??1):t==="space traveled"?(r=["spaceTraveled"],o=s.minValue??0,c=s.maxValue??1,l=1):t==="distance from center"&&(o=s.minValue??0,c=s.maxValue??Math.SQRT2);const g=(d,p)=>{const b=l===0?d:p;let m=0;if(r.length>0){const M=b[r[0]];r.length>1?m=M[r[1]]:m=M}m=f(m);let I=0;switch(t){case"random":I=s.rnd.minmax(e,n);break;case"distance from center":I=Qc(d,c,e,n);break;case"pos inside bounds":Kc(d.pos,s.bounds)?I=e:I=n;break;case"image luminance":if(d.supportData.features&&d.supportData.features.length>s.imageIndex){const M=z1(d.supportData.features[s.imageIndex]);M<u?I=1e-5:I=on(M,o,c,e,n)}else I=c;break;default:I=on(m,o,c,e,n);break}return h(I)};return{get:(d,p)=>g(d,p),update:i?(d,p)=>g(d,p):void 0,info:a,aux:[e,n]}};function Wh(t,e,n,{decimatePercentage:s=0,elasticity:i=[0,0],minSize:r=.01,margin:o=0,shakeAmount:c=[[0,0],[0,0]],shuffleResult:a=!1},l){let u=n,f=e;Array.isArray(e)&&Array.isArray(n)?l.probability(.5)?u=Array.isArray(n)?l.minmaxInt(n[0],n[1]+1):n:f=Array.isArray(e)?l.minmaxInt(e[0],e[1]+1):e:y(n)&&y(e)&&(l.probability(.5)?u=[n,n]:f=[e,e]);let h=y(u)?0:1,g=t;if(h===1){let m=u;u=f,f=m,g=gn([t.pos[1],t.pos[0]],[t.size[1],t.size[0]])}const d=Xh(g,u,f,i,r,o,l),p=[...K1(d)];h===1&&p.forEach(m=>{m.pos=[m.pos[1],m.pos[0]],m.size=[m.size[1],m.size[0]]});const b=Math.floor(p.length*s);return b>0&&Zh(p,b,l),xh(p,c[0],c[1],l),a&&th(p,p.length,l),p}function Xh(t,e,n,s,i,r=0,o){const c=[];for(let a=0;a<e;a++){const l=[];c.push(l);let u=Array.isArray(n)?o.minmaxInt(n[0],n[1]+1):n;const f=[(t.size[0]-(u+1)*r)/u,(t.size[1]-(e+1)*r)/e];if(s[0]===0&&s[1]===0||f[0]<=i||u===1)for(let h=0;h<u;h++){const g=gn([t.pos[0]+r+h*(f[0]+r),t.pos[1]+r+a*(f[1]+r)],[f[0],f[1]]);l.push(g)}else{let h=t.pos[0]+r,g=t.pos[1]+r+a*(f[1]+r);for(let d=0;d<u;d++){let p=Math.min(Math.max(f[0]+o.minmax(s[0],s[1]),i),t.pos[0]+t.size[0]-((u-(d+1))*(i+r)+h+r));d===u-1&&(p=t.pos[0]+t.size[0]-r-h);const b=gn([h,g],[p,f[1]]);h+=p+r,l.push(b)}}}return c}function xh(t,[e,n],[s,i],r){return t.forEach(o=>{const c=r.minmax(e,n),a=r.minmax(s,i);o.pos=[o.pos[0]+c,o.pos[1]+a]}),t}function Zh(t,e,n){for(let s=0;s<e;s++){const i=n.minmaxInt(0,t.length);t.splice(i,1)}return t}const Jh=Object.freeze([1,0,0,1]),Kh=Object.freeze([1,0,0,0,1,0,0,0,1]),ta=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Qn={default:{matrix:ta,offset:[0,0,0,0]}},Qh={brightness:0,contrast:0,filterMatrix:Qn.default.matrix,filterOffset:Qn.default.offset,exposure:0,saturation:0,simmetry:0,info:"default"};function td(t){const e=1+t,n=.2126,s=.7152,i=.0722,r=(1-e)*n,o=(1-e)*s,c=(1-e)*i;return[r+e,r,r,0,o,o+e,o,0,c,c,c+e,0,0,0,0,1]}function ed(t){const e=td(t.saturation||0);let n=t.filterMatrix||Qn.default.matrix,s=t.filterOffset||Qn.default.offset;return x1(Vc(t.brightness||0),Z1(1+(t.contrast||0),-.5*(t.contrast||0)),J1(1+(t.exposure||0)),[e[0],e[4],e[8],e[12],0,e[1],e[5],e[9],e[13],0,e[2],e[6],e[10],e[14],0,e[3],e[7],e[11],e[15],0],[n[0],n[4],n[8],n[12],s[0],n[1],n[5],n[9],n[13],s[1],n[2],n[6],n[10],n[14],s[2],n[3],n[7],n[11],n[15],s[3]])}const nd=["20d57945-4f8b-442e-b79a-112515735693","5d030ffe-89fb-4fb8-b791-da6eae875996","4f706548-1d55-4e4a-bdda-a701d6f65065","15e0343b-7b0e-4406-a41c-e22ce873dc58","bca582ba-2e02-4282-9b46-f604d4255c4c","9677cb84-e6c2-4e43-89b0-51d8d5f19eb0","e2b971ea-ccdb-48d4-b278-7fd57c2ffef7","e882f2f7-2556-4e70-8d54-120c139e2a7c"],jr={parcel:["#DBCBB2","#0A121C"],dark:["#111111","#FCFCFC"],blueprint_dark:["#191B27","#D2D4C5"],grey:["#373737","#D9D9D9"],severance:["#BBCFD4","#1B2937","#5C7F68","#223C33"]},sd=(t,e,n)=>({name:"area_lights",background:({bounds:s,colors:i,scalingFactor:r})=>({shapes:s.init,fill:w([[0,1,0],[0,1,0,1]],t.RND_STYLE),draw:w([[1],[1,1,1,0]],t.RND_STYLE),weights:s.init.map(()=>1.5*t.RND_STYLE.minmaxInt(1,5)*r),rounds:[0],colors:i.fg,info:"all-inverted"}),aspectRatio:e/n,halfDiagonal:({aspectRatio:s})=>Vh(s),scalingFactor:.3*Math.max(e,n)/1e3,gridSize:[e,n],assets:["./assets/"+w(["skagen.jpeg","contorted-wood.jpg"],t.RND_STYLE)],style:({aspectRatio:s,bounds:i})=>{const r={type:"line | sanding",alphaDecay:a=>a*a/1.5,grainsFactorRange:[100,725],minAlpha:.001,followBounds:!0,sizeFactor:w([.35,.5],t.RND_STYLE),doubleSided:!1,sameStyleOutsideBounds:t.RND_STYLE.probability(.2),sandedLineProbability:t.RND_STYLE.minmax(.9,1),sameWeightFactor:t.RND_STYLE.probability(.5),allSanded:t.RND_STYLE.probability(.6),maxLength:[.05,.2],multiplyByImageLuminance:{index:-1,range:[0,1]}};return{aux:r,get:(a,l)=>{const u=Wt(Ys([0,0],.45*s),a.pos);let f=a.pos[0]>(.25-.5)*s||a.pos[0]<(.75-.5)*s?1:.5;return f*=a.pos[1]>.25-.5||a.pos[1]<.75-.5?1:.5,{...r,type:t.RND_STYLE.probability(r.sandedLineProbability)&&(u||r.allSanded)?"line | sanding":"line",grainsFactor:t.RND_STYLE.minmaxInt(r.grainsFactorRange[0],r.grainsFactorRange[1]),maxLength:t.RND_STYLE.minmax(r.maxLength[0],r.maxLength[1])*f,sizeFactor:r.sameWeightFactor?r.sizeFactor:w([.35,.5,1],t.RND_STYLE),followBounds:!0}},update:(a,l)=>({type:a.attribs.style.type==="line"?"line":r.sameStyleOutsideBounds||Kc(a.pos,i.update)?"line | sanding":t.RND_STYLE.probability(.95)?"line":"line | sanding"})}},colors:()=>{const s=za(jr,t.RND_COLORS),i={...Hh(jr[s]),info:s};return{fg:[i.fg[0]],bg:i.bg,info:i.info}},vector_field:({aspectRatio:s,agentFactory:i,bounds:r,halfDiagonal:o})=>{const c=[],a=t.RND_NOISE.minmaxInt(2,8),l=[];for(let m=0;m<a;m++)c.push({...mh(t.RND_NOISE,["sinTimesCos","sinPlusCos","sinPlusSin","cos","sin","hopalong","clifford","deJong","gumowskiMira","fractalDream","perlin","macMillan"]),rotation:0,quantizationArray:qt([[],Lh(t.RND_NOISE.minmaxInt(3,10))],[6,1],t.RND_NOISE),conversion:w(["aCos"],t.RND_NOISE)}),l.push(c[m]);const u=[[0,0],[.2,1],[.4,0],[.6,0],[.8,1],[1,0]],f=qt([ks("hermite",u),ks("linear",u),ks("step",u)],[2,2,2],t.RND_NOISE),h="space traveled",g=["id","width","bounds-interp","distanceFromCenter","generation","id-nomix"],d=w(g,t.RND_NOISE);return{aux:l,info:{interpolatedBy:h,choice:d},get:(m,I)=>{const M=g[Math.floor(I.iterations/5e3)%g.length],N=[];for(let O=0;O<a;O++)N.push(Vr(m.pos,c[O]));const Pt=N[0];let Ut=f.at(I.spaceTraveled/i.maxSpaceTraveled);if(M==="id-nomix"){const O=m.ID%(a-1);return N[O+1]}else if(M==="id"){const O=m.ID%(a-1);return te(Pt,N[O+1],Ut)}else if(M==="bounds-interp"){const O=Bn(m.pos,r.update);return O<0?Pt:te(Pt,N[O%(a-1)+1],Ut)}else if(M==="distanceFromCenter"){const O=m.supportData.distanceToCenter/o,Gt=Math.floor(O*(a-1));return te(Pt,N[Gt+1],Ut)}else if(M==="generation"){const O=m.generation%(a-1)/(a-1),Gt=Math.floor(O*(a-1));return te(Pt,N[Gt+1],Ut)}else{const O=Yh(m.pos,s),Gt=Math.floor(O*(a-1));return te(Pt,N[Gt+1],Ut)}},getAt:(m,I)=>Vr(m,c[0])}},agentFactory:({bounds:s})=>{let i=0;for(const r of s.update)i+=ee(r);return{maxNewPerIteration:10,maxIterations:w([4e3],t.RND_SYSTEM),maxSpaceTraveled:qt([20,30,40,50,60,80,100],[i<.25?1:0,i>.2&&i<.4?1:0,i>.35?1:0,i>.35?1:0,i>.4?1:0,i>.4?1:0,i>.45?1:0],t.RND_SYSTEM),newPerIteration:0,maxActive:50,branch:t.RND_SYSTEM.minmaxInt(2,8),initialAgents:30,maxAgents:w([2e4],t.RND_SYSTEM),directions:[[0,1],[0,-1],[1,0],[-1,0]],initPolicy:r=>r.agents.length<30?"randomFree":"randomOccupied",neverEnding:!0,maxColliding:1e3}},agent:()=>{const s=w([[2,2],[1,2],[.5,1],[.1,.5],[.1,.2],[.03,.05]],t.RND);return{get:i=>({angled:!1,step:.01,fuzziness:0,chance:1,maxLength:t.RND.minmax(s[0],s[1]),maxIteration:1e3,minSpaceBeforeDrawing:.3/Math.max(e,n)})}},bounds:({aspectRatio:s})=>{const i=je([0,0],[s,1]),r=je([0,0],[s-.3,.7]);let o=t.RND_BOUNDS.probability(.5);const c=o?[r]:[i];let a=[i];t.RND_BOUNDS.minmaxInt(1,24);const l=w([t.RND_BOUNDS.minmaxInt(2,7),[2,6]],t.RND_BOUNDS),u=w([t.RND_BOUNDS.minmaxInt(1,5),[1,4]],t.RND_BOUNDS);a=Wh(o?je([0,0],[s-.25,.75]):je([0,0],[s-.15,1-.15]),u,l,{decimatePercentage:qt([0,t.RND_BOUNDS.minmax(0,.3)],[1,2],t.RND_BOUNDS),elasticity:[-.2,.2],minSize:.05,margin:t.RND_BOUNDS.minmax(.01,.02),shuffleResult:t.RND_BOUNDS.probability(.5),shakeAmount:w([void 0,[[-.002,.002],[-.002,.002]]],t.RND_BOUNDS)},t.RND_BOUNDS);let f=a;return{update:a,init:f,get:h=>w(c,t.RND_BOUNDS),overall:f,info:f.length}},stroke:({colors:s,bounds:i,background:r})=>{const o=(c,a)=>{const l=Bn(c.pos,i.update);return l<0||r?.fill[l%r.fill.length]===0?s.fg[0]:s.bg[0]};return qt([{info:"true inverted",get:o,update:o},{info:"inverted",get:(c,a)=>{const l=Bn(c.pos,i.update);return l<0||l%2===0?s.fg[0]:s.bg[0]},update:c=>{const a=Bn(c.pos,i.update);return a<0||a%2===1?s.fg[0]:s.bg[0]}},{info:"fg",get:(c,a)=>s.fg[0]}],[5,0,1],t.RND_STYLE)},weight:({agentFactory:s,halfDiagonal:i,bounds:r,scalingFactor:o})=>{const c=o,[a,l]=w([[7.5*c,.75*c],[9*c,.75*c]],t.RND_STYLE);return qt([jh({get:(u,f)=>on(u.ID%s.maxAgents,0,s.maxAgents,a,l),info:"agent ID",aux:[a,l]},Ht("distance from center",a,l,{maxValue:i*.75},!0)),Ht("pos inside bounds",a,l,{bounds:r.update},!0),Ht("pos inside bounds",a,0,{bounds:r.update},!0),{...Ht("random",l,a,{rnd:t.RND_STYLE}),update:u=>{const f=Math.min(u.attribs.weight,Qc(u,i*.75,a));return u.history.length<.008&&f<6?4.5*o:f},info:"random / distance from center"},Ht("distance from center",a*.75,l,{maxValue:i*.75},!0)],[1,1,1,1,1],t.RND_STYLE)},alpha:({agentFactory:s,bounds:i})=>{const[r,o]=w([[.81,.2],[.5,.02],[1,.01]],t.RND_STYLE);return w([{get:(c,a)=>on(c.ID%s.maxAgents,0,s.maxAgents,r,o),info:"agent ID",aux:[r,o]},Ht("pos inside bounds",r,o,{bounds:i.update},!0),Ht("random",o,r,{rnd:t.RND_STYLE}),Ht("image luminance",0,1,{imageIndex:0},!1)],t.RND_STYLE)},postprocess:{...Qh,fadeAmount:3e-4}}),id={WEBGL_draw_buffers:{gl:!0,alias:"GL_EXT_draw_buffers"},OES_standard_derivatives:{gl:!0,alias:"GL_OES_standard_derivatives"}};var qi=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(qi||{});const ea={fragColor:["vec4",0]};var ts=(t=>(t[t.ALPHA=6406]="ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.R16F=33325]="R16F",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32F=33326]="R32F",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.R8=33321]="R8",t[t.R8_SNORM=36756]="R8_SNORM",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.RED=6403]="RED",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RG16F=33327]="RG16F",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32F=33328]="RG32F",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RG8=33323]="RG8",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RGB=6407]="RGB",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB16I=36233]="RGB16I",t[t.RGB16UI=36215]="RGB16UI",t[t.RGB32F=34837]="RGB32F",t[t.RGB32I=36227]="RGB32I",t[t.RGB32UI=36209]="RGB32UI",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.RGB8=32849]="RGB8",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGB8I=36239]="RGB8I",t[t.RGB8UI=36221]="RGB8UI",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA=6408]="RGBA",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGBA16F=34842]="RGBA16F",t[t.RGBA16I=36232]="RGBA16I",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGBA32F=34836]="RGBA32F",t[t.RGBA32I=36226]="RGBA32I",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGBA4=32854]="RGBA4",t[t.RGBA8=32856]="RGBA8",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGBA8I=36238]="RGBA8I",t[t.RGBA8UI=36220]="RGBA8UI",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t))(ts||{}),Xe=(t=>(t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t))(Xe||{}),Ee=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t))(Ee||{}),es=(t=>(t[t.LINEAR=9729]="LINEAR",t[t.NEAREST=9728]="NEAREST",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t))(es||{}),ns=(t=>(t[t.REPEAT=10497]="REPEAT",t[t.CLAMP=33071]="CLAMP",t[t.REPEAT_MIRROR=33648]="REPEAT_MIRROR",t))(ns||{});const _=(t,e,n,s=!1,i=!1,r=s)=>({format:t,types:e,render:s,renderExt:r,filter:i,num:n}),nn={6406:_(6406,[5121,1,5131,2,36193,2,5126,4],1,!0,!0),6402:_(6402,[5123,2,5125,4],1,!0),33189:_(6402,[5123,2,5125,4],1,!0),33190:_(6402,[5125,4],1,!0),36012:_(6402,[5126,4],1,!0),34041:_(34041,[34042,4],1,!0),35056:_(34041,[34042,4],1,!0),36013:_(34041,[36269,4],1,!0),6410:_(6410,[5121,2,5131,4,36193,4,5126,8],2,!0,!0),6409:_(6409,[5121,1,5131,2,36193,2,5126,4],1,!0,!0),35898:_(6407,[5126,12,5131,6,35899,4],3,!1,!0,!0),33325:_(6403,[5126,4,5131,2],1,!1,!0,!0),33331:_(36244,[5122,2],1,!0),33332:_(36244,[5123,2],1,!0),33326:_(6403,[5126,4],1,!1,!1,!0),33333:_(36244,[5124,4],1,!0),33334:_(36244,[5125,4],1,!0),36756:_(6403,[5120,1],1,!1,!0),33321:_(6403,[5121,1],1,!0,!0),33329:_(36244,[5120,1],1,!0),33330:_(36244,[5121,1],1,!0),33327:_(33319,[5126,8,5131,4],2,!1,!0,!0),33337:_(33320,[5122,4],2,!0),33338:_(33320,[5123,4],2,!0),33328:_(33319,[5126,8],2,!1,!1,!0),33339:_(33320,[5124,8],2,!0),33340:_(33320,[5125,8],2,!0),36757:_(33319,[5120,2],2,!1,!0),33323:_(33319,[5121,2],2,!0,!0),33335:_(33320,[5120,2],2,!0),33336:_(33320,[5121,2],2,!0),6407:_(6407,[5121,3,5131,6,36193,6,5126,12,33635,2],3,!0,!0),32857:_(6408,[33640,4],4,!0,!0),36975:_(36249,[33640,4],4,!0),34843:_(6407,[5126,12,5131,6],3,!1,!0),36233:_(36248,[5122,6],3),36215:_(36248,[5123,6],3),34837:_(6407,[5126,12],3),36227:_(36248,[5124,12],3),36209:_(36248,[5125,12],3),32855:_(6408,[5121,4,32820,2,33640,4],4,!0,!0),36194:_(6407,[5121,3,33635,2],3,!0,!0),36758:_(6407,[5120,3],3,!1,!0),32849:_(6407,[5121,3],3,!0,!0),36239:_(36248,[5120,3],3),36221:_(36248,[5121,3],3),35901:_(6407,[5126,12,5131,6,35902,4],3,!1,!0),6408:_(6408,[5121,4,5131,8,36193,8,5126,16,32819,2,32820,2],4,!0,!0),34842:_(6408,[5126,16,5131,8],4,!1,!0,!0),36232:_(36249,[5122,8],4,!0),36214:_(36249,[5123,8],4,!0),34836:_(6408,[5126,16],4,!1,!1,!0),36226:_(36249,[5124,16],4,!0),36208:_(36249,[5125,16],4,!0),32854:_(6408,[5121,4,32819,2],4,!0,!0),36759:_(6408,[5120,4],4,!1,!0),32856:_(6408,[5121,4],4,!0,!0),36238:_(36249,[5120,4],4,!0),36220:_(36249,[5121,4],4,!0),35907:_(6408,[5121,4],4,!0,!0),35905:_(6407,[5121,3],3,!1,!0)},Ce=t=>typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,Wr=t=>t.type===Xe.FLOAT||t.type===Xe.HALF_FLOAT||t.type===Xe.HALF_FLOAT_OES||t.type===Xe.FLOAT_32_UNSIGNED_INT_24_8_REV,Xr=(t,e=new Map)=>n=>{e.has(n)||(e.set(n,!0),t(n))};var st=(t=>(t.GLES_100="100",t.GLES_300="300 es",t))(st||{});const we="vec2",rd="vec3",Re="vec4",na="bool",In="float",bs="int",Vi="uint",sa="sampler2D",od="sampler3D",cd=/^[iub]?vec[234]$/,ad=/^mat[234]$/,ld=t=>Ct(t)&&!!t.tag&&!!t.type,Pe=t=>cd.test(t.type),ia=t=>ad.test(t.type),ue=(t,e,n)=>t===e.type&&n===e.info?e:{tag:"lit",type:t,info:n,val:e},ra=t=>ue(na,y(t)?!!t:t),Rt=t=>ue(In,Sn(t)?t&1:t),Yi=t=>ue(bs,Sn(t)?t&1:y(t)?t|0:t),oa=t=>ue(Vi,Sn(t)?t&1:y(t)?t>>>0:t),ca=(t,e)=>n=>y(n)||n!==void 0&&!Pe(n)&&n.type!==t?e(n):n,ud=ca(In,Rt),fd=ca(bs,Yi);ra(!0);ra(!1);const ji=Rt(0),aa=Rt(1);Rt(2);Rt(.5);const la=Yi(0);Yi(1);oa(0);oa(1);Rt(Math.PI);Rt(Math.PI*2);Rt(Math.PI/2);Rt(Math.SQRT2);Rt((1+Math.sqrt(5))/2);const ua=(t,e)=>n=>[n[0]===void 0?e:t(n[0]),...n.slice(1).map(t)],Wi=ua(ud,ji),hd=ua(fd,la),dd=(t,e="")=>t[0]+e.substring(1),Xi=(t,e)=>Pe(t[0])?dd(t[0].type,e[t.length]):e[t.length],fa=(t,e,n)=>ue(t,n=e(n),Xi(n,["n","n"])),gd=(t,e,n)=>ue(t,n=e(n),Xi(n,["n","n","vn"])),md=(t,e,n)=>ue(t,n=e(n),n.length===2?Pe(n[1])?n[0].type[0]+n[1].type[0]:"vn":Xi(n,["n","n",void 0,"vnn"]));function xi(...t){return fa(we,Wi,t)}function Zi(...t){return gd(rd,Wi,t)}function ha(...t){return md(Re,Wi,t)}function pd(...t){return fa("ivec2",hd,t)}xi(0);xi(1);xi(2);Zi(0);Zi(1);Zi(2);const _d=t=>t.replace("[]","");let bd=0;const Ji=(t="_s")=>`${t}${(bd++).toString(36)}`;function K(t,...e){let n,s,i;switch(e.length){case 0:B(t)||(i=t,t=i.type);break;case 1:B(e[0])?n=e[0]:e[0].tag?i=e[0]:s=e[0];break;case 2:B(e[0])?[n,s]=e:[s,i]=e;break;case 3:[n,s,i]=e;break;default:it()}return{tag:"sym",type:t,id:n||Ji(),opts:s||{},init:i}}const xr=(t,e,n)=>K(t,e,{q:"in",type:"in",...n}),Zr=(t,e,n)=>K(t,e,{q:"out",type:"out",...n}),Jr=(t,e,n)=>K(t,e,{q:"in",type:"uni",...n}),yd=t=>Bt(e=>e.tag,{},{[j]:e=>At(`no impl for AST node type: '${e.tag}'`),...t}),Kr=/[};]$/,vd=t=>{const e={type:"fs",version:st.GLES_300,versionPragma:!0,prelude:"",...t},n=e.type==="vs",s=e.prec!==void 0?u=>u===(u|0)?u+".0":u.toFixed(e.prec):u=>u===(u|0)?u+".0":String(u),i=u=>u,r=(u,f=", ")=>u.map(l).join(f),o=u=>`${u.id}(${r(u.args)})`,c=(u,f=!1)=>{const{id:h,type:g,opts:d,init:p}=u,b=[];if(d.type){let m;e.version<st.GLES_300?n?m={in:"attribute",out:"varying",uni:"uniform"}[d.type]:(m={in:"varying",out:null,uni:"uniform"}[d.type],!m&&At("GLSL 100 doesn't support fragment shader output variables")):(d.loc!=null&&b.push(`layout(location=${d.loc}) `),d.smooth!=null&&b.push(d.smooth+" "),m=d.type==="uni"?"uniform":d.type),b.push(m+" ")}else d.const&&b.push("const "),f&&d.q&&b.push(d.q+" ");return d.prec&&b.push(d.prec+" "),b.push(i(_d(g))," ",h),d.num&&b.push(`[${d.num}]`),p&&b.push(" = ",l(p)),b.join("")},a=u=>`${l(u.val)}[${l(u.id)}]`,l=yd({arg:u=>c(u,!0),array_init:u=>e.version>=st.GLES_300?`${u.type}(${r(u.init)})`:At(`array initializers not available in GLSL ${e.version}`),assign:u=>l(u.l)+" = "+l(u.r),ctrl:u=>u.id,call:o,call_i:u=>u.id==="texture"&&e.version<st.GLES_300?`${u.id}${u.args[0].type.substring(7)}(${r(u.args)})`:o(u),decl:u=>c(u.id),fn:u=>`${i(u.type)} ${u.id}(${r(u.args)}) ${l(u.scope)}`,for:u=>`for(${u.init?l(u.init):""}; ${l(u.test)}; ${u.iter?l(u.iter):""}) ${l(u.scope)}`,idx:a,idxm:a,if:u=>{const f=`if (${l(u.test)}) `+l(u.t);return u.f?f+" else "+l(u.f):f},lit:u=>{const f=u.val;switch(u.type){case"bool":return Sn(f)?String(f):`bool(${l(f)})`;case"float":return y(f)?s(f):`float(${l(f)})`;case"int":return y(f)?String(f):`int(${l(f)})`;case"uint":return y(f)?`${f}u`:`uint(${l(f)})`;default:return Pe(u)||ia(u)?`${u.type}(${r(f)})`:At(`unknown type: ${u.type}`)}},op1:u=>u.post?`(${l(u.val)}${u.op})`:`(${u.op}${l(u.val)})`,op2:u=>`(${l(u.l)} ${u.op} ${l(u.r)})`,ret:u=>"return"+(u.val?" "+l(u.val):""),scope:u=>{let f=u.body.map(l).reduce((h,g)=>(h.push(Kr.test(g)?g:g+";"),h),[]).join(`
`);return f+=u.body.length&&!Kr.test(f)?";":"",u.global?(e.prelude&&(f=e.prelude+`
`+f),e.versionPragma&&(f=`#version ${e.version}
`+f),f):`{
${f}
}`},swizzle:u=>`${l(u.val)}.${u.id}`,sym:u=>u.id,ternary:u=>`(${l(u.test)} ? ${l(u.t)} : ${l(u.f)})`,while:u=>`while (${l(u.test)}) ${l(u.scope)}`});return Object.assign(l,{gl_FragColor:K(Re,"gl_FragColor"),gl_FragCoord:K(Re,"gl_FragCoord",{const:!0}),gl_FragData:K("vec4[]","gl_FragData",{num:1}),gl_FrontFacing:K("bool","gl_FrontFacing",{const:!0}),gl_PointCoord:K(we,"gl_PointCoord",{const:!0}),gl_PointSize:K(In,"gl_PointSize"),gl_Position:K(Re,"gl_Position")}),l};function da(t,e){for(let n of e)t.delete(n);return t}const Ad=(t,e)=>{if(t===e)return!0;if(!(e instanceof Map)||t.size!==e.size)return!1;for(let n of t.entries())if(!rt(e.get(n[0]),n[1]))return!1;return!0},Ed=(t,e)=>{if(t===e)return!0;if(!(e instanceof Set)||t.size!==e.size)return!1;for(let n of t.keys())if(!e.has(n))return!1;return!0},wd="modulepreload",Rd=function(t){return"/"+t},Qr={},Sd=function(e,n,s){let i=Promise.resolve();if(n&&n.length>0){let o=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),a=c?.nonce||c?.getAttribute("nonce");i=o(n.map(l=>{if(l=Rd(l),l in Qr)return;Qr[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":wd,u||(h.as="script"),h.crossOrigin="",h.href=l,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((g,d)=>{h.addEventListener("load",g),h.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return i.then(o=>{for(const c of o||[])c.status==="rejected"&&r(c.reason);return e().catch(r)})};let mn=null;nh()&&Sd(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]).then(t=>{mn=t.inspect});const Id=(t,e)=>[...F(n=>mn(n,e),t)].join(", "),Md=(t,e)=>[...F(([n,s])=>`${mn(n,e)} => ${mn(s,e)}`,t)].join(", "),ga=Rn({[Symbol.for("nodejs.util.inspect.custom")](t,e){const n=this[Symbol.toStringTag],s={...e,depth:e.depth===null?null:e.depth-1};return t>=0?[`${n}(${this.size||0}) {`,mn?this instanceof Set?Id(this,s):this instanceof Map?Md(this,s):"":"","}"].join(" "):e.stylize(`[${n}]`,"special")}});function ss(t,e){if(eh(t))for(let n of e)t.set(n[0],n[1]);else for(let n of e)t.add(n);return t}var Dd=Object.getOwnPropertyDescriptor,Nd=(t,e,n,s)=>{for(var i=s>1?void 0:s?Dd(e,n):e,r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(i)||i);return i};const Kt=new WeakMap,St=t=>Kt.get(t).vals;let G=class extends Set{constructor(t,e={}){super(),Kt.set(this,{equiv:e.equiv||rt,vals:[]}),t&&this.into(t)}*[Symbol.iterator](){yield*St(this)}get[Symbol.species](){return G}get[Symbol.toStringTag](){return"ArraySet"}get size(){return St(this).length}copy(){const{equiv:t,vals:e}=Kt.get(this),n=new G(null,{equiv:t});return Kt.get(n).vals=e.slice(),n}empty(){return new G(null,this.opts())}clear(){St(this).length=0}first(){if(this.size)return St(this)[0]}add(t){return!this.has(t)&&St(this).push(t),this}into(t){return ss(this,t)}has(t){return this.get(t,W)!==W}get(t,e){const{equiv:n,vals:s}=Kt.get(this),i=zh(s,t,n);return i>=0?s[i]:e}delete(t){const{equiv:e,vals:n}=Kt.get(this);for(let s=n.length;s-- >0;)if(e(n[s],t))return n.splice(s,1),!0;return!1}disj(t){return da(this,t)}equiv(t){return Ed(this,t)}forEach(t,e){const n=St(this);for(let s=n.length;s-- >0;){const i=n[s];t.call(e,i,i,this)}}*entries(){for(let t of St(this))yield[t,t]}*keys(){yield*St(this)}*values(){yield*St(this)}opts(){return{equiv:Kt.get(this).equiv}}};G=Nd([ga],G);var $d=Object.getOwnPropertyDescriptor,Od=(t,e,n,s)=>{for(var i=s>1?void 0:s?$d(e,n):e,r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(i)||i);return i};const X=new WeakMap,Pn=t=>X.get(t).map;let re=class extends Map{constructor(t,e){super();const n={equiv:rt,keys:G,...e};X.set(this,{keys:new n.keys(null,{equiv:n.equiv}),map:new Map,opts:n}),t&&this.into(t)}[Symbol.iterator](){return this.entries()}get[Symbol.species](){return re}get[Symbol.toStringTag](){return"EquivMap"}get size(){return X.get(this).keys.size}clear(){const{keys:t,map:e}=X.get(this);t.clear(),e.clear()}empty(){return new re(null,X.get(this).opts)}copy(){const{keys:t,map:e,opts:n}=X.get(this),s=new re;return X.set(s,{keys:t.copy(),map:new Map(e),opts:n}),s}equiv(t){return Ad(this,t)}delete(t){const{keys:e,map:n}=X.get(this);return t=e.get(t,W),t!==W?(n.delete(t),e.delete(t),!0):!1}dissoc(t){return da(this,t)}forEach(t,e){for(let n of Pn(this))t.call(e,n[1],n[0],this)}get(t,e){const{keys:n,map:s}=X.get(this);return t=n.get(t,W),t!==W?s.get(t):e}has(t){return X.get(this).keys.has(t)}set(t,e){const{keys:n,map:s}=X.get(this),i=n.get(t,W);return i!==W?s.set(i,e):(n.add(t),s.set(t,e)),this}into(t){return ss(this,t)}entries(){return Pn(this).entries()}keys(){return Pn(this).keys()}values(){return Pn(this).values()}opts(){return X.get(this).opts}};re=Od([ga],re);const Ld=(t,e)=>wt(t,"copy")?t.copy():new(t[Symbol.species]||e)(t),ma=(t,e,n)=>{if(t.size<e.size){const s=t;t=e,e=s}return n=n?ss(n,t):Ld(t,Set),t===e?n:ss(n,e)};class pn{dependencies;dependents;constructor(e){if(this.dependencies=new re,this.dependents=new re,e)for(let[n,s]of e)s!=null?this.addDependency(n,s):this.addNode(n)}*[Symbol.iterator](){yield*this.sort()}get[Symbol.species](){return pn}copy(){const e=new pn;for(let n of this.dependencies)e.dependencies.set(n[0],n[1].copy());for(let n of this.dependents)e.dependents.set(n[0],n[1].copy());return e}addNode(e){return!this.dependencies.has(e)&&this.dependencies.set(e,new G),this}addDependency(e,n){(rt(e,n)||this.depends(n,e))&&it(`Circular dependency between: ${e} & ${n}`);let s=this.dependencies.get(e);return this.dependencies.set(e,s?s.add(n):new G([n])),s=this.dependents.get(n),this.dependents.set(n,s?s.add(e):new G([e])),this}addDependencies(e,n){for(let s of n)this.addDependency(e,s)}removeEdge(e,n){let s=this.dependencies.get(e);return s&&s.delete(n),s=this.dependents.get(n),s&&s.delete(e),this}removeNode(e){return this.dependencies.delete(e),this}depends(e,n){return this.transitiveDependencies(e).has(n)}dependent(e,n){return this.transitiveDependents(e).has(n)}immediateDependencies(e){return this.dependencies.get(e)||new G}immediateDependents(e){return this.dependents.get(e)||new G}isLeaf(e){return this.immediateDependents(e).size===0}isRoot(e){return this.immediateDependencies(e).size===0}nodes(){return ma(new G(this.dependencies.keys()),new G(this.dependents.keys()))}leaves(){return Yt(e=>this.isLeaf(e),this.nodes())}roots(){return Yt(e=>this.isRoot(e),this.nodes())}transitiveDependencies(e){return fi(this.dependencies,e)}transitiveDependents(e){return fi(this.dependents,e)}sort(){const e=[],n=this.copy();let s=new G(n.leaves());for(;;){if(!s.size)return e.reverse();const i=s.first();s.delete(i);for(let r of[...n.immediateDependencies(i)])n.removeEdge(i,r),n.isLeaf(r)&&s.add(r);e.push(i),n.removeNode(i)}}}const fi=(t,e)=>{const n=t.get(e);return n?ln(ds(null,(s,i)=>ma(s,fi(t,i))),n,n):new G},pa=t=>{let e;switch(t.tag){case"scope":return t.body;case"fn":return t.scope.body;case"for":return e=[t.test,...t.scope.body],t.init&&e.push(t.init),t.iter&&e.push(t.iter),e;case"while":return[t.test,...t.scope.body];case"if":return e=[t.test,...t.t.body],t.f&&e.push(...t.f.body),e}},Cd=t=>pa(t)||(t.tag==="scope"?t.body:t.tag==="ternary"?[t.test,t.t,t.f]:t.tag==="ret"?t.val!==void 0?[t.val]:void 0:t.tag==="call"||t.tag==="call_i"?t.args:t.tag==="sym"&&t.init?[t.init]:t.tag==="decl"?[t.id]:t.tag==="op1"||t.tag==="swizzle"?[t.val]:t.tag==="op2"?[t.l,t.r]:t.tag==="assign"?[t.r]:Pe(t)||ia(t)||ld(t.val)?t.val:void 0),is=(t,e,n,s,i=!0)=>{if(D(s))s.forEach(r=>n=is(t,e,n,r,i));else{i&&(n=t(n,s));const r=e(s);r&&(n=is(t,e,n,r,i)),!i&&(n=t(n,s))}return n},_a=(t,e=new pn)=>t.deps?.length?t.deps.reduce((n,s)=>_a(s,n.addDependency(t,s)),e):e.addNode(t),Bd=t=>({tag:"decl",type:t.type,id:t}),ba=(t,e=!1)=>({tag:"scope",type:"void",body:t.filter(n=>n!=null).map(n=>n.tag==="sym"?Bd(n):n),global:e}),Td=t=>{const e=t.filter(s=>s.tag!=="fn"),n=t.reduce((s,i)=>i.tag==="fn"?_a(i,s):s,new pn);return ba(e.concat(n.sort()),!0)},rs=Wo.childLogger("webgl"),Pd={a:"",v:"",u:"",o:""},Ud={[st.GLES_100]:{number:100,attrib:(t,e,n)=>`attribute ${D(e)?e[0]:e} ${n.a}${t};`,varying:{vs:(t,e,n)=>me("varying",e,n.v+t),fs:(t,e,n)=>me("varying",e,n.v+t)},uniform:(t,e,n)=>me("uniform",e,n.u+t),output:(t,e,n)=>D(e)?`#define ${n.o}${t} gl_FragData[${e[1]}]`:""},[st.GLES_300]:{number:300,attrib:(t,e,n)=>D(e)?`layout(location=${e[1]}) in ${e[0]} ${n.a}${t};`:`in ${e} ${n.a}${t};`,varying:{vs:(t,e,n)=>me("out",e,n.v+t),fs:(t,e,n)=>me("in",e,n.v+t)},uniform:(t,e,n)=>me("uniform",e,n.u+t),output:(t,e,n)=>D(e)?`layout(location=${e[1]}) out ${e[0]} ${n.o}${t};`:`out ${e} ${n.o}${t};`}},me=(t,e,n)=>{const s=D(e)?e[0]:e;return s.indexOf("[]")>0?`${t} ${s.replace("[]","")} ${n}[${e[1]}];`:`${t} ${s} ${n};`},ya=(t,e,n="")=>{let s=">=";return e||(e=n,n=null,s="<"),`#if __VERSION__ ${s} ${t}
${e}${n?`
#else
${n}`:""}
#endif`};ya(300,"","#define texture texture2D");const to=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp int;
precision highp float;
#else
precision mediump int;
precision mediump float;
#endif
${ya(300,"precision lowp sampler3D;")}
#ifndef PI
#define PI 3.141592653589793
#endif
#ifndef TAU
#define TAU 6.283185307179586
#endif
#ifndef HALF_PI
#define HALF_PI 1.570796326794896
#endif
`,It=t=>(e,n,s=0)=>{let i;return r=>{r=r===void 0?s:r,r!==i&&(e["uniform1"+t](n,r),i=r)}},E=(t,e)=>(n,s,i=e)=>{let r=[];return o=>{o=o===void 0?i:o,vi(r,o)||(n["uniform"+t](s,o),r=[...o])}},pe=(t,e)=>(n,s,i=e)=>{let r=[];return o=>{o=o===void 0?i:o,vi(r,o)||(n["uniformMatrix"+t](s,!1,o),r=[...o])}},Mt=[0],Gd={bool:It("i"),float:It("f"),int:It("i"),uint:It("ui"),bvec2:E("2iv",ht),bvec3:E("3iv",dt),bvec4:E("4iv",xt),ivec2:E("2iv",ht),ivec3:E("3iv",dt),ivec4:E("4iv",xt),vec2:E("2fv",ht),vec3:E("3fv",dt),vec4:E("4fv",xt),mat2:pe("2fv",Jh),mat3:pe("3fv",Kh),mat4:pe("4fv",ta),sampler2D:It("i"),sampler2DShadow:It("i"),sampler3D:It("i"),samplerCube:It("i"),samplerCubeShadow:It("i"),"bool[]":E("1iv",Mt),"float[]":E("1fv",Mt),"int[]":E("1iv",Mt),"uint[]":E("1uiv",Mt),"bvec2[]":E("2iv",ht),"bvec3[]":E("3iv",dt),"bvec4[]":E("4iv",xt),"ivec2[]":E("2iv",ht),"ivec3[]":E("3iv",dt),"ivec4[]":E("4iv",xt),"vec2[]":E("2fv",ht),"vec3[]":E("3fv",dt),"vec4[]":E("4fv",xt),"mat2[]":pe("2fv",ht),"mat3[]":pe("3fv",dt),"mat4[]":pe("4fv",xt),"sampler2D[]":E("1iv",Mt),"sampler2DShadow[]":E("1iv",Mt),"sampler3D[]":E("1iv",Mt),"samplerCube[]":E("1iv",Mt),"samplerCubeShadow[]":E("1iv",Mt)},kd=/ERROR: \d+:(\d+): (.*)/;class Ki{gl;program;attribs;uniforms;state;warnAttrib=Xr(e=>rs.warn(`unknown attrib: ${e} (no further warnings will be shown...)`));warnUni=Xr(e=>rs.warn(`unknown uniform: ${e} (no further warnings will be shown...)`));constructor(e,n,s,i,r){this.gl=e,this.program=n,this.attribs=s,this.uniforms=i,this.state=r||{}}withState(e){return new Ki(this.gl,this.program,this.attribs,this.uniforms,{...this.state,...e})}bind(e){return this.program?(this.gl.useProgram(this.program),this.bindAttribs(e.attribs),this.bindUniforms(e.uniforms),!0):!1}unbind(){let e;for(let n in this.attribs)(e=this.attribs[n])&&this.gl.disableVertexAttribArray(e.loc);return this.gl.useProgram(null),!0}release(){return this.program?(this.gl.deleteProgram(this.program),delete this.program,!0):!1}bindAttribs(e){const n=this.gl;let s;for(let i in e)if(s=this.attribs[i]){const r=e[i];r.buffer.bind(),n.enableVertexAttribArray(s.loc),n.vertexAttribPointer(s.loc,r.size||3,sc(r.type||n.FLOAT),r.normalized||!1,r.stride||0,r.offset||0)}else this.warnAttrib(i)}bindUniforms(e={}){const n=this.uniforms;for(let s in e){const i=n[s];if(i){let r=e[s];r=$e(r)?r(n,e):F0(r),i.setter(r)}else this.warnUni(s)}for(let s in n)if(n.hasOwnProperty(s)&&(!e||!jc(e[s]))){const i=n[s],r=i.defaultFn?i.defaultFn(n,e):i.defaultVal;i.setter(r)}}prepareState(e=this.state){const n=this.gl;e.depth!==void 0&&this.setState(n.DEPTH_TEST,e.depth),e.cull!==void 0&&(this.setState(n.CULL_FACE,e.cull),e.cullMode&&n.cullFace(e.cullMode)),e.blend!==void 0&&(this.setState(n.BLEND,e.blend),e.blendFn&&n.blendFunc(e.blendFn[0],e.blendFn[1]),e.blendEq!==void 0&&n.blendEquation(e.blendEq)),e.stencil!==void 0&&(this.setState(n.STENCIL_TEST,e.stencil),e.stencilFn&&n.stencilFunc(e.stencilFn[0],e.stencilFn[1],e.stencilFn[2]),e.stencilOp&&n.stencilOp(e.stencilOp[0],e.stencilOp[1],e.stencilOp[2]),e.stencilMask!==void 0&&n.stencilMask(e.stencilMask))}setState(e,n){n?this.gl.enable(e):this.gl.disable(e)}}const va=(t,e,n)=>{const s=Ce(t)?st.GLES_300:st.GLES_100,i=$e(e.vs)?so(e,"vs",s,n):io(e,"vs",s),r=$e(e.fs)?so(e,"fs",s,n):io(e,"fs",s),o=rs;o.debug(i),o.debug(r),e.ext&&zd(t,e.ext);const c=ro(t,t.VERTEX_SHADER,i),a=ro(t,t.FRAGMENT_SHADER,r),l=t.createProgram()||C("error creating shader program");if(t.attachShader(l,c),t.attachShader(l,a),t.linkProgram(l),t.getProgramParameter(l,t.LINK_STATUS)){const u=Yd(t,l,e.attribs),f=jd(t,l,e.uniforms);return t.deleteShader(c),t.deleteShader(a),new Ki(t,l,u,f,e.state)}throw new Error(`Error linking shader: ${t.getProgramInfoLog(l)}`)},Un=(t,e,n)=>{let s=[];for(let i in t)t.hasOwnProperty(i)&&s.push(e(i,t[i],n));return s.push(""),s.join(`
`)},Fd=(t,e,n)=>{const s=id[t],i=n===st.GLES_300;return s&&(!i&&s.gl||i&&s.gl2)?`#extension ${s&&s.alias||t} : ${Sn(e)?e?"enable":"disable":e}
`:""},zd=(t,e)=>{for(let n in e){const s=e[n];(s===!0||s==="require")&&Mc(t,[n],s==="require")}},Aa=(t,e)=>{let n=t.pre?t.replacePrelude?t.pre:t.pre+`
`+to:to;if(t.ext)for(let s in t.ext)n+=Fd(s,t.ext[s],e);return n},eo=(t,e,n)=>{for(let s in e){const i=e[s];n[s]=D(i)?t(i[0],s,{loc:i[1]}):t(i,s)}},Hd=t=>{const[e,n]=D(t)?[t[0],{num:t[1]}]:[t,{}];return/(u?int|[ui]vec[234])/.test(e)&&(n.smooth="flat"),[e,n]},no=(t,e,n)=>{for(let s in t.varying){const[i,r]=Hd(t.varying[s]);n[s]=e(i,s,r)}},qd=(t,e)=>{for(let n in t.uniforms){const s=t.uniforms[n];e[n]=D(s)?Jr(s[0],n,s[0].indexOf("[]")>0?{num:s[1]}:void 0):Jr(s,n)}},so=(t,e,n,s={})=>{let i=Aa(t,n);const r={},o={},c={},a={};if(t.uniforms&&qd(t,a),e==="vs")eo(xr,t.attribs,r),t.varying&&no(t,Zr,o);else{t.varying&&no(t,xr,r);const u=t.outputs||ea;if(n>=st.GLES_300)eo(Zr,u,o);else for(let f in u){const h=u[f];D(h)&&h[0]==="vec4"?(i+=`#define ${f} gl_FragData[${h[1]}]
`,c[f]=K("vec4",f)):At(`GLSL ${n} doesn't support output vars`)}}const l=vd({type:e,version:n,prelude:i,prec:s.prec});return l(Td([...Us(a),...Us(r),...Us(o),...t[e](l,a,r,{...o,...c})]))+(t.post?`
`+t.post:"")},io=(t,e,n)=>{const s=Ud[n],i={...Pd,...t.declPrefixes},r=e==="vs";let o="";return o+=`#version ${n}
`,o+=Aa(t,n),t.generateDecls!==!1&&(o+=r?Un(t.attribs,s.attrib,i):Un(t.outputs||ea,s.output,i),o+=Un(t.varying,s.varying[e],i),o+=Un(t.uniforms,s.uniform,i)),o+=t[e],t.post&&(o+=`
`+t.post),o},ro=(t,e,n)=>{const s=t.createShader(e)||C("error creating shader");return t.shaderSource(s,n),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:Vd(t,s,n)},Vd=(t,e,n)=>{const s=n.split(`
`),r=t.getShaderInfoLog(e).split(`
`).map(o=>{const c=kd.exec(o),a=c?c[1]:null;if(a)return`line ${a}: ${c[2]}
${s[parseInt(a)-1]}`}).filter(jc).join(`
`);return C(`Error compiling shader:
${r}`)},Yd=(t,e,n)=>{const s={};for(let i in n){const r=n[i],[o,c]=D(r)?r:[r,null],a=i;c!=null?(t.bindAttribLocation(e,c,a),s[i]={type:o,loc:c}):s[i]={type:o,loc:t.getAttribLocation(e,a)}}return s},jd=(t,e,n={})=>{const s={};for(let i in n){const r=n[i];let o,c,a,l,u;D(r)?([o,c,a]=r,l=o.indexOf("[]")<0?c:a,$e(l)&&(u=l,l=void 0)):o=r;const f=t.getUniformLocation(e,i);if(f!=null){const h=Gd[o];h?s[i]={loc:f,setter:h(t,f,l),defaultFn:u,defaultVal:l,type:o}:C(`invalid uniform type: ${o}`)}else rs.warn(`unknown uniform: ${i}`)}return s};class Ea{gl;buffer;target;mode;data;constructor(e,n,s=e.ARRAY_BUFFER,i=e.STATIC_DRAW,r=!1){this.gl=e,this.buffer=e.createBuffer()||C("error creating WebGL buffer"),this.target=s,this.mode=i,n&&(this.set(n),r&&(this.data=n))}bind(){return this.gl.bindBuffer(this.target,this.buffer),!0}unbind(){return this.gl.bindBuffer(this.target,null),!0}release(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),delete this.buffer),!0}update(){this.data&&this.set(this.data)}set(e,n=this.mode){this.bind(),this.gl.bufferData(this.target,e,n),this.data&&(this.data=e)}setChunk(e,n=0){this.bind(),this.gl.bufferSubData(this.target,n,e),this.data&&this.data.set(e,n>>>n0[a0(e)])}}const Wd=(t,e,n=t.ARRAY_BUFFER,s=t.STATIC_DRAW,i=!1)=>new Ea(t,e,n,s,i),oo=(t,e,n=t.STATIC_DRAW)=>(e.attribPool?e.attribs=ao(t,e.attribPool,void 0,t.ARRAY_BUFFER,n):co(t,e.attribs,n),e.instancePool?e.instances={attribs:ao(t,e.instancePool,void 0,t.ARRAY_BUFFER,n),num:e.instancePool.capacity}:e.instances&&co(t,e.instances.attribs,n),Xd(t,e.indices,n),e.mode==null&&(e.mode=qi.TRIANGLES),Ct(e.shader)&&(e.shader=va(t,e.shader)),e),wa=(t,e,n,s)=>{e.buffer?e.data&&e.buffer.set(e.data):e.buffer=new Ea(t,e.data,n,s,e.retain)},co=(t,e,n)=>{if(e)for(let s in e)wa(t,e[s],t.ARRAY_BUFFER,n);return e},Xd=(t,e,n=t.STATIC_DRAW)=>(e&&wa(t,e,t.ELEMENT_ARRAY_BUFFER,n),e),ao=(t,e,n,s=t.ARRAY_BUFFER,i=t.STATIC_DRAW)=>{const r=Wd(t,e.bytes(),s,i,!0),o={};for(let c of Object.keys(e.specs)){const a=e.specs[c];o[c]={buffer:r,size:a.size,type:sc(a.type),stride:e.byteStride,offset:a.byteOffset}}return o},Ra=t=>e=>{if(e)for(let n=e.length,s;n-- >0;)(s=e[n])&&s[t](n)},xd=Ra("bind"),Zd=Ra("unbind");class Jd{gl;tex;target;format;filter;wrap;type;size;constructor(e,n={}){this.gl=e,this.tex=e.createTexture()||C("error creating WebGL texture"),this.configure({filter:es.NEAREST,wrap:ns.CLAMP,...n})}configure(e={},n=!0){const s=this.gl,i=e.target||this.target||Ee.TEXTURE_2D,r=e.format||this.format||ts.RGBA,o=nn[r],c=e.type||this.type||o.types[0];return!this.target&&(this.target=i),this.format=r,this.type=c,s.bindTexture(this.target,this.tex),e.flip!==void 0&&s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.flip?1:0),e.premultiply!==void 0&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiply?1:0),this.configureImage(i,e),e.mipmap&&s.generateMipmap(i),this.configureFilter(i,e),this.configureWrap(i,e),this.configureLOD(i,e),this.configureLevels(i,e),n&&s.bindTexture(this.target,null),!0}configureImage(e,n){n.image!==void 0&&(e===Ee.TEXTURE_3D?this.configureImage3d(e,n):this.configureImage2d(e,n))}configureImage2d(e,n){const s=n.level||0,i=n.pos||[0,0,0],{image:r,width:o,height:c}=n,l=nn[this.format].format,{gl:u,type:f,format:h}=this;o&&c?n.sub?u.texSubImage2D(e,s,i[0],i[1],o,c,l,f,r):(s===0&&(this.size=[o,c]),u.texImage2D(e,s,h,o,c,0,l,f,r)):n.sub?u.texSubImage2D(e,s,i[0],i[1],l,f,r):(r!=null&&s===0&&(this.size=[r.width,r.height]),u.texImage2D(e,s,h,l,f,r))}configureImage3d(e,n){const{image:s,width:i,height:r,depth:o}=n;if(!(i&&r&&o))return;const c=n.level||0,a=n.pos||[0,0,0],u=nn[this.format].format,{gl:f,type:h,format:g}=this;n.sub?f.texSubImage3D(e,c,a[0],a[1],a[2],i,r,o,u,h,s):(c===0&&(this.size=[i,r,o]),f.texImage3D(e,c,g,i,r,o,0,u,h,s))}configureFilter(e,n){const s=this.gl,i=n.filter||this.filter||es.NEAREST;let r,o;D(i)?(r=i[0],o=i[1]||r,this.filter=[r,o]):(this.filter=[i,i,i],r=o=i),s.texParameteri(e,s.TEXTURE_MIN_FILTER,r),s.texParameteri(e,s.TEXTURE_MAG_FILTER,o)}configureWrap(e,n){const s=this.gl,i=n.wrap||this.wrap||ns.CLAMP;let r,o,c;D(i)?(r=i[0],o=i[1]||r,c=i[2]||r,this.wrap=[r,o,c]):(r=o=c=i,this.wrap=[i,i,i]),s.texParameteri(e,s.TEXTURE_WRAP_S,r),s.texParameteri(e,s.TEXTURE_WRAP_T,o),Ce(s)&&e===s.TEXTURE_3D&&s.texParameteri(e,s.TEXTURE_WRAP_R,c)}configureLOD(e,n){const s=this.gl;if(n.lod){const[i,r]=n.lod;i&&s.texParameterf(e,s.TEXTURE_MIN_LOD,i),r&&s.texParameterf(e,s.TEXTURE_MAX_LOD,r)}}configureLevels(e,n){const s=this.gl;if(n.minMaxLevel){const[i,r]=n.minMaxLevel;s.texParameteri(e,s.TEXTURE_BASE_LEVEL,i),s.texParameteri(e,s.TEXTURE_MAX_LEVEL,r)}}bind(e=0){const n=this.gl;return n.activeTexture(n.TEXTURE0+e),n.bindTexture(this.target,this.tex),!0}unbind(e=0){const n=this.gl;return n.activeTexture(n.TEXTURE0+e),n.bindTexture(this.target,null),!0}release(){return this.tex?(this.gl.deleteTexture(this.tex),delete this.tex,delete this.gl,!0):!1}}const hi=(t,e)=>new Jd(t,e),Kd=(t,e={})=>{const n=D(t)?t:[t];for(let s=0,i=n.length;s<i;s++){const r=n[s],o=r.indices,c=r.shader.gl;e.bindTex!==!1&&xd(r.textures),e.shaderState!==!1&&r.shader.prepareState(),e.bindShader!==!1&&r.shader.bind(r),o?.buffer?(o.buffer.bind(),r.instances?lo(c,r):c.drawElements(r.mode,r.num,o.data instanceof Uint32Array?c.UNSIGNED_INT:c.UNSIGNED_SHORT,0)):r.instances?lo(c,r):c.drawArrays(r.mode,0,r.num),e.unbindShader!==!1&&r.shader.unbind(null),e.unbindTex&&Zd(r.textures)}},lo=(t,e)=>{const n=Ce(t),s=n?void 0:t.getExtension("ANGLE_instanced_arrays");n||s||C("instancing not supported");const i=e.shader.attribs,r=e.instances.attribs;e.shader.bindAttribs(r);for(let o in r){const c=i[o];if(c){let a=r[o].divisor;a=a!==void 0?a:1,n?t.vertexAttribDivisor(c.loc,a):s.vertexAttribDivisorANGLE(c.loc,a)}}if(e.indices){const o=e.indices.data instanceof Uint32Array?t.UNSIGNED_INT:t.UNSIGNED_SHORT;n?t.drawElementsInstanced(e.mode,e.num,o,0,e.instances.num):s.drawElementsInstancedANGLE(e.mode,e.num,o,0,e.instances.num)}else n?t.drawArraysInstanced(e.mode,0,e.num,e.instances.num):s.drawArraysInstancedANGLE(e.mode,0,e.num,e.instances.num);for(let o in r){const c=i[o];c&&(n?t.vertexAttribDivisor(c.loc,0):s.vertexAttribDivisorANGLE(c.loc,0))}e.shader.unbind(null)};class Qd{gl;buffer;format;width;height;constructor(e,n){this.gl=e,this.buffer=e.createRenderbuffer()||C("error creating RBO"),this.configure(n)}bind(){return this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.buffer),!0}unbind(){return this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),!0}release(){return this.gl.deleteRenderbuffer(this.buffer),delete this.buffer,!0}configure(e,n=!0){const s=this.gl;return this.bind(),this.format=e.format||s.DEPTH_COMPONENT16,this.width=e.width,this.height=e.height,s.renderbufferStorage(s.RENDERBUFFER,e.format||s.DEPTH_COMPONENT16,e.width,e.height),n?this.unbind():!0}}const tg=36064,eg=36063;class ng{gl;fbo;ext;maxAttachments;constructor(e,n){this.gl=e,this.fbo=e.createFramebuffer()||C("error creating FBO"),this.ext=!Ce(e)&&n?.tex&&n.tex.length>1?e.getExtension("WEBGL_draw_buffers")||C("missing WEBGL_draw_buffers ext"):void 0,this.maxAttachments=e.getParameter(eg),n&&this.configure(n)}bind(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),!0}unbind(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),!0}release(){return this.gl.deleteFramebuffer(this.fbo),delete this.fbo,delete this.ext,!0}configure(e,n=!0){const s=this.gl;if(this.bind(),e.tex){S(e.tex.length<this.maxAttachments,`too many attachments (max. ${this.maxAttachments})`);const i=[];for(let r=0;r<e.tex.length;r++){const o=e.tex[r];S(!!(nn[o.format].render||nn[o.format].renderExt),`texture #${r} has non-renderable format`);const c=tg+r;s.framebufferTexture2D(s.FRAMEBUFFER,c,s.TEXTURE_2D,o.tex,0),i[r]=c}this.ext?this.ext.drawBuffersWEBGL(i):Ce(s)&&s.drawBuffers(i)}return e.depth&&(e.depth instanceof Qd?s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e.depth.buffer):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,e.depth.tex,0)),this.validate(),n?this.unbind():!0}validate(){const e=this.gl,n=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(n){case e.FRAMEBUFFER_COMPLETE:return!0;case e.FRAMEBUFFER_UNSUPPORTED:C("FBO unsupported");case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:C("FBO incomplete attachment");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:C("FBO incomplete dimensions");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:C("FBO incomplete missing attachment");default:return C(`FBO error: ${n}`)}}}const sg=(t,e)=>new ng(t,e),_n=(t,e)=>(S(t.tag!=="swizzle"||t.val.tag==="sym","can't assign to non-symbol swizzle"),{tag:"assign",type:t.type,l:t,r:e}),ig=t=>{const[e,n,s]=B(t)?[t]:t;return{tag:"arg",type:e,id:n||Ji(),opts:{q:"in",...s}}};function rg(t,e,n,s){e=e||Ji();const i=n.map(ig),r=s(...i.map(a=>K(a.type,a.id,a.opts))).filter(a=>a!=null);is((a,l)=>(l.tag==="ret"&&(S(l.type===t,`wrong return type for function '${e}', expected ${t}, got ${l.type}`),a++),a),pa,0,r);const o=is((a,l)=>(l.tag==="call"&&l.fn&&a.push(l.fn),a),Cd,[],r),c=(...a)=>og(c,...a);return Object.assign(c,{tag:"fn",type:t,id:e,args:i,deps:o,scope:ba(r)})}const ys=t=>rg("void","main",[],t);function og(t,...e){return B(t)?{tag:"call",type:e[0],id:t,args:e.slice(1)}:{tag:"call",type:t.type,id:t.id,args:e,fn:t}}const uo=(t,e,...n)=>({tag:"call_i",type:e,id:t,args:n});function cg(t,e){const n=t.type[0],s=(i,r)=>e.length===1?i:r+e.length;return{tag:"swizzle",type:n==="i"?s(bs,"ivec"):n==="u"?s(Vi,"uvec"):n==="b"?s(na,"bvec"):s(In,"vec"),val:t,id:e}}function ag(t){return cg(t,"xy")}const fo=t=>{const e=t.type[0],n=t.type.indexOf("Shadow")>0;return e==="s"?n?In:Re:e==="i"?n?bs:"ivec4":e==="u"?n?Vi:"uvec4":it(`unknown sampler type ${t.type}`)},Sa=(t,e,n,s)=>{const i=s?uo(t,fo(e),e,...n,s):uo(t,fo(e),e,...n);return!Pe(i)&&(i.info="n"),i};function lg(t,e,n){return Sa("texture",t,[e],n)}function ug(t,e,n){return Sa("texelFetch",t,[e,n])}const Ia=(t={})=>{let{size:e=2,uv:n=!0,center:s=!0}=t;e*=.5;const i=s?0:e;return{attribs:{position:{data:new Float32Array([i-e,i-e,i+e,i-e,i-e,i+e,i+e,i+e]),size:2},...n?{uv:{data:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}:null},uniforms:{},shader:null,mode:qi.TRIANGLE_STRIP,num:4}},fg=(t,e,n)=>[ys(()=>[_n(t.gl_Position,ha(n.position,ji,aa))])],hg=(t,e,n,s)=>[ys(()=>[_n(s.v_uv,n.uv),_n(t.gl_Position,ha(n.position,ji,aa))])],dg=(t,e,n,s)=>[ys(()=>[_n(s.fragColor,lg(e.tex,n.v_uv))])],gg={vs:hg,fs:dg,attribs:{position:we,uv:we},varying:{v_uv:we},uniforms:{tex:sa},state:{depth:!1},ext:{}},mg=t=>{const e=t.gl,n=t.passes.length;S(n>0,"require at least one shader pass");const s=!t.passes[n-1].outputs.length,i=yg(t),r=pg(t,i),o=vg(t,i,s),c=(d,p,b=!0)=>{b&&o[d].bind();const m=t.passes[d],I=r[d],M=I.shader,N=m.outputs.length?i[m.outputs[0]].size:[e.drawingBufferWidth,e.drawingBufferHeight];M.uniforms.resolution&&(I.uniforms.resolution=N),M.uniforms.time&&(I.uniforms.time=p),e.viewport(0,0,N[0],N[1]),Kd(I),b&&o[d].unbind()},a=d=>{for(let p=0;p<o.length;p++)c(p,d);s&&c(n-1,d,!1)},l=()=>{a((Date.now()-f)*.001),u&&(h=requestAnimationFrame(l))};let u,f=Date.now(),h;return{start(){f=Date.now(),u=!0,h=requestAnimationFrame(l)},stop(){u&&(u=!1,cancelAnimationFrame(h))},update(d){a(d)},singlePass(d,p){c(d,p,d<o.length)},passes:t.passes,fbos:o,models:r,textures:i}},pg=(t,e)=>{const n=t.gl,s=oo(n,Ia({uv:!1}));return t.passes.map(i=>{const r=i.model?oo(n,i.model):{...s};return r.shader=bg(n,i,e),r.uniforms={...i.uniformVals},i.inputs.length>0&&(r.textures=i.inputs.map(o=>e[o])),r})},_g={[Ee.TEXTURE_2D]:sa,[Ee.TEXTURE_3D]:od,[Ee.TEXTURE_CUBE_MAP]:"samplerCube"},bg=(t,e,n)=>{const s=Ce(t),i=e.outputs.length,r={...e.ext},o={vs:e.vs||fg,fs:e.fs,attribs:e.attribs||{position:we},varying:e.varying,uniforms:{...e.uniforms,...$t(_c((l,u)=>[`input${l}`,[_g[n[u].target],l]]),ci(),e.inputs)},outputs:i?$t(F(l=>[`output${l}`,[Re,l]]),ci(),bc(i)):void 0,state:e.state,pre:e.pre,post:e.post,replacePrelude:e.replacePrelude,generateDecls:e.generateDecls,ext:r},c=ai(l=>Wr(n[l]),e.inputs),a=ai(l=>Wr(n[l]),e.outputs);return s||(c&&(r.OES_texture_float="require"),i>1&&(r.WEBGL_draw_buffers="require")),a&&(r[s?"EXT_color_buffer_float":"WEBGL_color_buffer_float"]="require",s&&(r.EXT_float_blend="require")),va(t,o)},yg=t=>Object.keys(t.textures).reduce((e,n)=>(e[n]=hi(t.gl,{width:t.width,height:t.height,depth:t.depth,filter:es.NEAREST,wrap:ns.CLAMP,image:null,...t.textures[n]}),e),{}),vg=(t,e,n)=>(n?t.passes.slice(0,t.passes.length-1):t.passes).map(s=>sg(t.gl,{tex:s.outputs.map(i=>e[i])})),Ag=(t,e)=>(S(t.length===e.length,"require same number of in/out textures"),{fs:(n,s,i,r)=>[ys(()=>[...F(o=>_n(r[`output${o}`],ug(s[`input${o}`],pd(ag(n.gl_FragCoord)),la)),bc(t.length))])],inputs:t,outputs:e});class Eg{constructor(e,n,s){this.gl=e;const i=ed(n);this.canvasTex=hi(this.gl),this.backgroundTex=hi(this.gl),this.fadeAmount=n.fadeAmount||0,this.pipeline=mg({gl:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,textures:{curr:{format:ts.RGBA32F},next:{format:ts.RGBA32F},canvasTex:{},backgroundTex:{}},passes:[{model:Ia({uv:!0}),...gg,fs:`
                    #define saturate(a) clamp( a, 0.0, 1.0 )
                    
                    void main() {
                        vec4 src = texture(input0, v_uv / uvScale + uvOffset );
                        vec4 background = texture(input2, v_uv / uvScale + uvOffset );
                        vec4 c;

                        if (src.a > 0.00001) {
                            
                            c = matrix * src + offset;
                            output0 = vec4(c.rgb, src.a);

                        } else {
                            c = src;
                        }

                        // read previous frame
                        vec4 prev = texture(input1, v_uv);
                        // fade it
                        prev = vec4(mix(background.rgb, prev.rgb, 1.0 - fadeAmount), prev.a);
                        
                        // alpha blend canvas and prev
                        output0 = vec4( c.rgb * c.a + (1.0-c.a) * prev.rgb, max(c.a, prev.a));
                    }`,inputs:["canvasTex","curr","backgroundTex"],outputs:["next"],uniforms:{canvasTex:"sampler2D",backgroundTex:"sampler2D",curr:"sampler2D",fadeAmount:["float",this.fadeAmount],fadeColor:["vec4",new Float32Array(ne(null,_s(s)))],matrix:["mat4",new Float32Array([i[0],i[5],i[10],i[15],i[1],i[6],i[11],i[16],i[2],i[7],i[12],i[17],i[3],i[8],i[13],i[18]])],offset:["vec4",[i[4],i[9],i[14],i[19]]],uvScale:["vec2",[1,1]],uvOffset:["vec2",[0,0]]},state:{blend:!1,blendFn:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEq:e.FUNC_ADD}},Ag(["next"],["curr"]),{fs:`void main() { 
                      
                      vec4 l = texelFetch(input0, ivec2(gl_FragCoord.xy), 0);
                      vec4 b = texelFetch(input1, ivec2(gl_FragCoord.xy), 0); // background
                    
                      // alpha compose background and current frame
                      fragColor = vec4(l.a * l.rgb + (1.0 - l.a) * b.rgb, 1.0); }`,inputs:["curr","backgroundTex"],outputs:[]}]})}pipeline;canvasTex;backgroundTex;fadeAmount;updateImage(e,n){this.pipeline.textures.canvasTex.configure({image:e,width:e.width,height:e.height,flip:!0}),this.pipeline.textures.backgroundTex.configure({image:n,width:n.width,height:n.height,flip:!0})}draw(e,n,s){s!==void 0&&(this.fadeAmount=s,this.pipeline.models[0].uniforms.fadeAmount=this.fadeAmount),this.updateImage(e,n),this.pipeline.update()}}const wg={};var ho={};const Rg=(t,e,n=!1)=>{const s=typeof global<"u"?global:typeof window<"u"?window:void 0;s&&(n||(typeof process<"u"&&ho!==void 0?ho.UMBRELLA_GLOBALS:!wg))&&(s[t]=e)},Qi=t=>D(t)?(t.every(e=>B(e)&&e!==""||y(e))||Ma(t),t):B(t)?t.length>0?Qi(t.split(".")):[]:t!=null?[t]:[],Sg=(t,e)=>{if(t==null)return!1;e=Qi(e);for(let n=e.length-1,s=0;s<=n;s++){const i=e[s];if(!t.hasOwnProperty(i)||(t=t[i],t==null&&s<n))return!1}return!0},Ig=t=>{const e=Qi(t);return ih(e)&&Ma(t),e},Ma=t=>it(`illegal path: ${JSON.stringify(t)}`);function Mg(t){const e=Ig(t);let[n,s,i,r]=e;switch(e.length){case 0:return(o,c)=>c;case 1:return(o,c)=>o?(o[n]=c,o):void 0;case 2:return(o,c)=>{let a;return o&&(a=o[n])?(a[s]=c,o):void 0};case 3:return(o,c)=>{let a;return o&&(a=o[n])&&(a=a[s])?(a[i]=c,o):void 0};case 4:return(o,c)=>{let a;return o&&(a=o[n])&&(a=a[s])&&(a=a[i])?(a[r]=c,o):void 0};default:return(o,c)=>{let a=o;const l=e.length-1;for(let u=0;u<l;u++)if(!(a=a[e[u]]))return;return a[e[l]]=c,o}}}const Da=(t,e,n)=>Mg(e)(t,n),Dg=/^(function\s+\w+)?\s*\(\{([\w\s,:]+)\}/;function Ng(t,e){const n={prefix:"@",unwrap:!0,...e};return Ct(t)?Na(t,n):D(t)?$a(t,n):t}const Na=(t,e,n,s=[],i={},r=[])=>{n=n||t;for(let o in t)bn(n,[...s,o],i,r,e);return!e.unwrap||s.length?t:La(t,i)},$a=(t,e,n,s=[],i={},r=[])=>{n=n||t;for(let o=0,c=t.length;o<c;o++)bn(n,[...s,o],i,r,e);return!e.unwrap||s.length?t:La(t,i)},bn=(t,e,n,s,i)=>{const r=e.join("/");s.indexOf(r)>=0&&it(`cyclic references not allowed: ${r}`);let[o,c]=Oa(t,e);if(!n[r]){if(c)return n[r]=!0,o;let a=W;s.push(r),Ct(o)?Na(o,{...i,unwrap:!1},t,e,n,s):D(o)?$a(o,{...i,unwrap:!1},t,e,n,s):!i.onlyFnRefs&&B(o)&&o.startsWith(i.prefix)?a=bn(t,go(e,o,i.prefix.length),n,s,i):$e(o)?a=Og(o,l=>bn(t,go(e,l,0),n,s,i),r,n):Sg(t,e)||(o=$g(t,e,n,s,i)),a!==W&&(Da(t,e,a),o=a),n[r]=!0,s.pop()}return o},$g=(t,e,n,s,i)=>{let r=s.pop(),o;for(let c=1,a=e.length;c<=a;c++)o=bn(t,e.slice(0,c),n,s,i);return s.push(r),o},Og=(t,e,n,s)=>{const i=Dg.exec(t.toString());let r;if(i){const o=i[2].replace(/\s|(,\s*$)/g,"").split(/,/g).map(c=>c.split(":")[0]).reduce((c,a)=>(c[a]=e(a),c),{});r=t(o,e)}else r=t(e);return tr(r,n,s),r},tr=(t,e,n)=>{n[e]=!0,Ct(t)?Lg(t,e,n):D(t)&&Cg(t,e,n)},Lg=(t,e,n)=>{let s,i;for(let r in t)s=t[r],i=e+"/"+r,tr(s,i,n)},Cg=(t,e,n)=>{let s,i;for(let r=0,o=t.length;r<o;r++)s=t[r],i=e+"/"+r,tr(s,i,n)},go=(t,e,n=1)=>{if(e.charAt(n)==="/")return e.substring(n+1).split("/");t=t.slice(0,t.length-1);const s=e.substring(n).split("/");for(let i=0,r=s.length;i<r;i++)if(s[i]==="..")!t.length&&it(`invalid lookup path: ${e}`),t.pop();else return t.concat(s.slice(i));return!t.length&&it(`invalid lookup path: ${e}`),t};class mo{constructor(e){this._value=e}deref(){return this._value}}const Oa=(t,e)=>{const n=e.length-1;let s=t,i=t instanceof mo;for(let r=0;s!=null&&r<=n;r++)s=s[e[r]],s instanceof mo&&(i=!0,s=s.deref());return[s,i]},La=(t,e)=>{for(let n in e){const s=n.split("/"),i=Oa(t,s);i[1]&&Da(t,s,i[0])}return t},Ca=(t,e,n)=>{t.attribs.stroke??=n.stroke.get(t,e);const s=n.stroke.update?n.stroke.update(t,e):t.attribs.stroke;t.attribs.weight??=n.weight.get(t,e);const i=n.weight.update?n.weight.update(t,e):t.attribs.weight;t.attribs.alpha??=n.alpha.get(t,e);const r=n.alpha.update?n.alpha.update(t,e):t.attribs.alpha;return{stroke:s,weight:i,alpha:r}},Bg=(t,e,n)=>(t.attribs.style??=n.style.get(t,e),n.style.update?{...t.attribs.style,...n.style.update(t,e)}:t.attribs.style),Tg=(t,e,n)=>n.map(s=>Gh(s,t.pos,[-e.aspectRatio/2,-.5],[e.aspectRatio/2,.5])),po=(t,e,n,s,i,r=0,o)=>({ID:t,parent:o,active:!0,pos:e,dir:n,bounds:s,generation:r,history:{positions:[],length:0},supportData:{features:[],distanceToCenter:0,velocity:[0,0]},opts:i,attribs:{},lastDrawnAtLength:0}),Pg=(t,e,n,s)=>{const{pos:i,bounds:r,history:o,opts:c}=t,{step:a,fuzziness:l,maxLength:u}=c;if(t.active){o.positions.push(_i(i));const f=e(t,s!==void 0?a*s/1e3:a,[l,l]);Wt(r,i)&&!n(t)&&o.length<=u?o.length+=f:t.active=!1}return t},Ug=(t,e)=>(n,s)=>{const{pos:i,dir:r}=n,o=Ne([],wi([],r,e.vector_field.get(n,t,[0])),s);return Ot(null,i,o),n.supportData.velocity=o,En(o)},Gg=(t,e)=>(n,s)=>{const[i,r]=n.pos;return Ba(n,t,s,e),oe(n.supportData.velocity,n.pos,[i,r]),En(n.supportData.velocity)},kg=(t,e)=>(n,s)=>{const{pos:i,dir:r}=n,[o,c]=i;Ba(n,t,s,e);const a=Ne([],wi([],r,e.vector_field.get(n,t,[0])),s);return Ot(null,i,a),oe(n.supportData.velocity,n.pos,[o,c]),En(n.supportData.velocity)},Fg=(t,e)=>(t.supportData.features=Tg(t,e.preset,e.images),t.supportData.distanceToCenter=En(t.pos),t),Ba=(t,e,n,s)=>{s.domain_warping&&Ot(null,t.pos,fs([],s.domain_warping.get(t,e),n))},zg={warped:Gg,vector_field:Ug,warped_vector_field:kg},Hg=(t,e)=>t.active?e>0?t.history.length-t.lastDrawnAtLength>=e:!0:!1;var qg=Object.getOwnPropertyDescriptor,Vg=(t,e,n,s)=>{for(var i=s>1?void 0:s?qg(e,n):e,r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(i)||i);return i};let di=class{constructor(t,e,n,s,i=void 0,r=(o,c)=>{}){this.space=n,this.rnd=s,this.data=new Array(t*e).fill(i),this.size=[t,e],this.stride=[1,t],this.spaceMin=n.pos,this.spaceMax=J([],n.pos,n.size),this.freeValue=i;for(let o=0;o<t;o++)for(let c=0;c<e;c++)this.setAtUnsafe(o,c,r(o,c))}size;stride;spaceMin;spaceMax;data=[];freeValue;agents=[];clear(){const[t,e]=this.size;for(let n=0;n<t;n++)for(let s=0;s<e;s++)this.setAtUnsafe(n,s,this.freeValue)}setAgents(t){this.agents=t}fromSpaceToGrid(t){const[e,n]=Zn([],t,this.spaceMin,this.spaceMax,[0,0],this.size);return[Math.floor(e),Math.floor(n)]}fromGridToSpace(t){return Zn([],t,[0,0],this.size,this.spaceMin,this.spaceMax)}isFree(t){const e=this.fromSpaceToGrid(t);return this.isCellFree(e[0],e[1])}checkCollision(t,e,n=!1,s=0){const i=this.fromSpaceToGrid(t.pos);return this.isCellFree(i[0],i[1],e,t,s)?(n&&this.setAt(i[0],i[1],t),!1):!0}isCellFree(t,e,n=0,s,i=0){if(this.includes(t,e)){const r=this.getAt(t,e);return r===this.freeValue||s!==void 0&&r===s||r.ID<i}}randomFree(t,e=0){let n=0;for(;n<1e4;){const s=Lr(t,1,this.rnd);if(s&&s.length>0){const i=this.fromSpaceToGrid(s[0]);if(this.isCellFree(Math.floor(i[0]),Math.floor(i[1]),0,void 0,e))return{pos:s[0],agent:void 0};n++}}return{pos:void 0,agent:void 0}}freeLine(t,e,n,s,i,r=!0,o=0){const c=s*Math.min(this.width,this.height),a=Ne([],n,1),l=this.fromSpaceToGrid(e);let u=Ot([],l,a),f=this.fromGridToSpace(u),h=0;for(;(!i||Wt(i,f))&&(!r||this.isCellFree(Math.floor(u[0]),Math.floor(u[1]),0,t,o))&&h<c;)Ot(null,u,a),f=this.fromGridToSpace(u),h++;return[f[0],f[1]]}randomOccupied(t,e="random point"){let n=0;for(;n<1e4;){if(e==="random point"){const s=Lr(t,1,this.rnd);if(s){const i=this.fromSpaceToGrid(s[0]);if(!this.isCellFree(Math.floor(i[0]),Math.floor(i[1]),0))return{pos:[s[0][0],s[0][1]],agent:this.getAt(Math.floor(i[0]),Math.floor(i[1]))}}}else if(this.agents.length>0){const s=qt(this.agents,this.agents.map(i=>i.history.length),this.rnd);if(s.history.length>0){const i=w(s.history.positions,this.rnd);if(Wt(t,i))return{agent:s,pos:[i[0]+this.rnd.minmax(-.001,.001),i[1]+this.rnd.minmax(-.001,.001)]}}}n++}return{pos:void 0,agent:void 0}}setAtUnsafe(t,e,n){}setAt(t,e,n){}getAt(t,e){}getAtUnsafe(t,e){}includes(t,e){}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}};di=Vg([Dc],di);const Yg=(t,e,n=[])=>({preset:t,agents:[],spaceManager:e,images:n,iterations:0,spaceTraveled:0,agentsToCreate:0,iterationSpawnableAgents:0,activeAgents:0}),jg=(t,e,n,s)=>{let i,r;if(t.iterations+=1,t.iterations<e.agentFactory.maxIterations&&t.spaceTraveled<e.agentFactory.maxSpaceTraveled||e.agentFactory.neverEnding){const o=h=>t.spaceManager.checkCollision(h,0,!0,t.agents.length-e.agentFactory.maxColliding),c=$t(An(Yt(h=>h.active),F(h=>(Fg(h,t),Pg(h,zg[h.opts.type?h.opts.type:"vector_field"](t,e),o,s)))),se(),t.agents);r=$t(Yt(h=>h.active),se(),c),t.activeAgents=r.length;const a=$t(Yt(h=>!h.active),se(),c);t.spaceTraveled=t.agents.reduce((h,g)=>h+g.history.length,0),t.agentsToCreate+=a.length*e.agentFactory.branch+e.agentFactory.newPerIteration,t.iterationSpawnableAgents+=e.agentFactory.maxNewPerIteration,i=Math.min(t.agentsToCreate,t.iterationSpawnableAgents,e.agentFactory.maxActive-r.length),e.agentFactory.neverEnding||(i=Math.min(i,e.agentFactory.maxAgents-t.agents.length)),t.agentsCreated=0;let l=0;const u=e.bounds.init.map(h=>ee(h)),f=u.reduce((h,g)=>h+g,0);for(;t.agentsCreated<i&&l<300;)Ta(t,e,u,f,n)&&t.agentsCreated++,l++;return t.iterationSpawnableAgents-=t.agentsCreated,!0}return t.iterations>=e.agentFactory.maxIterations&&console.log("max iterations reached"),t.spaceTraveled>=e.agentFactory.maxSpaceTraveled&&console.log("max length reached"),!1},Ta=(t,e,n,s,i)=>{let r=!1;const o=e.agentFactory.initPolicy(t);if(o==="randomFree"){const c=s>0?qt(e.bounds.init,n,i):w(e.bounds.init,i),{pos:a,agent:l}=t.spaceManager.randomFree(c),u=w(e.agentFactory.initialDirections?.length>0?e.agentFactory.initialDirections:e.agentFactory.directions,i);a&&u&&(t.agents.push(po(t.agents.length,a,u,e.bounds.get(t,a),e.agent.get(t))),r=!0,t.agentsToCreate--)}else if(o==="randomOccupied"){const{pos:c,agent:a}=t.spaceManager.randomOccupied(w(e.bounds.update,i));c&&a&&(t.agents.push(po(t.agents.length,c,w([[a.dir[1],-a.dir[0]],[-a.dir[1],a.dir[0]]],i),a.bounds,e.agent.get(t),a.generation+1,a)),r=!0,t.agentsToCreate--)}return r},Wg=(t,e,n)=>{const s=[],i=oe([],e,t),r=En(i);let o=n.grains.proportional?Math.floor(r*n.grains.factor):n.grains.factor;const c=1/(o-1);for(let a=0;a<o;a++){let l;n.grains.distribution&&n.grains.distribution==="sin"?l=[t[0]+(e[0]-t[0])*Math.sin(Math.sin(a*c)),t[1]+(e[1]-t[1])*Math.sin(Math.sin(a*c))]:l=_0([],t,e,[a/o,a/o]);let u=n.alpha.min?n.alpha.min:0,f=n.alpha.max===void 0?1:n.alpha.max,h=ot(te(u,f,n.alpha.decay(1-a/o)),u,f),g=n.color.color;const d=new Ke([l],{stroke:g,size:n.size,weight:n.shapeAttribs.weight,shape:"circle",alpha:h,fill:n.shapeAttribs.filled?g:void 0});s.push(d)}return s},Xg=(t,e,n)=>{let s=Ca(t,e,e.preset),i=Bg(t,e,e.preset);const r=[];return i.type.includes("line")&&r.push(xg(t,e)),i.type.includes("sanding")&&r.push(Zg(t,e,{...s,...i})),i.type.includes("square")&&r.push(Kg(t,e,{...s,...i},n)),i.type.includes("circle")&&r.push(Jg(t,e,{...s,...i},n)),t.lastDrawnAtLength=t.history.length,le(s,r)},xg=(t,e,n=1)=>Wu(t.history.positions.at(-n),t.pos,Ca(t,e,e.preset)),Zg=(t,e,n)=>{const s=[];if(n.type.includes("sanding")){n.color!==void 0&&(n.stroke=n.color);let r=Ne([],wi([],t.supportData.velocity,Gn));const o=_o(t.pos,e.spaceManager.freeLine(t,t.pos,r,n.maxLength*(n.multiplyLengthFactor??1),n.followBounds?t.bounds:void 0,!0,e.agents.length-e.preset.agentFactory.maxColliding),n);if(s.push(...o),n.shadingLength>0){const c=_o(t.pos,Ot([],t.pos,Ne([],[-r[0],-r[1]],n.shadingLength)),{...n,minAlpha:0,stroke:n.shadingColor!==void 0?n.shadingColor:oi([],Vc(-.8),_s(n.stroke)),grainsFactor:n.grainsFactor});s.push(...c)}}return le(n,s)},_o=(t,e,n)=>Wg(t,e,{grains:{factor:n.grainsFactor,proportional:!0,distribution:n.grainsDistribution},alpha:{min:n.minAlpha,max:n.maxAlpha>0?n.maxAlpha:n.alpha,decay:n.alphaDecay,multiplyByImage:void 0,luminanceRange:n.multiplyByImageLuminance?n.multiplyByImageLuminance.range:[0,1]},color:{color:n.stroke,fromImage:n.colorFromImage!==void 0?n.colorFromImage.index:void 0},size:Math.max(1e-4,n.weight*n.sizeFactor),shapeAttribs:{weight:n.weightFactor?n.weightFactor*n.weight:n.weight*.5,filled:!0}}),Jg=(t,e,n,s)=>{const i=[];return i.push(Ys(t.pos,Math.min(n.weight,.6),{...n,alpha:.001})),s.probability(0)&&i.push(Ys(t.pos,s.minmax(.001,.01),{...n,fill:Bc([],Hc(w(e.preset.colors.fg,s)),s.minmax(.2,.6))})),le(n,i)},Kg=(t,e,n,s)=>{const i=[];return s.probability(5e-4)&&i.push(je(t.pos,[s.minmax(.001,.3),s.minmax(.001,.3)],{...n,fill:Bc([],Hc(w(e.preset.colors.fg,s)),s.minmax(.2,.6))})),le(n,i)},Qg=(t,e,n,s,i,r)=>{const o=[];return t.forEach((c,a)=>{if(e[a%e.length]){const l=i[a%i.length],u={weight:s[a%s.length],stroke:l};n[a%n.length]&&(u.fill=l),r&&(u.r=r[a%r.length]),c.attribs=u,o.push(c)}}),le({lineCap:"round",radius:300},o)};let Se,er,_t;addEventListener("beforeunload",t=>{console.log("beforeunload"),er=[]});const tm=async(t,e,n,s)=>{const i=Ng({...t(e,n,s)},{onlyFnRefs:!0});return Se={preset:i,iterations:0,presetId:i.name,lineSlice:-1},er=await Th(i.assets),i.assets.length>0&&console.log("using images "+i.assets.map(r=>r).join(", ")),Rg("state",Se),Se},em=t=>{const{preset:e}=Se,{gridSize:n,aspectRatio:s}=e;_t=Yg(e,new di(Math.floor(n[0]),Math.floor(n[1]),gn([-s/2,-.5],[s,1]),t.RND,0,(o,c)=>0),er),window.agents=_t;const i=e.bounds.init.map(o=>ee(o)),r=i.reduce((o,c)=>o+c,0);for(let o=0;o<e.agentFactory.initialAgents;o++)Ta(_t,e,i,r,t.RND);return _t.agentsToCreate=0,_t},nm=(t,e)=>{const{preset:n}=Se;return jg(_t,n,t.RND,e)},sm=(t,e,n,s=!1,i=!1,r=!1)=>{const{preset:o}=Se,c=s||i,a=_t.preset.agent.get(_t).minSpaceBeforeDrawing||0,l=$t(An(Yt(f=>f.active&&f.history.positions.length>0&&Hg(f,a)),F(f=>Xg(f,_t,n))),se(),_t.agents),u=le({lineCap:"round",lineJoin:"round"},l);return c&&(r||s)&&u.children.unshift(nr(t,f=>f,o.background)),e(u)},nr=(t,e,n,s)=>{const i=[];return s&&i.push(gn(t,{fill:s})),n&&i.push(e(Qg(n.shapes,n.draw,n.fill,n.weights,n.colors,n.rounds))),le({lineCap:"round"},i)},im=(t=!1)=>{const e=document.createElement("div");e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.padding="12px 16px",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.fontFamily="monospace",e.style.fontSize="2vw",e.style.borderRadius="4px",e.style.zIndex="1000",e.style.display=t?"block":"none",e.style.pointerEvents="none",e.style.whiteSpace="pre-line",document.body.appendChild(e);let n=t;return{element:e,isVisible:n,toggle:()=>{n=!n,e.style.display=n?"block":"none"},update:(r,o,c,a)=>{n&&(e.textContent=`Frame: ${r}
        FPS: ${o}
        Iteration: ${c.iterations}
Agents: ${c.agents.length}
ActiveAgents: ${c.activeAgents}
AgentsCreated: ${c.agentsCreated}
Preset: ${a.presetId}`)}}};$genart.configure({id:"layer-trippy",allowExternalConfig:!1});await $genart.waitForAdapter();const sn=await $genart.setParams({hash:$genart.params.choice({name:"Hash",desc:"seed for random",edit:"protected",options:["random",...nd],default:"random"}),numAgents:$genart.params.range({name:"Max Active Agents",desc:"Max number of active agents",edit:"protected",min:1,max:200,step:1,default:50}),speed:$genart.params.range({name:"speed multiplier",desc:"speed multiplier of the drawing system",edit:"protected",min:.1,max:10,step:.1,default:2}),fade:$genart.params.range({name:"fade multiplier",desc:"fade multiplier of the drawing system",edit:"protected",min:0,max:10,step:.01,default:1})});$genart.random.reset();let Qt=$genart.random,gi=$genart.seed;sn("hash")!=="random"&&(gi=sn("hash"),Qt=new $genart.prng.SFC32(Fh(gi)));const os={RND:new Jt(Qt.rnd),RND_COLORS:new Jt(Qt.copy().rnd),RND_STYLE:new Jt(Qt.copy().rnd),RND_BOUNDS:new Jt(Qt.copy().rnd),RND_NOISE:new Jt(Qt.copy().rnd),RND_SYSTEM:new Jt(Qt.copy().rnd)};let Pa,rm=!0,cs,Ua,bo=1*60,om=!1,yo=!0,cm=-1,vo=0,Ao=0,am=!1;const as=await tm(sd,os,$genart.screen.width,$genart.screen.height),{preset:_e}=as;console.log($genart.seed,_e);$genart.on("genart:param-change",({paramID:t,param:e})=>{console.log("param change:",t,e)});$genart.on("genart:resize",({screen:t})=>{console.log("resize",t),Ga()});let ut,ft,ve,mt,Hn,mi,sr;const Ga=()=>{({width:ut,height:ft}=$genart.screen),mt||(mt=rn(ut,ft,document.body,{ctx:{colorSpace:"display-p3"}}),sr=im(am),Hn=rn(ut,ft,document.body,{ctx:{colorSpace:"display-p3"}}),ve=Vf({width:ut,height:ft,parent:document.body,version:2,autoScale:!1,opts:{preserveDrawingBuffer:!0}}),"drawingBufferColorSpace"in ve.gl&&rm&&(ve.gl.drawingBufferColorSpace="display-p3"),mt.canvas.style.display="none",Hn.canvas.style.display="none",Pa=new Eg(ve.gl,_e.postprocess,_e.colors.bg[0])),mt.canvas.width=ut,mt.canvas.height=ft,mi=mt.canvas.getContext("2d"),Ua=em(os),cs=t=>xs(Xs(t,[ut/_e.aspectRatio,ft]),[ut/2,ft/2]),Oe(Hn.canvas.getContext("2d"),nr([ut,ft],cs,_e.background,_e.colors.bg[0]))};Ga();$genart.setUpdate((t,e)=>{const{preset:n}=as;n.agentFactory.maxActive=sn("numAgents"),Ao=(n.postprocess.fadeAmount||0)*sn("fade");const s=Math.min(t-vo,100);vo=t,mt.ctx.clearRect(0,0,mt.canvas.width,mt.canvas.height);let i=!0;if(bo<=0){i=i&&nm(os,s*sn("speed"));const r=i&&sm([ut,ft],cs,os.RND_STYLE,om);i&&Oe(mi,r),!i&&yo&&n.foreground&&(console.log("drawing top layer"),Oe(mi,nr([ut,ft],cs,n.foreground)),yo=!1),Pa.draw(mt.canvas,Hn.canvas,Ao),i||console.log("stop")}return bo--,e===0&&$genart.capture(ve.canvas),e===cm&&ka(),sr.update(e,Math.round(1e3/Math.max(s,1)),Ua,as),i});window.onkeydown=t=>{switch(t.key){case"x":ka();break;case"o":sr.toggle();break}};const ka=()=>{Sf(ve.canvas,`${as.presetId}-${gi}-${zf()}`,"png"),console.log("saved to image")};
