(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const Ai=1/2**32;class fl{float(e=1){return this.int()*Ai*e}probability(e){return this.float()<e}norm(e=1){return(this.int()*Ai-.5)*2*e}normMinMax(e,n){const s=this.minmax(e,n);return this.float()<.5?s:-s}minmax(e,n){return this.float()*(n-e)+e}minmaxInt(e,n){e|=0;const s=(n|0)-e;return s?e+this.int()%s:e}minmaxUint(e,n){e>>>=0;const s=(n>>>0)-e;return s?e+this.int()%s:e}}class Kt extends fl{constructor(e){super(),this.rnd=e}float(e=1){return this.rnd()*e}norm(e=1){return(this.rnd()-.5)*2*e}int(){return this.rnd()*4294967296>>>0}}const fe=new Kt(Math.random),A=(t,e=fe,n=0,s=t.length)=>t[e.minmax(n,s)|0],dl=(t,e=fe)=>A(Object.keys(t),e),Mn=(t,e=n=>n!==void 0?": "+n:"")=>class extends Error{origMessage;constructor(n){super(t(n)+e(n)),this.origMessage=n!==void 0?String(n):""}},hl={};var wi={};const gl=Mn(()=>"Assertion failed"),M=(typeof process<"u"&&wi!==void 0?wi.UMBRELLA_ASSERTS:!hl)?(t,e)=>{if(typeof t=="function"&&!t()||!t)throw new gl(typeof e=="function"?e():e)}:()=>{},ml=(t,e,n=fe)=>{const s=t.length;M(s>0,"no choices given");const r=e?t.map((o,a)=>[e[a]||0,o]).sort((o,a)=>a[0]-o[0]):t.map(o=>[1,o]),i=r.reduce((o,a)=>o+a[0],0);return i<=0&&console.warn("total weights <= 0"),()=>{const o=n.float(i);let a=i;for(let c=0;c<s;c++)if(a-=r[c][0],a<=o)return r[c][1]}};let wt=20;const pl=Mn(()=>"unsupported operation"),Et=t=>{throw new pl(t)},G=(t=1,e,...n)=>{const s=[,,].concat(n),r=(...i)=>{const o=s[i[t].length]||e;return o?o(...i):Et(`no impl for vec size ${i[t].length}`)};return r.add=(i,o)=>s[i]=o,r.default=i=>e=i,r.impl=i=>i!=null&&s[i]||e,r},Pe=(t,e=1,n=!0)=>{const s=n?(a,c,l)=>{!a&&(a=c);for(let u=c.length;u-- >0;)a[u]=t(c[u],l[u]);return a}:(a,c,l)=>{!a&&(a=l);for(let u=c.length;u-- >0;)a[u]=t(c[u],l[u]);return a},r=n?(a,c,l)=>(!a&&(a=c),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a):(a,c,l)=>(!a&&(a=l),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a),i=n?(a,c,l)=>(!a&&(a=c),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a):(a,c,l)=>(!a&&(a=l),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a),o=n?(a,c,l)=>(!a&&(a=c),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a[3]=t(c[3],l[3]),a):(a,c,l)=>(!a&&(a=l),a[0]=t(c[0],l[0]),a[1]=t(c[1],l[1]),a[2]=t(c[2],l[2]),a[3]=t(c[3],l[3]),a);return[G(e,s,r,i,o),r,i,o]},qo=(t,e)=>t+e,bl=(t,e)=>t/e,Vo=(t,e,n)=>t*e+n,Yo=(t,e,n)=>t+(e-t)*n,Wo=(t,e)=>t*e,jo=(t,e)=>t-e,_l=(t,e,n)=>(t-e)*n,[yl,vl,Al,Im]=Pe(qo),Tt=yl,tt=vl,ve=Al,ys=(t,e=1)=>{const n=(o,a,c)=>{!o&&(o=a);for(let l=a.length;l-- >0;)o[l]=t(a[l],c);return o},s=(o,a,c)=>(!o&&(o=a),o[0]=t(a[0],c),o[1]=t(a[1],c),o),r=(o,a,c)=>(!o&&(o=a),o[0]=t(a[0],c),o[1]=t(a[1],c),o[2]=t(a[2],c),o),i=(o,a,c)=>(!o&&(o=a),o[0]=t(a[0],c),o[1]=t(a[1],c),o[2]=t(a[2],c),o[3]=t(a[3],c),o);return[G(e,n,s,r,i),s,r,i]},[Mm,wl,El,Dm]=ys(qo),xo=wl,Rl=El,Ei=-1/0,Ri=1/0,Sl=Object.freeze([Ei,Ei]),Il=Object.freeze([Ri,Ri]),pt=Object.freeze([0,0]),Ml=Object.freeze([1,0]),bt=Object.freeze([0,0,0]),Zt=Object.freeze([0,0,0,0]),Dl=(t,e=1)=>{const n=(o,a,c,l)=>{!o&&(o=a);for(let u=a.length;u-- >0;)o[u]=t(a[u],c,l[u]);return o},s=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c,l[0]),o[1]=t(a[1],c,l[1]),o),r=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c,l[0]),o[1]=t(a[1],c,l[1]),o[2]=t(a[2],c,l[2]),o),i=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c,l[0]),o[1]=t(a[1],c,l[1]),o[2]=t(a[2],c,l[2]),o[3]=t(a[3],c,l[3]),o);return[G(e,n,s,r,i),s,r,i]},[Nl,$l,Ll,Nm]=Dl(Vo),nn=Nl,Qn=$l,Js=Ll,[Cl,Ol,Tl,$m]=Pe(Math.max),Ks=Cl,ts=Ol,Si=Tl,z=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t),Ct=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t),ie=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t),Rt=G(1,(t,e)=>{!t&&(t=[]);for(let n=e.length;n-- >0;)t[n]=e[n];return t},z,Ct,ie),v=t=>typeof t=="number",Ii=Object.getPrototypeOf,Bt=t=>{let e;return t!=null&&typeof t=="object"&&((e=Ii(t))===null||Ii(e)===null)},kl=(t,e=0)=>new Array(t).fill(e),Or=t=>{if(t.length){const e=t[t.length-1];return Bt(e)?t.pop():(e==null&&t.pop(),void 0)}},Bl=t=>{const e=Or(t);return t.length?t.length===2?[t[0],t[1],e]:[void 0,t[0],e]:[void 0,void 0,e]},Pl=t=>{const e=Or(t);return t.length?t.length===2?[t[0],t[1],e]:v(t[0])?[void 0,t[0],e]:[t[0],void 0,e]:[void 0,void 0,e]},K=(t,e=2)=>v(t)?kl(e,t):t,Gl=t=>t instanceof Set,ct=(t,e)=>typeof t?.[e]=="function",Ul=t=>Gl(t)?t:new Set(t),Fl=(t,e)=>{const n=Ul(e),s={};for(let r in t)t.hasOwnProperty(r)&&!n.has(r)&&(s[r]=t[r]);return s},Tr=t=>ct(t,"copy")?t.copy():Rt([],t),kr=t=>t.map(Tr),E=(t,...e)=>t?e.length?Fl({...t},e):{...t}:void 0,je=t=>E(t.attribs,"__samples"),jt=(t,e,n)=>new t(n||kr(e.points),E(e.attribs));class Le{constructor(e=[0,0,0],n=1,s){this.pos=e,this.attribs=s,this.size=Si(null,K(n,3),bt)}type="aabb";dim=3;size;copy(){return new Le(Ct([],this.pos),Ct([],this.size),E(this.attribs))}withAttribs(e){return new Le(this.pos,this.size,e)}min(){return Ct([],this.pos)}max(){return ve([],this.pos,this.size)}offset(e){const n=Js([],this.size,.5,this.pos);return Si(null,Rl(null,this.size,e*2),bt),Js(this.pos,this.size,-.5,n),this}toHiccup(){return["aabb",this.attribs,this.pos,this.size]}}const I=Array.isArray,vs=t=>t!=null&&typeof t!="function"&&t.length!==void 0,zl=Mn(()=>"illegal argument(s)"),lt=t=>{throw new zl(t)},Hl=t=>((t==null||!t[Symbol.iterator])&&lt(`value is not iterable: ${t}`),t),Xo=t=>I(t)?t:[...Hl(t)];class As{constructor(e,n){this.attribs=n,this.points=e?Xo(e):[]}points;*[Symbol.iterator](){yield*this.points}clear(){this.points.length=0}}const Mi=Object.getPrototypeOf({}),Pn="function",Di="string",ut=(t,e)=>{let n;if(t===e)return!0;if(t!=null){if(typeof t.equiv===Pn)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===Pn)return e.equiv(t)}else return t==e;return typeof t===Di||typeof e===Di?!1:(n=Object.getPrototypeOf(t),(n==null||n===Mi)&&(n=Object.getPrototypeOf(e),n==null||n===Mi)?Yl(t,e):typeof t!==Pn&&t.length!==void 0&&typeof e!==Pn&&e.length!==void 0?Br(t,e):t instanceof Set&&e instanceof Set?ql(t,e):t instanceof Map&&e instanceof Map?Vl(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},Br=(t,e,n=ut)=>{let s=t.length;if(s===e.length)for(;s-- >0&&n(t[s],e[s]););return s<0},ql=(t,e,n=ut)=>t.size===e.size&&n([...t.keys()].sort(),[...e.keys()].sort()),Vl=(t,e,n=ut)=>t.size===e.size&&n([...t].sort(),[...e].sort()),Yl=(t,e,n=ut)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let s in t)if(!e.hasOwnProperty(s)||!n(t[s],e[s]))return!1;return!0},it=Math.PI,O=it*2,jn=it/2;let U=1e-6;const Pr=(t,e=1)=>[Math.cos(t)*e,Math.sin(t)*e],Wl=t=>(t%=O,t<0?O+t:t),jl=t=>(t=Math.abs(t),t>it?O-t:t),ft=(t,e,n)=>t<e?e:t>n?n:t,w=t=>t<0?0:t>1?1:t,Zo=(t,e,n)=>t>=e&&t<=n,Gr=(t,e,n)=>n!==e?(t-e)/(n-e):0,st=(t,e,n,s,r)=>s+(r-s)*Gr(t,e,n),dn=(t,e,n,s,r)=>s+(r-s)*w(Gr(t,e,n)),xl=(t,e,n)=>e+(n-e)*w(t),[Xl,Zl,Jl,Lm]=Pe(Wo),Kl=Xl,j=Zl,ze=Jl,Ql=(t,e)=>(n,s,r)=>{n?n!==s&&Rt(n,s):n=s;const i=Math.sin(r),o=Math.cos(r),a=s[t],c=s[e];return n[t]=a*o-c*i,n[e]=a*i+c*o,n},Jo=Ql(0,1),Ur=Jo,Ko=(t,e,n,s,r=[])=>tt(null,Jo(null,j(r,Pr(s),e),n),t),[tu,eu,nu,Cm]=ys(Wo),ws=tu,Ee=eu,Qs=nu,su=(t,e,n,s,r,i,o)=>(!t&&(t=e),nn(t,s,o,nn(t,n,i,ws(t,e,r)))),ru=(t,e,n,s,r,i,o,a,c)=>(!t&&(t=e),nn(t,r,c,nn(t,s,a,nn(t,n,o,ws(t,e,i))))),iu=(t,e,n,s,r,i)=>{const o=1-i,a=o*o,c=i*i;return ru(t,e,n,s,r,a*o,3*a*i,3*c*o,c*i)},ou=(t,e)=>{const n=Or(e);return new t(e.length===1?e[0]:e,n)},au=(t,e)=>M(t===e,`require ${e} points`);class Ce{constructor(e=[0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}type="circle";dim=2;copy(){return new Ce(z([],this.pos),this.r,E(this.attribs))}withAttribs(e){return new Ce(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class Yt extends As{type="poly";dim=2;add(...e){this.points.push(...e)}copy(){return jt(Yt,this)}copyTransformed(e){return jt(Yt,this,e(this.points))}withAttribs(e){return new Yt(this.points,e)}toHiccup(){return["polygon",this.attribs,this.points]}}class Oe{constructor(e=[0,0],n=[1,1],s){this.pos=e,this.attribs=s,this.r=K(n)}type="ellipse";dim=2;r;copy(){return new Oe(z([],this.pos),z([],this.r),E(this.attribs))}withAttribs(e){return new Oe(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class sn{constructor(e,n){this.attribs=e,this.children=n?Xo(n):[]}type="group";dim=2;children;*[Symbol.iterator](){yield*this.children}add(...e){return this.children.push(...e),this}clear(){this.children.length=0}copy(){return this.copyTransformed(e=>e.copy())}copyTransformed(e){return new sn(E(this.attribs),this.children.map(e))}withAttribs(e){return new sn(e,this.children)}equiv(e){return e instanceof sn&&ut(this.attribs,e.attribs)&&ut(this.children,e.children)}toHiccup(){return["g",this.attribs,...this.children.map(e=>e.toHiccup())]}}const Ni=(t,e)=>v(t)?[t,0,!1]:[t.theta?Math.floor(O/t.theta):t.dist?Math.floor(O/(t.dist/e)):t.num||wt,(t.start||0)*O,t.last===!0],ht=(t,e)=>{if(e){const n=e.__samples;return v(t)?v(n)?n:{num:t,...n}:v(n)?{...t,num:n}:{...t,...n}}return t},cu=(t,e)=>t[0]===e[0]?["V",e[1]]:t[1]===e[1]?["H",e[0]]:["L",e];class rn extends As{type="line";dim=2;constructor(e,n){super(e,n),au(this.points.length,2)}copy(){return jt(rn,this)}copyTransformed(e){return jt(rn,this,e(this.points))}withAttribs(e){return new rn(this.points,e)}toHiccup(){return[this.type,this.attribs,this.points[0],this.points[1]]}toHiccupPathSegments(){return[cu(this.points[0],this.points[1])]}}const Qo=t=>t[t.length-1],es=t=>t,Ge=t=>typeof t?.[Symbol.iterator]=="function",Dn=(t,e)=>[t[0],t[1],e];class hn{value;constructor(e){this.value=e}deref(){return this.value}}const $i=t=>new hn(t),kt=t=>t instanceof hn,lu=t=>t instanceof hn?t:new hn(t),gn=t=>t instanceof hn?t.deref():t,uu=()=>t=>{const e=t[2];return Dn(t,(n,s)=>{if(s){for(let r of gn(s)||[])if(n=e(n,r),kt(n))break}return kt(s)?lu(n):n})},fu=Mn(()=>"illegal arity"),Fr=t=>{throw new fu(t)};function ta(...t){let[e,n,s,r,i,o,a,c,l,u]=t;switch(t.length){case 0:Fr(0);case 1:return e;case 2:return(...f)=>e(n(...f));case 3:return(...f)=>e(n(s(...f)));case 4:return(...f)=>e(n(s(r(...f))));case 5:return(...f)=>e(n(s(r(i(...f)))));case 6:return(...f)=>e(n(s(r(i(o(...f))))));case 7:return(...f)=>e(n(s(r(i(o(a(...f)))))));case 8:return(...f)=>e(n(s(r(i(o(a(c(...f))))))));case 9:return(...f)=>e(n(s(r(i(o(a(c(l(...f)))))))));case 10:default:const d=(...f)=>e(n(s(r(i(o(a(c(l(u(...f))))))))));return t.length===10?d:ta(d,...t.slice(10))}}const Es=t=>ct(t,"xform")?t.xform():t;function Nn(...t){return t=t.map(Es),ta.apply(null,t)}const Z=Symbol(),Li=()=>{},du=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:Fr(t.length);function mn(...t){const e=t[0],n=e[0],s=e[1],r=e[2];t=du(t);const i=t[0]==null?n():t[0],o=t[1];return gn(s(ct(o,"$reduce")?o.$reduce(r,i):vs(o)?hu(r,i,o):gu(r,i,o)))}const hu=(t,e,n)=>{for(let s=0,r=n.length;s<r;s++)if(e=t(e,n[s]),kt(e)){e=e.deref();break}return e},gu=(t,e,n)=>{for(let s of n)if(e=t(e,s),kt(e)){e=e.deref();break}return e},Rs=(t,e)=>[t,es,e],mu=(t,e)=>{const n=e.length-1;return Ge(e[n])?e.length>1?mn(t.apply(null,e.slice(0,n)),e[n]):mn(t(),e[0]):void 0};function oe(t){return t?[...t]:Rs(()=>[],(e,n)=>(e.push(n),e))}function*ea(t,e){const n=Es(t)(oe()),s=n[1],r=n[2];for(let i of e){const o=r([],i);if(kt(o)){yield*gn(s(o.deref()));return}o.length&&(yield*o)}yield*gn(s([]))}function*Ss(t,e){const n=Es(t)([Li,Li,(s,r)=>r])[2];for(let s of e){let r=n(Z,s);if(kt(r)){r=gn(r.deref()),r!==Z&&(yield r);return}r!==Z&&(yield r)}}const pu=(t,e,n=Ss)=>{const s=e.length-1;return Ge(e[s])?e.length>1?n(t.apply(null,e.slice(0,s)),e[s]):n(t(),e[0]):void 0};function H(t,e){return Ge(e)?Ss(H(t),e):n=>{const s=n[2];return Dn(n,(r,i)=>s(r,t(i)))}}function ns(t,e){return Ge(e)?ea(ns(t),e):Nn(H(t),uu())}class on extends As{type="points";dim=2;copy(){return jt(on,this)}copyTransformed(e){return jt(on,this,e(this.points))}withAttribs(e){return new on(this.points,e)}toHiccup(){return[this.type,this.attribs,this.points]}}class ae extends As{type="poly3";dim=3;add(...e){this.points.push(...e)}copy(){return jt(ae,this)}copyTransformed(e){return jt(ae,this,e(this.points))}withAttribs(e){return new ae(this.points,e)}toHiccup(){return["polygon3",this.attribs,this.points]}}class pn{constructor(e,n,s){this.pos=e,this.dir=n,this.attribs=s}type="ray";dim=2;copy(){return new pn(z([],this.pos),z([],this.dir),E(this.attribs))}withAttribs(e){return new pn(this.pos,this.dir,e)}toHiccup(){return["line",this.attribs,this.pos,Qn([],this.dir,1e6,this.pos)]}}class bn{constructor(e,n,s){this.pos=e,this.dir=n,this.attribs=s}type="ray3";dim=3;copy(){return new bn(Ct([],this.pos),Ct([],this.dir),E(this.attribs))}withAttribs(e){return new bn(this.pos,this.dir,e)}toHiccup(){return["line3",this.attribs,this.pos,Js([],this.dir,1e6,this.pos)]}}class V{constructor(e=[0,0],n=1,s){this.pos=e,this.attribs=s,this.size=ts(null,K(n),pt)}type="rect";dim=2;size;copy(){return new V(z([],this.pos),z([],this.size),E(this.attribs))}withAttribs(e){return new V(this.pos,this.size,e)}min(){return z([],this.pos)}max(){return tt([],this.pos,this.size)}offset(e){const n=Qn([],this.size,.5,this.pos);return ts(null,xo(null,this.size,e*2),pt),Qn(this.pos,this.size,-.5,n),this}toHiccup(){return[this.type,this.attribs,this.pos,this.size[0],this.size[1]]}}class _n{constructor(e=[0,0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}type="sphere";dim=3;copy(){return new _n(Ct([],this.pos),this.r,E(this.attribs))}withAttribs(e){return new _n(this.pos,this.r,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.r]}}class yn{constructor(e,n,s){this.pos=e,this.body=n,this.attribs=s}type="text";dim=2;copy(){return new yn(Rt([],this.pos),this.body,E(this.attribs))}withAttribs(e){return new yn(this.pos,this.body,e)}toHiccup(){return[this.type,this.attribs,this.pos,this.body]}}const[bu,_u,Om,Tm]=Pe(Math.min),tr=bu,na=_u,[yu,vu,Au,km]=Pe(jo),le=yu,ss=vu,wu=Au,[Bm,Eu,Pm,Gm]=ys(jo),Ci=Eu,Ru=(t,e,n)=>new Le(t,wu([],e,t),n),Su=(t,e,n,s)=>Ru(t,e,s).offset(n),sa=(t,e=1)=>{const n=(o,a)=>{!o&&(o=a);for(let c=a.length;c-- >0;)o[c]=t(a[c]);return o},s=(o,a)=>(!o&&(o=a),o[0]=t(a[0]),o[1]=t(a[1]),o),r=(o,a)=>(!o&&(o=a),o[0]=t(a[0]),o[1]=t(a[1]),o[2]=t(a[2]),o),i=(o,a)=>(!o&&(o=a),o[0]=t(a[0]),o[1]=t(a[1]),o[2]=t(a[2]),o[3]=t(a[3]),o);return[G(e,n,s,r,i),s,r,i]},[Um,Iu,Fm,zm]=sa(Math.abs),Mu=Iu,Q=(t,e,n,s)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t),T=(t,e,n,s,r)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t[3]=r,t),ra=(t,e)=>t[0]*e[1]-t[1]*e[0],ia=(t,e)=>t[0]*e[0]+t[1]*e[1],zr=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],Du=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],Nu=G(0,(t,e)=>{let n=0;for(let s=t.length;s-- >0;)n+=t[s]*e[s];return n},ia,zr,Du),oa=t=>t[0]*t[0]+t[1]*t[1],aa=t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2],$u=t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3],Hr=G(0,t=>{let e=0;for(let n=t.length;n-- >0;)e+=t[n]*t[n];return e},oa,aa,$u),$n=t=>Math.sqrt(Hr(t)),Oi=(t,e,n=!1)=>{const s=Math.atan2(ra(t,e),ia(t,e));return n?jl(s):s},[Hm,Lu,qm,Vm]=Pe(bl),Ti=Lu,Cu=Math.abs,vt=(t,e,n=U)=>Cu(t-e)<=n,ca=(t,e,n=U)=>t.length===e.length&&vt(t[0],e[0],n)&&vt(t[1],e[1],n),Ou=(t,e,n=U)=>t.length===e.length&&vt(t[0],e[0],n)&&vt(t[1],e[1],n)&&vt(t[2],e[2],n),la=(t,e,n=U)=>t.length===e.length&&vt(t[0],e[0],n)&&vt(t[1],e[1],n)&&vt(t[2],e[2],n)&&vt(t[3],e[3],n),xe=G(0,(t,e,n=U)=>ct(t,"eqDelta")?t.eqDelta(e,n):ct(e,"eqDelta")?e.eqDelta(t,n):Tu(t,e,t.length,n),ca,Ou,la),Tu=(t,e,n,s=U,r=0,i=0,o=1,a=1)=>{for(;n>0;n--,r+=o,i+=a)if(!vt(t[r],e[i],s))return!1;return!0},ku=(t,e,n=U)=>{for(let s=e.length;s-- >0;)if(xe(t,e[s],n))return!0;return!1},[Bu,Ym,Wm,jm]=sa(t=>-t),Pu=Bu,[xm,Gu,Xm,Zm]=ys(Math.pow),Uu=Gu,ua=(t,e=1)=>{const n=(o,a,c,l)=>{!o&&(o=a);for(let u=a.length;u-- >0;)o[u]=t(a[u],c[u],l);return o},s=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c[0],l),o[1]=t(a[1],c[1],l),o),r=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c[0],l),o[1]=t(a[1],c[1],l),o[2]=t(a[2],c[2],l),o),i=(o,a,c,l)=>(!o&&(o=a),o[0]=t(a[0],c[0],l),o[1]=t(a[1],c[1],l),o[2]=t(a[2],c[2],l),o[3]=t(a[3],c[3],l),o);return[G(e,n,s,r,i),s,r,i]},[Jm,Fu,Km,Qm]=ua(_l),zu=Fu,Hu=(t,e,n,s=0,r=!1,i=!1)=>{const o=Mu([],n);if(ca(t,e)||o[0]<U||o[1]<U)return;s%=O;const a=zu([],t,e,.5),c=Math.cos(s),l=Math.sin(s),u=[c*a[0]+l*a[1],-l*a[0]+c*a[1]],[d,f]=Uu([],u,2),h=d/(o[0]*o[0])+f/(o[1]*o[1]);h>1&&Ee(o,o,Math.sqrt(h));const[g,m]=o,_=g*g,b=m*m,y=Math.max(0,(_*b-_*f-b*d)/(_*f+b*d)),D=(r!==i?1:-1)*Math.sqrt(y),N=[D*(g*u[1]/m),D*(-(m*u[0])/g)],dt=[c*N[0]-l*N[1]+(t[0]+e[0])/2,l*N[0]+c*N[1]+(t[1]+e[1])/2],Ut=Ti(null,ss([],u,N),o),Ls=Ti(null,ss(null,Pu([],u),N),o),Bn=Oi(Ml,Ut);let W=Oi(Ut,Ls);return!i&&W>0?W-=O:i&&W<0&&(W+=O),W%=O,{center:dt,r:o,axis:s,start:Bn,end:Bn+W,xl:r,cw:i}},qu=(t,e)=>Math.abs(t-e),Vu=(t,e=U)=>t>e?1:t<-e?-1:0,ne=(t,e,n)=>t+(e-t)*n,fa=(t,e,n,s,r,i)=>{const o=1-r,a=1-i;return t*o*a+e*r*a+n*o*i+s*r*i},Yu=(t,e,n,s,r)=>{const i=r*r,o=1-r,a=o*o;return t*a*o+e*3*a*r+n*3*i*o+s*i*r},Wu=(t,e,n,s,r)=>{const i=r-1,o=r*r,a=i*i,c=(1+2*r)*a,l=r*a,u=o*(3-2*r),d=o*i;return c*t+l*e+u*n+d*s},He=(t,e,n,s,r)=>{s*=.5;const i=-.5*t+1.5*e-1.5*n+s,o=t-2.5*e+2*n-s,a=-.5*t+.5*n,c=e,l=r*r;return r*l*i+l*o+r*a+c},da=(t,e,n,s,r,i,o,a,c,l,u,d,f,h,g,m,_,b)=>He(He(t,e,n,s,_),He(r,i,o,a,_),He(c,l,u,d,_),He(f,h,g,m,_),b),ki=(t,e,n=.5,s=0,r=2)=>n*((e-t)/(r-s)),ju=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1];return n*n+s*s},xu=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2];return n*n+s*s+r*r},Xu=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2],i=t[3]-e[3];return n*n+s*s+r*r+i*i},Ln=G(0,(t,e)=>{let n=0;for(let s=t.length;s-- >0;){const r=t[s]-e[s];n+=r*r}return n},ju,xu,Xu),Zu=(t,e)=>Math.sqrt(Ln(t,e)),[Ju,tp,ep,np]=ua(Yo),rs=Ju;function is(...t){return new Ce(...Pl(t))}var _t=(t=>(t[t.FINE=0]="FINE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.SEVERE=4]="SEVERE",t[t.NONE=5]="NONE",t))(_t||{});let Ku=0;class Qu{constructor(e,n=_t.FINE,s){this.parent=s,this.id=e||`logger-${Ku++}`,this.level=typeof n=="string"?_t[n]:n}id;level;addChild(e){return e.parent=this,e}enabled(e){return this.level<=e}fine(...e){this.log(_t.FINE,e)}debug(...e){this.log(_t.DEBUG,e)}info(...e){this.log(_t.INFO,e)}warn(...e){this.log(_t.WARN,e)}severe(...e){this.log(_t.SEVERE,e)}none(){}log(e,n){this.level<=e&&this.logEntry([e,this.id,Date.now(),...n])}}const ha=Object.freeze({level:_t.NONE,addChild(t){return t},childLogger:()=>ha,enabled:()=>!1,fine(){},debug(){},info(){},warn(){},severe(){},none(){},logEntry(){}});class qr extends Qu{set(e){this.parent=e}childLogger(e,n){return new qr(e,n??this.level,this)}logEntry(e){this.parent.logEntry(e)}}const ga=new qr("root",_t.FINE,ha),t0=ga.childLogger("defmulti"),x=Symbol();function Pt(t,e,n){const s={},r=e?e0(e):{},i=(...o)=>{const a=t(...o),c=s[a]||Xe(s,r,a)||s[x];return c?c(...o):Et(`missing implementation for: "${a.toString()}"`)};return i.add=(o,a)=>(s[o]&&t0.warn(`overwriting '${o.toString()}' impl`),s[o]=a,!0),i.addAll=o=>{let a=!0;for(let c in o)a=i.add(c,o[c])&&a;return x in o&&i.setDefault(o[x]),a},i.setDefault=o=>i.add(x,o),i.remove=o=>s[o]?(delete s[o],!0):!1,i.callable=(...o)=>{const a=t(...o);return!!(s[a]||Xe(s,r,a)||s[x])},i.isa=(o,a)=>{let c=r[o];!c&&(r[o]=c=new Set),c.add(a)},i.impls=()=>{const o=new Map;for(let a in s)o.set(a,s[a]);for(let a in r){const c=Xe(s,r,a);c&&o.set(a,c)}return s[x]&&o.set(x,s[x]),o},i.implForID=o=>s[String(o)]||Xe(s,r,o)||s[x],i.rels=()=>r,i.parents=o=>r[o],i.ancestors=o=>new Set(ma([],r,o)),i.dependencies=function*(){for(let o in r)for(let a of r[o])yield[o,a];for(let o in s)!r[o]&&(yield[o,void 0])},n&&i.addAll(n),i}const Xe=(t,e,n)=>{const s=e[n];if(s)for(let r of s){let i=t[r]||Xe(t,e,r);if(i)return i}},ma=(t,e,n)=>{const s=e[n];if(s)for(let r of s)t.push(r),ma(t,e,r);return t},e0=t=>{const e={};for(let n in t){const s=t[n];e[n]=s instanceof Set?s:Array.isArray(s)?new Set(s):new Set([s])}return e},de=t=>t.type,n0=(t,e)=>(t[0]=e,t[1]=e,t),s0=(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t),r0=(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t[3]=e,t);G(0,(t,e)=>{for(let n=t.length;n-- >0;)t[n]=e;return t},n0,s0,r0);const i0=t=>Array(t).fill(0),o0=t=>ct(t,"empty")?t.empty():i0(t.length),Vr=(t,e,n)=>{const s=le([],n,e),r=Hr(s);return r>1e-6?Nu(le([],t,e),s)/r:void 0},pa=(t,e,n,s,r=!1,i=0)=>{const o=Vr(t,e,n);if(o!==void 0&&(!r||o>=i&&o<=1-i))return s=s||o0(t),o<=0?Rt(s,e):o>=1?Rt(s,n):rs(s,e,n,o)},a0=(t,e,n=!1,s=[])=>{if(!e.length)return;const r=[],i=e.length-1;let o=1/0,a,c;for(n?(a=i,c=0):(a=0,c=1);c<=i;a=c,c++)if(pa(t,e[a],e[c],r)){const l=Ln(t,r);l<o&&(o=l,Rt(s,r))}return o<1/0?s:void 0},Yr=(t,e,n)=>(s,r,i=1)=>{!s&&(s=r);const o=Math.sqrt(t(r));return o>=U?e(s,r,i/o):s!==r?n(s,r):s},Te=Yr(Hr,ws,Rt),c0=Yr(oa,Ee,z),l0=Yr(aa,Qs,Ct);class Wr{points;index;constructor(e,n=!1){n?(this.points=e.slice(),this.points.push(e[0])):this.points=e,this.buildIndex()}totalLength(){const e=this.index;return e?e[e.length-1]:0}pointAt(e){const n=this.points,s=n.length-1;if(s<0)return;if(s===0||e<=0)return n[0];if(e>=1)return n[s];const r=this.index,i=e*r[s];for(let o=1;o<=s;o++)if(r[o]>=i)return rs([],n[o-1],n[o],(i-r[o-1])/(r[o]-r[o-1]))}closestPoint(e){return a0(e,this.points)}closestT(e){const{index:n,points:s}=this,r=[],i=[];let o=1/0,a=-1;for(let c=0,l=n.length-1;c<l;c++)if(pa(e,s[c],s[c+1],r)){const u=Ln(e,r);u<o&&(o=u,a=c,Rt(i,r))}return a>=0?xl(Vr(e,s[a],s[a+1])||0,n[a],n[a+1])/this.totalLength():void 0}segmentAt(e){let n=this.indexAt(e);if(n!==void 0)return n=Math.max(1,n),[this.points[n-1],this.points[n]]}tangentAt(e,n=1){const s=this.segmentAt(e);return s?Te(null,le([],s[1],s[0]),n):void 0}splitAt(e){if(e<=0||e>=1)return[this.points];const n=this.pointAt(e);if(!n)return;const s=Math.max(1,this.indexAt(e)),r=this.points.slice(0,s),i=this.points.slice(s);return xe(r[s-1],n)||r.push(n),xe(i[0],n)||i.unshift(n),[r,i]}splitNear(e){const n=this.closestT(e);return n!==void 0?this.splitAt(n):void 0}extractRange(e,n){if(e>n){const c=e;e=n,n=c}const s=this.pointAt(e),r=this.pointAt(n);if(!(s&&r))return;const i=Math.max(1,this.indexAt(e)),o=Math.max(1,this.indexAt(n)),a=this.points.slice(i,o);return(!a.length||!xe(a[0],s))&&a.unshift(s),xe(a[a.length-1],r)||a.push(r),a}indexAt(e){const s=this.points.length-1;if(s<0)return;if(s===0||e<=0)return 0;if(e>=1)return s;const r=this.index,i=e*r[s];for(let o=1;o<=s;o++)if(r[o]>=i)return o}sampleUniform(e,n=!1,s=[]){const{index:r,points:i}=this,o=this.totalLength(),a=e/o,c=r.length;for(let l=0,u=1;l<1;l+=a){const d=l*o;for(;d>=r[u]&&u<c;)u++;if(u>=c)break;const f=r[u-1];s.push(rs([],i[u-1],i[u],(d-f)/(r[u]-f)))}return n&&s.push(Rt([],i[i.length-1])),s}sampleFixedNum(e,n=!1,s){return this.sampleUniform(this.totalLength()/e,n,s)}buildIndex(){const e=[0],n=this.points,s=n.length;for(let r=0,i=1;i<s;r=i,i++)e[i]=e[r]+Zu(n[r],n[i]);this.index=e}}const Bi=Math.cos,Pi=Math.sin,ba=G(1),u0=ba.add(2,(t,e,n=pt)=>tt(t||e,Pr(e[1],e[0]),n));ba.add(3,(t,e,n=bt)=>{const s=e[0],r=e[1],i=e[2],o=Bi(r);return Q(t||e,s*o*Bi(i)+n[0],s*o*Pi(i)+n[1],s*Pi(r)+n[2])});const _a=(t,e,n,s,r,i)=>{if(Bt(i)&&i.dist!==void 0)return new Wr(_a(t,e,n,s,r,i.num||wt)).sampleUniform(i.dist,i.last!==!1);i=v(i)?{num:i,last:!0}:{num:wt,...i};let o=r-s,a=i.theta?Math.round(o/i.theta):i.num;o/=a,i.last!==!1&&a++;const c=new Array(a);for(let l=0;l<a;l++)c[l]=Ko(t,e,n,s+l*o);return c},Gi=(t,e,n=!1,s=!1)=>{if(f0(e)){const r=new Wr(t,n);return Bt(e)?n?e.dist?r.sampleUniform(e.dist,e.last):r.sampleFixedNum(e.num||wt,e.last):e.dist?r.sampleUniform(e.dist,e.last!==!1):r.sampleFixedNum(e.num||wt,e.last!==!1):r.sampleFixedNum(e||wt,!n)}return s?kr(t):t},f0=t=>t!==void 0&&(v(t)||t.dist!=null||t.last!=null||t.num!=null),ya=t=>function e(n,s){if(Bt(s)&&s.dist!==void 0)return new Wr(e(n,s.num||wt)).sampleUniform(s.dist,s.last!==!1);s=v(s)?{num:s,last:!0}:{num:wt,...s};const r=[];return t(r,n,s.num),s.last&&r.push(Rt([],n[n.length-1])),r},d0=ya((t,[e,n,s,r],i)=>{const o=1/i;for(let a=0;a<i;a++)t.push(iu([],e,n,s,r,a*o))}),h0=(t,e,n,s,r)=>{const i=1-r;return su(t,e,n,s,i*i,2*i*r,r*r)},g0=ya((t,[e,n,s],r)=>{const i=1/r;for(let o=0;o<r;o++)t.push(h0([],e,n,s,o*i))}),jr=(t,e=1,n=!0)=>{const s=n?(a,c,l,u)=>{!a&&(a=c);for(let d=c.length;d-- >0;)a[d]=t(c[d],l[d],u[d]);return a}:(a,c,l,u)=>{!a&&(a=u);for(let d=c.length;d-- >0;)a[d]=t(c[d],l[d],u[d]);return a},r=n?(a,c,l,u)=>(!a&&(a=c),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a):(a,c,l,u)=>(!a&&(a=u),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a),i=n?(a,c,l,u)=>(!a&&(a=c),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a):(a,c,l,u)=>(!a&&(a=u),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a),o=n?(a,c,l,u)=>(!a&&(a=c),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a[3]=t(c[3],l[3],u[3]),a):(a,c,l,u)=>(!a&&(a=u),a[0]=t(c[0],l[0],u[0]),a[1]=t(c[1],l[1],u[1]),a[2]=t(c[2],l[2],u[2]),a[3]=t(c[3],l[3],u[3]),a);return[G(e,s,r,i,o),r,i,o]},[sp,m0,rp,ip]=jr(Vo),p0=m0,yt=Pt(de,{bpatch:"points",cubic3:"cubic",group3:"group",line:"polyline",line3:"polyline",path3:"path",points3:"points",poly3:"poly",polyline3:"polyline",quad:"poly",quad3:"poly",quadratic3:"quadratic",tri:"poly",tri3:"poly"},{aabb:({pos:t,size:e})=>{const[n,s,r]=t,[i,o,a]=ve([],t,e);return[[n,s,r],[n,s,a],[i,s,a],[i,s,r],[n,o,r],[n,o,a],[i,o,a],[i,o,r]]},arc:(t,e)=>_a(t.pos,t.r,t.axis,t.start,t.end,ht(e,t.attribs)),circle:(t,e=wt)=>{e=ht(e,t.attribs);const n=t.pos,s=t.r;let[r,i,o]=Ni(e,s);const a=O/r;o&&r++;const c=new Array(r);for(let l=0;l<r;l++)c[l]=u0(null,[s,i+l*a],n);return c},complexpoly:(t,e)=>{const n=yt(t.boundary,e);for(let s of t.children)n.push(...yt(s,e));return n},cubic:(t,e)=>d0(t.points,ht(e,t.attribs)),ellipse:(t,e=wt)=>{e=ht(e,t.attribs);const n=[],s=t.pos,r=t.r;let[i,o,a]=Ni(e,Math.max(t.r[0],t.r[1]));const c=O/i;a&&i++;for(let l=0;l<i;l++)n[l]=p0([],Pr(o+l*c),r,s);return n},extra:()=>[],group:(t,e)=>(e=ht(e,t.attribs),t.children.reduce((n,s)=>n.concat(yt(s,e)),[])),path:(t,e)=>{e=ht(e,t.attribs);const n=v(e)?{num:e}:e,s=[],r=i=>{const o=Qo(i)?.type==="z";for(let a=i.length-1,c=0;c<=a;c++){const l=i[c];l.geo&&s.push(...yt(l.geo,{...n,last:!o&&c===a}))}};r(t.segments);for(let i of t.subPaths)r(i);return s},points:t=>t.points.slice(),poly:(t,e)=>Gi(t.points,ht(e,t.attribs),!0,!0),polyline:(t,e)=>Gi(t.points,ht(e,t.attribs),!1,!0),quadratic:(t,e)=>g0(t.points,ht(e,t.attribs)),rect:(t,e)=>{e=ht(e,t.attribs);const n=t.pos,s=tt([],n,t.size),r=[z([],n),[s[0],n[1]],s,[n[0],s[1]]];return e!=null?yt(new Yt(r),e):r}}),va=Pt(de,{circle:"points",complexpoly:"group",ellipse:"points",line:"points",line3:"points3",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",rect:"points",tri:"points",tri3:"points3"},{aabb:t=>{const[e,n,s,r,i,o,a,c]=yt(t);return[[o,a,c,i],[r,e,n,s],[s,r,c,a],[e,n,o,i],[n,s,a,o],[r,e,i,c]].map(l=>new ae(kr(l),je(t)))},arc:(t,e)=>{const n=[Tr(t.pos),...yt(t,e)];return[new Yt(n,je(t))]},group:(t,e)=>[...ns(n=>va(n,e),t)],path:(t,e)=>Ui(Yt,t,e),path3:(t,e)=>Ui(ae,t,e),points:(t,e)=>[new Yt(yt(t,e),je(t))],points3:(t,e)=>[new ae(yt(t,e),je(t))]}),Ui=(t,e,n)=>{const s=e.empty();return s.attribs=e.attribs,[e.segments,...e.subPaths].map(r=>(s.segments=r,new t(yt(s,n),je(e))))},os=(t,e)=>t-e*Math.floor(t/e),P=t=>t-Math.floor(t),Fi=(t,e=1)=>Math.round(t/e)*e,he=(t={},e)=>new sn(t,e);function b0(...t){return ou(rn,t)}const an=(t,e,n)=>{const s=t[0],r=t[1];return(e[0]-s)*(n[1]-r)-(n[0]-s)*(e[1]-r)},_0=(t,e,n,s=U)=>Vu(an(t,e,n),s),y0=(t,e,n,s=U)=>_0(t,e,n,s)<0,zi=(t,e)=>e!==0?t/e:0,v0=(t,e,n,s=!0,r=!0)=>{const i=n>0?s?function(){return this.buf[this.offset+n*this.stride]}:function(){return this.buf[this.offset+n]}:function(){return this.buf[this.offset]},o=n>0?s?function(a){this.buf[this.offset+n*this.stride]=a}:function(a){this.buf[this.offset+n]=a}:function(a){this.buf[this.offset]=a};r&&Object.defineProperty(t,n,{get:i,set:o,enumerable:!0}),Object.defineProperty(t,e,{get:i,set:o,enumerable:!0})},A0=(t,e,n,s)=>e.forEach((r,i)=>v0(t,r,i,n,s)),vn=t=>typeof t=="function";function Aa(t,e=Object.create(null)){return(...n)=>{const s=JSON.stringify(n);return s!==void 0?s in e?e[s]:e[s]=t.apply(null,n):t.apply(null,n)}}function wa(t,e=Object.create(null)){return(...n)=>{const s=n.join("-");return s in e?e[s]:e[s]=t(...n)}}const w0=wa((t,e)=>t.repeat(e)),Ea=Aa((t,e=!1)=>e?n=>E0(n)||n.toFixed(t):n=>n.toFixed(t)),E0=t=>isNaN(t)?"NaN":t===1/0?"+∞":t===-1/0?"-∞":void 0,R0={5120:"i8",5121:"u8",5122:"i16",5123:"u16",5124:"i32",5125:"u32",5126:"f32"},S0={i8:5120,u8:5121,u8c:5121,i16:5122,u16:5123,i32:5124,u32:5125,f32:5126,f64:void 0},I0={i8:0,u8:0,u8c:0,i16:1,u16:1,i32:2,u32:2,i64:3,u64:3,f32:2,f64:3},M0={f32:Float32Array,f64:Float64Array},D0={i8:Int8Array,i16:Int16Array,i32:Int32Array},N0={u8:Uint8Array,u8c:Uint8ClampedArray,u16:Uint16Array,u32:Uint32Array},$0={i64:BigInt64Array,u64:BigUint64Array},er={...M0,...D0,...N0},L0=t=>{const e=R0[t];return e!==void 0?e:t},Ra=t=>{const e=S0[t];return e!==void 0?e:t};function xn(t,...e){const n=$0[t];return new(n||er[L0(t)])(...e)}const C0=t=>{if(Array.isArray(t))return"f64";for(let e in er)if(t instanceof er[e])return e;return"f64"},O0=t=>t>16?"u32":t>8?"u16":"u8",T0=(t,e,n,s,r,i)=>{const o=[];for(;n-- >0;)o.push(new t(e,s,r)),s+=i;return o},[op,ap,cp,k0]=jr(ft),B0=k0,Cs=(t,e,n=0,s=0,r=1,i=1)=>t[n]*e[s]+t[n+r]*e[s+i]+t[n+2*r]*e[s+2*i],S=(t,e,n=0,s=0,r=1,i=1)=>t[n]*e[s]+t[n+r]*e[s+i]+t[n+2*r]*e[s+2*i]+t[n+3*r]*e[s+3*i],as=(t,e,n,s,r,i)=>(!t&&(t=e),t[0]=st(e[0],n[0],s[0],r[0],i[0]),t[1]=st(e[1],n[1],s[1],r[1],i[1]),t),P0=(t,e,n,s,r,i)=>(!t&&(t=e),t[0]=st(e[0],n[0],s[0],r[0],i[0]),t[1]=st(e[1],n[1],s[1],r[1],i[1]),t[2]=st(e[2],n[2],s[2],r[2],i[2]),t),G0=(t,e,n,s,r,i)=>(!t&&(t=e),t[0]=st(e[0],n[0],s[0],r[0],i[0]),t[1]=st(e[1],n[1],s[1],r[1],i[1]),t[2]=st(e[2],n[2],s[2],r[2],i[2]),t[3]=st(e[3],n[3],s[3],r[3],i[3]),t);G(1,(t,e,n,s,r,i)=>{!t&&(t=e);for(let o=e.length;o-- >0;)t[o]=st(e[o],n[o],s[o],r[o],i[o]);return t},as,P0,G0);function*U0(t,e,n,s){for(;e-- >0;)yield t[n],n+=s}const Hi=(t,e)=>(t>>>e|t<<32-e)>>>0,[F0,lp,up,fp]=jr(Yo),z0=F0,Sa=G(1,(t,e,n,s=fe)=>{!t&&(t=e);for(let r=e.length;r-- >0;)t[r]=s.minmax(e[r],n[r]);return t});function*Ia(t,e=!0,n=!1){if(t>0)for(let s=0,r=e?t+1:t;s<r;s++)yield n?1-s/t:s/t}function Ot(...t){return H0(Ot,mn,t)}const H0=(t,e,n)=>{let s,r;switch(n.length){case 4:r=n[3],s=n[2];break;case 3:r=n[2];break;case 2:return H(i=>t(n[0],n[1],i));default:Fr(n.length)}return e(Es(n[0])(n[1]),s,r)};function*nr(...t){const e=t.map(n=>n[Symbol.iterator]());for(;;){const n=[];for(let s of e){let r=s.next();if(r.done)return;n.push(r.value)}yield n}}function ue(...t){return new V(...Bl(t))}const q0=(t,e,n)=>new V(t,ss([],e,t),n),me=(t,e,n,s)=>q0(t,e,s).offset(n),Ze=(t,e,n)=>(e=K(e),new V(Qn([],e,-.5,t),e,n)),Ma=(t,e)=>n=>n.map(s=>s.geo?{type:s.type,geo:t(s.geo)}:s.point?{type:s.type,point:e(s.point)}:{...s}),sr=Pt(de,{bpatch:"points",complexpoly:"group",cubic:"points",cubic3:"points3",group3:"group",line:"points",line3:"points3",path3:"path",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",quadratic:"points",quadratic3:"points3",tri:"points",tri3:"points3"},{aabb:(t,e)=>(e=K(e,3),new Le(ze([],t.pos,e),ze([],t.size,e),E(t.attribs))),arc:(t,e)=>{e=K(e);const n=t.copy();return j(null,n.pos,e),j(null,n.r,e),n},circle:(t,e)=>v(e)?new Ce(Ee([],t.pos,e),t.r*e,E(t.attribs)):new Oe(j([],t.pos,e),Ee([],e,t.r),E(t.attribs)),ellipse:(t,e)=>(e=K(e),new Oe(j([],t.pos,e),j([],t.r,e),E(t.attribs))),extra:t=>t,group:(t,e)=>t.copyTransformed(n=>sr(n,e)),path:(t,e)=>(e=K(e),t.copyTransformed(Ma(n=>sr(n,e),n=>Kl([],n,e)))),points:(t,e)=>t.copyTransformed(n=>n.map(v(e)?s=>Ee([],s,e):s=>j([],s,e))),points3:(t,e)=>t.copyTransformed(n=>n.map(v(e)?s=>Qs([],s,e):s=>ze([],s,e))),ray:(t,e)=>(e=K(e),new pn(j([],t.pos,e),c0(null,j([],t.dir,e)),E(t.attribs))),ray3:(t,e)=>(e=K(e),new bn(ze([],t.pos,e),l0(null,ze([],t.dir,e)),E(t.attribs))),rect:(t,e)=>(e=K(e),new V(j([],t.pos,e),j([],t.size,e),E(t.attribs))),sphere:(t,e)=>v(e)?new _n(Qs([],t.pos,e),t.r*e,E(t.attribs)):Et("can't non-uniformly scale sphere"),text:(t,e)=>new yn(j([],t.pos,K(e)),t.body,E(t.attribs))}),rr=Pt(de,{bpatch:"points",cubic:"points",cubic3:"points3",complexpoly:"group",group3:"group",line:"points",line3:"points3",path3:"path",poly:"points",poly3:"points3",polyline:"points",polyline3:"points3",quad:"points",quad3:"points3",quadratic:"points",quadratic3:"points3",tri:"points",tri3:"points3"},{aabb:(t,e)=>new Le(ve([],t.pos,e),Ct([],t.size),E(t.attribs)),arc:(t,e)=>{const n=t.copy();return tt(null,n.pos,e),n},circle:(t,e)=>new Ce(tt([],t.pos,e),t.r,E(t.attribs)),ellipse:(t,e)=>new Oe(tt([],t.pos,e),z([],t.r),E(t.attribs)),extra:t=>t,group:(t,e)=>t.copyTransformed(n=>rr(n,e)),path:(t,e)=>t.copyTransformed(Ma(n=>rr(n,e),n=>Tt([],n,e))),points:(t,e)=>t.copyTransformed(n=>n.map(s=>tt([],s,e))),points3:(t,e)=>t.copyTransformed(n=>n.map(s=>ve([],s,e))),ray:(t,e)=>new pn(tt([],t.pos,e),t.dir,E(t.attribs)),ray3:(t,e)=>new bn(ve([],t.pos,e),t.dir,E(t.attribs)),rect:(t,e)=>new V(tt([],t.pos,e),z([],t.size),E(t.attribs)),sphere:(t,e)=>new _n(ve([],t.pos,e),t.r,E(t.attribs)),text:(t,e)=>new yn(tt([],t.pos,e),t.body,E(t.attribs))}),V0=t=>{const e=t.length-1;if(e<2)return 0;let n=0,s=t[e],r=t[0];for(let i=0;i<=e;s=r,r=t[++i])n+=ra(s,r);return n/2},se=Pt(de,{group3:"group",quad:"poly"},{[x]:()=>0,aabb:({size:[t,e,n]})=>2*(t*e+t*n+e*n),arc:t=>.5*Math.abs(t.start-t.end)*t.r[0]*t.r[1],circle:t=>it*t.r**2,complexpoly:(t,e)=>se(t.boundary,e)-t.children.reduce((n,s)=>n+se(s,e),0),ellipse:t=>it*t.r[0]*t.r[1],group:({children:t})=>t.reduce((e,n)=>e+se(n,!1),0),path:(t,e)=>t.closed?va(t).reduce((n,s)=>n+se(s,e),0):0,plane:()=>1/0,poly:(t,e)=>{const n=V0(t.points);return e?n:Math.abs(n)},rect:t=>t.size[0]*t.size[1],sphere:t=>4*it*t.r**2,tri:(t,e)=>{const n=.5*an(...t.points);return e?n:Math.abs(n)}}),B=t=>typeof t=="string",cn={},qi=(t,e)=>{for(let n in e){const s=e[n];if(I(s)){const[r,i,o,a]=s;e[n]=s.length===2?(c,l)=>i(c,r(c,l)):s.length===3?(c,l)=>o(c,i(c,r(c,l))):(c,l)=>a(c,o(c,i(c,r(c,l))))}}cn[t]={...cn[t],...e}},Da=(t,e,n,s)=>{const r=cn[n];M(!!r,`no conversions available for ${n}`);let i=r[s];return i?i(t,e):cn.rgb[s]?r.rgb(t,cn.rgb[s]([],e)):Et(`can't convert: ${s} -> ${n}`)},Y0=(t=0)=>e=>(e*100).toFixed(t)+"%",W0=[.299,.587,.114],Na=[.2126,.7152,.0722],j0=[3.1338561,-.9787684,.0719453,-1.6168667,1.9161415,-.2289914,-.4906146,.033454,1.4052427],x0=[3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252],X0=[.96422,1,.82521],Z0=[.95047,1,1.08883];let cs=Ea(3),Vi=Y0(3);const rt=1/255,Y=(t,e=1)=>t!=null?w(t):e,J0=t=>{if(typeof t[0]=="number")switch(t.length){case 1:return t.push(0,0,1),[t];case 2:return t.push(0,1),[t];case 3:return t.push(1),[t];default:return[t]}return t},$a=t=>{const e=cs(P(t[0])*360),n=Vi(w(t[1])),s=Vi(w(t[2])),r=Y(t[3]);return r<1?`hsla(${e},${n},${s},${cs(r)})`:`hsl(${e},${n},${s})`},Yi=(t,e,n=1)=>T(t||e,w(e[0]),w(e[1]),w(e[2]),Y(e[3],n)),xr=(t,e,n=1)=>T(t||e,P(e[0]),w(e[1]),w(e[2]),Y(e[3],n)),K0=(t,e)=>{t=xr(t||e,e);const n=t[1],s=t[2],r=(2-n)*s/2;return t[2]=r,t[1]=r&&r<1?n*s/(r<.5?r*2:2-r*2):n,t},Q0=t=>$a(K0([],t)),Wi="0123456789abcdef",ir=t=>Wi[t>>>4&15]+Wi[t&15],tf=t=>ir(t>>>8)+ir(t&255),ef=t=>ir(t>>>16)+tf(t),Xr=wa((t,e,n="")=>{const s=w0("0",e);return r=>(r=(r>>>0).toString(t),n+(r.length<e?s.substring(r.length)+r:r))});Xr(2,8);Xr(2,16);Xr(2,32);const La=ef,or=t=>{const e=t>>>24;return e<255?`rgba(${t>>16&255},${t>>8&255},${t&255},${cs(e*rt)})`:`#${La(t&16777215)}`},nf=t=>(t&255)<<16|t>>16&255|t&4278255360,sf=nf,Ca=(t,e,n,s=!1)=>{const r=Cs(e,n,0,0,3),i=Cs(e,n,1,0,3),o=Cs(e,n,2,0,3),a=Y(n[3]);return s?T(t||n,w(r),w(i),w(o),a):T(t||n,r,i,o,a)},rf=(t,e,n,s=!0)=>{t=T(t||n,n[0],n[1],n[2],Y(n[3]));const r=S(t,e,0,0)+e[4],i=S(t,e,0,5)+e[9],o=S(t,e,0,10)+e[14],a=S(t,e,0,15)+e[19];return s?T(t,w(r),w(i),w(o),w(a)):T(t,r,i,o,a)},of=(t,e)=>[S(e,t,0,0,1,5),S(e,t,0,1,1,5),S(e,t,0,2,1,5),S(e,t,0,3,1,5),S(e,t,0,4,1,5)+e[4],S(e,t,5,0,1,5),S(e,t,5,1,1,5),S(e,t,5,2,1,5),S(e,t,5,3,1,5),S(e,t,5,4,1,5)+e[9],S(e,t,10,0,1,5),S(e,t,10,1,1,5),S(e,t,10,2,1,5),S(e,t,10,3,1,5),S(e,t,10,4,1,5)+e[14],S(e,t,15,0,1,5),S(e,t,15,1,1,5),S(e,t,15,2,1,5),S(e,t,15,3,1,5),S(e,t,15,4,1,5)+e[19]],Os=t=>{const e=t**3;return e>.008856?e:(t-16/116)/7.787},Oa=(t,e,n=X0)=>{const s=(e[0]+.16)/1.16;return T(t||e,Os(e[1]/5+s)*n[0],Os(s)*n[1],Os(s-e[2]/2)*n[2],Y(e[3]))},af=(t,e)=>Oa(t,e,Z0),Ta=(t,e)=>{let{1:n,2:s}=e;s*=O;const r=Y(e[3]);return n>0?T(t||e,e[0],Math.cos(s)*n,Math.sin(s)*n,r):T(t||e,e[0],0,0,r)},Zr=(t,e,n=j0)=>Ca(t,n,e),ar=(t,e)=>Zr(t,e,x0),ls=(t,e)=>Zr(null,Oa(t,e)),ka=(t,e)=>ar(null,af(t,e)),Ts=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,ks=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4),ln=(t,e)=>T(t||e,Ts(e[0]),Ts(e[1]),Ts(e[2]),Y(e[3])),Bs=(t,e=0)=>(t<0?0:t>1?1:t)*255+.5<<e,Ae=t=>{const e=Bs(t[0]),n=Bs(t[1]),s=Bs(t[2]),r=Y(t[3]);return r<1?`rgba(${e},${n},${s},${cs(r)})`:`#${La(e<<16|n<<8|s)}`},cf=t=>Ae(ln([],t)),Ba={abgr32:t=>or(sf(t[0])),argb32:t=>or(t[0]),hsl:$a,hsv:Q0,lab50:t=>Ae(ln(null,ls([],t))),lab65:t=>Ae(ln(null,ka([],t))),lch:t=>Ae(ln(null,ls(null,Ta([],t)))),rgb:cf,srgb:Ae};({...Ba});let lf=Ba;const An=(t,e=lf)=>{let n;return B(t)?t:v(t)?or(t):t.mode?(n=e[t.mode])?n(t):e.rgb(Da([],t,"rgb",t.mode)):Ae(t)},uf=t=>t!=null&&typeof t.deref=="function",ff=t=>uf(t)?t.deref():t,df=t=>t!=null&&typeof t!="string"&&typeof t[Symbol.iterator]=="function",hf=(t,e,n,s,r)=>{const i=z([],Il),o=z([],Sl),a=[],c=l=>{Ko(t,e,n,l,a),na(null,i,a),ts(null,o,a)};if(c(s),c(r),s>r){const l=s;s=r,r=l}for(let l=Fi(s,jn),u=Fi(r,jn);l<u;l+=jn)Zo(l,s,r)&&c(l);return[i,o]},ji=(t,e=0,n=t.length)=>{let s=1/0,r=1/0,i=-1/0,o=-1/0;for(let a=e;a<n;a++){const[c,l]=t[a];c<s&&(s=c),c>i&&(i=c),l<r&&(r=l),l>o&&(o=l)}return[[s,r],[i,o]]},gf=(t,e=0,n=t.length)=>{let s=1/0,r=1/0,i=1/0,o=-1/0,a=-1/0,c=-1/0;for(let l=e;l<n;l++){const[u,d,f]=t[l];u<s&&(s=u),u>o&&(o=u),d<r&&(r=d),d>a&&(a=d),f<i&&(i=f),f>c&&(c=f)}return[[s,r,i],[o,a,c]]},mf=(t,e,n,s,r,i,o)=>{t[n]=Math.min(s,o),e[n]=Math.max(s,o);const a=-s+r,c=s-2*r+i,l=-s+3*r-3*i+o;let u=c*c-a*l;if(u>0){u=Math.sqrt(u);const d=f=>{if(f>0&&f<1){const h=Yu(s,r,i,o,f);t[n]=Math.min(t[n],h),e[n]=Math.max(e[n],h)}};d(a/(-c-u)),d(a/(-c+u))}},xi=(t,e,n,s)=>{const r=[],i=[];for(let o=t.length;o-- >0;)mf(r,i,o,t[o],e[o],n[o],s[o]);return[r,i]},pf=(t,e,n)=>{const s=w((t-e)/(t-2*e+n)),r=1-s;return r*r*t+2*r*s*e+s*s*n},bf=(t,e,n)=>{for(let s=t.length;s-- >0;)if(!Zo(t[s],e[s],n[s]))return!1;return!0},_f=(t,e,n)=>{const s=tr([],t,n),r=Ks([],t,n);if(!bf(e,s,r)){const i=[];for(let o=t.length;o-- >0;)i[o]=pf(t[o],e[o],n[o]);tr(null,s,i),Ks(null,r,i)}return[s,r]};function Wt(t,e){return Ge(e)?Ss(Wt(t),e):n=>{const s=n[2];return Dn(n,(r,i)=>t(i)?s(r,i):r)}}const Ps=(t,e)=>{let n=t.length-1;if(n<0)return;let s=e(t[n]);if(!s)return;let{pos:r,size:i}=s;for(;n-- >0;)s=e(t[n]),s&&([r,i]=yf(r,i,s.pos,s.size));return[r,i]},yf=(t,e,n,s)=>{const r=Tt([],t,e),i=Tt([],n,s),o=tr([],t,n);return[o,le(null,Ks(null,r,i),o)]},Xn=Pt(de,{aabb:"rect",bpatch:"points",poly:"points",polyline:"points",quad:"points",tri:"points"},{arc:(t,e=0)=>me(...hf(t.pos,t.r,t.axis,t.start,t.end),e),bpatch:({points:t},e=0)=>me(...ji([...ns(n=>xi(...n),[[t[0],t[1],t[2],t[3]],[t[3],t[7],t[11],t[15]],[t[12],t[13],t[14],t[15]],[t[0],t[4],t[8],t[12]]])]),e),circle:(t,e=0)=>new V(Ci([],t.pos,t.r+e),Ee(null,[2,2],t.r+e)),complexpoly:(t,e=0)=>{const n=Ps([t.boundary,...t.children],Xn);return n?new V(...n).offset(e):void 0},cubic:({points:t},e=0)=>me(...xi(t[0],t[1],t[2],t[3]),e),ellipse:(t,e=0)=>{const n=xo([],t.r,e);return new V(ss([],t.pos,n),j(null,[2,2],n))},extra:()=>{},group:(t,e=0)=>{const n=Ps(t.children,Xn);return n?new V(...n).offset(e):void 0},line:({points:[t,e]},n=0)=>me(na([],t,e),ts([],t,e),n),path:(t,e=0)=>{const n=r=>Ss(Nn(H(i=>i.geo),Wt(i=>!!i)),r),s=Ps([...n(t.segments),...ns(n,t.subPaths)],Xn);return s?new V(...s).offset(e):void 0},points:(t,e=0)=>me(...ji(t.points),e),points3:(t,e=0)=>Su(...gf(t.points),e),quadratic:({points:t},e=0)=>me(..._f(t[0],t[1],t[2]),e),rect:(t,e=0)=>e===0?t.copy():t.copy().offset(e),text:(t,e=0)=>new V(Ci([],t.pos,e),e*2)}),Pa=(t,e,n,s=U)=>{const r=Vr(t,e,n);return r!==void 0?Ln(t,rs([],e,n,w(r)))<s*s:!1},vf=(t,e,n,s=U)=>{const r=e.length;let[i,o]=[0,1];for(;o<r;i=o,o++)if(Pa(t,e[i],e[o],s))return!0;return!1},Af=(t,e,n)=>Ln(e,t)<=n*n,wf=(t,e,n,s)=>{const r=y0(e,n,s)?1:-1;return r*an(e,s,t)>=0&&r*an(n,e,t)>=0&&r*an(s,n,t)>=0},Gs=(t,e)=>{const n=e.length-1,s=t[0],r=t[1];let i=e[n],o=e[0],a=0;for(let c=0;c<=n;i=o,o=e[++c])a=Ef(s,r,i[0],i[1],o[0],o[1],a);return a},Ef=(t,e,n,s,r,i,o)=>(s<e&&i>=e||i<e&&s>=e)&&(n<=t||r<=t)?o^~~(n+(e-s)/(i-s)*(r-n)<t):o,Jr=G(0),Rf=Jr.add(2,([t,e],n,s)=>t>=n[0]&&t<=n[0]+s[0]&&e>=n[1]&&e<=n[1]+s[1]),Sf=Jr.add(3,([t,e,n],s,r)=>t>=s[0]&&t<=s[0]+r[0]&&e>=s[1]&&e<=s[1]+r[1]&&n>=s[2]&&n<=s[2]+r[2]);Jr.default((t,e,n)=>{for(let s=t.length;s-- >0;){const r=t[s],i=e[s];if(r<i||r>i+n[s])return!1}return!0});const Kr=G(0);Kr.add(2,([t,e],n,s)=>t>=n[0]-s[0]&&t<=n[0]+s[0]&&e>=n[1]-s[1]&&e<=n[1]+s[1]);Kr.add(3,([t,e,n],s,r)=>t>=s[0]-r[0]&&t<=s[0]+r[0]&&e>=s[1]-r[1]&&e<=s[1]+r[1]&&n>=s[2]-r[2]&&n<=s[2]+r[2]);Kr.default((t,e,n)=>{for(let s=t.length;s-- >0;){const r=t[s],i=e[s],o=n[s];if(r<i-o||r>i+o)return!1}return!0});const xt=Pt(de,{group3:"group",points3:"points",quad:"poly",sphere:"circle"},{[x]:()=>!1,aabb:(t,e)=>Sf(e,t.pos,t.size),circle:(t,e)=>Af(e,t.pos,t.r),complexpoly:(t,e)=>Gs(e,t.boundary.points)?!t.children.some(n=>Gs(e,n.points)):!1,group:(t,e)=>t.children.some(n=>xt(n,e)),line:(t,e)=>Pa(e,t.points[0],t.points[1]),points:({points:t},e)=>ku(e,t),poly:(t,e)=>Gs(e,t.points)>0,polyline:(t,e)=>vf(e,t.points),rect:(t,e)=>Rf(e,t.pos,t.size),tri:(t,e)=>wf(e,...t.points)}),Xi=(t,e,n=fe,s=[])=>{const r=Xn(t);if(!r)return;const i=r.pos,o=r.max();for(;e-- >0;)for(;;){const a=Sa([],i,o,n);if(xt(t,a)){s.push(a);break}}return s};function Ga(...t){return pu(Ga,t)||(e=>{const n=e[2],s=t[0];let r=t[1]||0;return Dn(e,(i,o)=>n(i,s(r++,o)))})}function Ua(t,e,n){return new If(t,e,n)}class If{from;to;step;constructor(e,n,s){e===void 0?(e=0,n=1/0):n===void 0&&(n=e,e=0),s=s===void 0?e<n?1:-1:s,this.from=e,this.to=n,this.step=s}*[Symbol.iterator](){let{from:e,to:n,step:s}=this;if(s>0)for(;e<n;)yield e,e+=s;else if(s<0)for(;e>n;)yield e,e+=s}$reduce(e,n){const s=this.step;if(s>0)for(let r=this.from,i=this.to;r<i&&!kt(n);r+=s)n=e(n,r);else for(let r=this.from,i=this.to;r>i&&!kt(n);r+=s)n=e(n,r);return n}}const Mf=(t,e)=>t===e?0:t==null?e==null?0:-1:e==null?t==null?0:1:typeof t.compare=="function"?t.compare(e):typeof e.compare=="function"?-e.compare(t):t<e?-1:t>e?1:0,Df=t=>typeof t=="string",Nf=(t,e,n)=>{const s={expire:1e4,utf8:!1,...n};Df(e)&&s.utf8&&(e=new TextEncoder().encode(e),s.mime+=";charset=UTF-8");const r=URL.createObjectURL(e instanceof Blob?e:new Blob([e],{type:s.mime})),i=document.createElement("a");i.setAttribute("download",t),i.setAttribute("href",r),document.body.appendChild(i),i.click(),document.body.removeChild(i),s.expire>0&&setTimeout(()=>URL.revokeObjectURL(r),s.expire)},$f=(t,e,n="png",s=.95)=>{const r=`image/${n}`;t.toBlob(i=>i?Nf(`${e}.${n}`,i,{mime:r}):console.warn("can't download canvas"),r,s)},Lf=[0,31,59,90,120,151,181,212,243,273,304,334],Cf=1e3,Of=60*Cf,Tf=(t,e)=>typeof t?.[e]=="function",kf=t=>typeof t=="number",Fa=t=>typeof t=="string",Bf=t=>Fa(t)||kf(t)?new Date(t):Tf(t,"toDate")?t.toDate():t,za=t=>!(t%4)&&(!!(t%100)||!(t%400));function Ha(t,e=Object.create(null)){return(...n)=>{const s=n.join("-");return s in e?e[s]:e[s]=t(...n)}}const Pf=Ha((t,e)=>t.repeat(e)),Qr=Ha((t,e=" ")=>{const n=Pf(String(e),t);return(s,r)=>s==null?n:(s=s.toString(),r=r!==void 0?r:s.length,r<t?n.substring(r)+s:s)}),gt=Qr(2,"0"),Gf=Qr(3,"0"),Uf=Qr(4,"0"),Ff=t=>typeof t=="function",zf={months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],sepHM:".",date:["dd","/DM","MM","/MY","yyyy"],time:["h","/HM","mm"," ","a"],units:{y:{s:"y",p:"y"},M:{s:"m",p:"m"},d:{s:"d",p:"d"},h:{s:"h",p:"h"},m:{s:"min",p:"min"},s:{s:"s",p:"s"},t:{s:"ms",p:"ms"}},less:"< %s",past:"%s ago",now:"just now",future:"in %s"},Hf=t=>{const e={sepED:" ",sepDM:"/",sepMY:"/",sepHM:":",date:["E","/ED","d","/DM","MMM","/MY","yyyy"],time:["H","/HM","mm"],...t};return!e.dateTime&&(e.dateTime=[...e.date,", ",...e.time]),e};let pe=Hf(zf);const qf=(t,e,n)=>Lf[e]+n+~~(e>1&&za(t)),Vf=(t,e,n)=>{const s=new Date(Date.UTC(t,0,1)).getDay()||7;if(!e){if(s===5&&n<4)return 53;if(s===6&&n<3)return 52+~~za(t-1);if(s===7&&n<2)return 52}const r=(s<5?8:15)-s;return Math.ceil((qf(t,e,n)-r)/7+1)},cr={yyyy:t=>Uf(t.getFullYear()),yy:t=>gt(t.getFullYear()%100),MMM:t=>pe.months[t.getMonth()],MM:t=>gt(t.getMonth()+1),M:t=>String(t.getMonth()+1),dd:t=>gt(t.getDate()),d:t=>String(t.getDate()),E:t=>pe.days[t.getDay()],ww:t=>gt(cr.w(t,!1)),w:t=>String(Vf(t.getFullYear(),t.getMonth(),t.getDate())),q:t=>String((t.getMonth()/3|0)+1),HH:t=>gt(t.getHours()),H:t=>String(t.getHours()),hh:t=>{const e=t.getHours()%12;return gt(e>0?e:12)},h:t=>{const e=t.getHours()%12;return String(e>0?e:12)},mm:t=>gt(t.getMinutes()),m:t=>String(t.getMinutes()),ss:t=>gt(t.getSeconds()),s:t=>String(t.getSeconds()),SS:t=>Gf(t.getMilliseconds()),S:t=>String(t.getMilliseconds()),A:t=>t.getHours()<12?"AM":"PM",a:t=>t.getHours()<12?"am":"pm",Z:(t,e=!1)=>{const n=e?0:t.getTimezoneOffset(),s=Math.abs(n);return`${n<0?"+":"-"}${gt(s/60|0)}:${gt(s%60)}`},ZZ:(t,e=!1)=>e?"Z":cr.Z(t,e),"/DM":()=>pe.sepDM,"/ED":()=>pe.sepED,"/HM":()=>pe.sepHM,"/MY":()=>pe.sepMY},Yf=t=>(e=Date.now(),n=!1)=>{let s=Bf(e);return n&&(s=new Date(s.getTime()+s.getTimezoneOffset()*Of)),t.map(r=>Fa(r)?r.startsWith("\\")?r.substring(1):cr[r]?.(s,n)??r:Ff(r)?r(s,n):r).join("")},Wf=Yf(["yyyy","MM","dd","-","HH","mm","ss"]),jf={WEBGL_draw_buffers:{gl:!0,alias:"GL_EXT_draw_buffers"},OES_standard_derivatives:{gl:!0,alias:"GL_OES_standard_derivatives"}};var ti=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(ti||{});const qa={fragColor:["vec4",0]};var Cn=(t=>(t[t.ALPHA=6406]="ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.R16F=33325]="R16F",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32F=33326]="R32F",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.R8=33321]="R8",t[t.R8_SNORM=36756]="R8_SNORM",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.RED=6403]="RED",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RG16F=33327]="RG16F",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32F=33328]="RG32F",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RG8=33323]="RG8",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RGB=6407]="RGB",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB16I=36233]="RGB16I",t[t.RGB16UI=36215]="RGB16UI",t[t.RGB32F=34837]="RGB32F",t[t.RGB32I=36227]="RGB32I",t[t.RGB32UI=36209]="RGB32UI",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.RGB8=32849]="RGB8",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGB8I=36239]="RGB8I",t[t.RGB8UI=36221]="RGB8UI",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA=6408]="RGBA",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGBA16F=34842]="RGBA16F",t[t.RGBA16I=36232]="RGBA16I",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGBA32F=34836]="RGBA32F",t[t.RGBA32I=36226]="RGBA32I",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGBA4=32854]="RGBA4",t[t.RGBA8=32856]="RGBA8",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGBA8I=36238]="RGBA8I",t[t.RGBA8UI=36220]="RGBA8UI",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t))(Cn||{}),Je=(t=>(t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t))(Je||{}),Re=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t))(Re||{}),us=(t=>(t[t.LINEAR=9729]="LINEAR",t[t.NEAREST=9728]="NEAREST",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t))(us||{}),fs=(t=>(t[t.REPEAT=10497]="REPEAT",t[t.CLAMP=33071]="CLAMP",t[t.REPEAT_MIRROR=33648]="REPEAT_MIRROR",t))(fs||{});const p=(t,e,n,s=!1,r=!1,i=s)=>({format:t,types:e,render:s,renderExt:i,filter:r,num:n}),un={6406:p(6406,[5121,1,5131,2,36193,2,5126,4],1,!0,!0),6402:p(6402,[5123,2,5125,4],1,!0),33189:p(6402,[5123,2,5125,4],1,!0),33190:p(6402,[5125,4],1,!0),36012:p(6402,[5126,4],1,!0),34041:p(34041,[34042,4],1,!0),35056:p(34041,[34042,4],1,!0),36013:p(34041,[36269,4],1,!0),6410:p(6410,[5121,2,5131,4,36193,4,5126,8],2,!0,!0),6409:p(6409,[5121,1,5131,2,36193,2,5126,4],1,!0,!0),35898:p(6407,[5126,12,5131,6,35899,4],3,!1,!0,!0),33325:p(6403,[5126,4,5131,2],1,!1,!0,!0),33331:p(36244,[5122,2],1,!0),33332:p(36244,[5123,2],1,!0),33326:p(6403,[5126,4],1,!1,!1,!0),33333:p(36244,[5124,4],1,!0),33334:p(36244,[5125,4],1,!0),36756:p(6403,[5120,1],1,!1,!0),33321:p(6403,[5121,1],1,!0,!0),33329:p(36244,[5120,1],1,!0),33330:p(36244,[5121,1],1,!0),33327:p(33319,[5126,8,5131,4],2,!1,!0,!0),33337:p(33320,[5122,4],2,!0),33338:p(33320,[5123,4],2,!0),33328:p(33319,[5126,8],2,!1,!1,!0),33339:p(33320,[5124,8],2,!0),33340:p(33320,[5125,8],2,!0),36757:p(33319,[5120,2],2,!1,!0),33323:p(33319,[5121,2],2,!0,!0),33335:p(33320,[5120,2],2,!0),33336:p(33320,[5121,2],2,!0),6407:p(6407,[5121,3,5131,6,36193,6,5126,12,33635,2],3,!0,!0),32857:p(6408,[33640,4],4,!0,!0),36975:p(36249,[33640,4],4,!0),34843:p(6407,[5126,12,5131,6],3,!1,!0),36233:p(36248,[5122,6],3),36215:p(36248,[5123,6],3),34837:p(6407,[5126,12],3),36227:p(36248,[5124,12],3),36209:p(36248,[5125,12],3),32855:p(6408,[5121,4,32820,2,33640,4],4,!0,!0),36194:p(6407,[5121,3,33635,2],3,!0,!0),36758:p(6407,[5120,3],3,!1,!0),32849:p(6407,[5121,3],3,!0,!0),36239:p(36248,[5120,3],3),36221:p(36248,[5121,3],3),35901:p(6407,[5126,12,5131,6,35902,4],3,!1,!0),6408:p(6408,[5121,4,5131,8,36193,8,5126,16,32819,2,32820,2],4,!0,!0),34842:p(6408,[5126,16,5131,8],4,!1,!0,!0),36232:p(36249,[5122,8],4,!0),36214:p(36249,[5123,8],4,!0),34836:p(6408,[5126,16],4,!1,!1,!0),36226:p(36249,[5124,16],4,!0),36208:p(36249,[5125,16],4,!0),32854:p(6408,[5121,4,32819,2],4,!0,!0),36759:p(6408,[5120,4],4,!1,!0),32856:p(6408,[5121,4],4,!0,!0),36238:p(36249,[5120,4],4,!0),36220:p(36249,[5121,4],4,!0),35907:p(6408,[5121,4],4,!0,!0),35905:p(6407,[5121,3],3,!1,!0)},ke=t=>typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,Zi=t=>t.type===Je.FLOAT||t.type===Je.HALF_FLOAT||t.type===Je.HALF_FLOAT_OES||t.type===Je.FLOAT_32_UNSIGNED_INT_24_8_REV,xf=Mn(()=>"WebGL"),k=t=>{throw new xf(t)},Va=t=>t!=null,On=t=>typeof t=="boolean",Ji=(t,e=new Map)=>n=>{e.has(n)||(e.set(n,!0),t(n))};var at=(t=>(t.GLES_100="100",t.GLES_300="300 es",t))(at||{});const Se="vec2",Xf="vec3",Ie="vec4",Ya="bool",Tn="float",Is="int",ei="uint",Wa="sampler2D",Zf="sampler3D",Jf=/^[iub]?vec[234]$/,Kf=/^mat[234]$/,Qf=t=>Bt(t)&&!!t.tag&&!!t.type,Ue=t=>Jf.test(t.type),ja=t=>Kf.test(t.type),ge=(t,e,n)=>t===e.type&&n===e.info?e:{tag:"lit",type:t,info:n,val:e},xa=t=>ge(Ya,v(t)?!!t:t),St=t=>ge(Tn,On(t)?t&1:t),ni=t=>ge(Is,On(t)?t&1:v(t)?t|0:t),Xa=t=>ge(ei,On(t)?t&1:v(t)?t>>>0:t),Za=(t,e)=>n=>v(n)||n!==void 0&&!Ue(n)&&n.type!==t?e(n):n,t1=Za(Tn,St),e1=Za(Is,ni);xa(!0);xa(!1);const si=St(0),Ja=St(1);St(2);St(.5);const Ka=ni(0);ni(1);Xa(0);Xa(1);St(Math.PI);St(Math.PI*2);St(Math.PI/2);St(Math.SQRT2);St((1+Math.sqrt(5))/2);const Qa=(t,e)=>n=>[n[0]===void 0?e:t(n[0]),...n.slice(1).map(t)],ri=Qa(t1,si),n1=Qa(e1,Ka),s1=(t,e="")=>t[0]+e.substring(1),ii=(t,e)=>Ue(t[0])?s1(t[0].type,e[t.length]):e[t.length],tc=(t,e,n)=>ge(t,n=e(n),ii(n,["n","n"])),r1=(t,e,n)=>ge(t,n=e(n),ii(n,["n","n","vn"])),i1=(t,e,n)=>ge(t,n=e(n),n.length===2?Ue(n[1])?n[0].type[0]+n[1].type[0]:"vn":ii(n,["n","n",void 0,"vnn"]));function oi(...t){return tc(Se,ri,t)}function ai(...t){return r1(Xf,ri,t)}function ec(...t){return i1(Ie,ri,t)}function o1(...t){return tc("ivec2",n1,t)}oi(0);oi(1);oi(2);ai(0);ai(1);ai(2);const a1=t=>t.replace("[]","");let c1=0;const ci=(t="_s")=>`${t}${(c1++).toString(36)}`;function et(t,...e){let n,s,r;switch(e.length){case 0:B(t)||(r=t,t=r.type);break;case 1:B(e[0])?n=e[0]:e[0].tag?r=e[0]:s=e[0];break;case 2:B(e[0])?[n,s]=e:[s,r]=e;break;case 3:[n,s,r]=e;break;default:lt()}return{tag:"sym",type:t,id:n||ci(),opts:s||{},init:r}}const Ki=(t,e,n)=>et(t,e,{q:"in",type:"in",...n}),Qi=(t,e,n)=>et(t,e,{q:"out",type:"out",...n}),to=(t,e,n)=>et(t,e,{q:"in",type:"uni",...n}),l1=t=>Pt(e=>e.tag,{},{[x]:e=>Et(`no impl for AST node type: '${e.tag}'`),...t}),eo=/[};]$/,u1=t=>{const e={type:"fs",version:at.GLES_300,versionPragma:!0,prelude:"",...t},n=e.type==="vs",s=e.prec!==void 0?u=>u===(u|0)?u+".0":u.toFixed(e.prec):u=>u===(u|0)?u+".0":String(u),r=u=>u,i=(u,d=", ")=>u.map(l).join(d),o=u=>`${u.id}(${i(u.args)})`,a=(u,d=!1)=>{const{id:f,type:h,opts:g,init:m}=u,_=[];if(g.type){let b;e.version<at.GLES_300?n?b={in:"attribute",out:"varying",uni:"uniform"}[g.type]:(b={in:"varying",out:null,uni:"uniform"}[g.type],!b&&Et("GLSL 100 doesn't support fragment shader output variables")):(g.loc!=null&&_.push(`layout(location=${g.loc}) `),g.smooth!=null&&_.push(g.smooth+" "),b=g.type==="uni"?"uniform":g.type),_.push(b+" ")}else g.const&&_.push("const "),d&&g.q&&_.push(g.q+" ");return g.prec&&_.push(g.prec+" "),_.push(r(a1(h))," ",f),g.num&&_.push(`[${g.num}]`),m&&_.push(" = ",l(m)),_.join("")},c=u=>`${l(u.val)}[${l(u.id)}]`,l=l1({arg:u=>a(u,!0),array_init:u=>e.version>=at.GLES_300?`${u.type}(${i(u.init)})`:Et(`array initializers not available in GLSL ${e.version}`),assign:u=>l(u.l)+" = "+l(u.r),ctrl:u=>u.id,call:o,call_i:u=>u.id==="texture"&&e.version<at.GLES_300?`${u.id}${u.args[0].type.substring(7)}(${i(u.args)})`:o(u),decl:u=>a(u.id),fn:u=>`${r(u.type)} ${u.id}(${i(u.args)}) ${l(u.scope)}`,for:u=>`for(${u.init?l(u.init):""}; ${l(u.test)}; ${u.iter?l(u.iter):""}) ${l(u.scope)}`,idx:c,idxm:c,if:u=>{const d=`if (${l(u.test)}) `+l(u.t);return u.f?d+" else "+l(u.f):d},lit:u=>{const d=u.val;switch(u.type){case"bool":return On(d)?String(d):`bool(${l(d)})`;case"float":return v(d)?s(d):`float(${l(d)})`;case"int":return v(d)?String(d):`int(${l(d)})`;case"uint":return v(d)?`${d}u`:`uint(${l(d)})`;default:return Ue(u)||ja(u)?`${u.type}(${i(d)})`:Et(`unknown type: ${u.type}`)}},op1:u=>u.post?`(${l(u.val)}${u.op})`:`(${u.op}${l(u.val)})`,op2:u=>`(${l(u.l)} ${u.op} ${l(u.r)})`,ret:u=>"return"+(u.val?" "+l(u.val):""),scope:u=>{let d=u.body.map(l).reduce((f,h)=>(f.push(eo.test(h)?h:h+";"),f),[]).join(`
`);return d+=u.body.length&&!eo.test(d)?";":"",u.global?(e.prelude&&(d=e.prelude+`
`+d),e.versionPragma&&(d=`#version ${e.version}
`+d),d):`{
${d}
}`},swizzle:u=>`${l(u.val)}.${u.id}`,sym:u=>u.id,ternary:u=>`(${l(u.test)} ? ${l(u.t)} : ${l(u.f)})`,while:u=>`while (${l(u.test)}) ${l(u.scope)}`});return Object.assign(l,{gl_FragColor:et(Ie,"gl_FragColor"),gl_FragCoord:et(Ie,"gl_FragCoord",{const:!0}),gl_FragData:et("vec4[]","gl_FragData",{num:1}),gl_FrontFacing:et("bool","gl_FrontFacing",{const:!0}),gl_PointCoord:et(Se,"gl_PointCoord",{const:!0}),gl_PointSize:et(Tn,"gl_PointSize"),gl_Position:et(Ie,"gl_Position")}),l},f1=(t,e,n=ut)=>{for(let s=t.length;s-- >0;)if(n(e,t[s]))return s;return-1};function nc(t,e){for(let n of e)t.delete(n);return t}const d1=(t,e)=>{if(t===e)return!0;if(!(e instanceof Map)||t.size!==e.size)return!1;for(let n of t.entries())if(!ut(e.get(n[0]),n[1]))return!1;return!0},h1=(t,e)=>{if(t===e)return!0;if(!(e instanceof Set)||t.size!==e.size)return!1;for(let n of t.keys())if(!e.has(n))return!1;return!0},g1="modulepreload",m1=function(t){return"/"+t},no={},p1=function(e,n,s){let r=Promise.resolve();if(n&&n.length>0){let o=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");r=o(n.map(l=>{if(l=m1(l),l in no)return;no[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":g1,u||(f.as="script"),f.crossOrigin="",f.href=l,c&&f.setAttribute("nonce",c),document.head.appendChild(f),u)return new Promise((h,g)=>{f.addEventListener("load",h),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},kn=(t,e={})=>{const n=Reflect.ownKeys(t),s=Reflect.ownKeys(e),r=Symbol("isa");function i(o){for(let a of n){const c=Object.getOwnPropertyDescriptor(o.prototype,a);(!c||c.configurable)&&Object.defineProperty(o.prototype,a,{value:t[a],writable:!0})}return Object.defineProperty(o.prototype,r,{value:!0}),o}for(let o of s)Object.defineProperty(i,o,{value:e[o],enumerable:e.propertyIsEnumerable(o)});return Object.defineProperty(i,Symbol.hasInstance,{value:o=>!!o[r]}),i},b1=()=>typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node<"u";let wn=null;b1()&&p1(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]).then(t=>{wn=t.inspect});const _1=(t,e)=>[...H(n=>wn(n,e),t)].join(", "),y1=(t,e)=>[...H(([n,s])=>`${wn(n,e)} => ${wn(s,e)}`,t)].join(", "),sc=kn({[Symbol.for("nodejs.util.inspect.custom")](t,e){const n=this[Symbol.toStringTag],s={...e,depth:e.depth===null?null:e.depth-1};return t>=0?[`${n}(${this.size||0}) {`,wn?this instanceof Set?_1(this,s):this instanceof Map?y1(this,s):"":"","}"].join(" "):e.stylize(`[${n}]`,"special")}}),v1=t=>t instanceof Map;function ds(t,e){if(v1(t))for(let n of e)t.set(n[0],n[1]);else for(let n of e)t.add(n);return t}var A1=Object.getOwnPropertyDescriptor,w1=(t,e,n,s)=>{for(var r=s>1?void 0:s?A1(e,n):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(r=o(r)||r);return r};const Qt=new WeakMap,It=t=>Qt.get(t).vals;let F=class extends Set{constructor(t,e={}){super(),Qt.set(this,{equiv:e.equiv||ut,vals:[]}),t&&this.into(t)}*[Symbol.iterator](){yield*It(this)}get[Symbol.species](){return F}get[Symbol.toStringTag](){return"ArraySet"}get size(){return It(this).length}copy(){const{equiv:t,vals:e}=Qt.get(this),n=new F(null,{equiv:t});return Qt.get(n).vals=e.slice(),n}empty(){return new F(null,this.opts())}clear(){It(this).length=0}first(){if(this.size)return It(this)[0]}add(t){return!this.has(t)&&It(this).push(t),this}into(t){return ds(this,t)}has(t){return this.get(t,Z)!==Z}get(t,e){const{equiv:n,vals:s}=Qt.get(this),r=f1(s,t,n);return r>=0?s[r]:e}delete(t){const{equiv:e,vals:n}=Qt.get(this);for(let s=n.length;s-- >0;)if(e(n[s],t))return n.splice(s,1),!0;return!1}disj(t){return nc(this,t)}equiv(t){return h1(this,t)}forEach(t,e){const n=It(this);for(let s=n.length;s-- >0;){const r=n[s];t.call(e,r,r,this)}}*entries(){for(let t of It(this))yield[t,t]}*keys(){yield*It(this)}*values(){yield*It(this)}opts(){return{equiv:Qt.get(this).equiv}}};F=w1([sc],F);var E1=Object.getOwnPropertyDescriptor,R1=(t,e,n,s)=>{for(var r=s>1?void 0:s?E1(e,n):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(r=o(r)||r);return r};const J=new WeakMap,Gn=t=>J.get(t).map;let ce=class extends Map{constructor(t,e){super();const n={equiv:ut,keys:F,...e};J.set(this,{keys:new n.keys(null,{equiv:n.equiv}),map:new Map,opts:n}),t&&this.into(t)}[Symbol.iterator](){return this.entries()}get[Symbol.species](){return ce}get[Symbol.toStringTag](){return"EquivMap"}get size(){return J.get(this).keys.size}clear(){const{keys:t,map:e}=J.get(this);t.clear(),e.clear()}empty(){return new ce(null,J.get(this).opts)}copy(){const{keys:t,map:e,opts:n}=J.get(this),s=new ce;return J.set(s,{keys:t.copy(),map:new Map(e),opts:n}),s}equiv(t){return d1(this,t)}delete(t){const{keys:e,map:n}=J.get(this);return t=e.get(t,Z),t!==Z?(n.delete(t),e.delete(t),!0):!1}dissoc(t){return nc(this,t)}forEach(t,e){for(let n of Gn(this))t.call(e,n[1],n[0],this)}get(t,e){const{keys:n,map:s}=J.get(this);return t=n.get(t,Z),t!==Z?s.get(t):e}has(t){return J.get(this).keys.has(t)}set(t,e){const{keys:n,map:s}=J.get(this),r=n.get(t,Z);return r!==Z?s.set(r,e):(n.add(t),s.set(t,e)),this}into(t){return ds(this,t)}entries(){return Gn(this).entries()}keys(){return Gn(this).keys()}values(){return Gn(this).values()}opts(){return J.get(this).opts}};ce=R1([sc],ce);const S1=new Set(["__proto__","prototype","constructor"]),Us=t=>S1.has(t),I1=t=>I(t)?t.some(Us):B(t)?t.indexOf(".")!==-1?t.split(".").some(Us):Us(t):!1,M1=(t,e)=>ct(t,"copy")?t.copy():new(t[Symbol.species]||e)(t),rc=(t,e,n)=>{if(t.size<e.size){const s=t;t=e,e=s}return n=n?ds(n,t):M1(t,Set),t===e?n:ds(n,e)};class En{dependencies;dependents;constructor(e){if(this.dependencies=new ce,this.dependents=new ce,e)for(let[n,s]of e)s!=null?this.addDependency(n,s):this.addNode(n)}*[Symbol.iterator](){yield*this.sort()}get[Symbol.species](){return En}copy(){const e=new En;for(let n of this.dependencies)e.dependencies.set(n[0],n[1].copy());for(let n of this.dependents)e.dependents.set(n[0],n[1].copy());return e}addNode(e){return!this.dependencies.has(e)&&this.dependencies.set(e,new F),this}addDependency(e,n){(ut(e,n)||this.depends(n,e))&&lt(`Circular dependency between: ${e} & ${n}`);let s=this.dependencies.get(e);return this.dependencies.set(e,s?s.add(n):new F([n])),s=this.dependents.get(n),this.dependents.set(n,s?s.add(e):new F([e])),this}addDependencies(e,n){for(let s of n)this.addDependency(e,s)}removeEdge(e,n){let s=this.dependencies.get(e);return s&&s.delete(n),s=this.dependents.get(n),s&&s.delete(e),this}removeNode(e){return this.dependencies.delete(e),this}depends(e,n){return this.transitiveDependencies(e).has(n)}dependent(e,n){return this.transitiveDependents(e).has(n)}immediateDependencies(e){return this.dependencies.get(e)||new F}immediateDependents(e){return this.dependents.get(e)||new F}isLeaf(e){return this.immediateDependents(e).size===0}isRoot(e){return this.immediateDependencies(e).size===0}nodes(){return rc(new F(this.dependencies.keys()),new F(this.dependents.keys()))}leaves(){return Wt(e=>this.isLeaf(e),this.nodes())}roots(){return Wt(e=>this.isRoot(e),this.nodes())}transitiveDependencies(e){return lr(this.dependencies,e)}transitiveDependents(e){return lr(this.dependents,e)}sort(){const e=[],n=this.copy();let s=new F(n.leaves());for(;;){if(!s.size)return e.reverse();const r=s.first();s.delete(r);for(let i of[...n.immediateDependencies(r)])n.removeEdge(r,i),n.isLeaf(i)&&s.add(i);e.push(r),n.removeNode(r)}}}const lr=(t,e)=>{const n=t.get(e);return n?mn(Rs(null,(s,r)=>rc(s,lr(t,r))),n,n):new F},ic=t=>{let e;switch(t.tag){case"scope":return t.body;case"fn":return t.scope.body;case"for":return e=[t.test,...t.scope.body],t.init&&e.push(t.init),t.iter&&e.push(t.iter),e;case"while":return[t.test,...t.scope.body];case"if":return e=[t.test,...t.t.body],t.f&&e.push(...t.f.body),e}},D1=t=>ic(t)||(t.tag==="scope"?t.body:t.tag==="ternary"?[t.test,t.t,t.f]:t.tag==="ret"?t.val!==void 0?[t.val]:void 0:t.tag==="call"||t.tag==="call_i"?t.args:t.tag==="sym"&&t.init?[t.init]:t.tag==="decl"?[t.id]:t.tag==="op1"||t.tag==="swizzle"?[t.val]:t.tag==="op2"?[t.l,t.r]:t.tag==="assign"?[t.r]:Ue(t)||ja(t)||Qf(t.val)?t.val:void 0),hs=(t,e,n,s,r=!0)=>{if(I(s))s.forEach(i=>n=hs(t,e,n,i,r));else{r&&(n=t(n,s));const i=e(s);i&&(n=hs(t,e,n,i,r)),!r&&(n=t(n,s))}return n},oc=(t,e=new En)=>t.deps?.length?t.deps.reduce((n,s)=>oc(s,n.addDependency(t,s)),e):e.addNode(t),N1=t=>({tag:"decl",type:t.type,id:t}),ac=(t,e=!1)=>({tag:"scope",type:"void",body:t.filter(n=>n!=null).map(n=>n.tag==="sym"?N1(n):n),global:e}),$1=t=>{const e=t.filter(s=>s.tag!=="fn"),n=t.reduce((s,r)=>r.tag==="fn"?oc(r,s):s,new En);return ac(e.concat(n.sort()),!0)};function*Fs(t){for(let e in t)t.hasOwnProperty(e)&&(yield t[e])}const L1=(t,e=t,n,s={})=>{const r=document.createElement("canvas");return ur(r,t,e,s.dpr),s.pixelated&&(r.style.imageRendering="pixelated"),n?.appendChild(r),{canvas:r,ctx:r.getContext("2d",s.ctx)}},Me=(t,e=t,n,s)=>L1(t,e,n,{dpr:1,...s}),ur=(t,e,n,s=window.devicePixelRatio||1)=>(s!==1&&(t.style.width=`${e}px`,t.style.height=`${n}px`),t.width=e*s,t.height=n*s,s),C1={alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},O1=(t={})=>{const e=t.canvas?B(t.canvas)?document.getElementById(t.canvas):t.canvas:document.createElement("canvas");t.width&&(e.width=t.width),t.height&&(e.height=t.height),t.autoScale!==!1&&ur(e,e.width,e.height),t.parent?.appendChild(e);const n=e.getContext(t.version!==1?"webgl2":"webgl",{...C1,...t.opts});return n||k("WebGL unavailable"),t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost),{canvas:e,gl:n,ext:cc(n,t.ext),resize:(s,r)=>{ur(e,s,r,t.autoScale!==!1?window.devicePixelRatio:1),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight)}}},cc=(t,e,n=!0)=>{const s={};if(e)for(let r of e)s[r]=t.getExtension(r),n&&!s[r]&&k(`extension ${r} not available`);return s},gs=ga.childLogger("webgl"),T1={a:"",v:"",u:"",o:""},k1={[at.GLES_100]:{number:100,attrib:(t,e,n)=>`attribute ${I(e)?e[0]:e} ${n.a}${t};`,varying:{vs:(t,e,n)=>be("varying",e,n.v+t),fs:(t,e,n)=>be("varying",e,n.v+t)},uniform:(t,e,n)=>be("uniform",e,n.u+t),output:(t,e,n)=>I(e)?`#define ${n.o}${t} gl_FragData[${e[1]}]`:""},[at.GLES_300]:{number:300,attrib:(t,e,n)=>I(e)?`layout(location=${e[1]}) in ${e[0]} ${n.a}${t};`:`in ${e} ${n.a}${t};`,varying:{vs:(t,e,n)=>be("out",e,n.v+t),fs:(t,e,n)=>be("in",e,n.v+t)},uniform:(t,e,n)=>be("uniform",e,n.u+t),output:(t,e,n)=>I(e)?`layout(location=${e[1]}) out ${e[0]} ${n.o}${t};`:`out ${e} ${n.o}${t};`}},be=(t,e,n)=>{const s=I(e)?e[0]:e;return s.indexOf("[]")>0?`${t} ${s.replace("[]","")} ${n}[${e[1]}];`:`${t} ${s} ${n};`},lc=(t,e,n="")=>{let s=">=";return e||(e=n,n=null,s="<"),`#if __VERSION__ ${s} ${t}
${e}${n?`
#else
${n}`:""}
#endif`};lc(300,"","#define texture texture2D");const so=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp int;
precision highp float;
#else
precision mediump int;
precision mediump float;
#endif
${lc(300,"precision lowp sampler3D;")}
#ifndef PI
#define PI 3.141592653589793
#endif
#ifndef TAU
#define TAU 6.283185307179586
#endif
#ifndef HALF_PI
#define HALF_PI 1.570796326794896
#endif
`,B1=Object.freeze([1,0,0,1]),P1=Object.freeze([1,0,0,0,1,0,0,0,1]),uc=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Mt=t=>(e,n,s=0)=>{let r;return i=>{i=i===void 0?s:i,i!==r&&(e["uniform1"+t](n,i),r=i)}},R=(t,e)=>(n,s,r=e)=>{let i=[];return o=>{o=o===void 0?r:o,Br(i,o)||(n["uniform"+t](s,o),i=[...o])}},_e=(t,e)=>(n,s,r=e)=>{let i=[];return o=>{o=o===void 0?r:o,Br(i,o)||(n["uniformMatrix"+t](s,!1,o),i=[...o])}},Dt=[0],G1={bool:Mt("i"),float:Mt("f"),int:Mt("i"),uint:Mt("ui"),bvec2:R("2iv",pt),bvec3:R("3iv",bt),bvec4:R("4iv",Zt),ivec2:R("2iv",pt),ivec3:R("3iv",bt),ivec4:R("4iv",Zt),vec2:R("2fv",pt),vec3:R("3fv",bt),vec4:R("4fv",Zt),mat2:_e("2fv",B1),mat3:_e("3fv",P1),mat4:_e("4fv",uc),sampler2D:Mt("i"),sampler2DShadow:Mt("i"),sampler3D:Mt("i"),samplerCube:Mt("i"),samplerCubeShadow:Mt("i"),"bool[]":R("1iv",Dt),"float[]":R("1fv",Dt),"int[]":R("1iv",Dt),"uint[]":R("1uiv",Dt),"bvec2[]":R("2iv",pt),"bvec3[]":R("3iv",bt),"bvec4[]":R("4iv",Zt),"ivec2[]":R("2iv",pt),"ivec3[]":R("3iv",bt),"ivec4[]":R("4iv",Zt),"vec2[]":R("2fv",pt),"vec3[]":R("3fv",bt),"vec4[]":R("4fv",Zt),"mat2[]":_e("2fv",pt),"mat3[]":_e("3fv",bt),"mat4[]":_e("4fv",Zt),"sampler2D[]":R("1iv",Dt),"sampler2DShadow[]":R("1iv",Dt),"sampler3D[]":R("1iv",Dt),"samplerCube[]":R("1iv",Dt),"samplerCubeShadow[]":R("1iv",Dt)},U1=/ERROR: \d+:(\d+): (.*)/;class li{gl;program;attribs;uniforms;state;warnAttrib=Ji(e=>gs.warn(`unknown attrib: ${e} (no further warnings will be shown...)`));warnUni=Ji(e=>gs.warn(`unknown uniform: ${e} (no further warnings will be shown...)`));constructor(e,n,s,r,i){this.gl=e,this.program=n,this.attribs=s,this.uniforms=r,this.state=i||{}}withState(e){return new li(this.gl,this.program,this.attribs,this.uniforms,{...this.state,...e})}bind(e){return this.program?(this.gl.useProgram(this.program),this.bindAttribs(e.attribs),this.bindUniforms(e.uniforms),!0):!1}unbind(){let e;for(let n in this.attribs)(e=this.attribs[n])&&this.gl.disableVertexAttribArray(e.loc);return this.gl.useProgram(null),!0}release(){return this.program?(this.gl.deleteProgram(this.program),delete this.program,!0):!1}bindAttribs(e){const n=this.gl;let s;for(let r in e)if(s=this.attribs[r]){const i=e[r];i.buffer.bind(),n.enableVertexAttribArray(s.loc),n.vertexAttribPointer(s.loc,i.size||3,Ra(i.type||n.FLOAT),i.normalized||!1,i.stride||0,i.offset||0)}else this.warnAttrib(r)}bindUniforms(e={}){const n=this.uniforms;for(let s in e){const r=n[s];if(r){let i=e[s];i=vn(i)?i(n,e):ff(i),r.setter(i)}else this.warnUni(s)}for(let s in n)if(n.hasOwnProperty(s)&&(!e||!Va(e[s]))){const r=n[s],i=r.defaultFn?r.defaultFn(n,e):r.defaultVal;r.setter(i)}}prepareState(e=this.state){const n=this.gl;e.depth!==void 0&&this.setState(n.DEPTH_TEST,e.depth),e.cull!==void 0&&(this.setState(n.CULL_FACE,e.cull),e.cullMode&&n.cullFace(e.cullMode)),e.blend!==void 0&&(this.setState(n.BLEND,e.blend),e.blendFn&&n.blendFunc(e.blendFn[0],e.blendFn[1]),e.blendEq!==void 0&&n.blendEquation(e.blendEq)),e.stencil!==void 0&&(this.setState(n.STENCIL_TEST,e.stencil),e.stencilFn&&n.stencilFunc(e.stencilFn[0],e.stencilFn[1],e.stencilFn[2]),e.stencilOp&&n.stencilOp(e.stencilOp[0],e.stencilOp[1],e.stencilOp[2]),e.stencilMask!==void 0&&n.stencilMask(e.stencilMask))}setState(e,n){n?this.gl.enable(e):this.gl.disable(e)}}const fc=(t,e,n)=>{const s=ke(t)?at.GLES_300:at.GLES_100,r=vn(e.vs)?oo(e,"vs",s,n):ao(e,"vs",s),i=vn(e.fs)?oo(e,"fs",s,n):ao(e,"fs",s),o=gs;o.debug(r),o.debug(i),e.ext&&z1(t,e.ext);const a=co(t,t.VERTEX_SHADER,r),c=co(t,t.FRAGMENT_SHADER,i),l=t.createProgram()||k("error creating shader program");if(t.attachShader(l,a),t.attachShader(l,c),t.linkProgram(l),t.getProgramParameter(l,t.LINK_STATUS)){const u=Y1(t,l,e.attribs),d=W1(t,l,e.uniforms);return t.deleteShader(a),t.deleteShader(c),new li(t,l,u,d,e.state)}throw new Error(`Error linking shader: ${t.getProgramInfoLog(l)}`)},Un=(t,e,n)=>{let s=[];for(let r in t)t.hasOwnProperty(r)&&s.push(e(r,t[r],n));return s.push(""),s.join(`
`)},F1=(t,e,n)=>{const s=jf[t],r=n===at.GLES_300;return s&&(!r&&s.gl||r&&s.gl2)?`#extension ${s&&s.alias||t} : ${On(e)?e?"enable":"disable":e}
`:""},z1=(t,e)=>{for(let n in e){const s=e[n];(s===!0||s==="require")&&cc(t,[n],s==="require")}},dc=(t,e)=>{let n=t.pre?t.replacePrelude?t.pre:t.pre+`
`+so:so;if(t.ext)for(let s in t.ext)n+=F1(s,t.ext[s],e);return n},ro=(t,e,n)=>{for(let s in e){const r=e[s];n[s]=I(r)?t(r[0],s,{loc:r[1]}):t(r,s)}},H1=t=>{const[e,n]=I(t)?[t[0],{num:t[1]}]:[t,{}];return/(u?int|[ui]vec[234])/.test(e)&&(n.smooth="flat"),[e,n]},io=(t,e,n)=>{for(let s in t.varying){const[r,i]=H1(t.varying[s]);n[s]=e(r,s,i)}},q1=(t,e)=>{for(let n in t.uniforms){const s=t.uniforms[n];e[n]=I(s)?to(s[0],n,s[0].indexOf("[]")>0?{num:s[1]}:void 0):to(s,n)}},oo=(t,e,n,s={})=>{let r=dc(t,n);const i={},o={},a={},c={};if(t.uniforms&&q1(t,c),e==="vs")ro(Ki,t.attribs,i),t.varying&&io(t,Qi,o);else{t.varying&&io(t,Ki,i);const u=t.outputs||qa;if(n>=at.GLES_300)ro(Qi,u,o);else for(let d in u){const f=u[d];I(f)&&f[0]==="vec4"?(r+=`#define ${d} gl_FragData[${f[1]}]
`,a[d]=et("vec4",d)):Et(`GLSL ${n} doesn't support output vars`)}}const l=u1({type:e,version:n,prelude:r,prec:s.prec});return l($1([...Fs(c),...Fs(i),...Fs(o),...t[e](l,c,i,{...o,...a})]))+(t.post?`
`+t.post:"")},ao=(t,e,n)=>{const s=k1[n],r={...T1,...t.declPrefixes},i=e==="vs";let o="";return o+=`#version ${n}
`,o+=dc(t,n),t.generateDecls!==!1&&(o+=i?Un(t.attribs,s.attrib,r):Un(t.outputs||qa,s.output,r),o+=Un(t.varying,s.varying[e],r),o+=Un(t.uniforms,s.uniform,r)),o+=t[e],t.post&&(o+=`
`+t.post),o},co=(t,e,n)=>{const s=t.createShader(e)||k("error creating shader");return t.shaderSource(s,n),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:V1(t,s,n)},V1=(t,e,n)=>{const s=n.split(`
`),i=t.getShaderInfoLog(e).split(`
`).map(o=>{const a=U1.exec(o),c=a?a[1]:null;if(c)return`line ${c}: ${a[2]}
${s[parseInt(c)-1]}`}).filter(Va).join(`
`);return k(`Error compiling shader:
${i}`)},Y1=(t,e,n)=>{const s={};for(let r in n){const i=n[r],[o,a]=I(i)?i:[i,null],c=r;a!=null?(t.bindAttribLocation(e,a,c),s[r]={type:o,loc:a}):s[r]={type:o,loc:t.getAttribLocation(e,c)}}return s},W1=(t,e,n={})=>{const s={};for(let r in n){const i=n[r];let o,a,c,l,u;I(i)?([o,a,c]=i,l=o.indexOf("[]")<0?a:c,vn(l)&&(u=l,l=void 0)):o=i;const d=t.getUniformLocation(e,r);if(d!=null){const f=G1[o];f?s[r]={loc:d,setter:f(t,d,l),defaultFn:u,defaultVal:l,type:o}:k(`invalid uniform type: ${o}`)}else gs.warn(`unknown uniform: ${r}`)}return s};class hc{gl;buffer;target;mode;data;constructor(e,n,s=e.ARRAY_BUFFER,r=e.STATIC_DRAW,i=!1){this.gl=e,this.buffer=e.createBuffer()||k("error creating WebGL buffer"),this.target=s,this.mode=r,n&&(this.set(n),i&&(this.data=n))}bind(){return this.gl.bindBuffer(this.target,this.buffer),!0}unbind(){return this.gl.bindBuffer(this.target,null),!0}release(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),delete this.buffer),!0}update(){this.data&&this.set(this.data)}set(e,n=this.mode){this.bind(),this.gl.bufferData(this.target,e,n),this.data&&(this.data=e)}setChunk(e,n=0){this.bind(),this.gl.bufferSubData(this.target,n,e),this.data&&this.data.set(e,n>>>I0[C0(e)])}}const j1=(t,e,n=t.ARRAY_BUFFER,s=t.STATIC_DRAW,r=!1)=>new hc(t,e,n,s,r),lo=(t,e,n=t.STATIC_DRAW)=>(e.attribPool?e.attribs=fo(t,e.attribPool,void 0,t.ARRAY_BUFFER,n):uo(t,e.attribs,n),e.instancePool?e.instances={attribs:fo(t,e.instancePool,void 0,t.ARRAY_BUFFER,n),num:e.instancePool.capacity}:e.instances&&uo(t,e.instances.attribs,n),x1(t,e.indices,n),e.mode==null&&(e.mode=ti.TRIANGLES),Bt(e.shader)&&(e.shader=fc(t,e.shader)),e),gc=(t,e,n,s)=>{e.buffer?e.data&&e.buffer.set(e.data):e.buffer=new hc(t,e.data,n,s,e.retain)},uo=(t,e,n)=>{if(e)for(let s in e)gc(t,e[s],t.ARRAY_BUFFER,n);return e},x1=(t,e,n=t.STATIC_DRAW)=>(e&&gc(t,e,t.ELEMENT_ARRAY_BUFFER,n),e),fo=(t,e,n,s=t.ARRAY_BUFFER,r=t.STATIC_DRAW)=>{const i=j1(t,e.bytes(),s,r,!0),o={};for(let a of Object.keys(e.specs)){const c=e.specs[a];o[a]={buffer:i,size:c.size,type:Ra(c.type),stride:e.byteStride,offset:c.byteOffset}}return o},mc=t=>e=>{if(e)for(let n=e.length,s;n-- >0;)(s=e[n])&&s[t](n)},X1=mc("bind"),Z1=mc("unbind");class J1{gl;tex;target;format;filter;wrap;type;size;constructor(e,n={}){this.gl=e,this.tex=e.createTexture()||k("error creating WebGL texture"),this.configure({filter:us.NEAREST,wrap:fs.CLAMP,...n})}configure(e={},n=!0){const s=this.gl,r=e.target||this.target||Re.TEXTURE_2D,i=e.format||this.format||Cn.RGBA,o=un[i],a=e.type||this.type||o.types[0];return!this.target&&(this.target=r),this.format=i,this.type=a,s.bindTexture(this.target,this.tex),e.flip!==void 0&&s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.flip?1:0),e.premultiply!==void 0&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiply?1:0),this.configureImage(r,e),e.mipmap&&s.generateMipmap(r),this.configureFilter(r,e),this.configureWrap(r,e),this.configureLOD(r,e),this.configureLevels(r,e),n&&s.bindTexture(this.target,null),!0}configureImage(e,n){n.image!==void 0&&(e===Re.TEXTURE_3D?this.configureImage3d(e,n):this.configureImage2d(e,n))}configureImage2d(e,n){const s=n.level||0,r=n.pos||[0,0,0],{image:i,width:o,height:a}=n,l=un[this.format].format,{gl:u,type:d,format:f}=this;o&&a?n.sub?u.texSubImage2D(e,s,r[0],r[1],o,a,l,d,i):(s===0&&(this.size=[o,a]),u.texImage2D(e,s,f,o,a,0,l,d,i)):n.sub?u.texSubImage2D(e,s,r[0],r[1],l,d,i):(i!=null&&s===0&&(this.size=[i.width,i.height]),u.texImage2D(e,s,f,l,d,i))}configureImage3d(e,n){const{image:s,width:r,height:i,depth:o}=n;if(!(r&&i&&o))return;const a=n.level||0,c=n.pos||[0,0,0],u=un[this.format].format,{gl:d,type:f,format:h}=this;n.sub?d.texSubImage3D(e,a,c[0],c[1],c[2],r,i,o,u,f,s):(a===0&&(this.size=[r,i,o]),d.texImage3D(e,a,h,r,i,o,0,u,f,s))}configureFilter(e,n){const s=this.gl,r=n.filter||this.filter||us.NEAREST;let i,o;I(r)?(i=r[0],o=r[1]||i,this.filter=[i,o]):(this.filter=[r,r,r],i=o=r),s.texParameteri(e,s.TEXTURE_MIN_FILTER,i),s.texParameteri(e,s.TEXTURE_MAG_FILTER,o)}configureWrap(e,n){const s=this.gl,r=n.wrap||this.wrap||fs.CLAMP;let i,o,a;I(r)?(i=r[0],o=r[1]||i,a=r[2]||i,this.wrap=[i,o,a]):(i=o=a=r,this.wrap=[r,r,r]),s.texParameteri(e,s.TEXTURE_WRAP_S,i),s.texParameteri(e,s.TEXTURE_WRAP_T,o),ke(s)&&e===s.TEXTURE_3D&&s.texParameteri(e,s.TEXTURE_WRAP_R,a)}configureLOD(e,n){const s=this.gl;if(n.lod){const[r,i]=n.lod;r&&s.texParameterf(e,s.TEXTURE_MIN_LOD,r),i&&s.texParameterf(e,s.TEXTURE_MAX_LOD,i)}}configureLevels(e,n){const s=this.gl;if(n.minMaxLevel){const[r,i]=n.minMaxLevel;s.texParameteri(e,s.TEXTURE_BASE_LEVEL,r),s.texParameteri(e,s.TEXTURE_MAX_LEVEL,i)}}bind(e=0){const n=this.gl;return n.activeTexture(n.TEXTURE0+e),n.bindTexture(this.target,this.tex),!0}unbind(e=0){const n=this.gl;return n.activeTexture(n.TEXTURE0+e),n.bindTexture(this.target,null),!0}release(){return this.tex?(this.gl.deleteTexture(this.tex),delete this.tex,delete this.gl,!0):!1}}const De=(t,e)=>new J1(t,e),K1=(t,e={})=>{const n=I(t)?t:[t];for(let s=0,r=n.length;s<r;s++){const i=n[s],o=i.indices,a=i.shader.gl;e.bindTex!==!1&&X1(i.textures),e.shaderState!==!1&&i.shader.prepareState(),e.bindShader!==!1&&i.shader.bind(i),o?.buffer?(o.buffer.bind(),i.instances?ho(a,i):a.drawElements(i.mode,i.num,o.data instanceof Uint32Array?a.UNSIGNED_INT:a.UNSIGNED_SHORT,0)):i.instances?ho(a,i):a.drawArrays(i.mode,0,i.num),e.unbindShader!==!1&&i.shader.unbind(null),e.unbindTex&&Z1(i.textures)}},ho=(t,e)=>{const n=ke(t),s=n?void 0:t.getExtension("ANGLE_instanced_arrays");n||s||k("instancing not supported");const r=e.shader.attribs,i=e.instances.attribs;e.shader.bindAttribs(i);for(let o in i){const a=r[o];if(a){let c=i[o].divisor;c=c!==void 0?c:1,n?t.vertexAttribDivisor(a.loc,c):s.vertexAttribDivisorANGLE(a.loc,c)}}if(e.indices){const o=e.indices.data instanceof Uint32Array?t.UNSIGNED_INT:t.UNSIGNED_SHORT;n?t.drawElementsInstanced(e.mode,e.num,o,0,e.instances.num):s.drawElementsInstancedANGLE(e.mode,e.num,o,0,e.instances.num)}else n?t.drawArraysInstanced(e.mode,0,e.num,e.instances.num):s.drawArraysInstancedANGLE(e.mode,0,e.num,e.instances.num);for(let o in i){const a=r[o];a&&(n?t.vertexAttribDivisor(a.loc,0):s.vertexAttribDivisorANGLE(a.loc,0))}e.shader.unbind(null)};class Q1{gl;buffer;format;width;height;constructor(e,n){this.gl=e,this.buffer=e.createRenderbuffer()||k("error creating RBO"),this.configure(n)}bind(){return this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.buffer),!0}unbind(){return this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),!0}release(){return this.gl.deleteRenderbuffer(this.buffer),delete this.buffer,!0}configure(e,n=!0){const s=this.gl;return this.bind(),this.format=e.format||s.DEPTH_COMPONENT16,this.width=e.width,this.height=e.height,s.renderbufferStorage(s.RENDERBUFFER,e.format||s.DEPTH_COMPONENT16,e.width,e.height),n?this.unbind():!0}}const td=36064,ed=36063;class nd{gl;fbo;ext;maxAttachments;constructor(e,n){this.gl=e,this.fbo=e.createFramebuffer()||k("error creating FBO"),this.ext=!ke(e)&&n?.tex&&n.tex.length>1?e.getExtension("WEBGL_draw_buffers")||k("missing WEBGL_draw_buffers ext"):void 0,this.maxAttachments=e.getParameter(ed),n&&this.configure(n)}bind(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),!0}unbind(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),!0}release(){return this.gl.deleteFramebuffer(this.fbo),delete this.fbo,delete this.ext,!0}configure(e,n=!0){const s=this.gl;if(this.bind(),e.tex){M(e.tex.length<this.maxAttachments,`too many attachments (max. ${this.maxAttachments})`);const r=[];for(let i=0;i<e.tex.length;i++){const o=e.tex[i];M(!!(un[o.format].render||un[o.format].renderExt),`texture #${i} has non-renderable format`);const a=td+i;s.framebufferTexture2D(s.FRAMEBUFFER,a,s.TEXTURE_2D,o.tex,0),r[i]=a}this.ext?this.ext.drawBuffersWEBGL(r):ke(s)&&s.drawBuffers(r)}return e.depth&&(e.depth instanceof Q1?s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e.depth.buffer):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,e.depth.tex,0)),this.validate(),n?this.unbind():!0}validate(){const e=this.gl,n=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(n){case e.FRAMEBUFFER_COMPLETE:return!0;case e.FRAMEBUFFER_UNSUPPORTED:k("FBO unsupported");case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:k("FBO incomplete attachment");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:k("FBO incomplete dimensions");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:k("FBO incomplete missing attachment");default:return k(`FBO error: ${n}`)}}}const sd=(t,e)=>new nd(t,e),Rn=(t,e)=>(M(t.tag!=="swizzle"||t.val.tag==="sym","can't assign to non-symbol swizzle"),{tag:"assign",type:t.type,l:t,r:e}),rd=t=>{const[e,n,s]=B(t)?[t]:t;return{tag:"arg",type:e,id:n||ci(),opts:{q:"in",...s}}};function id(t,e,n,s){e=e||ci();const r=n.map(rd),i=s(...r.map(c=>et(c.type,c.id,c.opts))).filter(c=>c!=null);hs((c,l)=>(l.tag==="ret"&&(M(l.type===t,`wrong return type for function '${e}', expected ${t}, got ${l.type}`),c++),c),ic,0,i);const o=hs((c,l)=>(l.tag==="call"&&l.fn&&c.push(l.fn),c),D1,[],i),a=(...c)=>od(a,...c);return Object.assign(a,{tag:"fn",type:t,id:e,args:r,deps:o,scope:ac(i)})}const Ms=t=>id("void","main",[],t);function od(t,...e){return B(t)?{tag:"call",type:e[0],id:t,args:e.slice(1)}:{tag:"call",type:t.type,id:t.id,args:e,fn:t}}const go=(t,e,...n)=>({tag:"call_i",type:e,id:t,args:n});function ad(t,e){const n=t.type[0],s=(r,i)=>e.length===1?r:i+e.length;return{tag:"swizzle",type:n==="i"?s(Is,"ivec"):n==="u"?s(ei,"uvec"):n==="b"?s(Ya,"bvec"):s(Tn,"vec"),val:t,id:e}}function cd(t){return ad(t,"xy")}const mo=t=>{const e=t.type[0],n=t.type.indexOf("Shadow")>0;return e==="s"?n?Tn:Ie:e==="i"?n?Is:"ivec4":e==="u"?n?ei:"uvec4":lt(`unknown sampler type ${t.type}`)},pc=(t,e,n,s)=>{const r=s?go(t,mo(e),e,...n,s):go(t,mo(e),e,...n);return!Ue(r)&&(r.info="n"),r};function ld(t,e,n){return pc("texture",t,[e],n)}function ud(t,e,n){return pc("texelFetch",t,[e,n])}function fr(t){return t?mn(fr(),t):Rs(()=>({}),(e,[n,s])=>(e[n]=s,e))}function dr(...t){const e=mu(dr,t);if(e!==void 0)return e;const n=t[0];return Rs(()=>!1,n?(s,r)=>n(r)?$i(!0):s:(s,r)=>r?$i(!0):s)}function bc(t,e){return Ge(e)?ea(bc(t),B(e)?[e]:e):n=>{const s=n[2],r=(i,o)=>{const a=t(o);if(a){for(let c of a)if(i=r(i,c),kt(i))break;return i}return s(i,o)};return Dn(n,r)}}function fd(t){return bc(e=>df(e)?e:void 0,t)}const dd=()=>es,hd=(t,e=0,n=t.length,s=fe)=>{for(M(e>=0&&n>=e&&n<=t.length,`illegal range ${e}..${n}`);n>e+1;){const r=s.minmax(e,n)|0,i=t[r];t[r]=t[--n],t[n]=i}return t},gd=(t,e=t.length,n=fe)=>hd(t,0,e,n),md=(t,e)=>t-e,pd=(t,e,n=o=>o,s=Mf,r=0,i=t.length-1)=>{const o=n(e);for(;r<=i;){const a=r+i>>>1,c=s(n(t[a]),o);if(c<0)r=a+1;else if(c>0)i=a-1;else return a}return-r-1},ui=(t={})=>{let{size:e=2,uv:n=!0,center:s=!0}=t;e*=.5;const r=s?0:e;return{attribs:{position:{data:new Float32Array([r-e,r-e,r+e,r-e,r-e,r+e,r+e,r+e]),size:2},...n?{uv:{data:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}:null},uniforms:{},shader:null,mode:ti.TRIANGLE_STRIP,num:4}},bd=(t,e,n)=>[Ms(()=>[Rn(t.gl_Position,ec(n.position,si,Ja))])],_d=(t,e,n,s)=>[Ms(()=>[Rn(s.v_uv,n.uv),Rn(t.gl_Position,ec(n.position,si,Ja))])],yd=(t,e,n,s)=>[Ms(()=>[Rn(s.fragColor,ld(e.tex,n.v_uv))])],_c={vs:_d,fs:yd,attribs:{position:Se,uv:Se},varying:{v_uv:Se},uniforms:{tex:Wa},state:{depth:!1},ext:{}},yc=t=>{const e=t.gl,n=t.passes.length;M(n>0,"require at least one shader pass");const s=!t.passes[n-1].outputs.length,r=Ed(t),i=vd(t,r),o=Rd(t,r,s),a=(g,m,_=!0)=>{_&&o[g].bind();const b=t.passes[g],y=i[g],D=y.shader,N=b.outputs.length?r[b.outputs[0]].size:[e.drawingBufferWidth,e.drawingBufferHeight];D.uniforms.resolution&&(y.uniforms.resolution=N),D.uniforms.time&&(y.uniforms.time=m),e.viewport(0,0,N[0],N[1]),K1(y),_&&o[g].unbind()},c=g=>{for(let m=0;m<o.length;m++)a(m,g);s&&a(n-1,g,!1)},l=()=>{c((Date.now()-d)*.001),u&&(f=requestAnimationFrame(l))};let u,d=Date.now(),f;return{start(){d=Date.now(),u=!0,f=requestAnimationFrame(l)},stop(){u&&(u=!1,cancelAnimationFrame(f))},update(g){c(g)},singlePass(g,m){a(g,m,g<o.length)},passes:t.passes,fbos:o,models:i,textures:r}},vd=(t,e)=>{const n=t.gl,s=lo(n,ui({uv:!1}));return t.passes.map(r=>{const i=r.model?lo(n,r.model):{...s};return i.shader=wd(n,r,e),i.uniforms={...r.uniformVals},r.inputs.length>0&&(i.textures=r.inputs.map(o=>e[o])),i})},Ad={[Re.TEXTURE_2D]:Wa,[Re.TEXTURE_3D]:Zf,[Re.TEXTURE_CUBE_MAP]:"samplerCube"},wd=(t,e,n)=>{const s=ke(t),r=e.outputs.length,i={...e.ext},o={vs:e.vs||bd,fs:e.fs,attribs:e.attribs||{position:Se},varying:e.varying,uniforms:{...e.uniforms,...Ot(Ga((l,u)=>[`input${l}`,[Ad[n[u].target],l]]),fr(),e.inputs)},outputs:r?Ot(H(l=>[`output${l}`,[Ie,l]]),fr(),Ua(r)):void 0,state:e.state,pre:e.pre,post:e.post,replacePrelude:e.replacePrelude,generateDecls:e.generateDecls,ext:i},a=dr(l=>Zi(n[l]),e.inputs),c=dr(l=>Zi(n[l]),e.outputs);return s||(a&&(i.OES_texture_float="require"),r>1&&(i.WEBGL_draw_buffers="require")),c&&(i[s?"EXT_color_buffer_float":"WEBGL_color_buffer_float"]="require",s&&(i.EXT_float_blend="require")),fc(t,o)},Ed=t=>Object.keys(t.textures).reduce((e,n)=>(e[n]=De(t.gl,{width:t.width,height:t.height,depth:t.depth,filter:us.NEAREST,wrap:fs.CLAMP,image:null,...t.textures[n]}),e),{}),Rd=(t,e,n)=>(n?t.passes.slice(0,t.passes.length-1):t.passes).map(s=>sd(t.gl,{tex:s.outputs.map(r=>e[r])})),vc=(t,e)=>(M(t.length===e.length,"require same number of in/out textures"),{fs:(n,s,r,i)=>[Ms(()=>[...H(o=>Rn(i[`output${o}`],ud(s[`input${o}`],o1(cd(n.gl_FragCoord)),Ka)),Ua(t.length))])],inputs:t,outputs:e});function Sd(t,e,n,s){let r,i;if(v(t)){const c=Me(t,e,n,s);r=c.canvas,i=c.ctx}else r=t,i=r.getContext("2d");const o=i.getImageData(0,0,r.width,r.height),a=new Uint32Array(o.data.buffer);return{canvas:r,ctx:i,img:o,data:a}}var At=(t=>(t[t.ALPHA=0]="ALPHA",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t[t.RED=3]="RED",t))(At||{});const Id=["rotateCW","rotate180","rotateCCW"],Md=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/255,hr=(t,e,n,s,r,i,o=0,a=0)=>(t|=0,e|=0,n|=0,s|=0,t<0&&(n+=t,o-=t,t=0),e<0&&(s+=e,a-=e,e=0),[t,e,ft(n,0,r-t),ft(s,0,i-e),o,a]),po=(t,e,n={})=>{const s=t.width,r=e.width;let i,o,a,c,l,u;return[i,o,l,u]=hr(n.sx||0,n.sy||0,n.w||s,n.h||t.height,s,t.height),[a,c,l,u,i,o]=hr(n.dx||0,n.dy||0,l,u,r,e.height,i,o),{sx:i,sy:o,dx:a,dy:c,rw:l,rh:u}},Dd=(t,e,n)=>{for(let s=t.length;s-- >0;)t[s]=n(t[s],e)},Nd=(t,e,n,s)=>{for(let r=t.length;r-- >0;)t[r]=s(t[r],n(e[r]))},$d=(t,e,n,s,r)=>{const i=~r;for(let o=t.length;o-- >0;)t[o]=t[o]&i|n(s(e[o]))&r},bo=(t,e,n)=>{const s=e.fromABGR,r=e.toABGR;for(let i=t.length;i-- >0;)t[i]=s(n(r(t[i])))},_o=t=>(t&255)<<16|t>>16&255|t&4278255360,Ld=(t,e,n={})=>(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):e).putImageData(t.toImageData(n.data),n.x||0,n.y||0),gr=(t,e)=>e>0?`(${t} << ${e})`:e<0?`(${t} >>> ${-e})`:`${t}`,fi=(t,e)=>gr(t,-e),Ac=t=>`0x${t.toString(16)}`,Cd=t=>{const e=8-t,n=(1<<t)-1;return new Function("luma",`return (x) => ${fi("luma(x)",e)} & ${n};`)(Md)},Od=t=>{let e;if(t!==8){const n=(1<<t)-1,s=255/n;e=`(((x & ${n}) * ${s}) | 0)`}else e="x";return new Function("x",`return 0xff000000 | (${e} * 0x010101);`)},Td=t=>new Function("x","return ("+t.map(e=>{const n=e.abgrShift+(8-e.size);return`(${fi("x",n)} & ${Ac(e.maskA)})`}).join(" | ")+") >>> 0;"),kd=(t,e)=>{const n=t.map(r=>{if(r.size!==8){const i=r.mask0,o=255/i,a=fi("x",r.shift);return gr(`((${a} & ${i}) * ${o})`,24-r.lane*8)}else return gr(`(x & ${Ac(r.maskA)})`,r.abgrShift)}).join(" | "),s=e?"":"0xff000000 | ";return new Function("x",`return (${s}${n}) >>> 0;`)},Bd=(t,e,n)=>{const s=1<<t.size,r=s-1,i=r<<n>>>0,o=~i>>>0,a=t.lane!=null?t.lane:e,c=u=>u>>>n&r,l=(u,d)=>u&o|(d&r)<<n;return{size:t.size,num:s,abgrShift:24-a*8-n,lane:a,shift:n,mask0:r,maskA:i,int:c,setInt:l,float:u=>c(u)/r,setFloat:(u,d)=>l(u,w(d)*r)}},di=t=>{M(t.channels.length>0,"no channel specs given");const e=t.channels.reduce(([n,s],r,i)=>(s-=r.size,n.push(Bd(r,i,s)),[n,s]),[[],t.size])[0];return{__packed:!0,type:t.type,size:t.size,alpha:t.alpha||0,channels:e,fromABGR:t.fromABGR||Td(e),toABGR:t.toABGR||kd(e,!!t.alpha)}},Pd=di({type:"u32",size:32,alpha:8,channels:[{size:8,lane:At.ALPHA},{size:8,lane:At.RED},{size:8,lane:At.GREEN},{size:8,lane:At.BLUE}],fromABGR:_o,toABGR:_o});kn({order(){return[0]},includes(t){return t>=0&&t<this.size[0]},indexAt(t){return this.includes(t)?this.indexAtUnsafe(t):-1},indexAtUnsafe(t){return this.offset+(t|0)*this.stride[0]},getAt(t){return this.includes(t)?this.data[this.indexAtUnsafe(t)]:0},getAtUnsafe(t){return this.data[this.indexAtUnsafe(t)]},setAt(t,e){return this.includes(t)?(this.data[this.indexAtUnsafe(t)]=e,!0):!1},setAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t)]=e,!0}});const wc=kn({order(){return Math.abs(this.stride[1])>Math.abs(this.stride[0])?[1,0]:[0,1]},includes(t,e){const n=this.size;return t>=0&&t<n[0]&&e>=0&&e<n[1]},indexAt(t,e){return this.includes(t,e)?this.indexAtUnsafe(t,e):-1},indexAtUnsafe(t,e){return this.offset+(t|0)*this.stride[0]+(e|0)*this.stride[1]},getAt(t,e){return this.includes(t,e)?this.data[this.indexAtUnsafe(t,e)]:0},getAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t,e)]},setAt(t,e,n){return this.includes(t,e)?(this.data[this.indexAtUnsafe(t,e)]=n,!0):!1},setAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e)]=n,!0}});kn({order(){return Ec(this.stride)},includes(t,e,n){const s=this.size;return t>=0&&t<s[0]&&e>=0&&e<s[1]&&n>=0&&n<s[2]},indexAt(t,e,n){return this.includes(t,e,n)?this.indexAtUnsafe(t,e,n):-1},indexAtUnsafe(t,e,n){const s=this.stride;return this.offset+(t|0)*s[0]+(e|0)*s[1]+(n|0)*s[2]},getAt(t,e,n){return this.includes(t,e,n)?this.data[this.indexAtUnsafe(t,e,n)]:0},getAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e,n)]},setAt(t,e,n,s){return this.includes(t,e,n)?(this.data[this.indexAtUnsafe(t,e,n)]=s,!0):!1},setAtUnsafe(t,e,n,s){return this.data[this.indexAtUnsafe(t,e,n)]=s,!0}});kn({order(){return Ec(this.stride)},includes(t,e,n,s){const r=this.size;return t>=0&&t<r[0]&&e>=0&&e<r[1]&&n>=0&&n<r[2]&&s>=0&&s<r[3]},indexAt(t,e,n,s){return this.includes(t,e,n,s)?this.indexAtUnsafe(t,e,n,s):-1},indexAtUnsafe(t,e,n,s){const r=this.stride;return this.offset+(t|0)*r[0]+(e|0)*r[1]+(n|0)*r[2]+(s|0)*r[3]},getAt(t,e,n,s){return this.includes(t,e,n,s)?this.data[this.indexAtUnsafe(t,e,n,s)]:0},getAtUnsafe(t,e,n,s){return this.data[this.indexAtUnsafe(t,e,n,s)]},setAt(t,e,n,s,r){return this.includes(t,e,n,s)?(this.data[this.indexAtUnsafe(t,e,n,s)]=r,!0):!1},setAtUnsafe(t,e,n,s,r){return this.data[this.indexAtUnsafe(t,e,n,s)]=r,!0}});const Ec=t=>[...t].map((e,n)=>[e,n]).sort((e,n)=>Math.abs(n[0])-Math.abs(e[0])).map(e=>e[1]),Gd=t=>{const e=(t>>>24)/255;return t&4278190080|(t>>>16&255)*e<<16|(t>>>8&255)*e<<8|(t&255)*e},Ud=t=>{const e=(t>>>24)/255;return e>0?(t&4278190080|Math.min(255,(t>>>16&255)/e)<<16|Math.min(255,(t>>>8&255)/e)<<8|Math.min(255,(t&255)/e))>>>0:t},Fd=t=>{const e=t>>>24;return(t>>>16&255)<=e&&(t>>>8&255)<=e&&(t&255)<=e},zd=(t,e,n,s=1)=>M(t.length>=e*n*s,"pixel buffer too small"),Hd=(t,e,n)=>t?(Rc(t,e,n),t):new ImageData(e,n),Rc=(t,e,n)=>M(t.width===e&&t.height===n,"imagedata has wrong dimensions"),Fn=(t,e)=>{const n=t.channels[e];return M(n!=null,`invalid channel ID: ${e}`),n},qd=t=>M(!!t.alpha,"missing alpha channel"),mr=di({type:"u32",size:32,alpha:8,channels:[{size:8,lane:At.ALPHA},{size:8,lane:At.BLUE},{size:8,lane:At.GREEN},{size:8,lane:At.RED}],fromABGR:es,toABGR:es}),Vd=(t,e,n=e,s,r)=>{const i=v(e)&&v(n)?Me(e,n,s,r):Me(t.width,t.height,s,r);return i.ctx.drawImage(t,0,0,i.canvas.width,i.canvas.height),i},Yd=async(t,e="anonymous")=>{const n=new Image;return n.crossOrigin=e,n.src=t,await n.decode(),n},Wd=Yd;function jd(t,e="linear",n="clamp"){const s=!!t.format.__float,r=t.format.channels.length===1?"1":"",i=`${e[0]}${n[0]}${r}`,o=(s?{nc1:zn,nw1:Hn,nr1:qn,nc:zn,nw:Hn,nr:qn,lc1:a=>zs(Ft(a)),lw1:a=>zs(zt(a)),lr1:a=>zs(Ht(a)),lc:a=>qs(a,zn(a)),lw:a=>qs(a,Hn(a)),lr:a=>qs(a,qn(a)),cc1:a=>Ys(Ft(a)),cw1:a=>Ys(zt(a)),cr1:a=>Ys(Ht(a)),cc:a=>js(a,zn(a)),cw:a=>js(a,Hn(a)),cr:a=>js(a,qn(a))}:{nc1:Ft,nw1:zt,nr1:Ht,nc:Ft,nw:zt,nr:Ht,lc1:a=>Zn(Ft(a)),lw1:a=>Zn(zt(a)),lr1:a=>Zn(Ht(a)),lc:a=>Hs(a,Ft(a)),lw:a=>Hs(a,zt(a)),lr:a=>Hs(a,Ht(a)),cc1:a=>Vs(a,Ft(a)),cw1:a=>Vs(a,zt(a)),cr1:a=>Vs(a,Ht(a)),cc:a=>Ws(a,Ft(a)),cw:a=>Ws(a,zt(a)),cr:a=>Ws(a,Ht(a))})[i];return M(!!o,`missing impl for ${i}`),o(t)}const Ft=({data:t,width:e,height:n})=>(s,r)=>s>=0&&s<e&&r>=0&&r<n?t[(r|0)*e+(s|0)]:0,zt=({data:t,width:e,height:n})=>(s,r)=>t[os(r|0,n)*e+os(s|0,e)],Ht=({data:t,width:e,height:n})=>{const s=e-1,r=n-1;return(i,o)=>t[ft(o|0,0,r)*e+ft(i|0,0,s)]},zn=({data:t,width:e,height:n,stride:[s,r]})=>(i,o)=>{let a;return i>=0&&i<e&&o>=0&&o<n?(a=(o|0)*r+(i|0)*s,t.slice(a,a+s)):[0]},Hn=({data:t,width:e,height:n,stride:[s,r]})=>(i,o)=>{let a=os(o|0,n)*r+os(i|0,e)*s;return t.slice(a,a+s)},qn=({data:t,width:e,height:n,stride:[s,r]})=>{const i=e-1,o=n-1;return(a,c)=>{let l=ft(c|0,0,o)*r+ft(a|0,0,i)*s;return t.slice(l,l+s)}},Ke=(t,e,n,s,r=4)=>fa(t[s],t[s+r],t[s+2*r],t[s+3*r],e,n),Zn=t=>(e,n)=>(e-=.5,n-=.5,fa(t(e,n),t(e+1,n),t(e,n+1),t(e+1,n+1),P(e),P(n))),zs=t=>(t=Zn(t),(e,n)=>[t(e,n)]),Hs=(t,e)=>{const{fromABGR:n,toABGR:s}=t.format,r=new Uint32Array(4),i=new Uint8Array(r.buffer);return(o,a)=>{o-=.5,a-=.5,r[0]=s(e(o,a)),r[1]=s(e(o+1,a)),r[2]=s(e(o,a+1)),r[3]=s(e(o+1,a+1));const c=P(o),l=P(a);return n(Ke(i,c,l,0)|Ke(i,c,l,1)<<8|Ke(i,c,l,2)<<16|Ke(i,c,l,3)<<24)>>>0}},qs=({stride:[t]},e)=>{const n=new Float32Array(t*4);return(s,r)=>{s-=.5,r-=.5,n.set(e(s,r),0),n.set(e(s+1,r),t),n.set(e(s,r+1),t*2),n.set(e(s+1,r+1),t*3);const i=P(s),o=P(r);let a=[];for(let c=0;c<t;c++)a.push(Ke(n,i,o,c,t));return a}},Sc=t=>(e,n)=>{e-=.5,n-=.5;const s=e-1,r=e+1,i=e+2,o=n-1,a=n+1,c=n+2;return da(t(s,o),t(e,o),t(r,o),t(i,o),t(s,n),t(e,n),t(r,n),t(i,n),t(s,a),t(e,a),t(r,a),t(i,a),t(s,c),t(e,c),t(r,c),t(i,c),P(e),P(n))},Vs=(t,e)=>{const n=t.format.channels[0].mask0;return e=Sc(e),(s,r)=>ft(e(s,r),0,n)},Ys=t=>(t=Sc(t),(e,n)=>[t(e,n)]),Ic=(t,e,n,s,r=4)=>da(t[s],t[s+r],t[s+2*r],t[s+3*r],t[s+4*r],t[s+5*r],t[s+6*r],t[s+7*r],t[s+8*r],t[s+9*r],t[s+10*r],t[s+11*r],t[s+12*r],t[s+13*r],t[s+14*r],t[s+15*r],e,n),Vn=(t,e,n,s,r=4)=>ft(Ic(t,e,n,s,r),0,255),Ws=(t,e)=>{const{fromABGR:n,toABGR:s}=t.format,r=new Uint32Array(16),i=new Uint8Array(r.buffer);return(o,a)=>{o-=.5,a-=.5;const c=o-1,l=o+1,u=o+2,d=a-1,f=a+1,h=a+2,g=P(o),m=P(a);return r[0]=s(e(c,d)),r[1]=s(e(o,d)),r[2]=s(e(l,d)),r[3]=s(e(u,d)),r[4]=s(e(c,a)),r[5]=s(e(o,a)),r[6]=s(e(l,a)),r[7]=s(e(u,a)),r[8]=s(e(c,f)),r[9]=s(e(o,f)),r[10]=s(e(l,f)),r[11]=s(e(u,f)),r[12]=s(e(c,h)),r[13]=s(e(o,h)),r[14]=s(e(l,h)),r[15]=s(e(u,h)),n(Vn(i,g,m,0)|Vn(i,g,m,1)<<8|Vn(i,g,m,2)<<16|Vn(i,g,m,3)<<24)>>>0}},js=({stride:[t]},e)=>{const n=new Float32Array(t*16);return(s,r)=>{s-=.5,r-=.5;const i=s-1,o=s+1,a=s+2,c=r-1,l=r+1,u=r+2,d=P(s),f=P(r);n.set(e(i,c),0),n.set(e(s,c),t),n.set(e(o,c),2*t),n.set(e(a,c),3*t),n.set(e(i,r),4*t),n.set(e(s,r),5*t),n.set(e(o,r),6*t),n.set(e(a,r),7*t),n.set(e(i,l),8*t),n.set(e(s,l),9*t),n.set(e(o,l),10*t),n.set(e(a,l),11*t),n.set(e(i,u),12*t),n.set(e(s,u),13*t),n.set(e(o,u),14*t),n.set(e(a,u),15*t);let h=[];for(let g=0;g<t;g++)h.push(Ic(n,d,f,g,t));return h}};var xd=Object.getOwnPropertyDescriptor,Xd=(t,e,n,s)=>{for(var r=s>1?void 0:s?xd(e,n):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(r=o(r)||r);return r};function Zd(...t){return t[0]instanceof Lt?t[0].as(t[1]):new Lt(...t)}const Jd=(t,e,n,s=n)=>Kd(Vd(t,n,s).canvas,e),Kd=(t,e=mr)=>{const{data:n}=Sd(t),s=t.width,r=t.height;let i;if(e===mr)i=n;else{i=xn(e.type,s*r);const o=n,a=e.fromABGR;for(let c=i.length;c-- >0;)i[c]=a(o[c])}return new Lt(s,r,e,i)};let Lt=class{size;stride;format;data;constructor(t,e,n=mr,s){this.size=[t,e],this.stride=[1,t],this.format=n.__packed?n:di(n),this.data=s||xn(n.type,t*e)}get pixels(){return this.data}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}get dim(){return 2}*[Symbol.iterator](){yield*this.data}as(t){return this.getRegion(0,0,this.width,this.height,t)}copy(){const t=this.empty();return t.data.set(this.data),t}empty(){return new Lt(this.width,this.height,this.format)}order(){}includes(t,e){}indexAt(t,e){}indexAtUnsafe(t,e){}getAt(t,e){}getAtUnsafe(t,e){}setAt(t,e,n){}setAtUnsafe(t,e,n){}getChannelAt(t,e,n,s=!1){const r=Fn(this.format,n),i=this.getAt(t,e);return s?r.float(i):r.int(i)}setChannelAt(t,e,n,s,r=!1){const i=Fn(this.format,n),o=this.getAt(t,e);return r?i.setFloat(o,s):i.setInt(o,s),this}blend(t,e,n){let s=this.width,r=e.width;const{sx:i,sy:o,dx:a,dy:c,rw:l,rh:u}=po(this,e,n);if(l<1||u<1)return e;const d=this.data,f=e.data,h=this.format.toABGR,g=e.format.toABGR,m=e.format.fromABGR;for(let _=(i|0)+(o|0)*s,b=(a|0)+(c|0)*r,y=0;y<u;y++,_+=s,b+=r)for(let D=0;D<l;D++)f[b+D]=m(t(h(d[_+D]),g(f[b+D])));return e}blit(t,e){let n=this.width,s=t.width;const{sx:r,sy:i,dx:o,dy:a,rw:c,rh:l}=po(this,t,e);if(c<1||l<1)return t;const u=this.data,d=t.data,f=this.format.toABGR,h=t.format.fromABGR,g=this.format!==t.format?(m,_)=>{for(let b=0;b<c;b++)d[_+b]=h(f(u[m+b]))}:(m,_)=>d.set(u.subarray(m,m+c),_);for(let m=(r|0)+(i|0)*n,_=(o|0)+(a|0)*s,b=0;b<l;b++,m+=n,_+=s)g(m,_);return t}blitCanvas(t,e={}){Ld(this,t,e)}setImageData(t){Rc(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,s=this.format.fromABGR;for(let r=e.length;r-- >0;)n[r]=s(e[r]);return this}toImageData(t){t=Hd(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,s=this.format.toABGR;for(let r=e.length;r-- >0;)e[r]=s(n[r]);return t}getRegion(t,e,n,s,r){const[i,o,a,c]=hr(t,e,n,s,this.width,this.height);if(!(a<1||c<1))return this.blit(new Lt(a,c,r||this.format),{sx:i,sy:o,w:a,h:c})}getChannel(t){const e=Fn(this.format,t),n=new Lt(this.width,this.height,{type:O0(e.size),size:e.size,channels:[{size:e.size,lane:At.RED}],fromABGR:Cd(e.size),toABGR:Od(e.size)}),s=this.data,r=n.data,i=e.int;for(let o=s.length;o-- >0;)r[o]=i(s[o]);return n}setChannel(t,e){const n=Fn(this.format,t),s=this.data,r=n.setInt;if(v(e))Dd(s,e,r);else{const i=e.data,o=e.format.channels[0];zd(i,this.width,this.height),n.size===o.size?Nd(s,i,o.int,r):$d(s,i,this.format.fromABGR,e.format.toABGR,n.maskA)}return this}invert(){const{data:t,format:e}=this,n=Math.pow(2,e.size-e.alpha)-1;for(let s=t.length;s-- >0;)t[s]^=n;return this}premultiply(){return qd(this.format),bo(this.data,this.format,Gd),this}postmultiply(){return bo(this.data,this.format,Ud),this}isPremultiplied(){const t=this.data,e=this.format.toABGR;for(let n=t.length;n-- >0;)if(!Fd(e(t[n])))return!1;return!0}forEach(t){const e=this.data;for(let n=e.length;n-- >0;)e[n]=t(e[n],n);return this}fill(t){this.data.fill(t)}flipX(){const{data:t,width:e}=this;for(let n=0;n<t.length;n+=e)t.subarray(n,n+e).reverse();return this}flipY(){const{data:t,width:e}=this,n=xn(this.format.type,e);for(let s=0,r=t.length-e;s<r;s+=e,r-=e)n.set(t.subarray(s,s+e)),t.copyWithin(s,r,r+e),t.set(n,r);return this}rotateByID(t){return t>0?this[Id[t-1]]():this}rotateCW(){const{width:t,height:e}=this,n=e-1;return this._rotate((s,r)=>s*e+n-r),this.size[0]=e,this.size[1]=t,this}rotateCCW(){const{width:t,height:e}=this,n=t-1;return this._rotate((s,r)=>(n-s)*e+r),this.size[0]=e,this.size[1]=t,this}rotate180(){const{width:t,height:e}=this,n=t-1,s=e-1;return this._rotate((r,i)=>(s-i)*t+n-r),this}scale(t,e="linear"){return M(t>0,"scale must be > 0"),this.resize(this.width*t,this.height*t,e)}resize(t,e,n="linear"){t|=0,e|=0,M(t>0&&e>0,"target width & height must be > 0");const s=Zd(t,e,this.format),r=s.data,i=t>0?this.width/t:0,o=e>0?this.height/e:0;n=B(n)?jd(this,n,"repeat"):n;for(let a=0,c=0;a<e;a++){const l=a*o;for(let u=0;u<t;u++,c++)r[c]=n(u*i,l)}return s}upsize(){const{width:t,height:e,data:n}=this,s=new Lt(t*2,e*2,this.format),r=s.data;for(let i=0,o=0;i<e;i++)for(let a=0,c=i*t*4;a<t;a++,o++,c+=2)r[c]=n[o];return s}_rotate(t){const{data:e,format:n,width:s,height:r}=this,i=xn(n.type,s*r);for(let o=0;o<r;o++)for(let a=0;a<s;a++)i[t(a,o)]=e[o*s+a];this.data=i}};Lt=Xd([wc],Lt);class Jt{constructor(e,n){this.mode=e,this.value=n}deref(){return this.value}}const Qd={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",grey:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32",transparent:"0000",rebeccapurple:"639"};let th={canvas:"fff",canvastext:"000",linktext:"001ee4",visitedtext:"4e2386",activetext:"eb3323",buttonface:"ddd",buttontext:"000",buttonborder:"000",field:"fff",fieldtext:"000",highlight:"bbd5fb",highlighttext:"000",mark:"000",marktext:"fff",graytext:"808080"};const Mc=(t,e,n)=>T(t||e,e[0],e[1],e[2],n),eh=t=>t.mode,nh=t=>(t&3840)*4352|(t&240)*272|(t&15)*17,sh=t=>((t&61440)*69632|(t&3840)*4352|(t&240)*272|(t&15)*17)>>>0,Ds=(t,e)=>T(t||[],(e>>>16&255)*rt,(e>>>8&255)*rt,(e&255)*rt,(e>>>24)*rt),Dc=(t,e)=>T(t||[],(e&255)*rt,(e>>>8&255)*rt,(e>>>16&255)*rt,(e>>>24)*rt),rh=t=>{t=(B(t)?t:t.deref()).toLowerCase();const e=Qd[t]||th[t];if(e||t[0]==="#")return new Jt("srgb",Ds([],oh(e||t)));const n=t.split(/[(),/ ]+/),[s,r,i,o,a]=n;switch(M(n.length===5||n.length===6,`invalid color: ${t}`),s){case"rgb":case"rgba":return new Jt("srgb",[q(r,1,rt,!0),q(i,1,rt,!0),q(o,1,rt,!0),ye(a)]);case"hsl":case"hsla":return new Jt("hsl",[xs(r),yo(i),yo(o),ye(a)]);case"lab":return new Jt("lab50",[q(r),q(i,1.25),q(o,1.25),ye(a)]);case"lch":return new Jt(s,[q(r),q(i,1.5),xs(o),ye(a)]);case"oklab":return new Jt(s,[q(r,1,1),q(i,.4,1),q(o,.4,1),ye(a)]);case"oklch":return new Jt(s,[q(r,1,1),q(i,.4,1),xs(o),ye(a)]);default:Et(`color mode: ${s}`)}},ih={rad:O,grad:400,turn:1,deg:360},xs=t=>{const e=/^(-?[0-9.]+)(deg|rad|grad|turn)?$/.exec(t);return M(!!e,`expected hue, got: ${t}`),P(parseFloat(e[1])/(ih[e[2]]||360))},ye=t=>t?q(t,1,1,!0):1,yo=(t,e=!0)=>{M(/^([0-9.]+)%$/.test(t),`expected percentage, got: ${t}`);const n=parseFloat(t)/100;return e?w(n):n},q=(t,e=1,n=.01,s=!1)=>{M(/^-?[0-9.]+%?$/.test(t),`expected number or percentage, got: ${t}`);const r=parseFloat(t)*(t.endsWith("%")?.01*e:n);return s?w(r):r},oh=t=>{const e=/^#?([0-9a-f]{3,8})$/i.exec(t);if(e){const n=e[1],s=parseInt(n,16);switch(n.length){case 3:return(nh(s)|4278190080)>>>0;case 4:return Hi(sh(s),8);case 6:return(s|4278190080)>>>0;case 8:return Hi(s,8)}}return lt(`invalid hex color: "${t}"`)},ah=Aa((t,e=3,n=",",s="[",r="]")=>{const i=typeof e=="number"?Ea(e):e;switch(t){case 1:return o=>`${s}${i(o[0])}${r}`;case 2:return o=>`${s}${i(o[0])}${n}${i(o[1])}${r}`;case 3:return o=>`${s}${i(o[0])}${n}${i(o[1])}${n}${i(o[2])}${r}`;case 4:return o=>`${s}${i(o[0])}${n}${i(o[1])}${n}${i(o[2])}${n}${i(o[3])}${r}`;default:return o=>{const a=[];for(let c=0;c<o.length;c++)a.push(i(o[c]));return`${s}${a.join(n)}${r}`}}}),Nc=t=>{const e=t.channels||{},n=t.order,s=n.length;n.reduce((f,h)=>(f[h]={range:[0,1],...e[h]},f),e);const r=Object.freeze(n.map(f=>e[f].range[0])),i=Object.freeze(n.map(f=>e[f].range[1])),o=ie([],r),a=ie([],i);o[s-1]=1;const c=n.findIndex(f=>!!e[f].hue),l=class{constructor(f,h=0,g=1){this.offset=h,this.stride=g,this.buf=f||[0,0,0,0],this.offset=h,this.stride=g}buf;get mode(){return t.mode}get length(){return s}get range(){return[r,i]}get[Symbol.toStringTag](){return t.mode}get xyz(){return[this[0],this[1],this[2]]}[Symbol.iterator](){return U0(this.buf,this.length,this.offset,this.stride)}copy(){return new l(this.deref())}copyView(){return new l(this.buf,this.offset,this.stride)}empty(){return new l}deref(){return[this[0],this[1],this[2],this[3]]}set(f){return ie(this,f)}clamp(){return c>=0&&(this[c]=P(this[c])),B0(null,this,r,i),this}eqDelta(f,h=U){return la(this,f,h)}randomize(f){return Sa(this,o,a,f)}toJSON(){return this.deref()}toString(){return ah(4,4)(this)}};A0(l.prototype,n),qi(t.mode,t.from),qi("rgb",{[t.mode]:t.toRgb});const u=(f,h,g)=>{const m=new l(...g);return h!==t.mode?Da(m,f,t.mode,h):m.set(f)},d=(f,...h)=>f==null?new l:B(f)?d(rh(f),...h):vs(f)?B(f.mode)?u(f,f.mode,h):new l(f,...h):ct(f,"deref")?u(f.deref(),f.mode,h):v(f)?h.length&&h.every(v)?new l(...J0([f,...h])):u(Ds([],f),"srgb",h):lt(`can't create a ${t.mode} color from: ${f}`);return d.class=l,d.range=[r,i],d.random=(f,h,g,m)=>new l(h,g,m).randomize(f),d.mapBuffer=(f,h=f.length/s|0,g=0,m=1,_=s)=>T0(l,f,h,g,m,_),d},pr=(t,e=Na)=>zr(t,e),ch=t=>zr(t,W0),lh=t=>((t>>>16&255)*76+(t>>>8&255)*150+(t&255)*29)/65025,uh=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/65025,fh=t=>lh(t[0]),dh=t=>uh(t[0]),hi=(t,e,n=1)=>(e=P(e)*6,T(t||[],w(Math.abs(e-3)-1),w(2-Math.abs(e-2)),w(2-Math.abs(e-4)),n)),$c=(t,e)=>{const n=e[0];let s=e[1];const r=e[2],i=hi(t||e,n,Y(e[3])),o=pr(i);return r<o?s*=r/o:o<1&&(s*=(1-r)/(1-o)),Q(i,w((i[0]-o)*s+r),w((i[1]-o)*s+r),w((i[2]-o)*s+r))},Lc=(t,e)=>{t=xr(t||e,e);const n=t[1],s=t[2];if(n<1e-6)return Q(t,s,s,s);const r=t[0]*6%6,i=s*(1-n),o=1-Math.abs(r%2-1);let a=3*s*n/(1+o);const c=a*o+i;switch(a+=i,r|0){case 0:return Q(t,a,c,i);case 1:return Q(t,c,a,i);case 2:return Q(t,i,a,c);case 3:return Q(t,i,c,a);case 4:return Q(t,c,i,a);case 5:return Q(t,a,i,c);default:return Q(t,i,i,i)}},Cc=(t,e)=>{const n=w(e[1]),s=w(e[2]);t=hi(t||e,e[0],Y(e[3]));const r=(1-Math.abs(2*s-1))*n;return Q(t,(t[0]-.5)*r+s,(t[1]-.5)*r+s,(t[2]-.5)*r+s)},Oc=(t,e)=>{t=xr(t||e,e);const n=t[1],s=t[2];return hi(t,e[0],t[3]),Q(t,((t[0]-1)*n+1)*s,((t[1]-1)*n+1)*s,((t[2]-1)*n+1)*s)},Ns=(t,e)=>T(t||e,ks(e[0]),ks(e[1]),ks(e[2]),Y(e[3])),hh=(t,e)=>Ns(null,Ds(t,e)),gh=(t,e)=>Ns(null,Dc(t,e)),mh=[4.0767416621,-1.2684380046,-.0041960863,-3.307711591,2.6097574011,-.7034186147,.2309699292,-.3413193965,1.707614701],ph=(t,{0:e,1:n,2:s,3:r})=>Ca(t,mh,[(e+.3963377774*n+.2158037573*s)**3,(e-.1055613458*n-.0638541728*s)**3,(e-.0894841775*n-1.291485548*s)**3,r]),bh=(t,e)=>{const{0:n,1:s,2:r}=e;return T(t||e,zi(r*n,s),r,zi(r*(1-n-s),s),Y(e[3]))},_h=(t,e,n=Na)=>{const s=e[0],r=(2-2*n[2])*e[1],i=(2-2*n[0])*e[2];return T(t||e,s+i,s-n[2]/n[1]*r-n[0]/n[1]*i,s+r,Y(e[3]))},gi=Nc({mode:"rgb",order:["r","g","b","alpha"],from:{abgr32:(t,e)=>gh(t,e[0]),argb32:(t,e)=>hh(t,e[0]),hcy:$c,hsi:Lc,hsl:Cc,hsv:Oc,lab50:ls,lab65:ka,lch:[Ta,ls],oklab:ph,rgb:ie,srgb:Ns,xyy:[bh,ar],xyz50:Zr,xyz65:ar,ycc:_h},toRgb:ie}),fn=Nc({mode:"srgb",order:["r","g","b","alpha"],from:{abgr32:(t,e)=>Dc(t,e[0]),argb32:(t,e)=>Ds(t,e[0]),hcy:$c,hsi:Lc,hsl:Cc,hsv:Oc,rgb:ln},toRgb:Ns});function yh(t,...e){let[n,s,r,i,o,a,c,l]=e;switch(e.length){case 1:return(...u)=>t(n,...u);case 2:return(...u)=>t(n,s,...u);case 3:return(...u)=>t(n,s,r,...u);case 4:return(...u)=>t(n,s,r,i,...u);case 5:return(...u)=>t(n,s,r,i,o,...u);case 6:return(...u)=>t(n,s,r,i,o,a,...u);case 7:return(...u)=>t(n,s,r,i,o,a,c,...u);case 8:return(...u)=>t(n,s,r,i,o,a,c,l,...u);default:lt()}}const vh=(t,e)=>Ot(H(([n,s,r,i])=>w(n+s*Math.cos(O*(r*e+i)))),oe(),nr(...t)),vo=(t,e,n)=>Ot(Nn(H(yh(vh,e)),dd()),oe(),Ia(t-1)),Ao=(t,e)=>{t=Yi([],t),e=Yi([],e);const n=[...H(([s,r])=>.5*(s-r),nr(t,e))];return[[...H(([s,r])=>s-r,nr(t,n))],n,[-.5,-.5,-.5,-.5],[0,0,0,0]]},Ah=Pt(eh,{lch:"lab",oklab:"lab",ycc:"lab",xyy:"hcy"},{argb32:fh,abgr32:dh,hcy:t=>t[2],lab:t=>t[0],rgb:pr,srgb:ch,xyz:t=>t[1],[x]:t=>pr(gi(t))}),qe=.072,Ve=.213,wh=.285,Ye=.715,Eh=.787,Rh=.928,Ne=rf,Sh=(t,...e)=>e.reduce(of,t),Tc=t=>[1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0],Ih=(t,e=.5*(1-t))=>[t,0,0,0,e,0,t,0,0,e,0,0,t,0,e,0,0,0,1,0],Mh=t=>[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],wo=t=>[Ve+Eh*t,Ye-Ye*t,qe-qe*t,0,0,Ve-Ve*t,Ye+wh*t,qe-qe*t,0,0,Ve-Ve*t,Ye-Ye*t,qe+Rh*t,0,0,0,0,0,1,0],Dh=t=>t,Nh=(t,e,n,s)=>{if(n===void 0||s===void 0){const r=t.timeBounds();n=n??r[0],s=s??r[1]}return H(r=>(r=ne(n,s,r),[r,t.at(r)]),Ia(e))};class Be{constructor(e,n,s){this.impl=e,this.stops=n,M(n.length>=2,"require at least 2 keyframes/stops");const r={domain:Dh,...s};this.domain=r.domain,this.sort()}domain;copy(){return new Be(this.impl,this.stops.map(e=>e.slice()))}empty(){return new Be(this.impl,[])}at(e){const{domain:n,impl:s,stops:r}=this,i=r.length-1,o=r[0],a=r[i];e=n(e,o[0],a[0]);const c=this.timeIndex(e);return c<0?o[1]:c>=i?a[1]:s.at(r,c,e)}samples(e=100,n,s){return Nh(this,e,n,s)}bounds(){const{impl:e,stops:n}=this,s=n.length;let r=null,i=null;for(let o=s;o-- >0;){const a=n[o][1];r=e.min(r,a),i=e.max(i,a)}return{min:r,max:i,minT:n[0][0],maxT:n[s-1][0]}}timeBounds(){return[this.stops[0][0],Qo(this.stops)[0]]}setStopAt(e,n,s=.01){const r=this.closestIndex(e,s);return r<0?(this.stops.push([e,n]),this.sort(),!0):(this.stops[r][1]=n,!1)}removeStopAt(e,n=.01){return this.stops.length>2?this.removeStopAtIndex(this.closestIndex(e,n)):!1}removeStopAtIndex(e){const n=this.stops;return e<0||e>=n.length||n.length<=2?!1:(n.splice(e,1),!0)}closestIndex(e,n=.01){const s=this.stops;for(let r=s.length;r-- >0;)if(qu(e,s[r][0])<n)return r;return-1}clampedIndexTime(e,n,s=.01){const r=this.stops,i=r.length-1;return e==0?Math.min(n,r[1][0]-s):e===i?Math.max(n,r[i-1][0]+s):ft(n,r[e-1][0]+s,r[e+1][0]-s)}sort(){this.stops.sort((e,n)=>e[0]-n[0])}uniform(){const e=this.stops.length-1;this.stops.forEach((n,s)=>n[0]=s/e)}timeIndex(e){const n=this.stops,s=n.length;if(s<256){for(let i=s;i-- >0;)if(e>=n[i][0])return i;return-1}const r=pd(n,[e,null],i=>i[0],md);return r<-1?-(r+2):r}}const $h=(t,e)=>new Be(Lh,t,e),Lh={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>{const s=t.length-1,r=t[Math.max(e-1,0)],[i,o]=t[Math.max(e,0)],[a,c]=t[Math.min(e+1,s)],l=t[Math.min(e+2,s)],u=ki(r[1],c,0,r[0],a),d=ki(o,l[1],0,i,l[0]);return Wu(o,u,c,d,Gr(n,i,a))}},Ch=(t,e)=>new Be(Oh,t,e),Oh={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>{const s=t[e],r=t[e+1];return st(n,s[0],r[0],s[1],r[1])}},kc=4,Yn=1<<kc,Bc=8,Th=1<<Bc,mt=4095;let Pc=4,Gc=.5;const Xs=t=>.5*(1-Math.cos(t*Math.PI));let ot;const kh=function(t,e=0,n=0){if(ot==null){ot=new Array(mt+1);for(let _=0;_<mt+1;_++)ot[_]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),n<0&&(n=-n);let s=Math.floor(t),r=Math.floor(e),i=Math.floor(n),o=t-s,a=e-r,c=n-i,l,u,d=0,f=.5,h,g,m;for(let _=0;_<Pc;_++){let b=s+(r<<kc)+(i<<Bc);l=Xs(o),u=Xs(a),h=ot[b&mt],h+=l*(ot[b+1&mt]-h),g=ot[b+Yn&mt],g+=l*(ot[b+Yn+1&mt]-g),h+=u*(g-h),b+=Th,g=ot[b&mt],g+=l*(ot[b+1&mt]-g),m=ot[b+Yn&mt],m+=l*(ot[b+Yn+1&mt]-m),g+=u*(m-g),h+=Xs(c)*(g-h),d+=h*f,f*=Gc,s<<=1,o*=2,r<<=1,a*=2,i<<=1,c*=2,o>=1&&(s++,o--),a>=1&&(r++,a--),c>=1&&(i++,c--)}return d},Bh=function(t,e){t>0&&(Pc=t),e>0&&(Gc=e)},br={sinTimesCos:Gh,sinFractCos:qh,sinPlusCos:Uh,sinPlusSin:Fh,cos:zh,sin:Hh,hopalong:Vh,clifford:Yh,deJong:Wh,gumowskiMira:Xh,bedhead:jh,fractalDream:xh,perlin:Ph,radial:_r,macMillan:Zh,juan:Jh,nAttractor:Kh};function Ph([t,e],n){const s=n.lod?n.lod:4,r=n.falloff?n.falloff:.5;return Bh(s,r),(kh(t,e)-.5)*2}function Gh([t,e],n){return Math.sin(t)*Math.cos(e)}function Uh([t,e],n){return(Math.sin(t)+Math.cos(e))*.5}function Fh([t,e],n){return(Math.sin(t)+Math.sin(e))*.5}function zh([t,e],n){return Math.cos(t)}function Hh([t,e],n){return Math.sin(t)}function qh([t,e],n){return Math.sin(t)/Math.cos(e)}function Gt([t,e],[n,s],r=1){return r===0?Math.atan2(s,n)/it:Math.atan2(s-e,n-t)/it}function Vh([t,e],{a:n=1,b:s=1,c:r=1,mode:i=0}){const o=e-1-Math.sqrt(Math.abs(s*t-1-r))*Math.sign(t-1),a=n-t-1;return Gt([t,e],[o,a],i)}function Yh([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=Math.sin(n*e)+r*Math.cos(n*t),c=Math.sin(s*t)+i*Math.cos(s*e);return Gt([t,e],[a,c],o)}function Wh([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=Math.sin(n*e)-Math.cos(s*t),c=Math.sin(r*t)-Math.cos(i*e);return Gt([t,e],[a,c],o)}function jh([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=Math.sin(t*e/s)*e+Math.cos(n*t-e),c=t+Math.sin(e)/s;return Gt([t,e],[a,c],o)}function xh([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=Math.sin(s*e)+r*Math.sin(s*t),c=Math.sin(n*t)+i*Math.sin(n*e);return Gt([t,e],[a,c],o)}function Xh([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=n*t+(1-n)*2*t*t/(1+t*t),c=s*e*a,l=a-t;return Gt([t,e],[c,l],o)}function Zh([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=e,c=-a+2*n*e/(1-e*e)+s*e;return Gt([t,e],[a,c],o)}function Jh([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=Math.cos(n*t),c=Math.sin(s*e),l=a*a-c*c,u=2*Math.cos(r*t)*Math.sin(i*e);return Gt([t,e],[l,u],o)}function Kh([t,e],{a:n=1,b:s=1,c:r=1,d:i=1,mode:o=0}){const a=n*Math.sin(e-e*(e*e+1)/2)+s*Math.tanh(t-t*(t*t+1)/2),c=r*Math.sin(t-t*(t*t+1)/2)+i/Math.cosh(e-e*(e*e+1)/2);return Gt([t,e],[a,c],o)}function _r([t,e],{center:n=[0,0],exchangeInputs:s=!1}){const[r,i]=s?[n[1],n[0]]:n;return Math.atan2(e-i,t-r)/it}function Uc(t,e,n=!0){if(t<=e[0])return e[0];let s=0;for(;s<e.length-1;){if(t<=e[s+1])return n?t-e[s]<e[s+1]-t?e[s]:e[s+1]:e[s];s++}return e[e.length-1]}function Eo(t,e=[-1,1]){const n=[];if(t>1)for(let s=0;s<=t;s++)n.push(e[0]+(e[1]-e[0])*s/t);return n}function Qh(t,e,n,s,r=!0){const i=n.amplitude?n.amplitude:1;let[o,a]=e;n.scale&&(o*=n.scale[0],a*=n.scale[1]);let c=t(n.exchangeInputs?[a,o]:[o,a],n);return s==null||s.length==0?c*i:i*Uc(c,s,r)}function tg(t,e,n,s,r=!0){if(br[t])return Qh(br[t],e,n,s,r);throw new Error(`noise '${t}' is not implemented.`)}function Ro(t,{type:e="perlin",opts:n={scale:[1,1]},rotation:s=0,conversion:r="multiplyByPI",quantizationArray:i=[],quantizeToClosest:o=!0}){const a=e||"perlin";if(a==="radial"){const[d,f]=n.exchangeInputs?[t[1],t[0]]:t;return i==null||i.length==0?_r([d,f],n)*it:Uc(_r([d,f],n),i,o)*it}const c=tg(a,t,n,i,o),l=n.amplitude?n.amplitude:1;let u=1;switch(r){case"aCos":u=s+Math.acos(c/l);break;case"aSin":u=s+Math.asin(c/l);break;default:u=s+it*c}return Wl(u)}const eg=async t=>{const e=[];return t.length>0&&e.push(...(await Promise.all(t.map(n=>Wd(n)))).map(n=>Jd(n,Pd))),e},ng={min:(t,e)=>Math.min(t??1/0,e),max:(t,e)=>Math.max(t??-1/0,e),at:(t,e,n)=>t[e+1][1]},sg=(t,e)=>new Be(ng,t,e);function Fc(t,e){for(const n of e)if(xt(n,t))return!0;return!1}function Zs(t,e){let n=0;for(const s of e){if(xt(s,t))return n;n++}return-1}const We=t=>[((t=Math.floor(t))>>16&255)/255,(t>>8&255)/255,(255&t)/255],Qe=(t,e)=>t==="hermite"?$h(e):t==="linear"?Ch(e):sg(e),rg=(t,e,n,s)=>{const[r,i]=as([],e,n,s,[0,0],[t.width,t.height]);return t.getAt(Math.floor(r),Math.floor(i))},Nt=(t,e,n)=>ml(t,e,n)(),Wn=0xfffffffffn,ig=t=>new Uint32Array([Number(t>>96n&Wn),Number(t>>64n&Wn),Number(t>>32n&Wn),Number(t&Wn)]),og=t=>ig(BigInt("0x"+t.replace(/-/g,"").substring(0,32))),ag=(t,e=0)=>{const n=f=>t[f+3]<<24|t[f+2]<<16|t[f+1]<<8|t[f],s=(f,h)=>f<<h|f>>>32-h,r=(f,h)=>{const g=h+1&3;u[h]=Math.imul(s(u[h]^Math.imul(s(Math.imul(n(f),l[h]),15+h),l[g]),19-(h<<1))+u[g],5)+c[h]},i=f=>{const h=f[0]+=f[1]+f[2]+f[3];return f[1]+=h,f[2]+=h,f[3]+=h,f},o=f=>(f^=f>>>16,f=Math.imul(f,2246822507),f^=f>>>13,f=Math.imul(f,3266489909),f^=f>>>16),a=t.length,c=new Uint32Array([1444728091,197830471,2530024501,850148119]),l=new Uint32Array([597399067,2869860233,951274213,2716044179]),u=l.map(f=>f^e);let d=0;for(const f=a&-16;d<f;d+=16)r(d,0),r(d+4,1),r(d+8,2),r(d+12,3);c.fill(0);for(let f=a&15;f>0;f--){const h=f-1;if((f&3)===1){const g=f>>2;c[g]=s(Math.imul(c[g]^t[d+h],l[g]),15+g),u[g]^=Math.imul(c[g],l[g+1&3])}else c[h>>2]^=t[d+h]<<(h<<3)}return i(i(u.map(f=>f^a)).map(o))},cg=(t,e)=>ag(new TextEncoder().encode(t),e);function lg(t){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)}[...vo(10,Ao([0,0,.102],[.933,.996,1])).map(t=>An(Ne(null,wo(.8),t)))],[...vo(10,Ao([.067,0,0,1],[1,.996,.933,1])).map(t=>An(Ne(null,wo(.8),t)))];const So={0:[2120566,15130821,16291640,13845523,271427,.01,1.01,1.1],1:[4562234,16777215,6596594,4145473,1973791,0,1,1.2],2:[4470864,12303972,15397070,12633537,8225937,0,1.05,1.5],3:[13354938,15131351,2633011,3159101,4540754,.03,1,1],5:[12442047,3031122,16762967,16777215,4268596,-.03,1,1.5],6:[16250866,12965997,2497557,15001283,15752483,0,1,1],7:[5871085,279433,16580427,16755973,8171460,-.04,1,1.2],8:[13762590,2589067,7179309,15508269,15425574,.01,1,1],9:[1529984,16708813,10072218,7631457,2766650,0,1,1.02],11:[11907778,5930364,14344183,2305075,10535377,0,1,1.1],12:[10289158,1659231,6661793,15566395,15354668,0,1,1],13:[13515281,469832,2384251,16707790,16288806,.01,1,1.15],14:[13553870,1644825,15814693,16777215,15132902,0,1,1.15],15:[1317406,15791103,4211788,3751743,2041382,0,1,1],16:[657672,2241339,15392981,13020303,6180927,0,1,1.9],17:[3368330,8829912,7704143,16166445,15885337,0,1,1.12],18:[16711422,16168524,15351084,3817281,6535886,0,1,1.1],19:[7289398,13139994,14797476,9608602,5534304,0,1,1.2],20:[13859385,13784116,7498570,15786420,15508823,0,1,1.1],21:[9831194,16427286,16515070,7169902,1776414,0,1,1.1],22:[42733,8370176,863316,16142621,16757760,0,1.02,1.1],23:[5777159,9907463,16730942,16757263,16770376,0,1.01,1.05],24:[15718311,3939072,8763312,15848851,16328960,0,1,1.26],27:[6124414,16579836,135451,4145221,3156271,0,1,2],28:[9947562,13732155,15702825,3610381,13942932,0,1.05,1.2],29:[14303591,16044894,16177326,3031127,540023,0,1.02,1.1],30:[14155826,2829634,9279918,15594228,15672124,0,1,1],31:[6575426,8371106,16119484,15051558,12471335,0,1,1.15],32:[15125682,14530706,11569512,8344889,10249796,0,1.03,1.05],34:[2994148,13099310,16120284,3223857,4036282,0,1.02,1.2],35:[2735890,11272015,572861,15866687,16750868,0,1.05,1.1],36:[402725,1332558,15194544,16034598,792857,.01,1.03,1.04],37:[4004864,8763055,15783315,16263680,15718568,0,1.03,1.04],38:[15971407,15193272,14338478,1844529,16400720,.01,1.04,1.3],40:[14719784,15459775,2831168,1916524,5136224,0,1.03,1.07],41:[9667969,12965348,8283473,4612962,8951467,0,1.05,1.6],42:[1716574,10208227,15266296,3770568,15821646,0,1,1.15],44:[16706750,16154427,16008999,2952226,16245696,0,1.01,1.02],45:[14342093,10727818,5800279,3824192,3427905,0,1.03,1.16],47:[2508371,2792847,15320170,16032353,15167313,0,1,1.12],48:[6319160,2635288,16710368,14524766,12348453,0,1.03,1.1],49:[15260604,8761251,0,5308418,11494980,0,1,1],50:[3084589,12921662,8323635,16702104,8323635]};Object.keys(So).map(t=>{const e=So[t];return[We(e[4]),We(e[0]),We(e[1]),We(e[2]),We(e[3])]});const zc=(t,e,n,s=.001,r=!0)=>dn(t.supportData.distanceToCenter,0,e,r?n:s,r?s:n),ug=t=>Math.sqrt(Math.pow(t/2,2)+Math.pow(.5,2)),fg=(t,e,n,s)=>(n===void 0&&(n=-e/2),s===void 0&&(s=e/2),st(t[0],n,s,0,1)),Io=(t,e)=>{let n;return(t.update!==void 0||e.update!==void 0)&&(n=(s,r)=>Math.min(t.update?t.update(s,r):Number.MAX_VALUE,e.update?e.update(s,r):Number.MAX_VALUE)),{get:(s,r)=>Math.min(t.get(s,r),e.get(s,r)),update:n,info:"min("+t.info+", "+e.info+")",aux:t.aux}},qt=(t,e=0,n=1,s={},r=!1)=>{let i=[],o=0,a=1,c=t,l=0,u=s.cutoff??0,d=s.valueTransform??(g=>g),f=s.outputTransform??(g=>g);t==="width"||t==="height"?(i=t==="width"?["pos",0]:["pos",1],o=s.minValue??-.5,a=s.maxValue??.5):t==="agent ID"||t==="agent generation"?(i=t==="agent ID"?["ID"]:["generation"],o=s.minValue??0,a=s.maxValue??1):t==="space traveled"?(i=["spaceTraveled"],o=s.minValue??0,a=s.maxValue??1,l=1):t==="distance from center"&&(o=s.minValue??0,a=s.maxValue??Math.SQRT2);const h=(g,m)=>{const _=l===0?g:m;let b=0;if(i.length>0){const D=_[i[0]];i.length>1?b=D[i[1]]:b=D}b=d(b);let y=0;switch(t){case"random":y=s.rnd.minmax(e,n);break;case"distance from center":y=zc(g,a,e,n);break;case"pos inside bounds":Fc(g.pos,s.bounds)?y=e:y=n;break;case"image luminance":if(g.supportData.features&&g.supportData.features.length>s.imageIndex){const D=Ah(g.supportData.features[s.imageIndex]);D<u?y=1e-5:y=dn(D,o,a,e,n)}else y=a;break;default:y=dn(b,o,a,e,n);break}return f(y)};return{get:(g,m)=>h(g,m),update:r?(g,m)=>h(g,m):void 0,info:c,aux:[e,n]}};function dg(t,e,n,{decimatePercentage:s=0,elasticity:r=[0,0],minSize:i=.01,margin:o=0,shakeAmount:a=[[0,0],[0,0]],shuffleResult:c=!1},l){let u=n,d=e;Array.isArray(e)&&Array.isArray(n)?l.probability(.5)?u=Array.isArray(n)?l.minmaxInt(n[0],n[1]+1):n:d=Array.isArray(e)?l.minmaxInt(e[0],e[1]+1):e:v(n)&&v(e)&&(l.probability(.5)?u=[n,n]:d=[e,e]);let f=v(u)?0:1,h=t;if(f===1){let b=u;u=d,d=b,h=ue([t.pos[1],t.pos[0]],[t.size[1],t.size[0]])}const g=hg(h,u,d,r,i,o,l),m=[...fd(g)];f===1&&m.forEach(b=>{b.pos=[b.pos[1],b.pos[0]],b.size=[b.size[1],b.size[0]]});const _=Math.floor(m.length*s);return _>0&&mg(m,_,l),gg(m,a[0],a[1],l),c&&gd(m,m.length,l),m}function hg(t,e,n,s,r,i=0,o){const a=[];for(let c=0;c<e;c++){const l=[];a.push(l);let u=Array.isArray(n)?o.minmaxInt(n[0],n[1]+1):n;const d=[(t.size[0]-(u+1)*i)/u,(t.size[1]-(e+1)*i)/e];if(s[0]===0&&s[1]===0||d[0]<=r||u===1)for(let f=0;f<u;f++){const h=ue([t.pos[0]+i+f*(d[0]+i),t.pos[1]+i+c*(d[1]+i)],[d[0],d[1]]);l.push(h)}else{let f=t.pos[0]+i,h=t.pos[1]+i+c*(d[1]+i);for(let g=0;g<u;g++){let m=Math.min(Math.max(d[0]+o.minmax(s[0],s[1]),r),t.pos[0]+t.size[0]-((u-(g+1))*(r+i)+f+i));g===u-1&&(m=t.pos[0]+t.size[0]-i-f);const _=ue([f,h],[m,d[1]]);f+=m+i,l.push(_)}}}return a}function gg(t,[e,n],[s,r],i){return t.forEach(o=>{const a=i.minmax(e,n),c=i.minmax(s,r);o.pos=[o.pos[0]+a,o.pos[1]+c]}),t}function mg(t,e,n){for(let s=0;s<e;s++){const r=n.minmaxInt(0,t.length);t.splice(r,1)}return t}const ms={default:{matrix:uc,offset:[0,0,0,0]}},pg={brightness:0,contrast:0,filterMatrix:ms.default.matrix,filterOffset:ms.default.offset,exposure:0,saturation:0,simmetry:0,info:"default"};function bg(t){const e=1+t,n=.2126,s=.7152,r=.0722,i=(1-e)*n,o=(1-e)*s,a=(1-e)*r;return[i+e,i,i,0,o,o+e,o,0,a,a,a+e,0,0,0,0,1]}function mi(t){const e=bg(t.saturation||0);let n=t.filterMatrix||ms.default.matrix,s=t.filterOffset||ms.default.offset;return Sh(Tc(t.brightness||0),Ih(1+(t.contrast||0),-.5*(t.contrast||0)),Mh(1+(t.exposure||0)),[e[0],e[4],e[8],e[12],0,e[1],e[5],e[9],e[13],0,e[2],e[6],e[10],e[14],0,e[3],e[7],e[11],e[15],0],[n[0],n[4],n[8],n[12],s[0],n[1],n[5],n[9],n[13],s[1],n[2],n[6],n[10],n[14],s[2],n[3],n[7],n[11],n[15],s[3]])}function _g(t,e){const n=mi(e);t.colors.bg=t.colors.bg.map(s=>Ne([],n,fn(s))),t.colors.fg=t.colors.fg.map(s=>Ne([],n,fn(s))),t.background?.colors&&(t.background.colors=t.background.colors.map(s=>Ne([],n,fn(s))))}const yg=(t,e,n,s,r,i)=>{const o=[];return t.forEach((a,c)=>{if(e[c%e.length]){const l=r[c%r.length],u={weight:s[c%s.length],stroke:l};n[c%n.length]&&(u.fill=l),i&&(u.r=i[c%i.length]),a.attribs=u,o.push(a)}}),he({lineCap:"round",radius:300},o)},tn=["bounds","bounds-interp","distanceFromCenter","generation","id-nomix"],Jn={shadow_trip:["#0A121C","#DBCBB2"],trip_shadow:["#DBCBB2","#0A121C"],ego_dissolution:["#111111","#FCFCFC"],dissolution_ego:["#FCFCFC","#111111"],astral_drift:["#191B27","#D2D4C5"],drif_astral:["#D2D4C5","#191B27"]},vg=(t,e=Object.keys(br))=>{const n=A(e,t);let s=1,r=10,i=A(["multiplyByPI","aCos","aSin"],t),o=0;switch(n){case"fractalDream":s=1,r=1,i="multiplyByPI";break;case"clifford":s=1,r=1,i="multiplyByPI";break;case"hopalong":s=5,r=10,i="multiplyByPI";break;case"perlin":s=2,r=20;break;case"bedhead":s=1,r=1,i="multiplyByPI";break;case"gumowskiMira":s=1,r=1,i="multiplyByPI";break;case"deJong":s=1,r=1,i="multiplyByPI";break;case"macMillan":s=5,r=10,i="multiplyByPI",o=1;break;case"sinTimesCos":s=5,r=50,i="multiplyByPI";break;case"sinPlusCos":s=5,r=50,i="multiplyByPI";break;case"sin":case"cos":s=5,r=50,i="multiplyByPI";break;default:r=t.minmaxInt(1,100);break}const a=t.minmaxInt(s,r);return{type:n,opts:{scale:[a,a],amplitude:t.minmax(.5,1.5),a:t.minmax(-15,15),b:t.minmax(-15,15),c:t.minmax(-15,15),d:t.minmax(-15,15),mode:o,center:[t.minmax(-.5,.5),t.minmax(-.5,.5)],falloff:t.minmax(.01,.3),lod:t.minmaxInt(0,5)},conversion:i}},Ag=(t,e,n,s={})=>({name:"while_the_ego_sleeps",agent:()=>{const r=A([[2,2],[1,2],[.5,1],[.1,.5]],t.RND);return{get:i=>({angled:!1,step:t.RND.minmax(.01,.05),fuzziness:0,chance:1,maxLength:t.RND.minmax(r[0],r[1]),maxIteration:1e3,minSpaceBeforeDrawing:.3/Math.max(e,n)})}},agentFactory:({bounds:r})=>{let i=0;for(const o of r.aux)i+=se(o);return{maxNewPerIteration:5,maxIterations:A([4e3],t.RND_SYSTEM),maxSpaceTraveled:A([30,50,80,100],t.RND_SYSTEM),newPerIteration:0,maxActive:50,branch:t.RND_SYSTEM.minmaxInt(2,8),initialAgents:20,maxAgents:A([2e4],t.RND_SYSTEM),directions:[[0,1],[0,-1],[1,0],[-1,0]],initPolicy:o=>o.agents.length<30?"randomFree":"randomOccupied",neverEnding:!0,maxColliding:1e3}},alpha:({agentFactory:r,bounds:i})=>{const[o,a]=A([[.8,.01],[1,.01]],t.RND_STYLE),c=[qt("pos inside bounds",.7,a,{bounds:i.aux},!0),qt("random",a,o,{rnd:t.RND_STYLE}),qt("image luminance",0,1,{imageIndex:0},!0)];return s.alpha?c[Number.parseInt(s.alpha)]:A(c,t.RND_STYLE)},aspectRatio:e/n,assets:["./assets/"+A(["skagen.jpeg"],t.RND_STYLE)],background:({bounds:r,colors:i,scalingFactor:o})=>{const a=t.RND_STYLE.probability(.3),c={shapes:r.aux,fill:A([[0],[0,1]],t.RND_STYLE),draw:A([[1]],t.RND_STYLE),weights:r.aux.map(()=>a?2*o:1.5*Nt([1,2,3,5],[8,4,2,1],t.RND_STYLE)*o),rounds:[0],colors:[i.fg[0]],info:"all-inverted"};return{get:l=>{const u=yg(c.shapes,c.draw,c.fill,c.weights,c.colors,c.rounds);for(let d=1;d<i.fg.length;d++){const f=Nt(u.children,c.shapes.map((h,g)=>1-c.fill[g%c.fill.length]),t.RND_STYLE);f.attribs.stroke=i.fg[d],f.attribs.fill=i.fg[d]}return u},aux:c}},bounds:({aspectRatio:r})=>{const i=A([0,.1,.3],t.RND_BOUNDS),o=Ze([0,0],[r-i,1-i]),a=[o],c=A([t.RND_BOUNDS.minmaxInt(2,7),[2,6]],t.RND_BOUNDS),l=A([t.RND_BOUNDS.minmaxInt(1,5),[1,4]],t.RND_BOUNDS),u=t.RND_BOUNDS.probability(.4),d=t.RND_BOUNDS.minmaxInt(2,5),f=dg(i===0?Ze([0,0],[r-.15,1-.15]):o,u?d:l,u?d:c,{decimatePercentage:0,elasticity:u?[0,0]:[-.1,.1],minSize:.05,margin:t.RND_BOUNDS.minmax(.01,.02),shuffleResult:t.RND_BOUNDS.probability(.5),shakeAmount:A([void 0,[[-.001,.001],[-.001,.001]]],t.RND_BOUNDS)},t.RND_BOUNDS);let h=[is([0,0],(i===.3?.2:.25)*r)];return{get:g=>({init:h,update:f,overall:a}),aux:f,info:f.length}},colors:()=>{const r=s.palette||dl(Jn,t.RND_COLORS);return{bg:[An(Jn[r][0])],fg:Jn[r].slice(1).map(i=>An(i)),info:r}},halfDiagonal:({aspectRatio:r})=>ug(r),gridSize:[e,n],postprocess:{...pg,fadeAmount:.001},scalingFactor:(s.scalingFactor?s.scalingFactor:1)*(.3*Math.max(e,n))/1e3,style:({aspectRatio:r,bounds:i})=>{const o={type:"line | sanding",alphaDecay:l=>l*l/1.5,grainsFactorRange:[100,625],followBounds:!0,sizeFactor:A([.2,.35,.5],t.RND_STYLE),weightFactor:A([.35,.5,.7],t.RND_STYLE),doubleSided:!1,sameStyleOutsideBounds:t.RND_STYLE.probability(.2),sandedLineProbability:t.RND_STYLE.minmax(.9,1),sameWeightFactor:t.RND_STYLE.probability(.5),maxLength:[.1,.2],multiplyByImageLuminance:!1,grainsDistribution:A(["sin","uniform"],t.RND_STYLE),sandingZone:Nt([is([0,0],.35*r),ue([-.5*r,-.5],[.5*r,1]),ue([0,-.5],[.5*r,1]),Ze([0,0],[1*r,.7]),Ze([0,0],[1*r,1])],[4,1,1,1,1],t.RND_STYLE)};return{aux:o,get:(l,u)=>{const d=xt(o.sandingZone,l.pos);let f=l.pos[0]>(.25-.5)*r||l.pos[0]<(.75-.5)*r?1:.5;return f*=l.pos[1]>.25-.5||l.pos[1]<.75-.5?1:.5,{...o,type:t.RND_STYLE.probability(o.sandedLineProbability)&&d?"line | sanding":"line",grainsFactor:t.RND_STYLE.minmaxInt(o.grainsFactorRange[0],o.grainsFactorRange[1]),weightFactor:o.sameWeightFactor?o.weightFactor:A([.35,.5,1],t.RND_STYLE),maxLength:t.RND_STYLE.minmax(o.maxLength[0],o.maxLength[1])*f,sizeFactor:o.sameWeightFactor?o.sizeFactor:A([.2,.35,.5,.7],t.RND_STYLE),followBounds:!0}},update:(l,u)=>({type:l.attribs.style.type==="line"?"line":o.sameStyleOutsideBounds||Fc(l.pos,i.aux)?"line | sanding":"line"})}},stroke:({colors:r,bounds:i,background:o})=>{const a=(c,l)=>{const u=Zs(c.pos,i.aux);return u<0||o?.aux.fill[u%o.aux.fill.length]===0?r.fg[0]:r.bg[0]};return Nt([{info:"true inverted",get:a,update:a}],[6,1],t.RND_STYLE)},vector_field:({aspectRatio:r,agentFactory:i,bounds:o,halfDiagonal:a})=>{const c=[],l=s.vfNumber?s.vfNumber:t.RND_NOISE.minmaxInt(2,4),u=[],d=s.quantization?Eo(Number.parseInt(s.quantization)):Nt([[],Eo(t.RND_NOISE.minmaxInt(4,10))],[6,1],t.RND_NOISE);for(let y=0;y<l;y++)c.push({...vg(t.RND_NOISE,["sinTimesCos","sinPlusCos","sinPlusSin","cos","sin","hopalong","clifford","gumowskiMira","fractalDream","perlin","macMillan"]),rotation:0,quantizationArray:d}),u.push(c[y]);const f=[[0,0],[.2,1],[.4,0],[.6,0],[.8,1],[1,0]],h=s.interpolation?Qe(s.interpolation,f):Nt([Qe("hermite",f),Qe("linear",f),Qe("step",f)],[2,2,2],t.RND_NOISE),g="space traveled",m=s.mixStrategy?s.mixStrategy:A(tn,t.RND_NOISE);return{aux:u,info:{interpolatedBy:g,choice:m},get:(y,D)=>{const N=[];for(let $=0;$<l;$++)N.push(Ro(y.pos,c[$]));const dt=N[0];if(l===1)return dt;let Ut=h.at(D.spaceTraveled%i.maxSpaceTraveled/i.maxSpaceTraveled);const Ls=Math.floor(D.spaceTraveled/i.maxSpaceTraveled),Bn=tn.indexOf(m),W=tn[(Bn+Ls)%tn.length];if(W==="id-nomix"){const $=y.ID%(l-1);return N[$+1]}else if(W==="id"){const $=y.ID%(l-1);return ne(dt,N[$+1],Ut)}else if(W==="bounds-interp"){const $=Zs(y.pos,o.aux);return $<0?dt:ne(dt,N[$%(l-1)+1],Ut)}else if(W==="bounds"){const $=Zs(y.pos,o.aux);return $<0?dt:N[$%(l-1)+1]}else if(W==="distanceFromCenter"){const $=y.supportData.distanceToCenter/a,Fe=Math.floor($*(l-1));return ne(dt,N[Fe+1],Ut)}else if(W==="generation"){const $=y.generation%(l-1)/(l-1),Fe=Math.floor($*(l-1));return ne(dt,N[Fe+1],Ut)}else{const $=fg(y.pos,r),Fe=Math.floor($*(l-1));return ne(dt,N[Fe+1],Ut)}},getAt:(y,D)=>Ro(y,c[0])}},weight:({agentFactory:r,halfDiagonal:i,bounds:o,scalingFactor:a})=>{const c=a,[l,u]=A([[7.5*c,.75*c],[12*c,1*c]],t.RND_STYLE),d=[Io({get:(f,h)=>dn(f.ID%r.maxAgents,0,r.maxAgents,l,u),info:"agent ID",aux:[l,u]},qt("distance from center",l,u,{maxValue:i*.7},!0)),Io(qt("pos inside bounds",7.5*c,0,{bounds:o.aux},!0),qt("random",u,l,{rnd:t.RND_STYLE})),{...qt("random",u,l,{rnd:t.RND_STYLE}),update:f=>{const h=Math.min(f.attribs.weight,zc(f,i*.75,l));return f.history.length<.01&&h<5*c&&f.attribs.style&&f.attribs.style.type==="line"?8*c:h},info:"random / distance from center"},{...qt("random",u,l,{rnd:t.RND_STYLE}),update:f=>Math.min(f.attribs.weight,dn(f.history.length,0,.2,l,u)),info:"random / length"}];return s.weight?d[Number.parseInt(s.weight)]:Nt(d,[1,1,1,1,1,1],t.RND_STYLE)}}),Xt=(t,e,n=!0)=>{let s;n&&(s=e.fill)&&s!=="none"&&((s=e.fillRule)?t.fill(s):t.fill()),(s=e.stroke)&&s!=="none"&&t.stroke(),(s=e.clip)&&t.clip(s===!0?"nonzero":s)},yr=(t,e,n,s,r=0,i=O,o=!1)=>{t.beginPath(),t.arc(n[0],n[1],s,r,i,o),Xt(t,e)},vr=(t,e,n,s,r=0,i=0,o=O,a=!1)=>{t.beginPath(),t.ellipse(n[0],n[1],s[0],s[1],r,i,o,a),Xt(t,e)},pi=An,$s=(t,e)=>B(e)?e[0]==="$"?t.grads[e.substring(1)]:e:pi(e),Hc=(t,{from:e,to:n},s)=>{const r=t.createLinearGradient(e[0],e[1],n[0],n[1]);for(let i of s)r.addColorStop(i[0],pi(i[1]));return r},qc=(t,{from:e,to:n,r1:s,r2:r},i)=>{const o=t.createRadialGradient(e[0],e[1],s,n[0],n[1],r);for(let a of i)o.addColorStop(a[0],pi(a[1]));return o},Vc=(t,e,{width:n,height:s},r,i,o,a)=>{if(ct(r,"toImageData")&&(r=r.toImageData()),r instanceof ImageData){t.putImageData(r,i[0],i[1]);return}n=n||r.width,s=s||r.height,o?t.drawImage(r,o[0],o[1],a?a[0]:n,a?a[1]:s,i[0],i[1],n,s):t.drawImage(r,i[0],i[1],n,s)},wg={align:"left",alpha:1,baseline:"alphabetic",compose:"source-over",dash:[],dashOffset:0,direction:"inherit",fill:"#000",filter:"none",font:"10px sans-serif",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",shadowX:0,shadowY:0,smooth:!0,stroke:"#000",weight:1},Yc={align:"textAlign",alpha:"globalAlpha",baseline:"textBaseline",clip:"clip",compose:"globalCompositeOperation",dash:"setLineDash",dashOffset:"lineDashOffset",direction:"direction",fill:"fillStyle",fillRule:"fillRule",filter:"filter",font:"font",lineCap:"lineCap",lineJoin:"lineJoin",miterLimit:"miterLimit",shadowBlur:"shadowBlur",shadowColor:"shadowColor",shadowX:"shadowOffsetX",shadowY:"shadowOffsetY",smooth:"imageSmoothingEnabled",stroke:"strokeStyle",weight:"lineWidth"},Mo=(t,e=!1)=>({attribs:{...t.attribs},grads:{...t.grads},edits:[],restore:e}),Eg=(t,e,n)=>{let s;if(n){Sg(t,n)&&(s=Mo(e,!0));for(let r in n){const i=Yc[r];if(i){const o=n[r];o!=null&&e.attribs[r]!==o&&(!s&&(s=Mo(e)),s.attribs[r]=o,s.edits.push(r),Wc(t,e,r,i,o))}else(r==="__background"||r==="__clear")&&(t.save(),t.resetTransform(),r==="__clear"?n[r]&&t.clearRect(0,0,t.canvas.width,t.canvas.height):(t.fillStyle=$s(e,n[r]),t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.restore())}return s}},Rg=(t,e,n)=>{if(n.restore){t.restore();return}const s=n.edits,r=e.attribs;for(let i=s.length;i-- >0;){const o=s[i],a=r[o];Wc(t,e,o,Yc[o],a??wg[o])}},Do=(t,e,n)=>{!t.grads&&(t.grads={}),t.grads[e]=n},Wc=(t,e,n,s,r)=>{switch(n){case"fill":case"stroke":case"shadowColor":t[s]=$s(e,r);break;case"dash":t[s].call(t,r);break;case"clip":case"fillRule":break;default:t[s]=r}},Sg=(t,e)=>{let n;return(n=e.transform)||e.setTransform||e.translate||e.scale||e.rotate?(t.save(),n?t.transform(n[0],n[1],n[2],n[3],n[4],n[5]):(n=e.setTransform)?t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]):((n=e.translate)&&t.translate(n[0],n[1]),(n=e.rotate)&&t.rotate(n),(n=e.scale)&&(vs(n)?t.scale(n[0],n[1]):t.scale(n,n))),!0):!1},$t=(t,e,n,s)=>{e.stroke!=="none"&&(t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(s[0],s[1]),t.stroke())},Ar=(t,e,n)=>{if(e.stroke!=="none"){t.beginPath();for(let{0:s,1:r}of n)t.moveTo(s[0],s[1]),t.lineTo(r[0],r[1]);t.stroke()}},wr=(t,e,n,s)=>{let r;(r=e.fill)&&r!=="none"&&No(t,n,s,"fill","fillRect"),(r=e.stroke)&&r!=="none"&&No(t,n,s,"stroke","strokeRect")},No=(t,e,n,s,r)=>{const{start:i=0,cstride:o=1,estride:a=2,size:c=1}=e;let l=e&&e.num!=null?e.num:(n.length-i)/a|0;if(e.shape==="circle")for(let u=i;l-- >0;u+=a)t.beginPath(),t.arc(n[u],n[u+o],c,0,O),t[s]();else{const u=c/2;for(let d=i;l-- >0;d+=a)t[r](n[d]-u,n[d+o]-u,c,c)}},Er=(t,e,n)=>{t.beginPath();let s=[0,0];for(let r=0,i=n.length;r<i;r++){const o=n[r];let a=o[1],c,l;switch(o[0]){case"m":a=[s[0]+a[0],s[1]+a[1]];case"M":t.moveTo(a[0],a[1]),s=a;break;case"l":a=[s[0]+a[0],s[1]+a[1]];case"L":t.lineTo(a[0],a[1]),s=a;break;case"h":a=[s[0]+a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"H":a=[a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"v":a=[s[0],s[1]+a],t.lineTo(a[0],a[1]),s=a;break;case"V":a=[s[0],a],t.lineTo(a[0],a[1]),s=a;break;case"c":c=o[2],l=o[3],l=[s[0]+l[0],s[1]+l[1]],t.bezierCurveTo(s[0]+a[0],s[1]+a[1],s[0]+c[0],s[1]+c[1],l[0],l[1]),s=l;break;case"C":c=o[2],l=o[3],t.bezierCurveTo(a[0],a[1],c[0],c[1],l[0],l[1]),s=l;break;case"q":c=o[2],c=[s[0]+c[0],s[1]+c[1]],t.quadraticCurveTo(s[0]+a[0],s[1]+a[1],c[0],c[1]),s=c;break;case"Q":c=o[2],t.quadraticCurveTo(a[0],a[1],c[0],c[1]),s=c;break;case"A":case"a":{c=o[2],l=o[6],o[0]==="a"&&(l=[s[0]+l[0],s[1]+l[1]]);const{center:[u,d],start:f,end:h}=Hu(s,l,[a,c],o[3],o[4],o[5]);t.ellipse(u,d,a,c,o[3],f,h,!o[5]),s=l;break}case"r":c=o[2],c=[s[0]+c[0],s[1]+c[1]],t.arcTo(s[0]+a[0],s[1]+a[1],c[0],c[1],o[3]),s=c;break;case"R":c=o[2],t.arcTo(a[0],a[1],c[0],c[1],o[3]),s=c;break;case"z":case"Z":t.closePath()}}Xt(t,e)},Rr=(t,e,n,s)=>{let r;(r=e.fill)&&r!=="none"&&$o(t,n,s,"fill","fillRect"),(r=e.stroke)&&r!=="none"&&$o(t,n,s,"stroke","strokeRect")},$o=(t,e,n,s,r)=>{const i=e?.size||1;if(e.shape==="circle")for(let o of n)t.beginPath(),t.arc(o[0],o[1],i,0,O),t[s]();else{const o=i/2;for(let a of n)t[r](a[0]-o,a[1]-o,i,i)}},Sr=(t,e,n)=>{n.length<2||(jc(t,n),t.closePath(),Xt(t,e))},Ir=(t,e,n,s)=>{s.length<2||(xc(t,n,s),t.closePath(),Xt(t,e))},jc=(t,e)=>{let n=e[0];t.beginPath(),t.moveTo(n[0],n[1]);for(let s=1,r=e.length;s<r;s++)n=e[s],t.lineTo(n[0],n[1])},xc=(t,e,n)=>{const{start:s=0,cstride:r=1,estride:i=2}=e;let o=e?.num??(n.length-s)/i|0;t.beginPath(),t.moveTo(n[s],n[s+r]);for(let a=s+i;o-- >1;a+=i)t.lineTo(n[a],n[a+r])},Mr=(t,e,n)=>{n.length<2||e.stroke=="none"||(jc(t,n),Xt(t,e,!1))},Dr=(t,e,n,s)=>{s.length<2||(xc(t,n,s),Xt(t,e,!1))},Nr=(t,e,n,s,r,i)=>{let o;if(i!==void 0){t.beginPath(),t.roundRect(n[0],n[1],s,r,i),Xt(t,e);return}(o=e.fill)&&o!=="none"&&t.fillRect(n[0],n[1],s,r),(o=e.stroke)&&o!=="none"&&t.strokeRect(n[0],n[1],s,r)},Xc=(t,e,n,s,r)=>{let i;(i=e.fill)&&i!=="none"&&t.fillText(s.toString(),n[0],n[1],r),(i=e.stroke)&&i!=="none"&&t.strokeText(s.toString(),n[0],n[1],r)},Sn=(t,e,n={attribs:{},edits:[]})=>{if(!e)return;if(ct(e,"toHiccup")){Sn(t,e.toHiccup(),n);return}if(I(e[0])){for(let o of e)Sn(t,o,n);return}const s=e[1];if(s?.__skip)return;const r=Eg(t,n,s),i=r?r.attribs:n.attribs;switch(e[0]){case"g":case"defs":Ig(t,r,n,e);break;case"linearGradient":Do(n,s.id,Hc(t,s,e[2]));break;case"radialGradient":Do(n,s.id,qc(t,s,e[2]));break;case"points":Rr(t,i,s,e[2]);break;case"packedPoints":wr(t,i,s,e[2]);break;case"line":$t(t,i,e[2],e[3]);break;case"lines":Ar(t,i,e[2]);break;case"hline":$t(t,i,[-1e6,e[2]],[1e6,e[2]]);break;case"vline":$t(t,i,[e[2],-1e6],[e[2],1e6]);break;case"polyline":Mr(t,i,e[2]);break;case"packedPolyline":Dr(t,i,s,e[2]);break;case"polygon":Sr(t,i,e[2]);break;case"packedPolygon":Ir(t,i,s,e[2]);break;case"path":Er(t,i,e[2]);break;case"rect":Nr(t,i,e[2],e[3],e[4],e[5]??s?.r);break;case"circle":case"arc":yr(t,i,e[2],e[3],e[4],e[5],e[6]);break;case"ellipse":vr(t,i,e[2],e[3],e[4],e[5],e[6],e[7]);break;case"text":Xc(t,i,e[2],e[3],e[4]);break;case"img":Vc(t,i,s,e[2],e[3],e[4],e[5])}r&&Rg(t,n,r)},Ig=(t,e,n,s)=>{const r=s.length,i=s[0]==="g"&&e||n;for(let o=2;o<r;o++)Sn(t,s[o],i)},Mg={align:"left",alpha:1,baseline:"alphabetic",compose:"source-over",dash:[],dashOffset:0,direction:"inherit",fill:"#000",filter:"none",font:"10px sans-serif",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",shadowX:0,shadowY:0,smooth:!0,stroke:"#000",weight:1},Zc={align:"textAlign",alpha:"globalAlpha",baseline:"textBaseline",clip:"clip",compose:"globalCompositeOperation",dash:"setLineDash",dashOffset:"lineDashOffset",direction:"direction",fill:"fillStyle",fillRule:"fillRule",filter:"filter",font:"font",lineCap:"lineCap",lineJoin:"lineJoin",miterLimit:"miterLimit",shadowBlur:"shadowBlur",shadowColor:"shadowColor",shadowX:"shadowOffsetX",shadowY:"shadowOffsetY",smooth:"imageSmoothingEnabled",stroke:"strokeStyle",weight:"lineWidth"},Lo=(t,e=!1)=>({attribs:{...t.attribs},grads:{...t.grads},edits:[],restore:e}),Co=(t,e,n)=>{let s;if(n){Dg(t,n)&&(s=Lo(e,!0));for(let r in n){const i=Zc[r];if(i){const o=n[r];o!=null&&e.attribs[r]!==o&&(!s&&(s=Lo(e)),s.attribs[r]=o,s.edits.push(r),Jc(t,e,r,i,o))}else(r==="__background"||r==="__clear")&&(t.save(),t.resetTransform(),r==="__clear"?n[r]&&t.clearRect(0,0,t.canvas.width,t.canvas.height):(t.fillStyle=$s(e,n[r]),t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.restore())}return s}},Oo=(t,e,n)=>{if(n.restore){t.restore();return}const s=n.edits,r=e.attribs;for(let i=s.length;i-- >0;){const o=s[i],a=r[o];Jc(t,e,o,Zc[o],a??Mg[o])}},To=(t,e,n)=>{!t.grads&&(t.grads={}),t.grads[e]=n},Jc=(t,e,n,s,r)=>{switch(n){case"fill":case"stroke":case"shadowColor":t[s]=$s(e,r);break;case"dash":t[s].call(t,r);break;case"clip":case"fillRule":break;default:t[s]=r}},Dg=(t,e)=>{let n;return(n=e.transform)||e.setTransform||e.translate||e.scale||e.rotate?(t.save(),n?t.transform(n[0],n[1],n[2],n[3],n[4],n[5]):(n=e.setTransform)?t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]):((n=e.translate)&&t.translate(n[0],n[1]),(n=e.rotate)&&t.rotate(n),(n=e.scale)&&(vs(n)?t.scale(n[0],n[1]):t.scale(n,n))),!0):!1};function ko(t){const e=Math.max(0,Math.min(1,t)),n=Math.floor(e*16777215),s=(n>>16&255)/255,r=(n>>8&255)/255,i=(n&255)/255;return[s,r,i,1]}class Ng{constructor(e,n,s,r=Cn.RGBA32F,i=!1){this.gl=e;const o=mi(n);this.canvasTex=De(this.gl),this.backgroundTex=De(this.gl),this.fadeAmount=n.fadeAmount||0,this.uvOffset=[0,0],this.pipeline=yc({gl:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,textures:{curr:{format:r},next:{format:r},canvasTex:{},backgroundTex:{}},passes:[{model:ui({uv:!0}),..._c,fs:`
                    #define saturate(a) clamp( a, 0.0, 1.0 )

                    vec3 srgbToLinear(vec3 srgb) {
                        return pow(srgb, vec3(2.2));  // Approximate gamma correction
                    }

                    float luminance(vec3 color) {
                        return dot(color, vec3(0.299, 0.587, 0.114));
                    }

                    // Normalized version: maps from [0, 1] to [min, max]
                    float mapFromNormalized(float value, float min, float max) {
                        return min + value * (max - min);
                    }
                    
                    void main() {
                        vec4 src = texture(input0, v_uv );
                        src.rgb = srgbToLinear(src.rgb);
                        vec4 background = texture(input2, v_uv );
                        background.rgb = srgbToLinear(background.rgb);
                        vec4 c = src;
                        ${i?"":`
                        if (src.a > 0.00001) {
                            
                            c = matrix * src + offset;

                        } 
                        `}

                        // read previous frame
                        vec4 prev = texture(input1, v_uv / uvScale + uvOffset);
                        // fade it
                        // compute background luminance
                        float l = luminance(background.rgb);
                        // compute compensation factor
                        l = mapFromNormalized(l,5.0,0.5);
                        prev.a *= pow(0.95, fadeAmount * l);
                        
                        // alpha blend canvas and prev
                        output0 = vec4( c.rgb * c.a + (1.0-c.a) * prev.rgb, max(c.a, prev.a));
                    }`,inputs:["canvasTex","curr","backgroundTex"],outputs:["next"],uniforms:{canvasTex:"sampler2D",backgroundTex:"sampler2D",curr:"sampler2D",fadeAmount:["float",this.fadeAmount],fadeColor:["vec4",new Float32Array(ie(null,gi(s)))],matrix:["mat4",new Float32Array([o[0],o[5],o[10],o[15],o[1],o[6],o[11],o[16],o[2],o[7],o[12],o[17],o[3],o[8],o[13],o[18]])],offset:["vec4",[o[4],o[9],o[14],o[19]]],uvScale:["vec2",[1,1]],uvOffset:["vec2",[0,0]]},state:{blend:!1,blendFn:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEq:e.FUNC_ADD}},vc(["next"],["curr"]),{fs:`
                    vec3 linearToSrgb(vec3 linear) {
                        return pow(linear, vec3(1.0/2.2));
                    }

                    vec3 srgbToLinear(vec3 srgb) {
                        return pow(srgb, vec3(2.2));  // Approximate gamma correction
                    }
                    
                    void main() {
                      
                      vec4 l = texelFetch(input0, ivec2(gl_FragCoord.xy), 0);
                      vec4 b = texelFetch(input1, ivec2(gl_FragCoord.xy), 0); // background
                      b.rgb = srgbToLinear(b.rgb);
                    
                      // alpha compose background and current frame
                      vec3 final = l.a * l.rgb + (1.0 - l.a) * b.rgb;
                      fragColor = vec4(linearToSrgb(final), 1.0); }`,inputs:["curr","backgroundTex"],outputs:[]}]})}pipeline;canvasTex;backgroundTex;fadeAmount;uvOffset;updateImage(e,n){this.pipeline.textures.canvasTex.configure({image:e,width:e.width,height:e.height,flip:!0}),this.pipeline.textures.backgroundTex.configure({image:n,width:n.width,height:n.height,flip:!0})}draw(e,n,s,r){r!==void 0&&(this.fadeAmount=r,this.pipeline.models[0].uniforms.fadeAmount=this.fadeAmount,this.pipeline.models[0].uniforms.uvOffset=this.uvOffset),this.updateImage(e,n),this.pipeline.update()}}class $g{constructor(e,n,s,r=Cn.RGBA32F,i=!1){this.gl=e;const o=mi(n);this.canvasTex=De(this.gl),this.alphaTex=De(this.gl),this.backgroundTex=De(this.gl),this.fadeAmount=n.fadeAmount||0,this.alphaBoost=s||1,this.pipeline=yc({gl:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,textures:{curr:{format:r},next:{format:r},canvasTex:{},alphaTex:{},backgroundTex:{}},passes:[{model:ui({uv:!0}),..._c,fs:`
                    #define saturate(a) clamp( a, 0.0, 1.0 )

                    vec3 srgbToLinear(vec3 srgb) {
                        return pow(srgb, vec3(2.2));  // Approximate gamma correction
                    }

                    float decodeAlpha(vec3 rgb) {
                        return dot(rgb, vec3(1.0, 1.0/256.0, 1.0/65536.0));
                    }

                    float mapFromNormalized(float value, float min, float max) {
                        return min + value * (max - min);
                    }

                    float luminance(vec3 color) {
                        return dot(color, vec3(0.299, 0.587, 0.114));
                    }
                    
                    void main() {
                        vec4 src = texture(input0, v_uv / uvScale + uvOffset );
                        src.rgb = srgbToLinear(src.rgb);
                        float alpha = min(alphaBoost * src.a * decodeAlpha(texture(input3, v_uv / uvScale + uvOffset).rgb), 1.0);
                        vec4 background = texture(input2, v_uv / uvScale + uvOffset );
                        background.rgb = srgbToLinear(background.rgb);
                        vec4 c = src;
                      ${i?"":`
                        if (alpha > 0.00001) {
                            
                            c = matrix * src + offset;

                        } 
                        `}
                        // read previous frame
                        vec4 prev = texture(input1, v_uv);
                        // fade it
                        // compute background luminance
                        float l = luminance(background.rgb);
                        // compute compensation factor
                        l = mapFromNormalized(l,5.0,0.5);
                        prev.a *= pow(0.95, fadeAmount * l);
                        
                        // alpha blend canvas and prev
                        output0 = vec4( c.rgb * alpha + (1.0-alpha) * prev.rgb, max(alpha, prev.a));
                    }`,inputs:["canvasTex","curr","backgroundTex","alphaTex"],outputs:["next"],uniforms:{canvasTex:"sampler2D",backgroundTex:"sampler2D",alphaTex:"sampler2D",curr:"sampler2D",fadeAmount:["float",this.fadeAmount],alphaBoost:["float",this.alphaBoost],matrix:["mat4",new Float32Array([o[0],o[5],o[10],o[15],o[1],o[6],o[11],o[16],o[2],o[7],o[12],o[17],o[3],o[8],o[13],o[18]])],offset:["vec4",[o[4],o[9],o[14],o[19]]],uvScale:["vec2",[1,1]],uvOffset:["vec2",[0,0]]},state:{blend:!1,blendFn:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEq:e.FUNC_ADD}},vc(["next"],["curr"]),{fs:`
                    vec3 linearToSrgb(vec3 linear) {
                        return pow(linear, vec3(1.0/2.2));
                    }

                    vec3 srgbToLinear(vec3 srgb) {
                        return pow(srgb, vec3(2.2));  // Approximate gamma correction
                    }
                        
                    void main() {
                      
                      vec4 l = texelFetch(input0, ivec2(gl_FragCoord.xy), 0);
                      vec4 b = texelFetch(input1, ivec2(gl_FragCoord.xy), 0); // background
                      b.rgb = srgbToLinear(b.rgb);
                    
                      // alpha compose background and current frame
                      vec3 final = l.a * l.rgb + (1.0 - l.a) * b.rgb;
                      fragColor = vec4(linearToSrgb(final), 1.0); }`,inputs:["curr","backgroundTex"],outputs:[]}]})}pipeline;canvasTex;alphaTex;backgroundTex;fadeAmount;alphaBoost;updateImage(e,n,s){this.pipeline.textures.canvasTex.configure({image:e,width:e.width,height:e.height,flip:!0}),this.pipeline.textures.alphaTex.configure({image:s,width:s.width,height:s.height,flip:!0}),this.pipeline.textures.backgroundTex.configure({image:n,width:n.width,height:n.height,flip:!0})}draw(e,n,s,r,i){i!==void 0&&(this.fadeAmount=i,this.pipeline.models[0].uniforms.fadeAmount=this.fadeAmount),this.updateImage(e,n,s),this.pipeline.update()}}const Lg=(t,e)=>{t.useWebGL||_g(e,e.postprocess);const n={drawCanvas:Me(t.width,t.height,document.body,t.useDisplayP3?{ctx:{colorSpace:"display-p3"}}:{}),useWebGL:t.useWebGL,useSeparateAlpha:t.useWebGL&&t.useSeparateAlpha};return t.useWebGL&&(n.backgroundCanvas=Me(t.width,t.height,document.body,t.useDisplayP3?{ctx:{colorSpace:"display-p3"}}:{}),n.canvas=O1({width:t.width,height:t.height,parent:document.body,version:2,autoScale:!1,opts:{preserveDrawingBuffer:!0}}),"drawingBufferColorSpace"in n.canvas.gl&&t.useDisplayP3&&(n.canvas.gl.drawingBufferColorSpace="display-p3"),n.drawCanvas.canvas.style.display="none",n.backgroundCanvas.canvas.style.display="none",t.useSeparateAlpha?(n.alphaCanvas=Me(t.width,t.height,document.body),n.alphaCanvas.canvas.style.display="none",n.webGLPipe=new $g(n.canvas.gl,e.postprocess,1.2,t.textureFormat,t.disablePostprocesing)):n.webGLPipe=new Ng(n.canvas.gl,e.postprocess,e.colors.bg[0],t.textureFormat,t.disablePostprocesing)),n},Cg=(t,e,n)=>{t.drawCanvas.canvas.width=e,t.drawCanvas.canvas.height=n,t.useWebGL&&(t.backgroundCanvas.canvas.width=e,t.backgroundCanvas.canvas.height=n,t.canvas.canvas.width=e,t.canvas.canvas.height=n,t.useSeparateAlpha&&(t.alphaCanvas.canvas.width=e,t.alphaCanvas.canvas.height=n))},Kc=t=>t.useWebGL?t.canvas.canvas:t.drawCanvas.canvas,Og=(t,e)=>{Sn(t.useWebGL?t.backgroundCanvas.canvas.getContext("2d"):t.drawCanvas.canvas.getContext("2d"),e)},Tg=(t,e,n,s)=>{t.useWebGL&&(t.drawCanvas.ctx.clearRect(0,0,t.drawCanvas.canvas.width,t.drawCanvas.canvas.height),t.useSeparateAlpha&&t.alphaCanvas.ctx.clearRect(0,0,t.alphaCanvas.canvas.width,t.alphaCanvas.canvas.height)),t.useSeparateAlpha?ps(t.drawCanvas.canvas.getContext("2d"),t.alphaCanvas.canvas.getContext("2d"),e):Sn(t.drawCanvas.canvas.getContext("2d"),e),t.useWebGL&&(t.useSeparateAlpha?t.webGLPipe.draw(t.drawCanvas.canvas,t.backgroundCanvas.canvas,t.alphaCanvas.canvas,n,s):t.webGLPipe.draw(t.drawCanvas.canvas,t.backgroundCanvas.canvas,n,s))},ps=(t,e,n,s={attribs:{},edits:[]},r={attribs:{},edits:[]})=>{if(!n)return;if(ct(n,"toHiccup")){ps(t,e,n.toHiccup(),s,r);return}if(I(n[0])){for(let u of n)ps(t,e,u,s,r);return}const i=n[1];if(i?.__skip)return;const o=Co(t,s,L(i)),a=Co(e,r,C(i)),c=o?o.attribs:s.attribs,l=a?a.attribs:r.attribs;switch(n[0]){case"g":case"defs":kg(t,e,o,s,a,r,n);break;case"linearGradient":To(s,i.id,Hc(t,i,n[2]));break;case"radialGradient":To(s,i.id,qc(t,i,n[2]));break;case"points":Rr(t,L(c),L(i),n[2]),Rr(e,C(l),C(i),n[2]);break;case"packedPoints":wr(t,L(c),L(i),n[2]),wr(e,C(l),C(i),n[2]);break;case"line":$t(e,C(l),n[2],n[3]),$t(t,L(c),n[2],n[3]);break;case"lines":Ar(t,L(c),n[2]),Ar(e,C(l),n[2]);break;case"hline":$t(t,L(c),[-1e6,n[2]],[1e6,n[2]]),$t(e,C(l),[-1e6,n[2]],[1e6,n[2]]);break;case"vline":$t(t,L(c),[n[2],-1e6],[n[2],1e6]),$t(e,C(l),[n[2],-1e6],[n[2],1e6]);break;case"polyline":Mr(t,L(c),n[2]),Mr(e,C(l),n[2]);break;case"packedPolyline":Dr(t,L(c),L(i),n[2]),Dr(e,C(l),C(i),n[2]);break;case"polygon":Sr(t,L(c),n[2]),Sr(e,C(l),n[2]);break;case"packedPolygon":Ir(t,L(c),L(i),n[2]),Ir(e,C(l),C(i),n[2]);break;case"path":Er(t,L(c),n[2]),Er(e,C(l),n[2]);break;case"rect":Nr(t,L(c),n[2],n[3],n[4],n[5]??i?.r),Nr(e,C(l),n[2],n[3],n[4],n[5]??i?.r);break;case"circle":case"arc":yr(t,L(c),n[2],n[3],n[4],n[5],n[6]),yr(e,C(l),n[2],n[3],n[4],n[5],n[6]);break;case"ellipse":vr(t,L(c),n[2],n[3],n[4],n[5],n[6],n[7]),vr(e,C(l),n[2],n[3],n[4],n[5],n[6],n[7]);break;case"text":Xc(t,c,n[2],n[3],n[4]);break;case"img":Vc(t,c,i,n[2],n[3],n[4],n[5])}o&&Oo(t,s,o),a&&Oo(e,r,a)},kg=(t,e,n,s,r,i,o)=>{const a=o.length,c=o[0]==="g"&&n||s,l=o[0]==="g"&&r||i;for(let u=2;u<a;u++)ps(t,e,o[u],c,l)},L=t=>{const e={...t};return e.alpha=1,e},C=t=>{const e={...t};return e.stroke&&(e.stroke=ko(t.alpha?t.alpha:1)),t.fill&&(e.fill=ko(t.alpha?t.alpha:1)),e.alpha=1,e},Bg={};var Bo={};const Pg=(t,e,n=!1)=>{const s=typeof global<"u"?global:typeof window<"u"?window:void 0;s&&(n||(typeof process<"u"&&Bo!==void 0?Bo.UMBRELLA_GLOBALS:!Bg))&&(s[t]=e)},bi=t=>I(t)?(t.every(e=>B(e)&&e!==""||v(e))||Qc(t),t):B(t)?t.length>0?bi(t.split(".")):[]:t!=null?[t]:[],Gg=(t,e)=>{if(t==null)return!1;e=bi(e);for(let n=e.length-1,s=0;s<=n;s++){const r=e[s];if(!t.hasOwnProperty(r)||(t=t[r],t==null&&s<n))return!1}return!0},Ug=t=>{const e=bi(t);return I1(e)&&Qc(t),e},Qc=t=>lt(`illegal path: ${JSON.stringify(t)}`);function Fg(t){const e=Ug(t);let[n,s,r,i]=e;switch(e.length){case 0:return(o,a)=>a;case 1:return(o,a)=>o?(o[n]=a,o):void 0;case 2:return(o,a)=>{let c;return o&&(c=o[n])?(c[s]=a,o):void 0};case 3:return(o,a)=>{let c;return o&&(c=o[n])&&(c=c[s])?(c[r]=a,o):void 0};case 4:return(o,a)=>{let c;return o&&(c=o[n])&&(c=c[s])&&(c=c[r])?(c[i]=a,o):void 0};default:return(o,a)=>{let c=o;const l=e.length-1;for(let u=0;u<l;u++)if(!(c=c[e[u]]))return;return c[e[l]]=a,o}}}const tl=(t,e,n)=>Fg(e)(t,n),zg=/^(function\s+\w+)?\s*\(\{([\w\s,:]+)\}/;function Hg(t,e){const n={prefix:"@",unwrap:!0,...e};return Bt(t)?el(t,n):I(t)?nl(t,n):t}const el=(t,e,n,s=[],r={},i=[])=>{n=n||t;for(let o in t)In(n,[...s,o],r,i,e);return!e.unwrap||s.length?t:rl(t,r)},nl=(t,e,n,s=[],r={},i=[])=>{n=n||t;for(let o=0,a=t.length;o<a;o++)In(n,[...s,o],r,i,e);return!e.unwrap||s.length?t:rl(t,r)},In=(t,e,n,s,r)=>{const i=e.join("/");s.indexOf(i)>=0&&lt(`cyclic references not allowed: ${i}`);let[o,a]=sl(t,e);if(!n[i]){if(a)return n[i]=!0,o;let c=Z;s.push(i),Bt(o)?el(o,{...r,unwrap:!1},t,e,n,s):I(o)?nl(o,{...r,unwrap:!1},t,e,n,s):!r.onlyFnRefs&&B(o)&&o.startsWith(r.prefix)?c=In(t,Po(e,o,r.prefix.length),n,s,r):vn(o)?c=Vg(o,l=>In(t,Po(e,l,0),n,s,r),i,n):Gg(t,e)||(o=qg(t,e,n,s,r)),c!==Z&&(tl(t,e,c),o=c),n[i]=!0,s.pop()}return o},qg=(t,e,n,s,r)=>{let i=s.pop(),o;for(let a=1,c=e.length;a<=c;a++)o=In(t,e.slice(0,a),n,s,r);return s.push(i),o},Vg=(t,e,n,s)=>{const r=zg.exec(t.toString());let i;if(r){const o=r[2].replace(/\s|(,\s*$)/g,"").split(/,/g).map(a=>a.split(":")[0]).reduce((a,c)=>(a[c]=e(c),a),{});i=t(o,e)}else i=t(e);return _i(i,n,s),i},_i=(t,e,n)=>{n[e]=!0,Bt(t)?Yg(t,e,n):I(t)&&Wg(t,e,n)},Yg=(t,e,n)=>{let s,r;for(let i in t)s=t[i],r=e+"/"+i,_i(s,r,n)},Wg=(t,e,n)=>{let s,r;for(let i=0,o=t.length;i<o;i++)s=t[i],r=e+"/"+i,_i(s,r,n)},Po=(t,e,n=1)=>{if(e.charAt(n)==="/")return e.substring(n+1).split("/");t=t.slice(0,t.length-1);const s=e.substring(n).split("/");for(let r=0,i=s.length;r<i;r++)if(s[r]==="..")!t.length&&lt(`invalid lookup path: ${e}`),t.pop();else return t.concat(s.slice(r));return!t.length&&lt(`invalid lookup path: ${e}`),t};class Go{constructor(e){this._value=e}deref(){return this._value}}const sl=(t,e)=>{const n=e.length-1;let s=t,r=t instanceof Go;for(let i=0;s!=null&&i<=n;i++)s=s[e[i]],s instanceof Go&&(r=!0,s=s.deref());return[s,r]},rl=(t,e)=>{for(let n in e){const s=n.split("/"),r=sl(t,s);r[1]&&tl(t,s,r[0])}return t},il=(t,e,n)=>{t.attribs.stroke??=n.stroke.get(t,e);const s=n.stroke.update?n.stroke.update(t,e):t.attribs.stroke;t.attribs.weight??=n.weight.get(t,e);const r=n.weight.update?n.weight.update(t,e):t.attribs.weight;t.attribs.alpha??=n.alpha.get(t,e);const i=n.alpha.update?n.alpha.update(t,e):t.attribs.alpha;return{stroke:s,weight:r,alpha:i}},jg=(t,e,n)=>(t.attribs.style??=n.style.get(t,e),n.style.update?{...t.attribs.style,...n.style.update(t,e)}:t.attribs.style),xg=(t,e,n)=>n.map(s=>rg(s,t.pos,[-e.aspectRatio/2,-.5],[e.aspectRatio/2,.5])),Uo=(t,e,n,s,r,i=0,o)=>({ID:t,parent:o,active:!0,pos:e,dir:n,bounds:s,generation:i,history:{positions:[],length:0},supportData:{features:[],distanceToCenter:0,velocity:[0,0]},opts:r,attribs:{},lastDrawnAtLength:0}),Xg=(t,e,n,s)=>{const{pos:r,bounds:i,history:o,opts:a}=t,{step:c,fuzziness:l,maxLength:u}=a;if(t.active){o.positions.push(Tr(r));const d=e(t,s!==void 0?c*s/1e3:c,[l,l]);xt(i,r)&&!n(t)&&o.length<=u?o.length+=d:t.active=!1}return t},Zg=(t,e)=>(n,s)=>{const{pos:r,dir:i}=n,o=Te([],Ur([],i,e.vector_field.get(n,t,[0])),s);return Tt(null,r,o),n.supportData.velocity=o,$n(o)},Jg=(t,e)=>(n,s)=>{const[r,i]=n.pos;return ol(n,t,s,e),le(n.supportData.velocity,n.pos,[r,i]),$n(n.supportData.velocity)},Kg=(t,e)=>(n,s)=>{const{pos:r,dir:i}=n,[o,a]=r;ol(n,t,s,e);const c=Te([],Ur([],i,e.vector_field.get(n,t,[0])),s);return Tt(null,r,c),le(n.supportData.velocity,n.pos,[o,a]),$n(n.supportData.velocity)},Qg=(t,e)=>(t.supportData.features=xg(t,e.preset,e.images),t.supportData.distanceToCenter=$n(t.pos),t),ol=(t,e,n,s)=>{s.domain_warping&&Tt(null,t.pos,ws([],s.domain_warping.get(t,e),n))},tm={warped:Jg,vector_field:Zg,warped_vector_field:Kg},em=(t,e)=>t.active?e>0?t.history.length-t.lastDrawnAtLength>=e:!0:!1;var nm=Object.getOwnPropertyDescriptor,sm=(t,e,n,s)=>{for(var r=s>1?void 0:s?nm(e,n):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(r=o(r)||r);return r};let $r=class{constructor(t,e,n,s,r=void 0,i=(o,a)=>{}){this.space=n,this.rnd=s,this.data=new Array(t*e).fill(r),this.size=[t,e],this.stride=[1,t],this.spaceMin=n.pos,this.spaceMax=tt([],n.pos,n.size),this.freeValue=r;for(let o=0;o<t;o++)for(let a=0;a<e;a++)this.setAtUnsafe(o,a,i(o,a))}size;stride;spaceMin;spaceMax;data=[];freeValue;agents=[];clear(){const[t,e]=this.size;for(let n=0;n<t;n++)for(let s=0;s<e;s++)this.setAtUnsafe(n,s,this.freeValue)}setAgents(t){this.agents=t}fromSpaceToGrid(t){const[e,n]=as([],t,this.spaceMin,this.spaceMax,[0,0],this.size);return[Math.floor(e),Math.floor(n)]}fromGridToSpace(t){return as([],t,[0,0],this.size,this.spaceMin,this.spaceMax)}isFree(t){const e=this.fromSpaceToGrid(t);return this.isCellFree(e[0],e[1])}checkCollision(t,e,n=!1,s=0){const r=this.fromSpaceToGrid(t.pos);return this.isCellFree(r[0],r[1],e,t,s)?(n&&this.setAt(r[0],r[1],t),!1):!0}isCellFree(t,e,n=0,s,r=0){if(this.includes(t,e)){const i=this.getAt(t,e);return i===this.freeValue||s!==void 0&&i===s||i.ID<r}}randomFree(t,e=0){let n=0;for(;n<1e4;){const s=Xi(t,1,this.rnd);if(s&&s.length>0){const r=this.fromSpaceToGrid(s[0]);if(this.isCellFree(Math.floor(r[0]),Math.floor(r[1]),0,void 0,e))return{pos:s[0],agent:void 0};n++}}return{pos:void 0,agent:void 0}}freeLine(t,e,n,s,r,i=!0,o=0){const a=s*Math.min(this.width,this.height),c=Te([],n,1),l=this.fromSpaceToGrid(e);let u=Tt([],l,c),d=this.fromGridToSpace(u),f=0;for(;(!r||xt(r,d))&&(!i||this.isCellFree(Math.floor(u[0]),Math.floor(u[1]),0,t,o))&&f<a;)Tt(null,u,c),d=this.fromGridToSpace(u),f++;return[d[0],d[1]]}randomOccupied(t,e="random point"){let n=0;for(;n<1e4;){if(e==="random point"){const s=Xi(t,1,this.rnd);if(s){const r=this.fromSpaceToGrid(s[0]);if(!this.isCellFree(Math.floor(r[0]),Math.floor(r[1]),0))return{pos:[s[0][0],s[0][1]],agent:this.getAt(Math.floor(r[0]),Math.floor(r[1]))}}}else if(this.agents.length>0){const s=Nt(this.agents,this.agents.map(r=>r.history.length),this.rnd);if(s.history.length>0){const r=A(s.history.positions,this.rnd);if(xt(t,r))return{agent:s,pos:[r[0]+this.rnd.minmax(-.001,.001),r[1]+this.rnd.minmax(-.001,.001)]}}}n++}return{pos:void 0,agent:void 0}}setAtUnsafe(t,e,n){}setAt(t,e,n){}getAt(t,e){}getAtUnsafe(t,e){}includes(t,e){}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}};$r=sm([wc],$r);const rm=(t,e,n=[])=>({preset:t,agents:[],spaceManager:e,images:n,iterations:0,spaceTraveled:0,agentsToCreate:0,iterationSpawnableAgents:0,activeAgents:0}),im=(t,e,n,s)=>{let r,i;if(t.iterations+=1,t.iterations<e.agentFactory.maxIterations&&t.spaceTraveled<e.agentFactory.maxSpaceTraveled||e.agentFactory.neverEnding){const o=h=>t.spaceManager.checkCollision(h,0,!0,t.agents.length-e.agentFactory.maxColliding),a=Ot(Nn(Wt(h=>h.active),H(h=>(Qg(h,t),Xg(h,tm[h.opts.type?h.opts.type:"vector_field"](t,e),o,s)))),oe(),t.agents);i=Ot(Wt(h=>h.active),oe(),a),t.activeAgents=i.length;const c=Ot(Wt(h=>!h.active),oe(),a);t.spaceTraveled=t.agents.reduce((h,g)=>h+g.history.length,0),t.agentsToCreate+=c.length*e.agentFactory.branch+e.agentFactory.newPerIteration,t.iterationSpawnableAgents+=e.agentFactory.maxNewPerIteration,r=Math.min(t.agentsToCreate,t.iterationSpawnableAgents,e.agentFactory.maxActive-i.length),e.agentFactory.neverEnding||(r=Math.min(r,e.agentFactory.maxAgents-t.agents.length)),t.agentsCreated=0;let l=0;const d=e.bounds.get(t).init.map(h=>se(h)),f=d.reduce((h,g)=>h+g,0);for(;t.agentsCreated<r&&l<300;)al(t,e,d,f,n)&&t.agentsCreated++,l++;return t.iterationSpawnableAgents-=t.agentsCreated,!0}return t.iterations>=e.agentFactory.maxIterations&&console.log("max iterations reached"),t.spaceTraveled>=e.agentFactory.maxSpaceTraveled&&console.log("max length reached"),!1},al=(t,e,n,s,r)=>{let i=!1;const o=e.agentFactory.initPolicy(t),a=e.bounds.get(t);if(o==="randomFree"){const c=s>0?Nt(a.init,n,r):A(a.init,r),{pos:l,agent:u}=t.spaceManager.randomFree(c),d=A(e.agentFactory.initialDirections?.length>0?e.agentFactory.initialDirections:e.agentFactory.directions,r);l&&d&&(t.agents.push(Uo(t.agents.length,l,d,A(a.overall,r),e.agent.get(t))),i=!0,t.agentsToCreate--)}else if(o==="randomOccupied"){const{pos:c,agent:l}=t.spaceManager.randomOccupied(A(a.update,r));c&&l&&(t.agents.push(Uo(t.agents.length,c,A([[l.dir[1],-l.dir[0]],[-l.dir[1],l.dir[0]]],r),l.bounds,e.agent.get(t),l.generation+1,l)),i=!0,t.agentsToCreate--)}return i},om=(t,e,n)=>{const s=[],r=le([],e,t),i=$n(r);let o=n.grains.proportional?Math.floor(i*n.grains.factor):n.grains.factor;const a=1/(o-1);for(let c=0;c<o;c++){let l;n.grains.distribution&&n.grains.distribution==="sin"?l=[t[0]+(e[0]-t[0])*Math.sin(Math.sin(c*a)),t[1]+(e[1]-t[1])*Math.sin(Math.sin(c*a))]:l=z0([],t,e,[c/o,c/o]);let u=n.alpha.min?n.alpha.min:0,d=n.alpha.max===void 0?1:n.alpha.max,f=ft(ne(u,d,n.alpha.decay(1-c/o)),u,d),h=n.color.color;const g=new on([l],{stroke:h,size:n.size,weight:n.shapeAttribs.weight,shape:"circle",alpha:f,fill:n.shapeAttribs.filled?h:void 0});s.push(g)}return s},am=(t,e,n)=>{let s=il(t,e,e.preset),r=jg(t,e,e.preset);const i=[];return r.type.includes("line")&&i.push(cm(t,e)),r.type.includes("sanding")&&i.push(lm(t,e,{...s,...r})),r.type.includes("square")&&i.push(fm(t,e,{...s,...r},n)),r.type.includes("circle")&&i.push(um(t,e,{...s,...r},n)),t.lastDrawnAtLength=t.history.length,he(s,i)},cm=(t,e,n=1)=>b0(t.history.positions.at(-n),t.pos,il(t,e,e.preset)),lm=(t,e,n)=>{const s=[];if(n.type.includes("sanding")){n.color!==void 0&&(n.stroke=n.color);let i=Te([],Ur([],t.supportData.velocity,jn));const o=Fo(t.pos,e.spaceManager.freeLine(t,t.pos,i,n.maxLength*(n.multiplyLengthFactor??1),n.followBounds?t.bounds:void 0,!0,e.agents.length-e.preset.agentFactory.maxColliding),n);if(s.push(...o),n.shadingLength>0){const a=Fo(t.pos,Tt([],t.pos,Te([],[-i[0],-i[1]],n.shadingLength)),{...n,minAlpha:0,stroke:n.shadingColor!==void 0?n.shadingColor:Ne([],Tc(-.8),gi(n.stroke)),grainsFactor:n.grainsFactor});s.push(...a)}}return he(n,s)},Fo=(t,e,n)=>om(t,e,{grains:{factor:n.grainsFactor,proportional:!0,distribution:n.grainsDistribution},alpha:{min:n.minAlpha,max:n.maxAlpha>0?n.maxAlpha:n.alpha,decay:n.alphaDecay,multiplyByImage:void 0,luminanceRange:n.multiplyByImageLuminance?n.multiplyByImageLuminance.range:[0,1]},color:{color:n.stroke,fromImage:n.colorFromImage!==void 0?n.colorFromImage.index:void 0},size:Math.max(1e-4,n.weight*n.sizeFactor),shapeAttribs:{weight:n.weightFactor?n.weightFactor*n.weight:n.weight*.5,filled:!1}}),um=(t,e,n,s)=>{const r=[];return r.push(is(t.pos,Math.min(n.weight,.6),{...n,alpha:.001})),s.probability(0)&&r.push(is(t.pos,s.minmax(.001,.01),{...n,fill:Mc([],fn(A(e.preset.colors.fg,s)),s.minmax(.2,.6))})),he(n,r)},fm=(t,e,n,s)=>{const r=[];return s.probability(5e-4)&&r.push(Ze(t.pos,[s.minmax(.001,.3),s.minmax(.001,.3)],{...n,fill:Mc([],fn(A(e.preset.colors.fg,s)),s.minmax(.2,.6))})),he(n,r)};let $e,yi,nt;addEventListener("beforeunload",t=>{console.log("beforeunload"),yi=[]});const dm=async(t,e,n,s,r)=>{const i=Hg({...t(e,n,s,r)},{onlyFnRefs:!0});return $e={preset:i,iterations:0,presetId:i.name,lineSlice:-1},yi=await eg(i.assets),i.assets.length>0&&console.log("using images "+i.assets.map(o=>o).join(", ")),Pg("state",$e),$e},hm=t=>{const{preset:e}=$e,{gridSize:n,aspectRatio:s}=e;nt=rm(e,new $r(Math.floor(n[0]),Math.floor(n[1]),ue([-s/2,-.5],[s,1]),t.RND,0,(o,a)=>0),yi),window.agents=nt;const r=e.bounds.get(nt).init.map(o=>se(o)),i=r.reduce((o,a)=>o+a,0);for(let o=0;o<e.agentFactory.initialAgents;o++)al(nt,e,r,i,t.RND);return nt.agentsToCreate=0,nt},gm=(t,e)=>{const{preset:n}=$e;return im(nt,n,t.RND,e)},mm=(t,e,n,s=!1,r=!1,i=!1)=>{const{preset:o}=$e,a=s||r,c=nt.preset.agent.get(nt).minSpaceBeforeDrawing||0,l=Ot(Nn(Wt(d=>d.active&&d.history.positions.length>0&&em(d,c)),H(d=>am(d,nt,n))),oe(),nt.agents),u=he({lineCap:"round",lineJoin:"round"},l);return a&&(i||s)&&u.children.unshift(cl(t,d=>d,o.background?.get(nt))),e(u)},cl=(t,e,n,s)=>{const r=[];return s&&r.push(ue(t,{fill:s})),n&&r.push(e(n)),he({lineCap:"round"},r)},pm=(t=!1)=>{const e=document.createElement("div");e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.padding="12px 16px",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.fontFamily="monospace",e.style.fontSize="2vw",e.style.borderRadius="4px",e.style.zIndex="1000",e.style.display=t?"block":"none",e.style.pointerEvents="none",e.style.whiteSpace="pre-line",document.body.appendChild(e);let n=t;return{element:e,isVisible:n,toggle:()=>{n=!n,e.style.display=n?"block":"none"},update:(i,o,a,c)=>{n&&(e.textContent=`Frame: ${i}
        FPS: ${o}
        SpaceTraveled: ${a.spaceTraveled.toFixed(2)}
        Agents: ${a.agents.length}
        ActiveAgents: ${a.activeAgents}
        AgentsCreated: ${a.agentsCreated}
        Preset: ${c.presetId}`)}}};$genart.configure({id:"layer-trippy",allowExternalConfig:!1});await $genart.waitForAdapter();const X=await $genart.setParams({hash:$genart.params.text({name:"Hash",desc:"seed for random",edit:"protected",minLength:64,maxLength:64,default:"                                                                "}),numAgents:$genart.params.range({name:"Max Active Agents",desc:"Max number of active agents",edit:"protected",min:1,max:50,step:1,default:20}),palette:$genart.params.choice({name:"Palette",desc:"Palette",options:Object.keys(Jn)}),vfNumber:$genart.params.range({name:"VF Number",desc:"Vector Fields Number",min:2,max:6,step:1}),mixStrategy:$genart.params.choice({name:"VF Mix Strategy",desc:"Vector Fields Mix Strategy",options:tn}),mixType:$genart.params.choice({name:"VF Mix Type",desc:"Vector Fields Mix Type",options:["linear","hermite"]}),vectorFieldQuantization:$genart.params.choice({name:"VF Quantization",desc:"Vector Fields Quantization",options:["0","2","3","4","5"]}),weight:$genart.params.choice({name:"Line weight style",desc:"Line weight style",options:["0","1","2","3"]}),alpha:$genart.params.choice({name:"Line alpha style",desc:"Line alpha style",options:["0","1","2"]}),scalingFactor:$genart.params.range({name:"scaling factor",desc:"line weight scaling factor",edit:"protected",min:.1,max:10,step:.1,default:1}),speed:$genart.params.range({name:"speed multiplier",desc:"speed multiplier of the drawing system",edit:"protected",min:.1,max:10,step:.1,default:1}),fade:$genart.params.range({name:"fade amount",desc:"amount of fade out of older lines, 0 = no fading",edit:"protected",min:0,max:1,step:.01,default:.1})});$genart.random.reset();let Vt=$genart.random,we=$genart.seed;X("hash").trim()!==""&&(we=X("hash"),lg(we)?Vt=new $genart.prng.SFC32(og(we)):Vt=new $genart.prng.SFC32(cg(we)));const bs={RND:new Kt(Vt.rnd),RND_COLORS:new Kt(Vt.copy().rnd),RND_STYLE:new Kt(Vt.copy().rnd),RND_BOUNDS:new Kt(Vt.copy().rnd),RND_NOISE:new Kt(Vt.copy().rnd),RND_SYSTEM:new Kt(Vt.copy().rnd)};let bm=!0,_m=!1,ym=Cn.RGBA16F,vm=!0,Am=!0,Lr,Cr,re,zo=1*60,wm=!1,Em=-1,Ho=0,Rm=!1,Kn=0,Sm=Qe("hermite",[[0,0],[.5,.5],[.75,10],[1,50]]);const _s=await dm(Ag,bs,$genart.screen.width,$genart.screen.height,{mixStrategy:X("mixStrategy"),quantization:X("vectorFieldQuantization"),interpolation:X("mixType"),vfNumber:X("vfNumber"),palette:X("palette"),weight:X("weight"),alpha:X("alpha"),scalingFactor:X("scalingFactor")}),{preset:en}=_s;console.log(we,en);$genart.on("genart:param-change",({paramID:t,param:e})=>{console.log("param change:",t,e)});$genart.on("genart:resize",({screen:t})=>{console.log("resize",t),ll()});let te,ee,vi;const ll=()=>{({width:te,height:ee}=$genart.screen),Kn=0,re||(re=Lg({useWebGL:bm,width:te,height:ee,useDisplayP3:vm,useSeparateAlpha:_m,textureFormat:ym,disablePostprocesing:Am},en),vi=pm(Rm)),Cg(re,te,ee),Cr=hm(bs),Lr=t=>rr(sr(t,[te/en.aspectRatio,ee]),[te/2,ee/2]),Og(re,cl([te,ee],Lr,en.background?.get(Cr),en.colors.bg[0]))};ll();$genart.setUpdate((t,e)=>{const{preset:n}=_s;Kn++,n.agentFactory.maxActive=X("numAgents");const s=Sm.at(X("fade")),r=Kn%3===0?(n.postprocess.fadeAmount||0)*s:0,i=Math.min(t-Ho,100);Ho=t;let o=!0;if(zo<=0){o=o&&gm(bs,i*X("speed"));const a=o&&mm([te,ee],Lr,bs.RND_STYLE,wm);o&&Tg(re,a,Kn,r),o||console.log("stop")}return zo--,e===0&&$genart.capture(Kc(re)),e===Em&&ul(),vi.update(e,Math.round(1e3/Math.max(i,1)),Cr,_s),o});window.onkeydown=t=>{switch(t.key){case"x":ul();break;case"o":vi.toggle();break}};const ul=()=>{$f(Kc(re),`${_s.presetId}-${we}-${Wf()}`,"png"),console.log("saved to image")};
